<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Automating List Construction for Wildcard Expansion | Reproducible Data Analytic Workflows with Snakemake and R</title>
  <meta name="description" content="In progress" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Automating List Construction for Wildcard Expansion | Reproducible Data Analytic Workflows with Snakemake and R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="In progress" />
  <meta name="github-repo" content="lachlandeer/snakemake-econ-r-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Automating List Construction for Wildcard Expansion | Reproducible Data Analytic Workflows with Snakemake and R" />
  
  <meta name="twitter:description" content="In progress" />
  

<meta name="author" content="Ulrich Bergmann" />
<meta name="author" content="Lachlan Deer" />
<meta name="author" content="Julian Langer" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="automatic-expansion-of-wildcards.html"/>
<link rel="next" href="part-iii-bringing-many-outputs-together.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html">Reproducible Data Analytic Workflows with Snakemake and `R`</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-we-wrote-this-tutorial"><i class="fa fa-check"></i>Why we wrote this tutorial</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#pre-requisite-knowledge"><i class="fa fa-check"></i>Pre-requisite Knowledge</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-needs-to-be-downloaded-installed-for-this-tutorial"><i class="fa fa-check"></i>What Needs to be Downloaded &amp; Installed for this Tutorial</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#template-scripts-and-documents"><i class="fa fa-check"></i>Template Scripts and Documents</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-installation"><i class="fa fa-check"></i>Software Installation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-we-cant-cover"><i class="fa fa-check"></i>What We Can’t Cover</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the Authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#instructional-material"><i class="fa fa-check"></i>Instructional material</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software"><i class="fa fa-check"></i>Software</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#citation"><i class="fa fa-check"></i>Citation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="part-0-preliminaries.html"><a href="part-0-preliminaries.html"><i class="fa fa-check"></i>PART 0 - Preliminaries</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Motivating &amp; Rationale</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#a-case-for-reproducibility"><i class="fa fa-check"></i><b>1.1</b> A Case for Reproducibility</a><ul>
<li class="chapter" data-level="1.1.1" data-path="intro.html"><a href="intro.html#how-far-to-go-in-the-quest-for-reproducibility"><i class="fa fa-check"></i><b>1.1.1</b> How far to go in the quest for reproducibility?</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#what-is-snakemake-why-should-you-use-it"><i class="fa fa-check"></i><b>1.2</b> What is <code>Snakemake</code> &amp; Why Should you use it?</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#why-r"><i class="fa fa-check"></i><b>1.3</b> Why <code>R</code>?</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#working-example-replicating-mankiw-romer-and-weils-1992-qje"><i class="fa fa-check"></i><b>1.4</b> Working Example: Replicating Mankiw, Romer and Weil’s 1992 QJE</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#the-way-forward"><i class="fa fa-check"></i><b>1.5</b> The way forward</a><ul>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#exercise-your-own-projects-steps"><i class="fa fa-check"></i>Exercise: Your own project’s steps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="project-organization.html"><a href="project-organization.html"><i class="fa fa-check"></i><b>2</b> Project Organization</a><ul>
<li class="chapter" data-level="" data-path="project-organization.html"><a href="project-organization.html#learning-objectives"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="2.1" data-path="project-organization.html"><a href="project-organization.html#subtitle-tbd"><i class="fa fa-check"></i><b>2.1</b> Subtitle TBD</a></li>
<li class="chapter" data-level="2.2" data-path="project-organization.html"><a href="project-organization.html#project-organization-i-separating-inputs-and-outputs"><i class="fa fa-check"></i><b>2.2</b> Project Organization I: Separating Inputs and Outputs</a></li>
<li class="chapter" data-level="2.3" data-path="project-organization.html"><a href="project-organization.html#project-structure-ii-separating-logical-chunks-of-the-project"><i class="fa fa-check"></i><b>2.3</b> Project Structure II: Separating Logical Chunks of the Project</a><ul>
<li class="chapter" data-level="2.3.1" data-path="project-organization.html"><a href="project-organization.html#aside-even-deeper-sub-folders"><i class="fa fa-check"></i><b>2.3.1</b> Aside: Even Deeper Sub-folders</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="project-organization.html"><a href="project-organization.html#project-structure-iii-separating-input-parameters-from-code"><i class="fa fa-check"></i><b>2.4</b> Project Structure III: Separating Input Parameters from Code</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="part-i-basic-snakemake-workflows.html"><a href="part-i-basic-snakemake-workflows.html"><i class="fa fa-check"></i>PART I - Basic Snakemake Workflows</a></li>
<li class="chapter" data-level="3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html"><i class="fa fa-check"></i><b>3</b> Initial Steps with Snakemake</a><ul>
<li class="chapter" data-level="3.1" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#snakefile-writing-our-first-rule"><i class="fa fa-check"></i><b>3.1</b> Snakefile – Writing Our First Rule</a></li>
<li class="chapter" data-level="3.2" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#the-snakemake-command-executing-a-rule"><i class="fa fa-check"></i><b>3.2</b> The Snakemake Command – Executing a Rule</a></li>
<li class="chapter" data-level="3.3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#reading-and-writing-files-first-steps-in-a-data-science-pipeline"><i class="fa fa-check"></i><b>3.3</b> Reading and Writing Files – First Steps in a Data Science Pipeline</a><ul>
<li class="chapter" data-level="3.3.1" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#using-the-rscript-command-to-execute-r-scripts"><i class="fa fa-check"></i><b>3.3.1</b> Using the Rscript command to execute R scripts</a></li>
<li class="chapter" data-level="3.3.2" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#the-input-and-output-arguments"><i class="fa fa-check"></i><b>3.3.2</b> The input and output arguments</a></li>
<li class="chapter" data-level="3.3.3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#a-rule-to-rename-variables."><i class="fa fa-check"></i><b>3.3.3</b> A rule to rename variables.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#redundant-executions-dont-run-a-rule-repeatedly"><i class="fa fa-check"></i><b>3.4</b> Redundant Executions – (Don’t) Run a Rule Repeatedly</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html"><i class="fa fa-check"></i><b>4</b> Working With Multiple Rules</a><ul>
<li class="chapter" data-level="4.1" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#creating-a-second-rule"><i class="fa fa-check"></i><b>4.1</b> Creating a second rule</a><ul>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#exercise-creating-rules"><i class="fa fa-check"></i>Exercise: Creating Rules</a></li>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#solution"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#clean-rules"><i class="fa fa-check"></i><b>4.2</b> Clean Rules</a><ul>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#exercise-creating-cleaning-rules"><i class="fa fa-check"></i>Exercise: Creating Cleaning Rules</a></li>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#solution-1"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="target-rules.html"><a href="target-rules.html"><i class="fa fa-check"></i><b>5</b> Target Rules</a><ul>
<li class="chapter" data-level="5.1" data-path="target-rules.html"><a href="target-rules.html#where-we-are-now"><i class="fa fa-check"></i><b>5.1</b> Where we are now?</a></li>
<li class="chapter" data-level="5.2" data-path="target-rules.html"><a href="target-rules.html#how-snakemake-determines-the-build-order-when-multiple-rules-are-present"><i class="fa fa-check"></i><b>5.2</b> How Snakemake determines the build order when multiple rules are present</a></li>
<li class="chapter" data-level="5.3" data-path="target-rules.html"><a href="target-rules.html#dedicated-target-rules-to-execute-multiple-rules"><i class="fa fa-check"></i><b>5.3</b> Dedicated target rules to execute multiple rules</a><ul>
<li class="chapter" data-level="" data-path="target-rules.html"><a href="target-rules.html#exercise-using-target-rules"><i class="fa fa-check"></i>Exercise: Using target rules</a></li>
<li class="chapter" data-level="" data-path="target-rules.html"><a href="target-rules.html#solution-2"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="target-rules.html"><a href="target-rules.html#target-rules-can-do-more-for-us"><i class="fa fa-check"></i><b>5.4</b> Target rules can do more for us</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="part-ii-minimizing-repetition-maximizing-generalizability.html"><a href="part-ii-minimizing-repetition-maximizing-generalizability.html"><i class="fa fa-check"></i>PART II - Minimizing Repetition, Maximizing Generalizability</a></li>
<li class="chapter" data-level="6" data-path="wildcards.html"><a href="wildcards.html"><i class="fa fa-check"></i><b>6</b> Wildcards</a><ul>
<li class="chapter" data-level="6.1" data-path="wildcards.html"><a href="wildcards.html#the-starting-point-of-our-snakefile"><i class="fa fa-check"></i><b>6.1</b> The starting point of our Snakefile</a></li>
<li class="chapter" data-level="6.2" data-path="wildcards.html"><a href="wildcards.html#using-wildcards-to-tidy-up-our-code"><i class="fa fa-check"></i><b>6.2</b> Using wildcards to tidy up our code</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html"><i class="fa fa-check"></i><b>7</b> Automatic Expansion of Wildcards</a><ul>
<li class="chapter" data-level="7.1" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#learning-goals"><i class="fa fa-check"></i><b>7.1</b> Learning Goals</a></li>
<li class="chapter" data-level="7.2" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#the-expand-function"><i class="fa fa-check"></i><b>7.2</b> The <code>expand()</code> function</a><ul>
<li class="chapter" data-level="" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#exercise-exploring-the-expand-function-i"><i class="fa fa-check"></i>Exercise: Exploring the expand function I</a></li>
<li class="chapter" data-level="7.2.1" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#solution-3"><i class="fa fa-check"></i><b>7.2.1</b> SOLUTION:</a></li>
<li class="chapter" data-level="" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#exercise-exploring-the-expand-function-ii"><i class="fa fa-check"></i>Exercise: Exploring the expand() function II</a></li>
<li class="chapter" data-level="7.2.2" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#solution-4"><i class="fa fa-check"></i><b>7.2.2</b> Solution</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#expanding-multiple-wildcards"><i class="fa fa-check"></i><b>7.3</b> Expanding Multiple Wildcards</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html"><i class="fa fa-check"></i><b>8</b> Automating List Construction for Wildcard Expansion</a><ul>
<li class="chapter" data-level="8.1" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#learning-objectives-1"><i class="fa fa-check"></i><b>8.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="8.2" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#state-of-the-snakefile"><i class="fa fa-check"></i><b>8.2</b> State of the Snakefile</a></li>
<li class="chapter" data-level="8.3" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#the-glob_wildcards-function"><i class="fa fa-check"></i><b>8.3</b> The <code>glob_wildcards</code> Function</a></li>
<li class="chapter" data-level="8.4" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#looking-at-the-dag-redux"><i class="fa fa-check"></i><b>8.4</b> Looking at the DAG (redux)</a><ul>
<li class="chapter" data-level="" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#exercise-exploring-glob_wildcards"><i class="fa fa-check"></i>Exercise: Exploring glob_wildcards()</a></li>
<li class="chapter" data-level="8.4.1" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#solution-5"><i class="fa fa-check"></i><b>8.4.1</b> Solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="part-iii-bringing-many-outputs-together.html"><a href="part-iii-bringing-many-outputs-together.html"><i class="fa fa-check"></i>PART III - Bringing Many Outputs Together</a></li>
<li class="chapter" data-level="9" data-path="make-tables.html"><a href="make-tables.html"><i class="fa fa-check"></i><b>9</b> Make Tables</a><ul>
<li class="chapter" data-level="9.1" data-path="make-tables.html"><a href="make-tables.html#the-state-of-the-snakefile"><i class="fa fa-check"></i><b>9.1</b> The State of the Snakefile</a></li>
<li class="chapter" data-level="9.2" data-path="make-tables.html"><a href="make-tables.html#building-a-single-table"><i class="fa fa-check"></i><b>9.2</b> Building a single table</a></li>
<li class="chapter" data-level="9.3" data-path="make-tables.html"><a href="make-tables.html#building-all-tables-at-once"><i class="fa fa-check"></i><b>9.3</b> Building all tables at once</a><ul>
<li class="chapter" data-level="" data-path="make-tables.html"><a href="make-tables.html#exercise"><i class="fa fa-check"></i>Exercise</a></li>
<li class="chapter" data-level="" data-path="make-tables.html"><a href="make-tables.html#solution-6"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html"><i class="fa fa-check"></i><b>10</b> One rule to rule them all</a><ul>
<li class="chapter" data-level="10.1" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#the-state-of-the-snakefile-1"><i class="fa fa-check"></i><b>10.1</b> The State of the Snakefile</a></li>
<li class="chapter" data-level="10.2" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#creating-an-all-target-rule"><i class="fa fa-check"></i><b>10.2</b> Creating an <code>all</code> target rule</a></li>
<li class="chapter" data-level="10.3" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#concluding-remarks"><i class="fa fa-check"></i><b>10.3</b> Concluding Remarks</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html"><i class="fa fa-check"></i><b>11</b> Adding Papers and Slides to a Snakemake Workflow</a><ul>
<li class="chapter" data-level="11.1" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#learning-objectives-2"><i class="fa fa-check"></i><b>11.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="11.2" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#state-of-our-snakefile"><i class="fa fa-check"></i><b>11.2</b> State of Our Snakefile</a></li>
<li class="chapter" data-level="11.3" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#where-we-are"><i class="fa fa-check"></i><b>11.3</b> Where We Are</a></li>
<li class="chapter" data-level="11.4" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#building-a-paper"><i class="fa fa-check"></i><b>11.4</b> Building a Paper</a></li>
<li class="chapter" data-level="11.5" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#integrating-build_paper-output-into-all"><i class="fa fa-check"></i><b>11.5</b> Integrating <code>build_paper</code> output into <code>all</code></a></li>
<li class="chapter" data-level="11.6" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#making-paper.pdf-easier-to-find"><i class="fa fa-check"></i><b>11.6</b> Making <code>paper.pdf</code> Easier to Find</a><ul>
<li class="chapter" data-level="11.6.1" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#exercise-adding-a-slide-deck."><i class="fa fa-check"></i><b>11.6.1</b> Exercise: Adding a Slide Deck.</a></li>
<li class="chapter" data-level="11.6.2" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#exercise-solution"><i class="fa fa-check"></i><b>11.6.2</b> Exercise Solution</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#final-thoughts"><i class="fa fa-check"></i><b>11.7</b> Final Thoughts</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="part-iv-decorating-snakemake-workflows.html"><a href="part-iv-decorating-snakemake-workflows.html"><i class="fa fa-check"></i>PART IV - Decorating Snakemake Workflows</a></li>
<li class="chapter" data-level="12" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html"><i class="fa fa-check"></i><b>12</b> Logging Output and Errors</a><ul>
<li class="chapter" data-level="12.1" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#logging-output"><i class="fa fa-check"></i><b>12.1</b> Logging Output</a></li>
<li class="chapter" data-level="12.2" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#logging-output-and-errors-in-one-file"><i class="fa fa-check"></i><b>12.2</b> Logging Output and Errors in One File</a><ul>
<li class="chapter" data-level="" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#exercise-logging-all-r-scripts"><i class="fa fa-check"></i>Exercise: Logging all R Scripts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="adding-parameters.html"><a href="adding-parameters.html"><i class="fa fa-check"></i><b>13</b> Adding Parameters</a><ul>
<li class="chapter" data-level="13.1" data-path="adding-parameters.html"><a href="adding-parameters.html#motivating-example-constructing-a-regression-table-from-ols-results"><i class="fa fa-check"></i><b>13.1</b> Motivating Example: Constructing a Regression Table from OLS Results</a></li>
<li class="chapter" data-level="13.2" data-path="adding-parameters.html"><a href="adding-parameters.html#creating-a-rule-with-params"><i class="fa fa-check"></i><b>13.2</b> Creating a Rule with <code>params</code></a><ul>
<li class="chapter" data-level="" data-path="adding-parameters.html"><a href="adding-parameters.html#exercise-building-table-2"><i class="fa fa-check"></i>Exercise: Building Table 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="config-files.html"><a href="config-files.html"><i class="fa fa-check"></i><b>14</b> Config Files</a><ul>
<li class="chapter" data-level="14.1" data-path="config-files.html"><a href="config-files.html#the-config.yaml-filepath"><i class="fa fa-check"></i><b>14.1</b> The <code>config.yaml</code> filepath</a></li>
<li class="chapter" data-level="14.2" data-path="config-files.html"><a href="config-files.html#using-paths-from-the-config-file"><i class="fa fa-check"></i><b>14.2</b> Using paths from the config file</a><ul>
<li class="chapter" data-level="" data-path="config-files.html"><a href="config-files.html#exercise-using-config-files"><i class="fa fa-check"></i>Exercise: Using Config Files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="self-documenting-help.html"><a href="self-documenting-help.html"><i class="fa fa-check"></i><b>15</b> Self Documenting Help</a><ul>
<li class="chapter" data-level="15.1" data-path="self-documenting-help.html"><a href="self-documenting-help.html#our-commenting-syle"><i class="fa fa-check"></i><b>15.1</b> Our Commenting Syle</a></li>
<li class="chapter" data-level="15.2" data-path="self-documenting-help.html"><a href="self-documenting-help.html#adding-further-comments"><i class="fa fa-check"></i><b>15.2</b> Adding Further Comments</a><ul>
<li class="chapter" data-level="" data-path="self-documenting-help.html"><a href="self-documenting-help.html#exercise-adding-comments"><i class="fa fa-check"></i>Exercise: Adding Comments</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="self-documenting-help.html"><a href="self-documenting-help.html#a-help-rule"><i class="fa fa-check"></i><b>15.3</b> A <code>help</code> Rule</a><ul>
<li><a href="self-documenting-help.html#exercise-saving-help-output-to-file">Exercise: Saving <code>help</code> output to file</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html"><i class="fa fa-check"></i><b>16</b> Subworkflows: Divide and Conquer</a><ul>
<li class="chapter" data-level="16.1" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#subworkflow-basics"><i class="fa fa-check"></i><b>16.1</b> Subworkflow Basics</a></li>
<li class="chapter" data-level="16.2" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#subworkflow-dependencies"><i class="fa fa-check"></i><b>16.2</b> Subworkflow dependencies</a><ul>
<li class="chapter" data-level="" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#exercise-more-subworkflows"><i class="fa fa-check"></i>Exercise: More Subworkflows</a></li>
<li><a href="subworkflows-divide-and-conquer.html#guided-exercise-help-rules-with-subworkflows">Guided Exercise: <code>help</code> rules with subworkflows</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="part-iv-putting-workflows-in-a-box.html"><a href="part-iv-putting-workflows-in-a-box.html"><i class="fa fa-check"></i>PART IV - Putting Workflows in a Box</a></li>
<li class="chapter" data-level="17" data-path="package-dependencies-with-renv.html"><a href="package-dependencies-with-renv.html"><i class="fa fa-check"></i><b>17</b> Package Dependencies with <code>renv</code></a></li>
<li class="chapter" data-level="18" data-path="containers.html"><a href="containers.html"><i class="fa fa-check"></i><b>18</b> Containers</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="installation-guide.html"><a href="installation-guide.html"><i class="fa fa-check"></i><b>A</b> Installation Guide</a><ul>
<li class="chapter" data-level="A.1" data-path="installation-guide.html"><a href="installation-guide.html#windows"><i class="fa fa-check"></i><b>A.1</b> Windows</a><ul>
<li class="chapter" data-level="A.1.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal"><i class="fa fa-check"></i><b>A.1.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.1.2" data-path="installation-guide.html"><a href="installation-guide.html#python"><i class="fa fa-check"></i><b>A.1.2</b> Python</a></li>
<li class="chapter" data-level="" data-path="installation-guide.html"><a href="installation-guide.html#installing-snakemake"><i class="fa fa-check"></i>Installing Snakemake</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="installation-guide.html"><a href="installation-guide.html#mac"><i class="fa fa-check"></i><b>A.2</b> Mac</a><ul>
<li class="chapter" data-level="A.2.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal-1"><i class="fa fa-check"></i><b>A.2.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.2.2" data-path="installation-guide.html"><a href="installation-guide.html#python-1"><i class="fa fa-check"></i><b>A.2.2</b> Python</a></li>
<li class="chapter" data-level="" data-path="installation-guide.html"><a href="installation-guide.html#installing-snakemake-1"><i class="fa fa-check"></i>Installing Snakemake</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="installation-guide.html"><a href="installation-guide.html#linux-ubuntu"><i class="fa fa-check"></i><b>A.3</b> Linux / Ubuntu</a><ul>
<li class="chapter" data-level="A.3.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal-2"><i class="fa fa-check"></i><b>A.3.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.3.2" data-path="installation-guide.html"><a href="installation-guide.html#python-2"><i class="fa fa-check"></i><b>A.3.2</b> Python</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>B</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible Data Analytic Workflows with Snakemake and <code>R</code></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="automating-list-construction-for-wildcard-expansion" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Automating List Construction for Wildcard Expansion</h1>
<div id="learning-objectives-1" class="section level2">
<h2><span class="header-section-number">8.1</span> Learning Objectives</h2>
<p>TODO!</p>
</div>
<div id="state-of-the-snakefile" class="section level2">
<h2><span class="header-section-number">8.2</span> State of the Snakefile</h2>
<p>TODO: Make this a box + code fold</p>
<p>To proceed with this chapter, we expect you Snakefile to look as follows:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb106-1"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-1"></a><span class="co"># --- Dictionaries --- #</span></span>
<span id="cb106-2"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-2"></a></span>
<span id="cb106-3"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-3"></a><span class="ex">MODELS</span> = [</span>
<span id="cb106-4"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-4"></a>          <span class="st">&quot;model_solow&quot;</span>,</span>
<span id="cb106-5"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-5"></a>          <span class="st">&quot;model_aug_solow&quot;</span></span>
<span id="cb106-6"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-6"></a>          ]</span>
<span id="cb106-7"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-7"></a></span>
<span id="cb106-8"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-8"></a><span class="ex">DATA_SUBSET</span> = [</span>
<span id="cb106-9"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-9"></a>                <span class="st">&quot;subset_oecd&quot;</span>,</span>
<span id="cb106-10"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-10"></a>                <span class="st">&quot;subset_intermediate&quot;</span>,</span>
<span id="cb106-11"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-11"></a>                <span class="st">&quot;subset_nonoil&quot;</span></span>
<span id="cb106-12"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-12"></a>                ]</span>
<span id="cb106-13"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-13"></a></span>
<span id="cb106-14"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-14"></a><span class="ex">PLOTS</span> = [</span>
<span id="cb106-15"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-15"></a>    <span class="st">&quot;aug_conditional_convergence&quot;</span>,</span>
<span id="cb106-16"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-16"></a>    <span class="st">&quot;conditional_convergence&quot;</span>,</span>
<span id="cb106-17"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-17"></a>    <span class="st">&quot;unconditional_convergence&quot;</span></span>
<span id="cb106-18"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-18"></a>]</span>
<span id="cb106-19"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-19"></a></span>
<span id="cb106-20"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-20"></a><span class="co"># --- Build Rules --- #</span></span>
<span id="cb106-21"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-21"></a></span>
<span id="cb106-22"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-22"></a><span class="ex">rule</span> run_models:</span>
<span id="cb106-23"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-23"></a>    <span class="ex">input</span>:</span>
<span id="cb106-24"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-24"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/analysis/{iModel}.{iSubset}.rds&quot;</span>,</span>
<span id="cb106-25"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-25"></a>                    <span class="ex">iSubset</span> = DATA_SUBSET,</span>
<span id="cb106-26"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-26"></a>                    <span class="ex">iModel</span> = MODELS)</span>
<span id="cb106-27"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-27"></a></span>
<span id="cb106-28"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-28"></a><span class="ex">rule</span> model:</span>
<span id="cb106-29"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-29"></a>    <span class="ex">input</span>:</span>
<span id="cb106-30"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-30"></a>        <span class="ex">script</span> = <span class="st">&quot;src/analysis/estimate_ols_model.R&quot;</span>,</span>
<span id="cb106-31"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-31"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb106-32"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-32"></a>        <span class="ex">model</span>  = <span class="st">&quot;src/model-specs/{iModel}.json&quot;</span>,</span>
<span id="cb106-33"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-33"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/{iSubset}.json&quot;</span></span>
<span id="cb106-34"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-34"></a>    <span class="ex">output</span>:</span>
<span id="cb106-35"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-35"></a>        <span class="ex">estimate</span> = <span class="st">&quot;out/analysis/{iModel}.{iSubset}.rds&quot;</span></span>
<span id="cb106-36"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-36"></a>    <span class="ex">shell</span>:</span>
<span id="cb106-37"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-37"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb106-38"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-38"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb106-39"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-39"></a><span class="st">            --model {input.model} \</span></span>
<span id="cb106-40"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-40"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb106-41"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-41"></a><span class="st">            --out {output.estimate}&quot;</span></span>
<span id="cb106-42"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-42"></a></span>
<span id="cb106-43"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-43"></a><span class="ex">rule</span> make_figures:</span>
<span id="cb106-44"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-44"></a>    <span class="ex">input</span>:</span>
<span id="cb106-45"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-45"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/figures/{iFigure}.pdf&quot;</span>,</span>
<span id="cb106-46"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-46"></a>                    <span class="ex">iFigure</span> = PLOTS)</span>
<span id="cb106-47"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-47"></a></span>
<span id="cb106-48"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-48"></a></span>
<span id="cb106-49"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-49"></a><span class="ex">rule</span> figure:</span>
<span id="cb106-50"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-50"></a>    <span class="ex">input</span>:</span>
<span id="cb106-51"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-51"></a>        <span class="ex">script</span> = <span class="st">&quot;src/figures/{iFigure}.R&quot;</span>,</span>
<span id="cb106-52"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-52"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb106-53"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-53"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/subset_intermediate.json&quot;</span></span>
<span id="cb106-54"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-54"></a>    <span class="ex">output</span>:</span>
<span id="cb106-55"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-55"></a>        <span class="ex">fig</span> = <span class="st">&quot;out/figures/{iFigure}.pdf&quot;</span></span>
<span id="cb106-56"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-56"></a>    <span class="ex">shell</span>:</span>
<span id="cb106-57"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-57"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb106-58"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-58"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb106-59"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-59"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb106-60"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-60"></a><span class="st">            --out {output.fig}&quot;</span></span>
<span id="cb106-61"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-61"></a></span>
<span id="cb106-62"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-62"></a></span>
<span id="cb106-63"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-63"></a><span class="ex">rule</span> gen_regression_vars:</span>
<span id="cb106-64"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-64"></a>    <span class="ex">input</span>:</span>
<span id="cb106-65"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-65"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/gen_reg_vars.R&quot;</span>,</span>
<span id="cb106-66"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-66"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span>,</span>
<span id="cb106-67"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-67"></a>        <span class="ex">param</span>  = <span class="st">&quot;src/data-specs/param_solow.json&quot;</span></span>
<span id="cb106-68"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-68"></a>    <span class="ex">output</span>:</span>
<span id="cb106-69"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-69"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span></span>
<span id="cb106-70"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-70"></a>    <span class="ex">shell</span>:</span>
<span id="cb106-71"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-71"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb106-72"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-72"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb106-73"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-73"></a><span class="st">            --param {input.param} \</span></span>
<span id="cb106-74"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-74"></a><span class="st">            --out {output.data}&quot;</span></span>
<span id="cb106-75"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-75"></a></span>
<span id="cb106-76"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-76"></a><span class="ex">rule</span> rename_vars:</span>
<span id="cb106-77"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-77"></a>    <span class="ex">input</span>:</span>
<span id="cb106-78"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-78"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/rename_variables.R&quot;</span>,</span>
<span id="cb106-79"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-79"></a>        <span class="ex">data</span>   = <span class="st">&quot;src/data/mrw.dta&quot;</span></span>
<span id="cb106-80"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-80"></a>    <span class="ex">output</span>:</span>
<span id="cb106-81"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-81"></a>        <span class="ex">data</span> = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span></span>
<span id="cb106-82"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-82"></a>    <span class="ex">shell</span>:</span>
<span id="cb106-83"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-83"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb106-84"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-84"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb106-85"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-85"></a><span class="st">            --out {output.data}&quot;</span></span>
<span id="cb106-86"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-86"></a></span>
<span id="cb106-87"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-87"></a></span>
<span id="cb106-88"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-88"></a><span class="ex">rule</span> clean:</span>
<span id="cb106-89"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-89"></a>    <span class="ex">shell</span>:</span>
<span id="cb106-90"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-90"></a>        <span class="st">&quot;rm -rf out/*&quot;</span></span>
<span id="cb106-91"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-91"></a></span>
<span id="cb106-92"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-92"></a><span class="ex">rule</span> clean_data:</span>
<span id="cb106-93"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-93"></a>    <span class="ex">shell</span>:</span>
<span id="cb106-94"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-94"></a>        <span class="st">&quot;rm -rf out/data/*&quot;</span></span>
<span id="cb106-95"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-95"></a></span>
<span id="cb106-96"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-96"></a><span class="ex">rule</span> clean_analysis:</span>
<span id="cb106-97"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-97"></a>    <span class="ex">shell</span>:</span>
<span id="cb106-98"><a href="automating-list-construction-for-wildcard-expansion.html#cb106-98"></a>        <span class="st">&quot;rm -rf out/analysis/*&quot;</span></span></code></pre></div>
<p>In the previous chapter when we wanted to expand a wildcard we manually specified the valued we wanted them to take by constructing a list.
By doing so, the beginning of our Snakefile looks like this:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb107-1"><a href="automating-list-construction-for-wildcard-expansion.html#cb107-1"></a><span class="ex">MODELS</span> = [</span>
<span id="cb107-2"><a href="automating-list-construction-for-wildcard-expansion.html#cb107-2"></a>          <span class="st">&quot;model_solow&quot;</span>,</span>
<span id="cb107-3"><a href="automating-list-construction-for-wildcard-expansion.html#cb107-3"></a>          <span class="st">&quot;model_aug_solow&quot;</span></span>
<span id="cb107-4"><a href="automating-list-construction-for-wildcard-expansion.html#cb107-4"></a>          ]</span>
<span id="cb107-5"><a href="automating-list-construction-for-wildcard-expansion.html#cb107-5"></a></span>
<span id="cb107-6"><a href="automating-list-construction-for-wildcard-expansion.html#cb107-6"></a><span class="ex">DATA_SUBSET</span> = [</span>
<span id="cb107-7"><a href="automating-list-construction-for-wildcard-expansion.html#cb107-7"></a>                <span class="st">&quot;subset_oecd&quot;</span>,</span>
<span id="cb107-8"><a href="automating-list-construction-for-wildcard-expansion.html#cb107-8"></a>                <span class="st">&quot;subset_intermediate&quot;</span>,</span>
<span id="cb107-9"><a href="automating-list-construction-for-wildcard-expansion.html#cb107-9"></a>                <span class="st">&quot;subset_nonoil&quot;</span></span>
<span id="cb107-10"><a href="automating-list-construction-for-wildcard-expansion.html#cb107-10"></a>                ]</span>
<span id="cb107-11"><a href="automating-list-construction-for-wildcard-expansion.html#cb107-11"></a></span>
<span id="cb107-12"><a href="automating-list-construction-for-wildcard-expansion.html#cb107-12"></a><span class="ex">FIGURES</span> = [</span>
<span id="cb107-13"><a href="automating-list-construction-for-wildcard-expansion.html#cb107-13"></a>            <span class="st">&quot;aug_conditional_convergence&quot;</span>,</span>
<span id="cb107-14"><a href="automating-list-construction-for-wildcard-expansion.html#cb107-14"></a>            <span class="st">&quot;conditional_convergence&quot;</span>,</span>
<span id="cb107-15"><a href="automating-list-construction-for-wildcard-expansion.html#cb107-15"></a>            <span class="st">&quot;unconditional_convergence&quot;</span></span>
<span id="cb107-16"><a href="automating-list-construction-for-wildcard-expansion.html#cb107-16"></a>            ]</span></code></pre></div>
<p>This is not too problematic when we only have a few values that we want the wildcard to take,
but manually specifying long lists can get tedious and is prone to error.
Snakemake has a built in function, <code>glob_wildcards</code> that will help us to remove the manual listing of values that we had to do so far.</p>
</div>
<div id="the-glob_wildcards-function" class="section level2">
<h2><span class="header-section-number">8.3</span> The <code>glob_wildcards</code> Function</h2>
<p>Let’s start by trying to replace the <code>MODELS</code> list that we manually specified with a more automated approach.
The <code>glob_wildcards()</code> function takes one input - the path of the files that we want to search combined with the part of the file name we want to extract written as a wildcard.
It then looks to find anything that along the specidied path, collecting what it finds along the way.</p>
<p>Let’s look at <code>glob_wildcards</code> in action to get a sense of what will happen.
Replace our manually specified <code>MODELS</code> list with the following code:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb108-1"><a href="automating-list-construction-for-wildcard-expansion.html#cb108-1"></a><span class="ex">MODELS</span> = glob_wildcards(<span class="st">&quot;src/model-specs/{fname}&quot;</span>)</span></code></pre></div>
<p>This says look inside the <code>src/model-specs/</code> folder, and return any files we find there.
<code>{fname}</code> is the name of the wildcard we use to tell snakemake we want the filenames from inside the folder.
The name <code>fname</code> itself doesn’t matter, we could use whatever we liked, but we decided <code>{fname}</code> is suggestive we want filenames so it helps us to understand what the code is doing.</p>
<p>Next, we want to look at what is now stored in <code>MODELS</code>.
This is a litle tricker than it should be, but if we add a <code>print(MODELS)</code> command in our Snakefile we can get the value printed to screen.
Let’s do that, and then do a dry run.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb109-1"><a href="automating-list-construction-for-wildcard-expansion.html#cb109-1"></a><span class="ex">MODELS</span> = glob_wildcards(<span class="st">&quot;src/model-specs/{fname}&quot;</span>)</span>
<span id="cb109-2"><a href="automating-list-construction-for-wildcard-expansion.html#cb109-2"></a><span class="ex">print</span>(MODELS)</span></code></pre></div>
<p>then:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb110-1"><a href="automating-list-construction-for-wildcard-expansion.html#cb110-1"></a>$ <span class="ex">snakemake</span> --dryrun</span></code></pre></div>
<p>What we are interested in is the first printed lines (in white text):</p>
<pre class="out"><code>Wildcards(fname=[&#39;.gitkeep&#39;, &#39;model_solow.json&#39;, &#39;model_aug_cc_restr.json&#39;,
                &#39;model_solow_restr.json&#39;, &#39;model_cc.json&#39;, &#39;model_ucc.json&#39;,
                &#39;model_aug_solow_restr.json&#39;, &#39;model_aug_cc.json&#39;, &#39;model_aug_solow.json&#39;])</code></pre>
<p>Here we see that all files are returned.
Compared to our original <code>MODELS</code> list we see three differences</p>
<ol style="list-style-type: decimal">
<li>There are more .json files, because there is potentially more specifications to run</li>
<li>There is a .gitkeep file</li>
<li>Each ‘fname’ ends with .json, which we did’t have earlier.</li>
</ol>
<ol style="list-style-type: decimal">
<li>is not a problem, it reflects that there is more potential analysis files that we haven’t manually specified.
But (2) and (3) are problematic.
We can remove the .gitkeep file <em>and</em> the .json file endings from the list with one step:
telling the <code>glob_wildcards()</code> function to only return the part of the filename that comes before the .json.</li>
</ol>
<p>We do this by updating our <code>glob_wildcards()</code> call as follows;</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb112-1"><a href="automating-list-construction-for-wildcard-expansion.html#cb112-1"></a><span class="ex">MODELS</span> = glob_wildcards(<span class="st">&quot;src/model-specs/{fname}.json&quot;</span>)</span>
<span id="cb112-2"><a href="automating-list-construction-for-wildcard-expansion.html#cb112-2"></a><span class="ex">print</span>(MODELS)</span></code></pre></div>
<p>This says store in the list <code>MODELS</code> the part of the filename that comes before <code>.json</code> for all files in <code>src/model-specs</code>.
The .gitkeep will also not be not returned, because this file does not have a .json ending:</p>
<p>Now let’s try the dry run again:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb113-1"><a href="automating-list-construction-for-wildcard-expansion.html#cb113-1"></a>$ <span class="ex">snakemake</span> --dryrun</span></code></pre></div>
<p>Now the first line is:</p>
<pre class="out"><code>Wildcards(fname=[&#39;model_solow&#39;, &#39;model_aug_cc_restr&#39;,
                &#39;model_solow_restr&#39;, &#39;model_cc&#39;, &#39;model_ucc&#39;,
                &#39;model_aug_solow_restr&#39;, &#39;model_aug_cc&#39;, &#39;model_aug_solow&#39;])</code></pre>
<p>That’s definitely an improvement.
We note that the dry-run command is still giving us an error though, complaining about missing input files.
That is because currently <code>MODELS</code> is not yet the the list that is was when we manually specified it.<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a>
The list we want is inside the <code>Wildcards()</code> class, and we can see it has the name <code>fname</code> which is the name of the wildcard we assigned ourselves.</p>
<p>Our final step is to extract this list so that we can use it like our old <code>MODELS</code> list.</p>
<p>We do this as follows:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb115-1"><a href="automating-list-construction-for-wildcard-expansion.html#cb115-1"></a><span class="ex">MODELS</span> = glob_wildcards(<span class="st">&quot;src/model-specs/{fname}.json&quot;</span>)<span class="ex">.fname</span></span>
<span id="cb115-2"><a href="automating-list-construction-for-wildcard-expansion.html#cb115-2"></a><span class="ex">print</span>(MODELS)</span></code></pre></div>
<p>Read this as “get the list called <code>fname</code> from inside the Wildcards() object &amp; assign it to the name <code>MODELS</code>”.
Now if we do a dry-run:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb116-1"><a href="automating-list-construction-for-wildcard-expansion.html#cb116-1"></a>$ <span class="ex">snakemake</span> --dryrun</span></code></pre></div>
<p>We are returned the following lines at the beginning of the output:</p>
<pre class="out"><code>[&#39;model_solow&#39;, &#39;model_aug_cc_restr&#39;, &#39;model_solow_restr&#39;,
 &#39;model_cc&#39;, &#39;model_ucc&#39;, &#39;model_aug_solow_restr&#39;,
 &#39;model_aug_cc&#39;, &#39;model_aug_solow&#39;]

 ...</code></pre>
<p>which looks like the list we had manually entered, but with more elements.</p>
<p>The dry-run output also showed us that there are many steps it wants to run next time it is executed.
This is because it will want to obtain the output from each of 8 models estimated on all three of the data subsets in <code>DATA_SUBSET</code>.
Recall that in Chapter XX we estimated two models, <code>aug_solow</code> and <code>solow</code>.
This means there are six models left to run, each across 3 data sets, for a total of 18 steps.
If we look through the dry run output we see that is indeed what is going to happen:</p>
<pre class="out"><code>Building DAG of jobs...
Job counts:
        count   jobs
        18      model
        1       run_models
        19

[Fri Feb 19 21:46:25 2021]
rule model:
    input: src/analysis/estimate_ols_model.R, out/data/mrw_complete.csv, src/model-specs/model_aug_solow_restr.json, src/data-specs/subset_oecd.json
    output: out/analysis/model_aug_solow_restr.subset_oecd.rds
    jobid: 8
    wildcards: iModel=model_aug_solow_restr, iSubset=subset_oecd


[Fri Feb 19 21:46:25 2021]
rule model:
    input: src/analysis/estimate_ols_model.R, out/data/mrw_complete.csv, src/model-specs/model_solow_restr.json, src/data-specs/subset_nonoil.json
    output: out/analysis/model_solow_restr.subset_nonoil.rds
    jobid: 17
    wildcards: iModel=model_solow_restr, iSubset=subset_nonoil


[Fri Feb 19 21:46:25 2021]
rule model:
    input: src/analysis/estimate_ols_model.R, out/data/mrw_complete.csv, src/model-specs/model_aug_cc_restr.json, src/data-specs/subset_intermediate.json
    output: out/analysis/model_aug_cc_restr.subset_intermediate.rds
    jobid: 12
    wildcards: iModel=model_aug_cc_restr, iSubset=subset_intermediate


[Fri Feb 19 21:46:25 2021]
rule model:
    input: src/analysis/estimate_ols_model.R, out/data/mrw_complete.csv, src/model-specs/model_aug_solow_restr.json, src/data-specs/subset_nonoil.json
    output: out/analysis/model_aug_solow_restr.subset_nonoil.rds
    jobid: 24
    wildcards: iModel=model_aug_solow_restr, iSubset=subset_nonoil


[Fri Feb 19 21:46:25 2021]
rule model:
    input: src/analysis/estimate_ols_model.R, out/data/mrw_complete.csv, src/model-specs/model_ucc.json, src/data-specs/subset_oecd.json
    output: out/analysis/model_ucc.subset_oecd.rds
    jobid: 7
    wildcards: iModel=model_ucc, iSubset=subset_oecd


[Fri Feb 19 21:46:25 2021]
rule model:
    input: src/analysis/estimate_ols_model.R, out/data/mrw_complete.csv, src/model-specs/model_aug_cc.json, src/data-specs/subset_intermediate.json
    output: out/analysis/model_aug_cc.subset_intermediate.rds
    jobid: 10
    wildcards: iModel=model_aug_cc, iSubset=subset_intermediate


[Fri Feb 19 21:46:25 2021]
rule model:
    input: src/analysis/estimate_ols_model.R, out/data/mrw_complete.csv, src/model-specs/model_aug_cc.json, src/data-specs/subset_nonoil.json
    output: out/analysis/model_aug_cc.subset_nonoil.rds
    jobid: 18
    wildcards: iModel=model_aug_cc, iSubset=subset_nonoil


[Fri Feb 19 21:46:25 2021]
rule model:
    input: src/analysis/estimate_ols_model.R, out/data/mrw_complete.csv, src/model-specs/model_aug_cc_restr.json, src/data-specs/subset_nonoil.json
    output: out/analysis/model_aug_cc_restr.subset_nonoil.rds
    jobid: 20
    wildcards: iModel=model_aug_cc_restr, iSubset=subset_nonoil


[Fri Feb 19 21:46:25 2021]
rule model:
    input: src/analysis/estimate_ols_model.R, out/data/mrw_complete.csv, src/model-specs/model_cc.json, src/data-specs/subset_oecd.json
    output: out/analysis/model_cc.subset_oecd.rds
    jobid: 3
    wildcards: iModel=model_cc, iSubset=subset_oecd


[Fri Feb 19 21:46:25 2021]
rule model:
    input: src/analysis/estimate_ols_model.R, out/data/mrw_complete.csv, src/model-specs/model_solow_restr.json, src/data-specs/subset_intermediate.json
    output: out/analysis/model_solow_restr.subset_intermediate.rds
    jobid: 9
    wildcards: iModel=model_solow_restr, iSubset=subset_intermediate


[Fri Feb 19 21:46:25 2021]
rule model:
    input: src/analysis/estimate_ols_model.R, out/data/mrw_complete.csv, src/model-specs/model_aug_cc.json, src/data-specs/subset_oecd.json
    output: out/analysis/model_aug_cc.subset_oecd.rds
    jobid: 2
    wildcards: iModel=model_aug_cc, iSubset=subset_oecd


[Fri Feb 19 21:46:25 2021]
rule model:
    input: src/analysis/estimate_ols_model.R, out/data/mrw_complete.csv, src/model-specs/model_ucc.json, src/data-specs/subset_intermediate.json
    output: out/analysis/model_ucc.subset_intermediate.rds
    jobid: 15
    wildcards: iModel=model_ucc, iSubset=subset_intermediate


[Fri Feb 19 21:46:25 2021]
rule model:
    input: src/analysis/estimate_ols_model.R, out/data/mrw_complete.csv, src/model-specs/model_aug_cc_restr.json, src/data-specs/subset_oecd.json
    output: out/analysis/model_aug_cc_restr.subset_oecd.rds
    jobid: 4
    wildcards: iModel=model_aug_cc_restr, iSubset=subset_oecd


[Fri Feb 19 21:46:25 2021]
rule model:
    input: src/analysis/estimate_ols_model.R, out/data/mrw_complete.csv, src/model-specs/model_cc.json, src/data-specs/subset_nonoil.json
    output: out/analysis/model_cc.subset_nonoil.rds
    jobid: 19
    wildcards: iModel=model_cc, iSubset=subset_nonoil


[Fri Feb 19 21:46:25 2021]
rule model:
    input: src/analysis/estimate_ols_model.R, out/data/mrw_complete.csv, src/model-specs/model_aug_solow_restr.json, src/data-specs/subset_intermediate.json
    output: out/analysis/model_aug_solow_restr.subset_intermediate.rds
    jobid: 16
    wildcards: iModel=model_aug_solow_restr, iSubset=subset_intermediate


[Fri Feb 19 21:46:25 2021]
rule model:
    input: src/analysis/estimate_ols_model.R, out/data/mrw_complete.csv, src/model-specs/model_solow_restr.json, src/data-specs/subset_oecd.json
    output: out/analysis/model_solow_restr.subset_oecd.rds
    jobid: 1
    wildcards: iModel=model_solow_restr, iSubset=subset_oecd


[Fri Feb 19 21:46:25 2021]
rule model:
    input: src/analysis/estimate_ols_model.R, out/data/mrw_complete.csv, src/model-specs/model_cc.json, src/data-specs/subset_intermediate.json
    output: out/analysis/model_cc.subset_intermediate.rds
    jobid: 11
    wildcards: iModel=model_cc, iSubset=subset_intermediate


[Fri Feb 19 21:46:25 2021]
rule model:
    input: src/analysis/estimate_ols_model.R, out/data/mrw_complete.csv, src/model-specs/model_ucc.json, src/data-specs/subset_nonoil.json
    output: out/analysis/model_ucc.subset_nonoil.rds
    jobid: 23
    wildcards: iModel=model_ucc, iSubset=subset_nonoil


[Fri Feb 19 21:46:25 2021]
localrule run_models:
    input: out/analysis/model_solow_restr.subset_oecd.rds, out/analysis/model_aug_cc.subset_oecd.rds, out/analysis/model_cc.subset_oecd.rds, out/analysis/model_aug_cc_restr.subset_oecd.rds, out/analysis/model_aug_solow.subset_oecd.rds, out/analysis/model_solow.subset_oecd.rds, out/analysis/model_ucc.subset_oecd.rds, out/analysis/model_aug_solow_restr.subset_oecd.rds, out/analysis/model_solow_restr.subset_intermediate.rds, out/analysis/model_aug_cc.subset_intermediate.rds, out/analysis/model_cc.subset_intermediate.rds, out/analysis/model_aug_cc_restr.subset_intermediate.rds, out/analysis/model_aug_solow.subset_intermediate.rds, out/analysis/model_solow.subset_intermediate.rds, out/analysis/model_ucc.subset_intermediate.rds, out/analysis/model_aug_solow_restr.subset_intermediate.rds, out/analysis/model_solow_restr.subset_nonoil.rds, out/analysis/model_aug_cc.subset_nonoil.rds, out/analysis/model_cc.subset_nonoil.rds, out/analysis/model_aug_cc_restr.subset_nonoil.rds, out/analysis/model_aug_solow.subset_nonoil.rds, out/analysis/model_solow.subset_nonoil.rds, out/analysis/model_ucc.subset_nonoil.rds, out/analysis/model_aug_solow_restr.subset_nonoil.rds
    jobid: 0

Job counts:
        count   jobs
        18      model
        1       run_models
        19
This was a dry-run (flag -n). The order of jobs does not reflect the order of execution.</code></pre>
<p>Let’s run Snakemake to get all of the estimates.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb119-1"><a href="automating-list-construction-for-wildcard-expansion.html#cb119-1"></a>$ <span class="ex">snakemake</span></span></code></pre></div>
<p>The power of using <code>glob_wildcards()</code> is clear.
It’s a relatively easy way to construct a list to iterate over as part of a wildcard expansion based on the names of files.</p>
</div>
<div id="looking-at-the-dag-redux" class="section level2">
<h2><span class="header-section-number">8.4</span> Looking at the DAG (redux)</h2>
<p>With the addition of all of these new model estimates, Figure XX shows that the project’s DAG has expanded in complexity.</p>
<embed src="img/ch-5d/dag.pdf" style="display: block; margin: auto;" type="application/pdf" />
<p>The DAG again makes clear what our workflow is doing.
Reading from the bottom of the figure upwards:</p>
<ul>
<li>Snakemake wants to build the inputs listed in <code>run_models</code>.
This is the pairwise combination of all <code>MODELS</code> that were found in <code>src/model-specs</code> and all <code>DATA_SUBSETS</code> found in <code>src/data-specs</code></li>
<li>It can build those inputs by running the <code>model</code> rule <span class="math inline">\(8 \times 3 = 24\)</span> times when it iterates over the wildcards</li>
<li>To run each model, it needs the clean data, so it needs to run the two data cleaning steps first</li>
</ul>
<p>!!! REMARK !!!</p>
<p>Notice (again) how the figures aren’t produced automatically.
Do you remember why?
If not, revisit Chapter XX.
You can build them with <code>snakemake --cores 1 make_figures</code>.
Chapter YY will show us how to get all the outputs build with one run of Snakemake.</p>
<div id="exercise-exploring-glob_wildcards" class="section level3 unnumbered exercise">
<h3>Exercise: Exploring glob_wildcards()</h3>
<p>The Snakemake file still has two manually specified lists, <code>DATA_SUBSET</code> and <code>PLOTS</code>.</p>
<ol style="list-style-type: lower-alpha">
<li>Use the <code>glob_wildcards()</code> function to automate the the list construction.</li>
<li>Clean the output directory</li>
<li>Run Snakemake so that all models and all figures have been produced.</li>
</ol>
</div>
<div id="solution-5" class="section level3">
<h3><span class="header-section-number">8.4.1</span> Solution</h3>
<p>Will need to run Snakemake twice <code>snakemake --cores 1 run_models</code> and <code>snakemake --cores 1 make_figures</code>.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb120-1"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-1"></a><span class="co"># --- Dictionaries --- #</span></span>
<span id="cb120-2"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-2"></a><span class="ex">MODELS</span> = glob_wildcards(<span class="st">&quot;src/model-specs/{fname}.json&quot;</span>)<span class="ex">.fname</span> </span>
<span id="cb120-3"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-3"></a><span class="ex">DATA_SUBSET</span> = glob_wildcards(<span class="st">&quot;src/data-specs/{fname}.json&quot;</span>)<span class="ex">.fname</span></span>
<span id="cb120-4"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-4"></a><span class="ex">PLOTS</span> = glob_wildcards(<span class="st">&quot;src/figures/{fname}.R&quot;</span>)<span class="ex">.fname</span></span>
<span id="cb120-5"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-5"></a></span>
<span id="cb120-6"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-6"></a><span class="co"># --- Build Rules --- #</span></span>
<span id="cb120-7"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-7"></a></span>
<span id="cb120-8"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-8"></a><span class="ex">rule</span> run_models:</span>
<span id="cb120-9"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-9"></a>    <span class="ex">input</span>:</span>
<span id="cb120-10"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-10"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/analysis/{iModel}.{iSubset}.rds&quot;</span>,</span>
<span id="cb120-11"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-11"></a>                    <span class="ex">iSubset</span> = DATA_SUBSET,</span>
<span id="cb120-12"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-12"></a>                    <span class="ex">iModel</span> = MODELS)</span>
<span id="cb120-13"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-13"></a></span>
<span id="cb120-14"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-14"></a><span class="ex">rule</span> model:</span>
<span id="cb120-15"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-15"></a>    <span class="ex">input</span>:</span>
<span id="cb120-16"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-16"></a>        <span class="ex">script</span> = <span class="st">&quot;src/analysis/estimate_ols_model.R&quot;</span>,</span>
<span id="cb120-17"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-17"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb120-18"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-18"></a>        <span class="ex">model</span>  = <span class="st">&quot;src/model-specs/{iModel}.json&quot;</span>,</span>
<span id="cb120-19"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-19"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/{iSubset}.json&quot;</span></span>
<span id="cb120-20"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-20"></a>    <span class="ex">output</span>:</span>
<span id="cb120-21"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-21"></a>        <span class="ex">estimate</span> = <span class="st">&quot;out/analysis/{iModel}.{iSubset}.rds&quot;</span></span>
<span id="cb120-22"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-22"></a>    <span class="ex">shell</span>:</span>
<span id="cb120-23"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-23"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb120-24"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-24"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb120-25"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-25"></a><span class="st">            --model {input.model} \</span></span>
<span id="cb120-26"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-26"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb120-27"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-27"></a><span class="st">            --out {output.estimate}&quot;</span></span>
<span id="cb120-28"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-28"></a></span>
<span id="cb120-29"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-29"></a><span class="ex">rule</span> make_figures:</span>
<span id="cb120-30"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-30"></a>    <span class="ex">input</span>:</span>
<span id="cb120-31"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-31"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/figures/{iFigure}.pdf&quot;</span>,</span>
<span id="cb120-32"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-32"></a>                    <span class="ex">iFigure</span> = PLOTS)</span>
<span id="cb120-33"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-33"></a></span>
<span id="cb120-34"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-34"></a></span>
<span id="cb120-35"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-35"></a><span class="ex">rule</span> figure:</span>
<span id="cb120-36"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-36"></a>    <span class="ex">input</span>:</span>
<span id="cb120-37"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-37"></a>        <span class="ex">script</span> = <span class="st">&quot;src/figures/{iFigure}.R&quot;</span>,</span>
<span id="cb120-38"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-38"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb120-39"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-39"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/subset_intermediate.json&quot;</span></span>
<span id="cb120-40"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-40"></a>    <span class="ex">output</span>:</span>
<span id="cb120-41"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-41"></a>        <span class="ex">fig</span> = <span class="st">&quot;out/figures/{iFigure}.pdf&quot;</span></span>
<span id="cb120-42"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-42"></a>    <span class="ex">shell</span>:</span>
<span id="cb120-43"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-43"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb120-44"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-44"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb120-45"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-45"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb120-46"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-46"></a><span class="st">            --out {output.fig}&quot;</span></span>
<span id="cb120-47"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-47"></a></span>
<span id="cb120-48"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-48"></a></span>
<span id="cb120-49"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-49"></a><span class="ex">rule</span> gen_regression_vars:</span>
<span id="cb120-50"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-50"></a>    <span class="ex">input</span>:</span>
<span id="cb120-51"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-51"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/gen_reg_vars.R&quot;</span>,</span>
<span id="cb120-52"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-52"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span>,</span>
<span id="cb120-53"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-53"></a>        <span class="ex">param</span>  = <span class="st">&quot;src/data-specs/param_solow.json&quot;</span></span>
<span id="cb120-54"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-54"></a>    <span class="ex">output</span>:</span>
<span id="cb120-55"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-55"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span></span>
<span id="cb120-56"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-56"></a>    <span class="ex">shell</span>:</span>
<span id="cb120-57"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-57"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb120-58"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-58"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb120-59"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-59"></a><span class="st">            --param {input.param} \</span></span>
<span id="cb120-60"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-60"></a><span class="st">            --out {output.data}&quot;</span></span>
<span id="cb120-61"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-61"></a></span>
<span id="cb120-62"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-62"></a><span class="ex">rule</span> rename_vars:</span>
<span id="cb120-63"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-63"></a>    <span class="ex">input</span>:</span>
<span id="cb120-64"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-64"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/rename_variables.R&quot;</span>,</span>
<span id="cb120-65"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-65"></a>        <span class="ex">data</span>   = <span class="st">&quot;src/data/mrw.dta&quot;</span></span>
<span id="cb120-66"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-66"></a>    <span class="ex">output</span>:</span>
<span id="cb120-67"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-67"></a>        <span class="ex">data</span> = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span></span>
<span id="cb120-68"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-68"></a>    <span class="ex">shell</span>:</span>
<span id="cb120-69"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-69"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb120-70"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-70"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb120-71"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-71"></a><span class="st">            --out {output.data}&quot;</span></span>
<span id="cb120-72"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-72"></a></span>
<span id="cb120-73"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-73"></a></span>
<span id="cb120-74"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-74"></a><span class="ex">rule</span> clean:</span>
<span id="cb120-75"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-75"></a>    <span class="ex">shell</span>:</span>
<span id="cb120-76"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-76"></a>        <span class="st">&quot;rm -rf out/*&quot;</span></span>
<span id="cb120-77"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-77"></a></span>
<span id="cb120-78"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-78"></a><span class="ex">rule</span> clean_data:</span>
<span id="cb120-79"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-79"></a>    <span class="ex">shell</span>:</span>
<span id="cb120-80"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-80"></a>        <span class="st">&quot;rm -rf out/data/*&quot;</span></span>
<span id="cb120-81"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-81"></a></span>
<span id="cb120-82"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-82"></a><span class="ex">rule</span> clean_analysis:</span>
<span id="cb120-83"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-83"></a>    <span class="ex">shell</span>:</span>
<span id="cb120-84"><a href="automating-list-construction-for-wildcard-expansion.html#cb120-84"></a>        <span class="st">&quot;rm -rf out/analysis/*&quot;</span></span></code></pre></div>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="11">
<li id="fn11"><p>
If one replaces <code>print(MODELS)</code> with <code>print(type(MODELS))</code> we learn that <code>MODELS</code> is currently a <code>class</code> object rather than a list.
It remains unclear to us as authors why this is what the Snakemake designers made this decision, but we have learned to embrace it.
We hope you do too.<a href="automating-list-construction-for-wildcard-expansion.html#fnref11" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="automatic-expansion-of-wildcards.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="part-iii-bringing-many-outputs-together.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/23-glob_wildcards.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["book.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
