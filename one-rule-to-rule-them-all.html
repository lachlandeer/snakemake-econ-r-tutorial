<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 One rule to rule them all | Reproducible Data Analytic Workflows with Snakemake and R</title>
  <meta name="description" content="In progress" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 One rule to rule them all | Reproducible Data Analytic Workflows with Snakemake and R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="In progress" />
  <meta name="github-repo" content="lachlandeer/snakemake-econ-r-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 One rule to rule them all | Reproducible Data Analytic Workflows with Snakemake and R" />
  
  <meta name="twitter:description" content="In progress" />
  

<meta name="author" content="Ulrich Bergmann" />
<meta name="author" content="Lachlan Deer" />
<meta name="author" content="Julian Langer" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="make-tables.html"/>
<link rel="next" href="adding-papers-and-slides-to-a-snakemake-workflow.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="img/logo.png"></a></li>
<div style="text-align:center">
<li><a href="./index.html">Reproducible Data Analytic <br /> Workflows with Snakemake and `R`</a></li>
</div>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-we-wrote-this-tutorial"><i class="fa fa-check"></i>Why we wrote this tutorial</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#pre-requisite-knowledge"><i class="fa fa-check"></i>Pre-requisite Knowledge</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-needs-to-be-downloaded-installed-for-this-tutorial"><i class="fa fa-check"></i>What Needs to be Downloaded &amp; Installed for this Tutorial</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#template-scripts-and-documents"><i class="fa fa-check"></i>Template Scripts and Documents</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-installation"><i class="fa fa-check"></i>Software Installation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-we-cant-cover"><i class="fa fa-check"></i>What We Can’t Cover</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the Authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#instructional-material"><i class="fa fa-check"></i>Instructional material</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software"><i class="fa fa-check"></i>Software</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#citation"><i class="fa fa-check"></i>Citation</a></li>
</ul></li>
<li class="part"><span><b>I Preliminaries</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Motivating &amp; Rationale</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#a-case-for-reproducibility"><i class="fa fa-check"></i><b>1.1</b> A Case for Reproducibility</a><ul>
<li class="chapter" data-level="1.1.1" data-path="intro.html"><a href="intro.html#how-far-to-go-in-the-quest-for-reproducibility"><i class="fa fa-check"></i><b>1.1.1</b> How far to go in the quest for reproducibility?</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#what-is-snakemake-why-should-you-use-it"><i class="fa fa-check"></i><b>1.2</b> What is <code>Snakemake</code> &amp; Why Should you use it?</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#why-r"><i class="fa fa-check"></i><b>1.3</b> Why <code>R</code>?</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#working-example-replicating-mankiw-romer-and-weils-1992-qje"><i class="fa fa-check"></i><b>1.4</b> Working Example: Replicating Mankiw, Romer and Weil’s 1992 QJE</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#the-way-forward"><i class="fa fa-check"></i><b>1.5</b> The way forward</a><ul>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#exercise-your-own-projects-steps"><i class="fa fa-check"></i>Exercise: Your own project’s steps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="project-organization.html"><a href="project-organization.html"><i class="fa fa-check"></i><b>2</b> Project Organization</a><ul>
<li class="chapter" data-level="" data-path="project-organization.html"><a href="project-organization.html#learning-objectives"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="2.1" data-path="project-organization.html"><a href="project-organization.html#subtitle-tbd"><i class="fa fa-check"></i><b>2.1</b> Subtitle TBD</a></li>
<li class="chapter" data-level="2.2" data-path="project-organization.html"><a href="project-organization.html#project-organization-i-separating-inputs-and-outputs"><i class="fa fa-check"></i><b>2.2</b> Project Organization I: Separating Inputs and Outputs</a></li>
<li class="chapter" data-level="2.3" data-path="project-organization.html"><a href="project-organization.html#project-structure-ii-separating-logical-chunks-of-the-project"><i class="fa fa-check"></i><b>2.3</b> Project Structure II: Separating Logical Chunks of the Project</a><ul>
<li class="chapter" data-level="2.3.1" data-path="project-organization.html"><a href="project-organization.html#aside-even-deeper-sub-folders"><i class="fa fa-check"></i><b>2.3.1</b> Aside: Even Deeper Sub-folders</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="project-organization.html"><a href="project-organization.html#project-structure-iii-separating-input-parameters-from-code"><i class="fa fa-check"></i><b>2.4</b> Project Structure III: Separating Input Parameters from Code</a></li>
</ul></li>
<li class="part"><span><b>II Basic Snakemake Workflows</b></span></li>
<li class="chapter" data-level="3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html"><i class="fa fa-check"></i><b>3</b> Initial Steps with Snakemake</a><ul>
<li class="chapter" data-level="3.1" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#snakefile-writing-our-first-rule"><i class="fa fa-check"></i><b>3.1</b> Snakefile – Writing Our First Rule</a></li>
<li class="chapter" data-level="3.2" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#the-snakemake-command-executing-a-rule"><i class="fa fa-check"></i><b>3.2</b> The Snakemake Command – Executing a Rule</a></li>
<li class="chapter" data-level="3.3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#reading-and-writing-files-first-steps-in-a-data-science-pipeline"><i class="fa fa-check"></i><b>3.3</b> Reading and Writing Files – First Steps in a Data Science Pipeline</a><ul>
<li class="chapter" data-level="3.3.1" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#using-the-rscript-command-to-execute-r-scripts"><i class="fa fa-check"></i><b>3.3.1</b> Using the Rscript command to execute R scripts</a></li>
<li class="chapter" data-level="3.3.2" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#the-input-and-output-arguments"><i class="fa fa-check"></i><b>3.3.2</b> The input and output arguments</a></li>
<li class="chapter" data-level="3.3.3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#a-rule-to-rename-variables."><i class="fa fa-check"></i><b>3.3.3</b> A rule to rename variables.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#redundant-executions-dont-run-a-rule-repeatedly"><i class="fa fa-check"></i><b>3.4</b> Redundant Executions – (Don’t) Run a Rule Repeatedly</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html"><i class="fa fa-check"></i><b>4</b> Working With Multiple Rules</a><ul>
<li class="chapter" data-level="4.1" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#creating-a-second-rule"><i class="fa fa-check"></i><b>4.1</b> Creating a second rule</a><ul>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#exercise-creating-rules"><i class="fa fa-check"></i>Exercise: Creating Rules</a></li>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#solution"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#clean-rules"><i class="fa fa-check"></i><b>4.2</b> Clean Rules</a><ul>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#exercise-creating-cleaning-rules"><i class="fa fa-check"></i>Exercise: Creating Cleaning Rules</a></li>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#solution-1"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="target-rules.html"><a href="target-rules.html"><i class="fa fa-check"></i><b>5</b> Target Rules</a><ul>
<li class="chapter" data-level="5.1" data-path="target-rules.html"><a href="target-rules.html#where-we-are-now"><i class="fa fa-check"></i><b>5.1</b> Where we are now?</a></li>
<li class="chapter" data-level="5.2" data-path="target-rules.html"><a href="target-rules.html#how-snakemake-determines-the-build-order-when-multiple-rules-are-present"><i class="fa fa-check"></i><b>5.2</b> How Snakemake determines the build order when multiple rules are present</a></li>
<li class="chapter" data-level="5.3" data-path="target-rules.html"><a href="target-rules.html#dedicated-target-rules-to-execute-multiple-rules"><i class="fa fa-check"></i><b>5.3</b> Dedicated target rules to execute multiple rules</a><ul>
<li class="chapter" data-level="" data-path="target-rules.html"><a href="target-rules.html#exercise-using-target-rules"><i class="fa fa-check"></i>Exercise: Using target rules</a></li>
<li class="chapter" data-level="" data-path="target-rules.html"><a href="target-rules.html#solution-2"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="target-rules.html"><a href="target-rules.html#target-rules-can-do-more-for-us"><i class="fa fa-check"></i><b>5.4</b> Target rules can do more for us</a></li>
</ul></li>
<li class="part"><span><b>III Minimizing Repetition, Maximizing Generalizability</b></span></li>
<li class="chapter" data-level="6" data-path="wildcards.html"><a href="wildcards.html"><i class="fa fa-check"></i><b>6</b> Wildcards</a><ul>
<li class="chapter" data-level="6.1" data-path="wildcards.html"><a href="wildcards.html#the-starting-point-of-our-snakefile"><i class="fa fa-check"></i><b>6.1</b> The starting point of our Snakefile</a></li>
<li class="chapter" data-level="6.2" data-path="wildcards.html"><a href="wildcards.html#using-wildcards-to-tidy-up-our-code"><i class="fa fa-check"></i><b>6.2</b> Using wildcards to tidy up our code</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html"><i class="fa fa-check"></i><b>7</b> Automatic Expansion of Wildcards</a><ul>
<li class="chapter" data-level="7.1" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#learning-goals"><i class="fa fa-check"></i><b>7.1</b> Learning Goals</a></li>
<li class="chapter" data-level="7.2" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#the-expand-function"><i class="fa fa-check"></i><b>7.2</b> The <code>expand()</code> function</a><ul>
<li class="chapter" data-level="" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#exercise-exploring-the-expand-function-i"><i class="fa fa-check"></i>Exercise: Exploring the expand function I</a></li>
<li class="chapter" data-level="7.2.1" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#solution-3"><i class="fa fa-check"></i><b>7.2.1</b> SOLUTION:</a></li>
<li class="chapter" data-level="" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#exercise-exploring-the-expand-function-ii"><i class="fa fa-check"></i>Exercise: Exploring the expand() function II</a></li>
<li class="chapter" data-level="7.2.2" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#solution-4"><i class="fa fa-check"></i><b>7.2.2</b> Solution</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#expanding-multiple-wildcards"><i class="fa fa-check"></i><b>7.3</b> Expanding Multiple Wildcards</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html"><i class="fa fa-check"></i><b>8</b> Automating List Construction for Wildcard Expansion</a><ul>
<li class="chapter" data-level="8.1" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#learning-objectives-1"><i class="fa fa-check"></i><b>8.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="8.2" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#state-of-the-snakefile"><i class="fa fa-check"></i><b>8.2</b> State of the Snakefile</a></li>
<li class="chapter" data-level="8.3" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#the-glob_wildcards-function"><i class="fa fa-check"></i><b>8.3</b> The <code>glob_wildcards</code> Function</a></li>
<li class="chapter" data-level="8.4" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#looking-at-the-dag-redux"><i class="fa fa-check"></i><b>8.4</b> Looking at the DAG (redux)</a><ul>
<li class="chapter" data-level="" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#exercise-exploring-glob_wildcards"><i class="fa fa-check"></i>Exercise: Exploring glob_wildcards()</a></li>
<li class="chapter" data-level="8.4.1" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#solution-5"><i class="fa fa-check"></i><b>8.4.1</b> Solution</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Bringing Many Outputs Together</b></span></li>
<li class="chapter" data-level="9" data-path="make-tables.html"><a href="make-tables.html"><i class="fa fa-check"></i><b>9</b> Make Tables</a><ul>
<li class="chapter" data-level="9.1" data-path="make-tables.html"><a href="make-tables.html#the-state-of-the-snakefile"><i class="fa fa-check"></i><b>9.1</b> The State of the Snakefile</a></li>
<li class="chapter" data-level="9.2" data-path="make-tables.html"><a href="make-tables.html#building-a-single-table"><i class="fa fa-check"></i><b>9.2</b> Building a single table</a></li>
<li class="chapter" data-level="9.3" data-path="make-tables.html"><a href="make-tables.html#building-all-tables-at-once"><i class="fa fa-check"></i><b>9.3</b> Building all tables at once</a><ul>
<li class="chapter" data-level="" data-path="make-tables.html"><a href="make-tables.html#exercise"><i class="fa fa-check"></i>Exercise</a></li>
<li class="chapter" data-level="" data-path="make-tables.html"><a href="make-tables.html#solution-6"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html"><i class="fa fa-check"></i><b>10</b> One rule to rule them all</a><ul>
<li class="chapter" data-level="10.1" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#the-state-of-the-snakefile-1"><i class="fa fa-check"></i><b>10.1</b> The State of the Snakefile</a></li>
<li class="chapter" data-level="10.2" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#creating-an-all-target-rule"><i class="fa fa-check"></i><b>10.2</b> Creating an <code>all</code> target rule</a></li>
<li class="chapter" data-level="10.3" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#concluding-remarks"><i class="fa fa-check"></i><b>10.3</b> Concluding Remarks</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html"><i class="fa fa-check"></i><b>11</b> Adding Papers and Slides to a Snakemake Workflow</a><ul>
<li class="chapter" data-level="11.1" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#learning-objectives-2"><i class="fa fa-check"></i><b>11.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="11.2" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#state-of-our-snakefile"><i class="fa fa-check"></i><b>11.2</b> State of Our Snakefile</a></li>
<li class="chapter" data-level="11.3" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#where-we-are"><i class="fa fa-check"></i><b>11.3</b> Where We Are</a></li>
<li class="chapter" data-level="11.4" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#building-a-paper"><i class="fa fa-check"></i><b>11.4</b> Building a Paper</a></li>
<li class="chapter" data-level="11.5" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#integrating-build_paper-output-into-all"><i class="fa fa-check"></i><b>11.5</b> Integrating <code>build_paper</code> output into <code>all</code></a></li>
<li class="chapter" data-level="11.6" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#making-paper.pdf-easier-to-find"><i class="fa fa-check"></i><b>11.6</b> Making <code>paper.pdf</code> Easier to Find</a><ul>
<li class="chapter" data-level="11.6.1" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#exercise-adding-a-slide-deck."><i class="fa fa-check"></i><b>11.6.1</b> Exercise: Adding a Slide Deck.</a></li>
<li class="chapter" data-level="11.6.2" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#exercise-solution"><i class="fa fa-check"></i><b>11.6.2</b> Exercise Solution</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#final-thoughts"><i class="fa fa-check"></i><b>11.7</b> Final Thoughts</a></li>
</ul></li>
<li class="part"><span><b>V Decorating Snakemake Workflows</b></span></li>
<li class="chapter" data-level="12" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html"><i class="fa fa-check"></i><b>12</b> Logging Output and Errors</a><ul>
<li class="chapter" data-level="12.1" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#logging-output"><i class="fa fa-check"></i><b>12.1</b> Logging Output</a></li>
<li class="chapter" data-level="12.2" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#logging-output-and-errors-in-one-file"><i class="fa fa-check"></i><b>12.2</b> Logging Output and Errors in One File</a><ul>
<li class="chapter" data-level="" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#exercise-logging-all-r-scripts"><i class="fa fa-check"></i>Exercise: Logging all R Scripts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="adding-parameters.html"><a href="adding-parameters.html"><i class="fa fa-check"></i><b>13</b> Adding Parameters</a><ul>
<li class="chapter" data-level="13.1" data-path="adding-parameters.html"><a href="adding-parameters.html#motivating-example-constructing-a-regression-table-from-ols-results"><i class="fa fa-check"></i><b>13.1</b> Motivating Example: Constructing a Regression Table from OLS Results</a></li>
<li class="chapter" data-level="13.2" data-path="adding-parameters.html"><a href="adding-parameters.html#creating-a-rule-with-params"><i class="fa fa-check"></i><b>13.2</b> Creating a Rule with <code>params</code></a><ul>
<li class="chapter" data-level="" data-path="adding-parameters.html"><a href="adding-parameters.html#exercise-building-table-2"><i class="fa fa-check"></i>Exercise: Building Table 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="config-files.html"><a href="config-files.html"><i class="fa fa-check"></i><b>14</b> Config Files</a><ul>
<li class="chapter" data-level="14.1" data-path="config-files.html"><a href="config-files.html#the-config.yaml-filepath"><i class="fa fa-check"></i><b>14.1</b> The <code>config.yaml</code> filepath</a></li>
<li class="chapter" data-level="14.2" data-path="config-files.html"><a href="config-files.html#using-paths-from-the-config-file"><i class="fa fa-check"></i><b>14.2</b> Using paths from the config file</a><ul>
<li class="chapter" data-level="" data-path="config-files.html"><a href="config-files.html#exercise-using-config-files"><i class="fa fa-check"></i>Exercise: Using Config Files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="self-documenting-help.html"><a href="self-documenting-help.html"><i class="fa fa-check"></i><b>15</b> Self Documenting Help</a><ul>
<li class="chapter" data-level="15.1" data-path="self-documenting-help.html"><a href="self-documenting-help.html#our-commenting-syle"><i class="fa fa-check"></i><b>15.1</b> Our Commenting Syle</a></li>
<li class="chapter" data-level="15.2" data-path="self-documenting-help.html"><a href="self-documenting-help.html#adding-further-comments"><i class="fa fa-check"></i><b>15.2</b> Adding Further Comments</a><ul>
<li class="chapter" data-level="" data-path="self-documenting-help.html"><a href="self-documenting-help.html#exercise-adding-comments"><i class="fa fa-check"></i>Exercise: Adding Comments</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="self-documenting-help.html"><a href="self-documenting-help.html#a-help-rule"><i class="fa fa-check"></i><b>15.3</b> A <code>help</code> Rule</a><ul>
<li><a href="self-documenting-help.html#exercise-saving-help-output-to-file">Exercise: Saving <code>help</code> output to file</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html"><i class="fa fa-check"></i><b>16</b> Subworkflows: Divide and Conquer</a><ul>
<li class="chapter" data-level="16.1" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#subworkflow-basics"><i class="fa fa-check"></i><b>16.1</b> Subworkflow Basics</a></li>
<li class="chapter" data-level="16.2" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#subworkflow-dependencies"><i class="fa fa-check"></i><b>16.2</b> Subworkflow dependencies</a><ul>
<li class="chapter" data-level="" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#exercise-more-subworkflows"><i class="fa fa-check"></i>Exercise: More Subworkflows</a></li>
<li><a href="subworkflows-divide-and-conquer.html#guided-exercise-help-rules-with-subworkflows">Guided Exercise: <code>help</code> rules with subworkflows</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VI Putting Workflows in a Box</b></span></li>
<li class="chapter" data-level="17" data-path="package-dependencies-with-renv.html"><a href="package-dependencies-with-renv.html"><i class="fa fa-check"></i><b>17</b> Package Dependencies with <code>renv</code></a></li>
<li class="chapter" data-level="18" data-path="containers.html"><a href="containers.html"><i class="fa fa-check"></i><b>18</b> Containers</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="installation-guide.html"><a href="installation-guide.html"><i class="fa fa-check"></i><b>A</b> Installation Guide</a><ul>
<li class="chapter" data-level="A.1" data-path="installation-guide.html"><a href="installation-guide.html#windows"><i class="fa fa-check"></i><b>A.1</b> Windows</a><ul>
<li class="chapter" data-level="A.1.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal"><i class="fa fa-check"></i><b>A.1.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.1.2" data-path="installation-guide.html"><a href="installation-guide.html#python"><i class="fa fa-check"></i><b>A.1.2</b> Python</a></li>
<li class="chapter" data-level="" data-path="installation-guide.html"><a href="installation-guide.html#installing-snakemake"><i class="fa fa-check"></i>Installing Snakemake</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="installation-guide.html"><a href="installation-guide.html#mac"><i class="fa fa-check"></i><b>A.2</b> Mac</a><ul>
<li class="chapter" data-level="A.2.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal-1"><i class="fa fa-check"></i><b>A.2.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.2.2" data-path="installation-guide.html"><a href="installation-guide.html#python-1"><i class="fa fa-check"></i><b>A.2.2</b> Python</a></li>
<li class="chapter" data-level="" data-path="installation-guide.html"><a href="installation-guide.html#installing-snakemake-1"><i class="fa fa-check"></i>Installing Snakemake</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="installation-guide.html"><a href="installation-guide.html#linux-ubuntu"><i class="fa fa-check"></i><b>A.3</b> Linux / Ubuntu</a><ul>
<li class="chapter" data-level="A.3.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal-2"><i class="fa fa-check"></i><b>A.3.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.3.2" data-path="installation-guide.html"><a href="installation-guide.html#python-2"><i class="fa fa-check"></i><b>A.3.2</b> Python</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>B</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.comlachlandeer/snakemake-econ-r/" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible Data Analytic Workflows with Snakemake and <code>R</code></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="one-rule-to-rule-them-all" class="section level1">
<h1><span class="header-section-number">Chapter 10</span> One rule to rule them all</h1>
<p>We have now officially replicated all the data analysis in <span class="citation">Mankiw, Romer, and Weil (<a href="#ref-mrw" role="doc-biblioref">1992</a>)</span>.
Our analysis pipeline runs via two simple commands,</p>
<ol style="list-style-type: decimal">
<li><code>snakemake make_tables</code> – to construct the regression tables,</li>
<li><code>snakemake make_figures</code> – to construct the figures</li>
</ol>
<p>and executes also all necessary previous steps</p>
<ul>
<li>two data management steps,</li>
<li>a total 24 different regressions for different subsets of the data and regression specifications.</li>
</ul>
<p>We will now create a last target rule to unify all our analysis under a <em>single rule to rule them all</em>.</p>
<div id="the-state-of-the-snakefile-1" class="section level2">
<h2><span class="header-section-number">10.1</span> The State of the Snakefile</h2>
<div class="sourceCode" id="cb141"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb141-1"><a href="one-rule-to-rule-them-all.html#cb141-1"></a></span>
<span id="cb141-2"><a href="one-rule-to-rule-them-all.html#cb141-2"></a><span class="co">##############################################</span></span>
<span id="cb141-3"><a href="one-rule-to-rule-them-all.html#cb141-3"></a><span class="co"># DICTIONARIES</span></span>
<span id="cb141-4"><a href="one-rule-to-rule-them-all.html#cb141-4"></a><span class="co">##############################################</span></span>
<span id="cb141-5"><a href="one-rule-to-rule-them-all.html#cb141-5"></a></span>
<span id="cb141-6"><a href="one-rule-to-rule-them-all.html#cb141-6"></a><span class="ex">MODELS</span> = glob_wildcards(<span class="st">&quot;src/model-specs/{fname}.json&quot;</span>)<span class="ex">.fname</span> </span>
<span id="cb141-7"><a href="one-rule-to-rule-them-all.html#cb141-7"></a></span>
<span id="cb141-8"><a href="one-rule-to-rule-them-all.html#cb141-8"></a><span class="co"># note this filter is only needed coz we are running an older version of the src files, will be updated soon</span></span>
<span id="cb141-9"><a href="one-rule-to-rule-them-all.html#cb141-9"></a><span class="ex">DATA_SUBSET</span> = glob_wildcards(<span class="st">&quot;src/data-specs/{fname}.json&quot;</span>)<span class="ex">.fname</span></span>
<span id="cb141-10"><a href="one-rule-to-rule-them-all.html#cb141-10"></a><span class="ex">DATA_SUBSET</span> = list(filter(lambda x: x.startswith(<span class="st">&quot;subset&quot;</span>), <span class="ex">DATA_SUBSET</span>))</span>
<span id="cb141-11"><a href="one-rule-to-rule-them-all.html#cb141-11"></a></span>
<span id="cb141-12"><a href="one-rule-to-rule-them-all.html#cb141-12"></a><span class="ex">PLOTS</span> = glob_wildcards(<span class="st">&quot;src/figures/{fname}.R&quot;</span>)<span class="ex">.fname</span></span>
<span id="cb141-13"><a href="one-rule-to-rule-them-all.html#cb141-13"></a></span>
<span id="cb141-14"><a href="one-rule-to-rule-them-all.html#cb141-14"></a><span class="ex">TABLES</span> = glob_wildcards(<span class="st">&quot;src/table-specs/{fname}.json&quot;</span>)<span class="ex">.fname</span></span>
<span id="cb141-15"><a href="one-rule-to-rule-them-all.html#cb141-15"></a></span>
<span id="cb141-16"><a href="one-rule-to-rule-them-all.html#cb141-16"></a></span>
<span id="cb141-17"><a href="one-rule-to-rule-them-all.html#cb141-17"></a><span class="co">##############################################</span></span>
<span id="cb141-18"><a href="one-rule-to-rule-them-all.html#cb141-18"></a><span class="co"># TARGETS</span></span>
<span id="cb141-19"><a href="one-rule-to-rule-them-all.html#cb141-19"></a><span class="co">##############################################</span></span>
<span id="cb141-20"><a href="one-rule-to-rule-them-all.html#cb141-20"></a></span>
<span id="cb141-21"><a href="one-rule-to-rule-them-all.html#cb141-21"></a><span class="ex">rule</span> make_tables:</span>
<span id="cb141-22"><a href="one-rule-to-rule-them-all.html#cb141-22"></a>    <span class="ex">input</span>:</span>
<span id="cb141-23"><a href="one-rule-to-rule-them-all.html#cb141-23"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/tables/{iTable}.tex&quot;</span>,</span>
<span id="cb141-24"><a href="one-rule-to-rule-them-all.html#cb141-24"></a>                <span class="ex">iTable</span> = TABLES)</span>
<span id="cb141-25"><a href="one-rule-to-rule-them-all.html#cb141-25"></a></span>
<span id="cb141-26"><a href="one-rule-to-rule-them-all.html#cb141-26"></a><span class="ex">rule</span> run_models:</span>
<span id="cb141-27"><a href="one-rule-to-rule-them-all.html#cb141-27"></a>    <span class="ex">input</span>:</span>
<span id="cb141-28"><a href="one-rule-to-rule-them-all.html#cb141-28"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/analysis/{iModel}.{iSubset}.rds&quot;</span>,</span>
<span id="cb141-29"><a href="one-rule-to-rule-them-all.html#cb141-29"></a>                    <span class="ex">iSubset</span> = DATA_SUBSET,</span>
<span id="cb141-30"><a href="one-rule-to-rule-them-all.html#cb141-30"></a>                    <span class="ex">iModel</span> = MODELS)</span>
<span id="cb141-31"><a href="one-rule-to-rule-them-all.html#cb141-31"></a></span>
<span id="cb141-32"><a href="one-rule-to-rule-them-all.html#cb141-32"></a><span class="ex">rule</span> make_figures:</span>
<span id="cb141-33"><a href="one-rule-to-rule-them-all.html#cb141-33"></a>    <span class="ex">input</span>:</span>
<span id="cb141-34"><a href="one-rule-to-rule-them-all.html#cb141-34"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/figures/{iFigure}.pdf&quot;</span>,</span>
<span id="cb141-35"><a href="one-rule-to-rule-them-all.html#cb141-35"></a>                    <span class="ex">iFigure</span> = PLOTS)</span>
<span id="cb141-36"><a href="one-rule-to-rule-them-all.html#cb141-36"></a></span>
<span id="cb141-37"><a href="one-rule-to-rule-them-all.html#cb141-37"></a></span>
<span id="cb141-38"><a href="one-rule-to-rule-them-all.html#cb141-38"></a><span class="co">##############################################</span></span>
<span id="cb141-39"><a href="one-rule-to-rule-them-all.html#cb141-39"></a><span class="co"># INTERMEDIATE RULES</span></span>
<span id="cb141-40"><a href="one-rule-to-rule-them-all.html#cb141-40"></a><span class="co">##############################################</span></span>
<span id="cb141-41"><a href="one-rule-to-rule-them-all.html#cb141-41"></a></span>
<span id="cb141-42"><a href="one-rule-to-rule-them-all.html#cb141-42"></a><span class="ex">rule</span> table:</span>
<span id="cb141-43"><a href="one-rule-to-rule-them-all.html#cb141-43"></a>    <span class="ex">input</span>:</span>
<span id="cb141-44"><a href="one-rule-to-rule-them-all.html#cb141-44"></a>        <span class="ex">script</span> = <span class="st">&quot;src/tables/regression_table.R&quot;</span>,</span>
<span id="cb141-45"><a href="one-rule-to-rule-them-all.html#cb141-45"></a>        <span class="ex">spec</span>   = <span class="st">&quot;src/table-specs/{iTable}.json&quot;</span>,</span>
<span id="cb141-46"><a href="one-rule-to-rule-them-all.html#cb141-46"></a>        <span class="ex">models</span> = expand(<span class="st">&quot;out/analysis/{iModel}.{iSubset}.rds&quot;</span>,</span>
<span id="cb141-47"><a href="one-rule-to-rule-them-all.html#cb141-47"></a>                        <span class="ex">iModel</span> = MODELS,</span>
<span id="cb141-48"><a href="one-rule-to-rule-them-all.html#cb141-48"></a>                        <span class="ex">iSubset</span> = DATA_SUBSET),</span>
<span id="cb141-49"><a href="one-rule-to-rule-them-all.html#cb141-49"></a>    <span class="ex">output</span>:</span>
<span id="cb141-50"><a href="one-rule-to-rule-them-all.html#cb141-50"></a>        <span class="ex">table</span> = <span class="st">&quot;out/tables/{iTable}.tex&quot;</span></span>
<span id="cb141-51"><a href="one-rule-to-rule-them-all.html#cb141-51"></a>    <span class="ex">shell</span>:</span>
<span id="cb141-52"><a href="one-rule-to-rule-them-all.html#cb141-52"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb141-53"><a href="one-rule-to-rule-them-all.html#cb141-53"></a><span class="st">            --spec {input.spec} \</span></span>
<span id="cb141-54"><a href="one-rule-to-rule-them-all.html#cb141-54"></a><span class="st">            --out {output.table}&quot;</span></span>
<span id="cb141-55"><a href="one-rule-to-rule-them-all.html#cb141-55"></a></span>
<span id="cb141-56"><a href="one-rule-to-rule-them-all.html#cb141-56"></a><span class="ex">rule</span> model:</span>
<span id="cb141-57"><a href="one-rule-to-rule-them-all.html#cb141-57"></a>    <span class="ex">input</span>:</span>
<span id="cb141-58"><a href="one-rule-to-rule-them-all.html#cb141-58"></a>        <span class="ex">script</span> = <span class="st">&quot;src/analysis/estimate_ols_model.R&quot;</span>,</span>
<span id="cb141-59"><a href="one-rule-to-rule-them-all.html#cb141-59"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb141-60"><a href="one-rule-to-rule-them-all.html#cb141-60"></a>        <span class="ex">model</span>  = <span class="st">&quot;src/model-specs/{iModel}.json&quot;</span>,</span>
<span id="cb141-61"><a href="one-rule-to-rule-them-all.html#cb141-61"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/{iSubset}.json&quot;</span></span>
<span id="cb141-62"><a href="one-rule-to-rule-them-all.html#cb141-62"></a>    <span class="ex">output</span>:</span>
<span id="cb141-63"><a href="one-rule-to-rule-them-all.html#cb141-63"></a>        <span class="ex">estimate</span> = <span class="st">&quot;out/analysis/{iModel}.{iSubset}.rds&quot;</span></span>
<span id="cb141-64"><a href="one-rule-to-rule-them-all.html#cb141-64"></a>    <span class="ex">shell</span>:</span>
<span id="cb141-65"><a href="one-rule-to-rule-them-all.html#cb141-65"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb141-66"><a href="one-rule-to-rule-them-all.html#cb141-66"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb141-67"><a href="one-rule-to-rule-them-all.html#cb141-67"></a><span class="st">            --model {input.model} \</span></span>
<span id="cb141-68"><a href="one-rule-to-rule-them-all.html#cb141-68"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb141-69"><a href="one-rule-to-rule-them-all.html#cb141-69"></a><span class="st">            --out {output.estimate}&quot;</span></span>
<span id="cb141-70"><a href="one-rule-to-rule-them-all.html#cb141-70"></a></span>
<span id="cb141-71"><a href="one-rule-to-rule-them-all.html#cb141-71"></a><span class="ex">rule</span> figure:</span>
<span id="cb141-72"><a href="one-rule-to-rule-them-all.html#cb141-72"></a>    <span class="ex">input</span>:</span>
<span id="cb141-73"><a href="one-rule-to-rule-them-all.html#cb141-73"></a>        <span class="ex">script</span> = <span class="st">&quot;src/figures/{iFigure}.R&quot;</span>,</span>
<span id="cb141-74"><a href="one-rule-to-rule-them-all.html#cb141-74"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb141-75"><a href="one-rule-to-rule-them-all.html#cb141-75"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/subset_intermediate.json&quot;</span></span>
<span id="cb141-76"><a href="one-rule-to-rule-them-all.html#cb141-76"></a>    <span class="ex">output</span>:</span>
<span id="cb141-77"><a href="one-rule-to-rule-them-all.html#cb141-77"></a>        <span class="ex">fig</span> = <span class="st">&quot;out/figures/{iFigure}.pdf&quot;</span></span>
<span id="cb141-78"><a href="one-rule-to-rule-them-all.html#cb141-78"></a>    <span class="ex">shell</span>:</span>
<span id="cb141-79"><a href="one-rule-to-rule-them-all.html#cb141-79"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb141-80"><a href="one-rule-to-rule-them-all.html#cb141-80"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb141-81"><a href="one-rule-to-rule-them-all.html#cb141-81"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb141-82"><a href="one-rule-to-rule-them-all.html#cb141-82"></a><span class="st">            --out {output.fig}&quot;</span></span>
<span id="cb141-83"><a href="one-rule-to-rule-them-all.html#cb141-83"></a></span>
<span id="cb141-84"><a href="one-rule-to-rule-them-all.html#cb141-84"></a><span class="ex">rule</span> gen_regression_vars:</span>
<span id="cb141-85"><a href="one-rule-to-rule-them-all.html#cb141-85"></a>    <span class="ex">input</span>:</span>
<span id="cb141-86"><a href="one-rule-to-rule-them-all.html#cb141-86"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/gen_reg_vars.R&quot;</span>,</span>
<span id="cb141-87"><a href="one-rule-to-rule-them-all.html#cb141-87"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span>,</span>
<span id="cb141-88"><a href="one-rule-to-rule-them-all.html#cb141-88"></a>        <span class="ex">param</span>  = <span class="st">&quot;src/data-specs/param_solow.json&quot;</span></span>
<span id="cb141-89"><a href="one-rule-to-rule-them-all.html#cb141-89"></a>    <span class="ex">output</span>:</span>
<span id="cb141-90"><a href="one-rule-to-rule-them-all.html#cb141-90"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span></span>
<span id="cb141-91"><a href="one-rule-to-rule-them-all.html#cb141-91"></a>    <span class="ex">shell</span>:</span>
<span id="cb141-92"><a href="one-rule-to-rule-them-all.html#cb141-92"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb141-93"><a href="one-rule-to-rule-them-all.html#cb141-93"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb141-94"><a href="one-rule-to-rule-them-all.html#cb141-94"></a><span class="st">            --param {input.param} \</span></span>
<span id="cb141-95"><a href="one-rule-to-rule-them-all.html#cb141-95"></a><span class="st">            --out {output.data}&quot;</span></span>
<span id="cb141-96"><a href="one-rule-to-rule-them-all.html#cb141-96"></a></span>
<span id="cb141-97"><a href="one-rule-to-rule-them-all.html#cb141-97"></a><span class="ex">rule</span> rename_vars:</span>
<span id="cb141-98"><a href="one-rule-to-rule-them-all.html#cb141-98"></a>    <span class="ex">input</span>:</span>
<span id="cb141-99"><a href="one-rule-to-rule-them-all.html#cb141-99"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/rename_variables.R&quot;</span>,</span>
<span id="cb141-100"><a href="one-rule-to-rule-them-all.html#cb141-100"></a>        <span class="ex">data</span>   = <span class="st">&quot;src/data/mrw.dta&quot;</span></span>
<span id="cb141-101"><a href="one-rule-to-rule-them-all.html#cb141-101"></a>    <span class="ex">output</span>:</span>
<span id="cb141-102"><a href="one-rule-to-rule-them-all.html#cb141-102"></a>        <span class="ex">data</span> = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span></span>
<span id="cb141-103"><a href="one-rule-to-rule-them-all.html#cb141-103"></a>    <span class="ex">shell</span>:</span>
<span id="cb141-104"><a href="one-rule-to-rule-them-all.html#cb141-104"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb141-105"><a href="one-rule-to-rule-them-all.html#cb141-105"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb141-106"><a href="one-rule-to-rule-them-all.html#cb141-106"></a><span class="st">            --out {output.data}&quot;</span></span>
<span id="cb141-107"><a href="one-rule-to-rule-them-all.html#cb141-107"></a></span>
<span id="cb141-108"><a href="one-rule-to-rule-them-all.html#cb141-108"></a></span>
<span id="cb141-109"><a href="one-rule-to-rule-them-all.html#cb141-109"></a><span class="co">##############################################</span></span>
<span id="cb141-110"><a href="one-rule-to-rule-them-all.html#cb141-110"></a><span class="co"># CLEANING RULES</span></span>
<span id="cb141-111"><a href="one-rule-to-rule-them-all.html#cb141-111"></a><span class="co">##############################################</span></span>
<span id="cb141-112"><a href="one-rule-to-rule-them-all.html#cb141-112"></a></span>
<span id="cb141-113"><a href="one-rule-to-rule-them-all.html#cb141-113"></a><span class="ex">rule</span> clean:</span>
<span id="cb141-114"><a href="one-rule-to-rule-them-all.html#cb141-114"></a>    <span class="ex">shell</span>:</span>
<span id="cb141-115"><a href="one-rule-to-rule-them-all.html#cb141-115"></a>        <span class="st">&quot;rm -rf out/*&quot;</span></span>
<span id="cb141-116"><a href="one-rule-to-rule-them-all.html#cb141-116"></a></span>
<span id="cb141-117"><a href="one-rule-to-rule-them-all.html#cb141-117"></a><span class="ex">rule</span> clean_data:</span>
<span id="cb141-118"><a href="one-rule-to-rule-them-all.html#cb141-118"></a>    <span class="ex">shell</span>:</span>
<span id="cb141-119"><a href="one-rule-to-rule-them-all.html#cb141-119"></a>        <span class="st">&quot;rm -rf out/data/*&quot;</span></span>
<span id="cb141-120"><a href="one-rule-to-rule-them-all.html#cb141-120"></a></span>
<span id="cb141-121"><a href="one-rule-to-rule-them-all.html#cb141-121"></a><span class="ex">rule</span> clean_analysis:</span>
<span id="cb141-122"><a href="one-rule-to-rule-them-all.html#cb141-122"></a>    <span class="ex">shell</span>:</span>
<span id="cb141-123"><a href="one-rule-to-rule-them-all.html#cb141-123"></a>        <span class="st">&quot;rm -rf out/analysis/*&quot;</span></span></code></pre></div>
</div>
<div id="creating-an-all-target-rule" class="section level2">
<h2><span class="header-section-number">10.2</span> Creating an <code>all</code> target rule</h2>
<p>Our <code>all</code> rule unifies the <code>make_figures</code> and <code>make_tables</code> target rules.</p>
<p>Let’s take a look at the structure of each of these rules so that we get a sense of what we might need to do.</p>
<p>Here is the <code>make_figures</code> rule:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb142-1"><a href="one-rule-to-rule-them-all.html#cb142-1"></a><span class="ex">rule</span> make_figures:</span>
<span id="cb142-2"><a href="one-rule-to-rule-them-all.html#cb142-2"></a>    <span class="ex">input</span>:</span>
<span id="cb142-3"><a href="one-rule-to-rule-them-all.html#cb142-3"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/figures/{iFigure}.pdf&quot;</span>,</span>
<span id="cb142-4"><a href="one-rule-to-rule-them-all.html#cb142-4"></a>                <span class="ex">iFigure</span> = FIGURES)</span></code></pre></div>
<p>And the <code>make_tables</code> rule:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb143-1"><a href="one-rule-to-rule-them-all.html#cb143-1"></a><span class="ex">rule</span> make_tables:</span>
<span id="cb143-2"><a href="one-rule-to-rule-them-all.html#cb143-2"></a>    <span class="ex">input</span>:</span>
<span id="cb143-3"><a href="one-rule-to-rule-them-all.html#cb143-3"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/tables/{iTable}.tex&quot;</span>,</span>
<span id="cb143-4"><a href="one-rule-to-rule-them-all.html#cb143-4"></a>                <span class="ex">iTable</span> = TABLES)</span></code></pre></div>
<p>Both rules only have expanded files as inputs.
To unite both under a single rule, it therefore enough to add all figure and table inputs of these rules under our new rule.</p>
<p>This will give us something like this:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb144-1"><a href="one-rule-to-rule-them-all.html#cb144-1"></a><span class="ex">rule</span> all:</span>
<span id="cb144-2"><a href="one-rule-to-rule-them-all.html#cb144-2"></a>    <span class="ex">input</span>:</span>
<span id="cb144-3"><a href="one-rule-to-rule-them-all.html#cb144-3"></a>                <span class="ex">expand</span>(<span class="st">&quot;out/figures/{iFigure}.pdf&quot;</span>,</span>
<span id="cb144-4"><a href="one-rule-to-rule-them-all.html#cb144-4"></a>                    <span class="ex">iFigure</span> = PLOTS),</span>
<span id="cb144-5"><a href="one-rule-to-rule-them-all.html#cb144-5"></a>                <span class="ex">expand</span>(<span class="st">&quot;out/tables/{iTable}.tex&quot;</span>,</span>
<span id="cb144-6"><a href="one-rule-to-rule-them-all.html#cb144-6"></a>                    <span class="ex">iTable</span> = TABLES)    </span></code></pre></div>
<p>It is best to put this rule as the first rule into <code>Snakefile</code>.
Making it the first rule in the <code>TARGET RULE</code> section above is a good place for this.</p>
<p>Before continuing, let us clean our project folder once more via</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb145-1"><a href="one-rule-to-rule-them-all.html#cb145-1"></a><span class="ex">snakemake</span> --cores 1 clean</span></code></pre></div>
<p>Having the <code>all</code> rule as the first rule in <code>Snakefile</code> allows us to execute our entire project implicitly via:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb146-1"><a href="one-rule-to-rule-them-all.html#cb146-1"></a><span class="ex">snakemake</span> --cores 1</span></code></pre></div>
<div class="sourceCode" id="cb147"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb147-1"><a href="one-rule-to-rule-them-all.html#cb147-1"></a><span class="ex">Building</span> DAG of jobs...</span>
<span id="cb147-2"><a href="one-rule-to-rule-them-all.html#cb147-2"></a><span class="ex">Job</span> counts:</span>
<span id="cb147-3"><a href="one-rule-to-rule-them-all.html#cb147-3"></a>    <span class="ex">count</span>   jobs</span>
<span id="cb147-4"><a href="one-rule-to-rule-them-all.html#cb147-4"></a>    <span class="ex">1</span>   all</span>
<span id="cb147-5"><a href="one-rule-to-rule-them-all.html#cb147-5"></a>    <span class="ex">3</span>   figure</span>
<span id="cb147-6"><a href="one-rule-to-rule-them-all.html#cb147-6"></a>    <span class="ex">1</span>   gen_regression_vars</span>
<span id="cb147-7"><a href="one-rule-to-rule-them-all.html#cb147-7"></a>    <span class="ex">24</span>  model</span>
<span id="cb147-8"><a href="one-rule-to-rule-them-all.html#cb147-8"></a>    <span class="ex">1</span>   rename_vars</span>
<span id="cb147-9"><a href="one-rule-to-rule-them-all.html#cb147-9"></a>    <span class="ex">6</span>   table</span>
<span id="cb147-10"><a href="one-rule-to-rule-them-all.html#cb147-10"></a>    <span class="ex">36</span></span>
<span id="cb147-11"><a href="one-rule-to-rule-them-all.html#cb147-11"></a></span>
<span id="cb147-12"><a href="one-rule-to-rule-them-all.html#cb147-12"></a>[<span class="ex">...</span>]</span>
<span id="cb147-13"><a href="one-rule-to-rule-them-all.html#cb147-13"></a></span>
<span id="cb147-14"><a href="one-rule-to-rule-them-all.html#cb147-14"></a>[<span class="ex">Sun</span> Feb 21 22:16:41 2021]</span>
<span id="cb147-15"><a href="one-rule-to-rule-them-all.html#cb147-15"></a><span class="ex">localrule</span> all:</span>
<span id="cb147-16"><a href="one-rule-to-rule-them-all.html#cb147-16"></a>    <span class="ex">input</span>: out/figures/aug_conditional_convergence.pdf,  </span>
<span id="cb147-17"><a href="one-rule-to-rule-them-all.html#cb147-17"></a>    <span class="ex">out/figures</span>/<span class="ex">conditional_convergence.pdf</span>, out/figures/  unconditional_convergence.pdf,  </span>
<span id="cb147-18"><a href="one-rule-to-rule-them-all.html#cb147-18"></a>    <span class="ex">out/tables</span>/<span class="ex">table_06.tex</span>, out/tables/table_01.tex, out/tables/table_02.tex,  </span>
<span id="cb147-19"><a href="one-rule-to-rule-them-all.html#cb147-19"></a>    <span class="ex">out/tables</span>/<span class="ex">table_03.tex</span>, out/tables/table_04.tex, out/tables/table_05.tex  </span>
<span id="cb147-20"><a href="one-rule-to-rule-them-all.html#cb147-20"></a>    <span class="ex">jobid</span>: 0</span>
<span id="cb147-21"><a href="one-rule-to-rule-them-all.html#cb147-21"></a></span>
<span id="cb147-22"><a href="one-rule-to-rule-them-all.html#cb147-22"></a>[<span class="ex">Sun</span> Feb 21 22:16:41 2021]  </span>
<span id="cb147-23"><a href="one-rule-to-rule-them-all.html#cb147-23"></a><span class="ex">Finished</span> job 0.  </span>
<span id="cb147-24"><a href="one-rule-to-rule-them-all.html#cb147-24"></a><span class="ex">36</span> of 36 steps (100%) <span class="kw">done</span></span></code></pre></div>
<p>And that’s it!
Our rule has executed all 36 steps necessary to replicate the entire analysis of <span class="citation">Mankiw, Romer, and Weil (<a href="#ref-mrw" role="doc-biblioref">1992</a>)</span>.</p>
<p>If we examine the full Snakemake output which we omitted here, we see the order in which Snakemake executed the jobs:</p>
<ol style="list-style-type: decimal">
<li>First the data management steps are executed to prepare the data
<ul>
<li>This is what we would expect, as we cannot do any analysis without cleaned data</li>
</ul></li>
<li>Then all figures are produced
<ul>
<li>Figures are the first input to the <code>all</code> rule and therefore produced first.</li>
</ul></li>
<li>Next all tables are produced
<ul>
<li>They are the final outputs to the <code>all</code> rule<br />
</li>
</ul></li>
<li>Last the <code>all</code> rule is executed
<ul>
<li>As a good target rule, this does nothing substantial.</li>
</ul></li>
</ol>
<p>We note three more things:</p>
<ol style="list-style-type: decimal">
<li>The <code>make_figures</code> and <code>make_tables</code> target rules are not executed. The <code>all</code> rule sits parallel to both (has the same inputs as them) and does not require their output (they do not produce any, after all).</li>
<li>The order of jobs in the count statistic at the beginning of the output does not reflect the actual build order.</li>
<li>Some R console outputs are mixed in between the Snakemake messages. Essentially this is caused by our terminal application being too slow in printing messages to keep up with all the computational steps in the background. This does not reflect the actual steps, which are of course aligned and can be safely ignored.</li>
</ol>
</div>
<div id="concluding-remarks" class="section level2">
<h2><span class="header-section-number">10.3</span> Concluding Remarks</h2>
<p>We have now created a fully reproducible replication workflow.
With a single line of code we can execute the whole analysis of <span class="citation">Mankiw, Romer, and Weil (<a href="#ref-mrw" role="doc-biblioref">1992</a>)</span>.</p>
<p>It is now also a breeze to make modifications to the analysis.
Snakemake and the <code>all</code> rule allow us to simply re-run all modified steps and all downstream operations that depend on them so that all results are updated accordingly.
We can even add additional models, regression tables or figures without having to remember to account for them in our build script.
Using <code>glob_wildcards</code> will always ensure that all additional analysis is performed.</p>
<p>This state of our project is a natural end point for any researcher or research assistant who performs the data analysis in a project with colleagues who do not use Snakemake themselves.
In such a workflow the data analysis and drafting stages of slides or a research paper are often separate processes.</p>
<p>For a single researcher or a group of researchers, who all work jointly with Snakemake, we have created the next chapter.
There we will also automate the generation of a research paper draft and presentation slides in a single workflow together with the data analysis.</p>

</div>
</div>
<h3><span class="header-section-number">B</span> References</h3>
<div id="refs" class="references">
<div id="ref-mrw">
<p>Mankiw, N. Gregory, David Romer, and David N. Weil. 1992. “A Contribution to the Empirics of Economic Growth*.” <em>The Quarterly Journal of Economics</em> 107 (2): 407–37. <a href="https://doi.org/10.2307/2118477">https://doi.org/10.2307/2118477</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="make-tables.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="adding-papers-and-slides-to-a-snakemake-workflow.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/lachlandeer/snakemake-econ-r/edit/master/32-all.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["https://github.com/lachlandeer/snakemake-econ-r/raw/master/32-all.Rmd"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
