<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Target Rules | Reproducible Data Analytic Workflows with Snakemake and R</title>
  <meta name="description" content="In progress" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Target Rules | Reproducible Data Analytic Workflows with Snakemake and R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="In progress" />
  <meta name="github-repo" content="lachlandeer/snakemake-econ-r-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Target Rules | Reproducible Data Analytic Workflows with Snakemake and R" />
  
  <meta name="twitter:description" content="In progress" />
  

<meta name="author" content="Ulrich Bergmann" />
<meta name="author" content="Lachlan Deer" />
<meta name="author" content="Julian Langer" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="working-with-multiple-rules.html"/>
<link rel="next" href="wildcards.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="img/logo.png"></a></li>
<div style="text-align:center">
<li><a href="./index.html">Reproducible Data Analytic <br /> Workflows with Snakemake and `R`</a></li>
</div>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-we-wrote-this-tutorial"><i class="fa fa-check"></i>Why we wrote this tutorial</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#pre-requisite-knowledge"><i class="fa fa-check"></i>Pre-requisite Knowledge</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-needs-to-be-downloaded-installed-for-this-tutorial"><i class="fa fa-check"></i>What Needs to be Downloaded &amp; Installed for this Tutorial</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#template-scripts-and-documents"><i class="fa fa-check"></i>Template Scripts and Documents</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-installation"><i class="fa fa-check"></i>Software Installation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-we-cant-cover"><i class="fa fa-check"></i>What We Can’t Cover</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the Authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#instructional-material"><i class="fa fa-check"></i>Instructional material</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software"><i class="fa fa-check"></i>Software</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#citation"><i class="fa fa-check"></i>Citation</a></li>
</ul></li>
<li class="part"><span><b>I Preliminaries</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Motivating &amp; Rationale</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#a-case-for-reproducibility"><i class="fa fa-check"></i><b>1.1</b> A Case for Reproducibility</a><ul>
<li class="chapter" data-level="1.1.1" data-path="intro.html"><a href="intro.html#how-far-to-go-in-the-quest-for-reproducibility"><i class="fa fa-check"></i><b>1.1.1</b> How far to go in the quest for reproducibility?</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#what-is-snakemake-why-should-you-use-it"><i class="fa fa-check"></i><b>1.2</b> What is <code>Snakemake</code> &amp; Why Should you use it?</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#why-r"><i class="fa fa-check"></i><b>1.3</b> Why <code>R</code>?</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#working-example-replicating-mankiw-romer-and-weils-1992-qje"><i class="fa fa-check"></i><b>1.4</b> Working Example: Replicating Mankiw, Romer and Weil’s 1992 QJE</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#the-way-forward"><i class="fa fa-check"></i><b>1.5</b> The way forward</a><ul>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#exercise-your-own-projects-steps"><i class="fa fa-check"></i>Exercise: Your own project’s steps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="project-organization.html"><a href="project-organization.html"><i class="fa fa-check"></i><b>2</b> Project Organization</a><ul>
<li class="chapter" data-level="" data-path="project-organization.html"><a href="project-organization.html#learning-objectives-1"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="2.1" data-path="project-organization.html"><a href="project-organization.html#subtitle-tbd"><i class="fa fa-check"></i><b>2.1</b> Subtitle TBD</a></li>
<li class="chapter" data-level="2.2" data-path="project-organization.html"><a href="project-organization.html#project-organization-i-separating-inputs-and-outputs"><i class="fa fa-check"></i><b>2.2</b> Project Organization I: Separating Inputs and Outputs</a></li>
<li class="chapter" data-level="2.3" data-path="project-organization.html"><a href="project-organization.html#project-structure-ii-separating-logical-chunks-of-the-project"><i class="fa fa-check"></i><b>2.3</b> Project Structure II: Separating Logical Chunks of the Project</a><ul>
<li class="chapter" data-level="2.3.1" data-path="project-organization.html"><a href="project-organization.html#aside-even-deeper-sub-folders"><i class="fa fa-check"></i><b>2.3.1</b> Aside: Even Deeper Sub-folders</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="project-organization.html"><a href="project-organization.html#project-structure-iii-separating-input-parameters-from-code"><i class="fa fa-check"></i><b>2.4</b> Project Structure III: Separating Input Parameters from Code</a></li>
</ul></li>
<li class="part"><span><b>II Basic Snakemake Workflows</b></span></li>
<li class="chapter" data-level="3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html"><i class="fa fa-check"></i><b>3</b> Initial Steps with Snakemake</a><ul>
<li class="chapter" data-level="3.1" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#writing-our-first-rule"><i class="fa fa-check"></i><b>3.1</b> Writing Our First Rule</a></li>
<li class="chapter" data-level="3.2" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#executing-a-rule"><i class="fa fa-check"></i><b>3.2</b> Executing a Rule</a></li>
<li class="chapter" data-level="3.3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#first-steps-in-the-mrw-pipeline"><i class="fa fa-check"></i><b>3.3</b> First Steps in the MRW Pipeline</a><ul>
<li class="chapter" data-level="3.3.1" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#using-the-rscript-command-to-execute-r-scripts"><i class="fa fa-check"></i><b>3.3.1</b> Using the <code>Rscript</code> command to execute R scripts</a></li>
<li class="chapter" data-level="3.3.2" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#the-input-and-output-arguments"><i class="fa fa-check"></i><b>3.3.2</b> The <code>input</code> and <code>output</code> arguments</a></li>
<li class="chapter" data-level="3.3.3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#a-rule-to-rename-variables."><i class="fa fa-check"></i><b>3.3.3</b> A rule to rename variables.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#no-redundant-executions"><i class="fa fa-check"></i><b>3.4</b> No Redundant Executions</a></li>
<li class="chapter" data-level="3.5" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#our-workflow-in-graphs"><i class="fa fa-check"></i><b>3.5</b> Our Workflow in Graphs</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html"><i class="fa fa-check"></i><b>4</b> Working With Multiple Rules</a><ul>
<li class="chapter" data-level="4.1" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#creating-a-second-rule"><i class="fa fa-check"></i><b>4.1</b> Creating a second rule</a><ul>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#exercise-creating-rules"><i class="fa fa-check"></i>Exercise: Creating Rules</a></li>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#solution"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#clean-rules"><i class="fa fa-check"></i><b>4.2</b> Clean Rules</a><ul>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#exercise-creating-cleaning-rules"><i class="fa fa-check"></i>Exercise: Creating Cleaning Rules</a></li>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#solution-1"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="target-rules.html"><a href="target-rules.html"><i class="fa fa-check"></i><b>5</b> Target Rules</a><ul>
<li class="chapter" data-level="5.1" data-path="target-rules.html"><a href="target-rules.html#where-we-are-now"><i class="fa fa-check"></i><b>5.1</b> Where we are now?</a></li>
<li class="chapter" data-level="5.2" data-path="target-rules.html"><a href="target-rules.html#how-snakemake-determines-the-build-order-when-multiple-rules-are-present"><i class="fa fa-check"></i><b>5.2</b> How Snakemake determines the build order when multiple rules are present</a></li>
<li class="chapter" data-level="5.3" data-path="target-rules.html"><a href="target-rules.html#dedicated-target-rules-to-execute-multiple-rules"><i class="fa fa-check"></i><b>5.3</b> Dedicated target rules to execute multiple rules</a><ul>
<li class="chapter" data-level="" data-path="target-rules.html"><a href="target-rules.html#exercise-using-target-rules"><i class="fa fa-check"></i>Exercise: Using target rules</a></li>
<li class="chapter" data-level="" data-path="target-rules.html"><a href="target-rules.html#solution-2"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="target-rules.html"><a href="target-rules.html#target-rules-can-do-more-for-us"><i class="fa fa-check"></i><b>5.4</b> Target rules can do more for us</a></li>
</ul></li>
<li class="part"><span><b>III Minimizing Repetition, Maximizing Generalizability</b></span></li>
<li class="chapter" data-level="6" data-path="wildcards.html"><a href="wildcards.html"><i class="fa fa-check"></i><b>6</b> Wildcards</a><ul>
<li class="chapter" data-level="6.1" data-path="wildcards.html"><a href="wildcards.html#the-starting-point-of-our-snakefile"><i class="fa fa-check"></i><b>6.1</b> The starting point of our Snakefile</a></li>
<li class="chapter" data-level="6.2" data-path="wildcards.html"><a href="wildcards.html#using-wildcards-to-tidy-up-our-code"><i class="fa fa-check"></i><b>6.2</b> Using wildcards to tidy up our code</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html"><i class="fa fa-check"></i><b>7</b> Automatic Expansion of Wildcards</a><ul>
<li class="chapter" data-level="7.1" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#learning-goals"><i class="fa fa-check"></i><b>7.1</b> Learning Goals</a></li>
<li class="chapter" data-level="7.2" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#the-expand-function"><i class="fa fa-check"></i><b>7.2</b> The <code>expand()</code> function</a><ul>
<li class="chapter" data-level="" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#exercise-exploring-the-expand-function-i"><i class="fa fa-check"></i>Exercise: Exploring the expand function I</a></li>
<li class="chapter" data-level="7.2.1" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#solution-3"><i class="fa fa-check"></i><b>7.2.1</b> SOLUTION:</a></li>
<li class="chapter" data-level="" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#exercise-exploring-the-expand-function-ii"><i class="fa fa-check"></i>Exercise: Exploring the expand() function II</a></li>
<li class="chapter" data-level="7.2.2" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#solution-4"><i class="fa fa-check"></i><b>7.2.2</b> Solution</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#expanding-multiple-wildcards"><i class="fa fa-check"></i><b>7.3</b> Expanding Multiple Wildcards</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html"><i class="fa fa-check"></i><b>8</b> Automating List Construction for Wildcard Expansion</a><ul>
<li class="chapter" data-level="8.1" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#learning-objectives-2"><i class="fa fa-check"></i><b>8.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="8.2" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#state-of-the-snakefile"><i class="fa fa-check"></i><b>8.2</b> State of the Snakefile</a></li>
<li class="chapter" data-level="8.3" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#the-glob_wildcards-function"><i class="fa fa-check"></i><b>8.3</b> The <code>glob_wildcards</code> Function</a></li>
<li class="chapter" data-level="8.4" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#looking-at-the-dag-redux"><i class="fa fa-check"></i><b>8.4</b> Looking at the DAG (redux)</a><ul>
<li class="chapter" data-level="" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#exercise-exploring-glob_wildcards"><i class="fa fa-check"></i>Exercise: Exploring glob_wildcards()</a></li>
<li class="chapter" data-level="8.4.1" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#solution-5"><i class="fa fa-check"></i><b>8.4.1</b> Solution</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Bringing Many Outputs Together</b></span></li>
<li class="chapter" data-level="9" data-path="make-tables.html"><a href="make-tables.html"><i class="fa fa-check"></i><b>9</b> Make Tables</a><ul>
<li class="chapter" data-level="9.1" data-path="make-tables.html"><a href="make-tables.html#the-state-of-the-snakefile"><i class="fa fa-check"></i><b>9.1</b> The State of the Snakefile</a></li>
<li class="chapter" data-level="9.2" data-path="make-tables.html"><a href="make-tables.html#building-a-single-table"><i class="fa fa-check"></i><b>9.2</b> Building a single table</a></li>
<li class="chapter" data-level="9.3" data-path="make-tables.html"><a href="make-tables.html#building-all-tables-at-once"><i class="fa fa-check"></i><b>9.3</b> Building all tables at once</a><ul>
<li class="chapter" data-level="" data-path="make-tables.html"><a href="make-tables.html#exercise"><i class="fa fa-check"></i>Exercise</a></li>
<li class="chapter" data-level="" data-path="make-tables.html"><a href="make-tables.html#solution-6"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html"><i class="fa fa-check"></i><b>10</b> One rule to rule them all</a><ul>
<li class="chapter" data-level="10.1" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#the-state-of-the-snakefile-1"><i class="fa fa-check"></i><b>10.1</b> The State of the Snakefile</a></li>
<li class="chapter" data-level="10.2" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#creating-an-all-target-rule"><i class="fa fa-check"></i><b>10.2</b> Creating an <code>all</code> target rule</a></li>
<li class="chapter" data-level="10.3" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#concluding-remarks"><i class="fa fa-check"></i><b>10.3</b> Concluding Remarks</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html"><i class="fa fa-check"></i><b>11</b> Adding Papers and Slides to a Snakemake Workflow</a><ul>
<li class="chapter" data-level="11.1" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#learning-objectives-3"><i class="fa fa-check"></i><b>11.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="11.2" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#state-of-our-snakefile"><i class="fa fa-check"></i><b>11.2</b> State of Our Snakefile</a></li>
<li class="chapter" data-level="11.3" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#where-we-are"><i class="fa fa-check"></i><b>11.3</b> Where We Are</a></li>
<li class="chapter" data-level="11.4" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#building-a-paper"><i class="fa fa-check"></i><b>11.4</b> Building a Paper</a></li>
<li class="chapter" data-level="11.5" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#integrating-build_paper-output-into-all"><i class="fa fa-check"></i><b>11.5</b> Integrating <code>build_paper</code> output into <code>all</code></a></li>
<li class="chapter" data-level="11.6" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#making-paper.pdf-easier-to-find"><i class="fa fa-check"></i><b>11.6</b> Making <code>paper.pdf</code> Easier to Find</a><ul>
<li class="chapter" data-level="11.6.1" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#exercise-adding-a-slide-deck."><i class="fa fa-check"></i><b>11.6.1</b> Exercise: Adding a Slide Deck.</a></li>
<li class="chapter" data-level="11.6.2" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#exercise-solution"><i class="fa fa-check"></i><b>11.6.2</b> Exercise Solution</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#final-thoughts"><i class="fa fa-check"></i><b>11.7</b> Final Thoughts</a></li>
</ul></li>
<li class="part"><span><b>V Decorating Snakemake Workflows</b></span></li>
<li class="chapter" data-level="12" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html"><i class="fa fa-check"></i><b>12</b> Logging Output and Errors</a><ul>
<li class="chapter" data-level="12.1" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#logging-output"><i class="fa fa-check"></i><b>12.1</b> Logging Output</a></li>
<li class="chapter" data-level="12.2" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#logging-output-and-errors-in-one-file"><i class="fa fa-check"></i><b>12.2</b> Logging Output and Errors in One File</a><ul>
<li class="chapter" data-level="" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#exercise-logging-all-r-scripts"><i class="fa fa-check"></i>Exercise: Logging all R Scripts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="adding-parameters.html"><a href="adding-parameters.html"><i class="fa fa-check"></i><b>13</b> Adding Parameters</a><ul>
<li class="chapter" data-level="13.1" data-path="adding-parameters.html"><a href="adding-parameters.html#motivating-example-constructing-a-regression-table-from-ols-results"><i class="fa fa-check"></i><b>13.1</b> Motivating Example: Constructing a Regression Table from OLS Results</a></li>
<li class="chapter" data-level="13.2" data-path="adding-parameters.html"><a href="adding-parameters.html#creating-a-rule-with-params"><i class="fa fa-check"></i><b>13.2</b> Creating a Rule with <code>params</code></a><ul>
<li class="chapter" data-level="" data-path="adding-parameters.html"><a href="adding-parameters.html#exercise-building-table-2"><i class="fa fa-check"></i>Exercise: Building Table 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="config-files.html"><a href="config-files.html"><i class="fa fa-check"></i><b>14</b> Config Files</a><ul>
<li class="chapter" data-level="14.1" data-path="config-files.html"><a href="config-files.html#the-config.yaml-filepath"><i class="fa fa-check"></i><b>14.1</b> The <code>config.yaml</code> filepath</a></li>
<li class="chapter" data-level="14.2" data-path="config-files.html"><a href="config-files.html#using-paths-from-the-config-file"><i class="fa fa-check"></i><b>14.2</b> Using paths from the config file</a><ul>
<li class="chapter" data-level="" data-path="config-files.html"><a href="config-files.html#exercise-using-config-files"><i class="fa fa-check"></i>Exercise: Using Config Files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="self-documenting-help.html"><a href="self-documenting-help.html"><i class="fa fa-check"></i><b>15</b> Self Documenting Help</a><ul>
<li class="chapter" data-level="15.1" data-path="self-documenting-help.html"><a href="self-documenting-help.html#our-commenting-syle"><i class="fa fa-check"></i><b>15.1</b> Our Commenting Syle</a></li>
<li class="chapter" data-level="15.2" data-path="self-documenting-help.html"><a href="self-documenting-help.html#adding-further-comments"><i class="fa fa-check"></i><b>15.2</b> Adding Further Comments</a><ul>
<li class="chapter" data-level="" data-path="self-documenting-help.html"><a href="self-documenting-help.html#exercise-adding-comments"><i class="fa fa-check"></i>Exercise: Adding Comments</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="self-documenting-help.html"><a href="self-documenting-help.html#a-help-rule"><i class="fa fa-check"></i><b>15.3</b> A <code>help</code> Rule</a><ul>
<li><a href="self-documenting-help.html#exercise-saving-help-output-to-file">Exercise: Saving <code>help</code> output to file</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html"><i class="fa fa-check"></i><b>16</b> Subworkflows: Divide and Conquer</a><ul>
<li class="chapter" data-level="16.1" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#subworkflow-basics"><i class="fa fa-check"></i><b>16.1</b> Subworkflow Basics</a></li>
<li class="chapter" data-level="16.2" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#subworkflow-dependencies"><i class="fa fa-check"></i><b>16.2</b> Subworkflow dependencies</a><ul>
<li class="chapter" data-level="" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#exercise-more-subworkflows"><i class="fa fa-check"></i>Exercise: More Subworkflows</a></li>
<li><a href="subworkflows-divide-and-conquer.html#guided-exercise-help-rules-with-subworkflows">Guided Exercise: <code>help</code> rules with subworkflows</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VI Putting Workflows in a Box</b></span></li>
<li class="chapter" data-level="17" data-path="package-dependencies-with-renv.html"><a href="package-dependencies-with-renv.html"><i class="fa fa-check"></i><b>17</b> Package Dependencies with <code>renv</code></a></li>
<li class="chapter" data-level="18" data-path="containers.html"><a href="containers.html"><i class="fa fa-check"></i><b>18</b> Containers</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="installation-guide.html"><a href="installation-guide.html"><i class="fa fa-check"></i><b>A</b> Installation Guide</a><ul>
<li class="chapter" data-level="A.1" data-path="installation-guide.html"><a href="installation-guide.html#windows"><i class="fa fa-check"></i><b>A.1</b> Windows</a><ul>
<li class="chapter" data-level="A.1.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal"><i class="fa fa-check"></i><b>A.1.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.1.2" data-path="installation-guide.html"><a href="installation-guide.html#python"><i class="fa fa-check"></i><b>A.1.2</b> Python</a></li>
<li class="chapter" data-level="" data-path="installation-guide.html"><a href="installation-guide.html#installing-snakemake"><i class="fa fa-check"></i>Installing Snakemake</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="installation-guide.html"><a href="installation-guide.html#mac"><i class="fa fa-check"></i><b>A.2</b> Mac</a><ul>
<li class="chapter" data-level="A.2.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal-1"><i class="fa fa-check"></i><b>A.2.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.2.2" data-path="installation-guide.html"><a href="installation-guide.html#python-1"><i class="fa fa-check"></i><b>A.2.2</b> Python</a></li>
<li class="chapter" data-level="" data-path="installation-guide.html"><a href="installation-guide.html#installing-snakemake-1"><i class="fa fa-check"></i>Installing Snakemake</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="installation-guide.html"><a href="installation-guide.html#linux-ubuntu"><i class="fa fa-check"></i><b>A.3</b> Linux / Ubuntu</a><ul>
<li class="chapter" data-level="A.3.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal-2"><i class="fa fa-check"></i><b>A.3.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.3.2" data-path="installation-guide.html"><a href="installation-guide.html#python-2"><i class="fa fa-check"></i><b>A.3.2</b> Python</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>B</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.comlachlandeer/snakemake-econ-r/" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible Data Analytic Workflows with Snakemake and <code>R</code></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="target-rules" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Target Rules</h1>
<p>Learning Goals:</p>
<ul>
<li>How to build several parallel tasks at once</li>
</ul>
<div id="where-we-are-now" class="section level2">
<h2><span class="header-section-number">5.1</span> Where we are now?</h2>
<p>If you still have the <code>hello_world</code> rule in your Snakefile, now is a good moment to remove it.
Then, your Snakefile should look something like this:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb65-1"><a href="target-rules.html#cb65-1"></a><span class="co">## Snakemake - MRW Replication</span></span>
<span id="cb65-2"><a href="target-rules.html#cb65-2"></a><span class="co">##</span></span>
<span id="cb65-3"><a href="target-rules.html#cb65-3"></a><span class="co">## @yourname</span></span>
<span id="cb65-4"><a href="target-rules.html#cb65-4"></a></span>
<span id="cb65-5"><a href="target-rules.html#cb65-5"></a></span>
<span id="cb65-6"><a href="target-rules.html#cb65-6"></a><span class="co"># --- OLS Rules --- #</span></span>
<span id="cb65-7"><a href="target-rules.html#cb65-7"></a></span>
<span id="cb65-8"><a href="target-rules.html#cb65-8"></a><span class="ex">rule</span> solow_intermediate:</span>
<span id="cb65-9"><a href="target-rules.html#cb65-9"></a>    <span class="ex">input</span>:</span>
<span id="cb65-10"><a href="target-rules.html#cb65-10"></a>        <span class="ex">script</span>   = <span class="st">&quot;src/analysis/estimate_ols_model.R&quot;</span>,</span>
<span id="cb65-11"><a href="target-rules.html#cb65-11"></a>        <span class="ex">data</span>     = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb65-12"><a href="target-rules.html#cb65-12"></a>        <span class="ex">model</span>    = <span class="st">&quot;src/model-specs/model_solow.json&quot;</span>,</span>
<span id="cb65-13"><a href="target-rules.html#cb65-13"></a>        <span class="ex">subset</span>   = <span class="st">&quot;src/data-specs/subset_intermediate.json&quot;</span></span>
<span id="cb65-14"><a href="target-rules.html#cb65-14"></a>    <span class="ex">output</span>:</span>
<span id="cb65-15"><a href="target-rules.html#cb65-15"></a>        <span class="ex">estimate</span> = <span class="st">&quot;out/analysis/model_solow_subset_intermediate.rds&quot;</span>,</span>
<span id="cb65-16"><a href="target-rules.html#cb65-16"></a>    <span class="ex">shell</span>:</span>
<span id="cb65-17"><a href="target-rules.html#cb65-17"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb65-18"><a href="target-rules.html#cb65-18"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb65-19"><a href="target-rules.html#cb65-19"></a><span class="st">            --model {input.model} \</span></span>
<span id="cb65-20"><a href="target-rules.html#cb65-20"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb65-21"><a href="target-rules.html#cb65-21"></a><span class="st">            --out {output.estimate}&quot;</span></span>
<span id="cb65-22"><a href="target-rules.html#cb65-22"></a></span>
<span id="cb65-23"><a href="target-rules.html#cb65-23"></a><span class="ex">rule</span> solow_nonoil:</span>
<span id="cb65-24"><a href="target-rules.html#cb65-24"></a>    <span class="ex">input</span>:</span>
<span id="cb65-25"><a href="target-rules.html#cb65-25"></a>        <span class="ex">script</span>   = <span class="st">&quot;src/analysis/estimate_ols_model.R&quot;</span>,</span>
<span id="cb65-26"><a href="target-rules.html#cb65-26"></a>        <span class="ex">data</span>     = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb65-27"><a href="target-rules.html#cb65-27"></a>        <span class="ex">model</span>    = <span class="st">&quot;src/model-specs/model_solow.json&quot;</span>,</span>
<span id="cb65-28"><a href="target-rules.html#cb65-28"></a>        <span class="ex">subset</span>   = <span class="st">&quot;src/data-specs/subset_nonoil.json&quot;</span></span>
<span id="cb65-29"><a href="target-rules.html#cb65-29"></a>    <span class="ex">output</span>:</span>
<span id="cb65-30"><a href="target-rules.html#cb65-30"></a>        <span class="ex">estimate</span> = <span class="st">&quot;out/analysis/model_solow_subset_nonoil.rds&quot;</span>,</span>
<span id="cb65-31"><a href="target-rules.html#cb65-31"></a>    <span class="ex">shell</span>:</span>
<span id="cb65-32"><a href="target-rules.html#cb65-32"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb65-33"><a href="target-rules.html#cb65-33"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb65-34"><a href="target-rules.html#cb65-34"></a><span class="st">            --model {input.model} \</span></span>
<span id="cb65-35"><a href="target-rules.html#cb65-35"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb65-36"><a href="target-rules.html#cb65-36"></a><span class="st">            --out {output.estimate}&quot;</span></span>
<span id="cb65-37"><a href="target-rules.html#cb65-37"></a></span>
<span id="cb65-38"><a href="target-rules.html#cb65-38"></a><span class="ex">rule</span> solow_oecd:</span>
<span id="cb65-39"><a href="target-rules.html#cb65-39"></a>    <span class="ex">input</span>:</span>
<span id="cb65-40"><a href="target-rules.html#cb65-40"></a>        <span class="ex">script</span>   = <span class="st">&quot;src/analysis/estimate_ols_model.R&quot;</span>,</span>
<span id="cb65-41"><a href="target-rules.html#cb65-41"></a>        <span class="ex">data</span>     = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb65-42"><a href="target-rules.html#cb65-42"></a>        <span class="ex">model</span>    = <span class="st">&quot;src/model-specs/model_solow.json&quot;</span>,</span>
<span id="cb65-43"><a href="target-rules.html#cb65-43"></a>        <span class="ex">subset</span>   = <span class="st">&quot;src/data-specs/subset_oecd.json&quot;</span></span>
<span id="cb65-44"><a href="target-rules.html#cb65-44"></a>    <span class="ex">output</span>:</span>
<span id="cb65-45"><a href="target-rules.html#cb65-45"></a>        <span class="ex">estimate</span> = <span class="st">&quot;out/analysis/model_solow_subset_oecd.rds&quot;</span>,</span>
<span id="cb65-46"><a href="target-rules.html#cb65-46"></a>    <span class="ex">shell</span>:</span>
<span id="cb65-47"><a href="target-rules.html#cb65-47"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb65-48"><a href="target-rules.html#cb65-48"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb65-49"><a href="target-rules.html#cb65-49"></a><span class="st">            --model {input.model} \</span></span>
<span id="cb65-50"><a href="target-rules.html#cb65-50"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb65-51"><a href="target-rules.html#cb65-51"></a><span class="st">            --out {output.estimate}&quot;</span></span>
<span id="cb65-52"><a href="target-rules.html#cb65-52"></a></span>
<span id="cb65-53"><a href="target-rules.html#cb65-53"></a></span>
<span id="cb65-54"><a href="target-rules.html#cb65-54"></a><span class="co"># --- Data Management --- #</span></span>
<span id="cb65-55"><a href="target-rules.html#cb65-55"></a></span>
<span id="cb65-56"><a href="target-rules.html#cb65-56"></a><span class="ex">rule</span> gen_regression_vars:</span>
<span id="cb65-57"><a href="target-rules.html#cb65-57"></a>    <span class="ex">input</span>:</span>
<span id="cb65-58"><a href="target-rules.html#cb65-58"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/gen_reg_vars.R&quot;</span>,</span>
<span id="cb65-59"><a href="target-rules.html#cb65-59"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span></span>
<span id="cb65-60"><a href="target-rules.html#cb65-60"></a>    <span class="ex">output</span>:</span>
<span id="cb65-61"><a href="target-rules.html#cb65-61"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span></span>
<span id="cb65-62"><a href="target-rules.html#cb65-62"></a>    <span class="ex">shell</span>:</span>
<span id="cb65-63"><a href="target-rules.html#cb65-63"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb65-64"><a href="target-rules.html#cb65-64"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb65-65"><a href="target-rules.html#cb65-65"></a><span class="st">            --out {output.data}&quot;</span></span>
<span id="cb65-66"><a href="target-rules.html#cb65-66"></a></span>
<span id="cb65-67"><a href="target-rules.html#cb65-67"></a><span class="ex">rule</span> rename_vars:</span>
<span id="cb65-68"><a href="target-rules.html#cb65-68"></a>    <span class="ex">input</span>:</span>
<span id="cb65-69"><a href="target-rules.html#cb65-69"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/rename_variables.R&quot;</span>,</span>
<span id="cb65-70"><a href="target-rules.html#cb65-70"></a>        <span class="ex">data</span>   = <span class="st">&quot;src/data/mrw.dta&quot;</span></span>
<span id="cb65-71"><a href="target-rules.html#cb65-71"></a>    <span class="ex">output</span>:</span>
<span id="cb65-72"><a href="target-rules.html#cb65-72"></a>        <span class="ex">data</span> = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span></span>
<span id="cb65-73"><a href="target-rules.html#cb65-73"></a>    <span class="ex">shell</span>:</span>
<span id="cb65-74"><a href="target-rules.html#cb65-74"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb65-75"><a href="target-rules.html#cb65-75"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb65-76"><a href="target-rules.html#cb65-76"></a><span class="st">            --out {output.data}&quot;</span></span>
<span id="cb65-77"><a href="target-rules.html#cb65-77"></a></span>
<span id="cb65-78"><a href="target-rules.html#cb65-78"></a></span>
<span id="cb65-79"><a href="target-rules.html#cb65-79"></a><span class="co"># --- Clean Rules --- #</span></span>
<span id="cb65-80"><a href="target-rules.html#cb65-80"></a></span>
<span id="cb65-81"><a href="target-rules.html#cb65-81"></a><span class="ex">rule</span> clean:</span>
<span id="cb65-82"><a href="target-rules.html#cb65-82"></a>    <span class="ex">shell</span>:</span>
<span id="cb65-83"><a href="target-rules.html#cb65-83"></a>        <span class="st">&quot;rm -rf out/*&quot;</span></span>
<span id="cb65-84"><a href="target-rules.html#cb65-84"></a></span>
<span id="cb65-85"><a href="target-rules.html#cb65-85"></a><span class="ex">rule</span> clean_data:</span>
<span id="cb65-86"><a href="target-rules.html#cb65-86"></a>    <span class="ex">shell</span>:</span>
<span id="cb65-87"><a href="target-rules.html#cb65-87"></a>        <span class="st">&quot;rm -rf out/data/*&quot;</span></span>
<span id="cb65-88"><a href="target-rules.html#cb65-88"></a></span>
<span id="cb65-89"><a href="target-rules.html#cb65-89"></a><span class="ex">rule</span> clean_analysis:</span>
<span id="cb65-90"><a href="target-rules.html#cb65-90"></a>    <span class="ex">shell</span>:</span>
<span id="cb65-91"><a href="target-rules.html#cb65-91"></a>        <span class="st">&quot;rm -rf out/analysis/*&quot;</span></span></code></pre></div>
</div>
<div id="how-snakemake-determines-the-build-order-when-multiple-rules-are-present" class="section level2">
<h2><span class="header-section-number">5.2</span> How Snakemake determines the build order when multiple rules are present</h2>
<p>Now that we have worked with multiple rules and seen how one can execute another rule, let us try to understand the principle behind this.</p>
<p>As we know, we can execute any rule in <code>Snakefile</code> explicitly by calling it by name:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb66-1"><a href="target-rules.html#cb66-1"></a><span class="ex">snakemake</span> --cores 1 solow_intermediate</span></code></pre></div>
<p>When no rule name is explicitly given, Snakemake will execute the first rule it encounters at the top of <code>Snakefile</code>:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb67-1"><a href="target-rules.html#cb67-1"></a><span class="ex">snakemake</span> --cores 1</span></code></pre></div>
<p>If you followed the order of rules in the solution to the previous exercise, <code>solow_intermediate</code> is the first rule in <code>Snakefile</code>.
In this case, both the explicit and implicit commands are equivalent.
You can verify this by cleaning your project before executing either or by adding <code>--summary</code> to either command.</p>
<p>The rule we ask <code>Snakemake</code> to execute either explicitly or implicitly is called a <strong>target rule</strong>.
Snakemake focusses on executing this rule.</p>
<p>When all necessary inputs to build the target rule exist, Snakemake will simply execute the rule and build the defined outputs.</p>
<p>When Snakemake recognizes that a necessary input to execute the target rule is missing, Snakemake will try to build it through the other rules present in <code>Snakefile</code>.</p>
<p>To illustrate this, let us stick to our present project and assume the target rule is <code>solow_intermediate</code>.
The following graph shows all rules which lead up to the target rule:</p>
<embed src="img/ch-5a/filegraph.pdf" style="display: block; margin: auto;" type="application/pdf" />
<p><code>mrw_complete.csv</code> is a necessary input to <code>solow_intermediate</code>.
If the file does not exist, <code>Snakemake</code> will search through <code>Snakefile</code> for another rule which has <code>mrw_complete.csv</code> as its output – in our case <code>gen_regression_vars</code>.
In this case, Snakemake will first execute <code>gen_regression_vars</code> before executing the target rule <code>solow_intermediate</code>.</p>
<p>If necessary inputs are missing to execute <code>gen_regression_vars</code>, Snakemake will search for other rules to produce it and so forth…</p>
<p>To allow Snakemake to work properly, the input and output relationships in a project need to follow a <strong>directed acyclic graph (DAG)</strong>.
TODO: Finish sentence.
Directed here means that….
Acyclic implies that there can be no two rules which require output from one another as inputs, either directly or in a larger loop.</p>
<p>This has a few implications on how we should define our intermediate input and output files.
We should follow the following best practices to prevent problems:</p>
<ul>
<li><strong>No rule should have the same file as input and output.</strong> It is often common practice to load a certain dataset, perform operations on it and overwrite the original file. While there are good reasons to never do this in any workflow, this behavior can lead to more severe problems when using Snakemake. Snakemake only searches for rules which can create input files which do <strong>not</strong> exist. If a rule overwrites an already existing input file, Snakemake would not recognize it as a dependency and simply ignore it. This implies that a project might run through cleanly and produce incorrect results without this being detected. In our workflow, we prevented such behavior by making sure the <code>gen_regression_vars</code> rule writes its results to a new file.</li>
<li><strong>No two rules should have the same output.</strong> When Snakemake searches for a file to create a missing input file, it will execute the first rule it encounters which produces this file. To make sure our input and output relationships are explicit and reproducible, we do not want the order of the rules in a <code>Snakefile</code> determine which rule is actually executed.</li>
<li><strong>A project should have a clear direction.</strong> A project should have a clear trajectory. In practice this typically starts with data manipulations which are necessary to perform analysis, which in turn will be used to create plots and tables, which finally end up in a paper or set of slides.
In such a typical workflow, directedness implies for example that a regression table ist not an input in the data manipulation steps.</li>
<li><strong>A project cannot be circular.</strong> Any circularity would let Snakemake search for rules in an infinite loop.</li>
</ul>
</div>
<div id="dedicated-target-rules-to-execute-multiple-rules" class="section level2">
<h2><span class="header-section-number">5.3</span> Dedicated target rules to execute multiple rules</h2>
<p>Currently, our project has three rules which perform OLS regressions parallel to one another at the top of <code>Snakefile</code>.
As only one rule can be the target, it would require us to execute Snakemake three times – once for every OLS regression:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb68-1"><a href="target-rules.html#cb68-1"></a><span class="ex">snakemake</span> --cores 1 solow_intermediate</span>
<span id="cb68-2"><a href="target-rules.html#cb68-2"></a><span class="ex">snakemake</span> --cores 1 solow_nonoil</span>
<span id="cb68-3"><a href="target-rules.html#cb68-3"></a><span class="ex">snakemake</span> --cores 1 solow_oecd</span></code></pre></div>
<p>While either command would simplify our lives a bit by also running all the necessary data manipulations automatically, it’s still a bit silly to run Snakemake repeatedly.
After all it is our goal to make our workflow reproducible via a single line of code.</p>
<p>Now that we understand the concept of <code>target rules</code>, we will try to make use of them to our advantage.</p>
<p>As we know, Snakemake will execute any rule which can produce an output which a target rule requires as its input.
Adding a new dedicated target rule which requires the outputs of our three solow models will allow us to execute all three rules via a single line of code.</p>
<p>We add this rule at the top of <code>Snakefile</code> and name it <code>solow_target</code>.
The rule only has three inputs, one for the output of each solow model like so:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb69-1"><a href="target-rules.html#cb69-1"></a><span class="ex">rule</span> solow_target:</span>
<span id="cb69-2"><a href="target-rules.html#cb69-2"></a>    <span class="ex">input</span>:</span>
<span id="cb69-3"><a href="target-rules.html#cb69-3"></a>        <span class="ex">intermediate</span> = <span class="st">&quot;out/analysis/model_solow_subset_intermediate.rds&quot;</span>,</span>
<span id="cb69-4"><a href="target-rules.html#cb69-4"></a>        <span class="ex">nonoil</span>       = <span class="st">&quot;out/analysis/model_solow_subset_nonoil.rds&quot;</span>,</span>
<span id="cb69-5"><a href="target-rules.html#cb69-5"></a>        <span class="ex">oecd</span>         = <span class="st">&quot;out/analysis/model_solow_subset_oecd.rds&quot;</span></span></code></pre></div>
<p>After saving <code>Snakefile</code>, we can inspect how Snakemake perceives the state of our project with the summary option</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb70-1"><a href="target-rules.html#cb70-1"></a><span class="ex">snakemake</span> --summary</span></code></pre></div>
<div class="sourceCode" id="cb71"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb71-1"><a href="target-rules.html#cb71-1"></a><span class="ex">output_file</span> date    rule    version log-file(s) <span class="ex">status</span>  plan</span>
<span id="cb71-2"><a href="target-rules.html#cb71-2"></a><span class="ex">out/analysis/model_solow_subset_intermediate.rds</span>    Thu Feb 18 14:18:20 2021    solow_intermediate  -       ok  no update</span>
<span id="cb71-3"><a href="target-rules.html#cb71-3"></a><span class="ex">out/analysis/model_solow_subset_nonoil.rds</span>  -   -   -   -   missing update pending</span>
<span id="cb71-4"><a href="target-rules.html#cb71-4"></a><span class="ex">out/analysis/model_solow_subset_oecd.rds</span>    -   -   -   -   missing update pending</span>
<span id="cb71-5"><a href="target-rules.html#cb71-5"></a><span class="ex">out/data/mrw_complete.csv</span>   Thu Feb 11 16:29:24 2021    gen_regression_vars -       ok  no update</span>
<span id="cb71-6"><a href="target-rules.html#cb71-6"></a><span class="ex">out/data/mrw_renamed.csv</span>    Tue Feb  9 15:46:38 2021    rename_vars -       ok  no update</span></code></pre></div>
<p>What does this mean?
Snakemake sees the three <code>model_solow_*</code> outputs as files it needs to create for the <code>solow_target</code> rule.
Out of these three files, the first, <code>model_solow_subset_intermediate.rds</code> already exists and is up to date after our last run above.
The other two files, <code>model_solow_subset_nonoil.rds</code> and <code>model_solow_subset_oecd.rds</code>, do not yet exist and must be created.
The rule column presents the rule Snakemake found to create the respective output file.</p>
<p>The output therefore shows, that a single run of <code>solow_target</code> would create all files in our project.
In the following exercise, you will practice executing the project with help of our new target rule.</p>
<div id="exercise-using-target-rules" class="section level3 unnumbered exercise">
<h3>Exercise: Using target rules</h3>
<p>It is time to put our new and shiny target rule to work and execute our full workflow with a single line of code.</p>
<ol style="list-style-type: decimal">
<li>Delete the content of the <code>out/</code> folder with help of the <code>clean</code> rule.</li>
<li>Verify that the output folder is empty.</li>
<li>Execute the <code>solow_target</code> rule and build all outputs in a single swoop.</li>
</ol>
</div>
<div id="solution-2" class="section level3 unnumbered solution">
<h3>Solution</h3>
<ol style="list-style-type: decimal">
<li>Delete the content of the <code>out/</code> folder with help of the <code>clean</code> rule.</li>
</ol>
<div class="sourceCode" id="cb72"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb72-1"><a href="target-rules.html#cb72-1"></a><span class="ex">snakemake</span> --cores 1 clean</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Verify that the output folder is empty.</li>
</ol>
<div class="sourceCode" id="cb73"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb73-1"><a href="target-rules.html#cb73-1"></a><span class="fu">ls</span> out</span></code></pre></div>
<div class="sourceCode" id="cb74"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb74-1"><a href="target-rules.html#cb74-1"></a><span class="ex">Nothing</span> to show here</span></code></pre></div>
<p>This shows that the output folder is indeed cleaned properly.</p>
<ol start="3" style="list-style-type: decimal">
<li>Execute the <code>solow_target</code> rule and build all outputs in a single swoop.</li>
</ol>
<div class="sourceCode" id="cb75"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb75-1"><a href="target-rules.html#cb75-1"></a><span class="ex">snakemake</span> --cores 1 solow_target</span></code></pre></div>
<div class="sourceCode" id="cb76"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb76-1"><a href="target-rules.html#cb76-1"></a><span class="ex">Building</span> DAG of jobs...</span>
<span id="cb76-2"><a href="target-rules.html#cb76-2"></a><span class="ex">Using</span> shell: /bin/bash</span>
<span id="cb76-3"><a href="target-rules.html#cb76-3"></a><span class="ex">Provided</span> cores: 1 (use --cores to define parallelism)</span>
<span id="cb76-4"><a href="target-rules.html#cb76-4"></a><span class="ex">Rules</span> claiming more threads will be scaled down.</span>
<span id="cb76-5"><a href="target-rules.html#cb76-5"></a><span class="ex">Job</span> counts:</span>
<span id="cb76-6"><a href="target-rules.html#cb76-6"></a>    <span class="ex">count</span>   jobs</span>
<span id="cb76-7"><a href="target-rules.html#cb76-7"></a>    <span class="ex">1</span>   gen_regression_vars</span>
<span id="cb76-8"><a href="target-rules.html#cb76-8"></a>    <span class="ex">1</span>   rename_vars</span>
<span id="cb76-9"><a href="target-rules.html#cb76-9"></a>    <span class="ex">1</span>   solow_intermediate</span>
<span id="cb76-10"><a href="target-rules.html#cb76-10"></a>    <span class="ex">1</span>   solow_nonoil</span>
<span id="cb76-11"><a href="target-rules.html#cb76-11"></a>    <span class="ex">1</span>   solow_oecd</span>
<span id="cb76-12"><a href="target-rules.html#cb76-12"></a>    <span class="ex">1</span>   solow_target</span>
<span id="cb76-13"><a href="target-rules.html#cb76-13"></a>    <span class="ex">6</span></span>
<span id="cb76-14"><a href="target-rules.html#cb76-14"></a></span>
<span id="cb76-15"><a href="target-rules.html#cb76-15"></a>[<span class="ex">...</span>]</span>
<span id="cb76-16"><a href="target-rules.html#cb76-16"></a></span>
<span id="cb76-17"><a href="target-rules.html#cb76-17"></a>[<span class="ex">Thu</span> Feb 18 14:38:11 2021]</span>
<span id="cb76-18"><a href="target-rules.html#cb76-18"></a><span class="ex">localrule</span> solow_target:</span>
<span id="cb76-19"><a href="target-rules.html#cb76-19"></a>    <span class="ex">input</span>: out/analysis/model_solow_subset_intermediate.rds, out/analysis/model_solow_subset_nonoil.rds, out/analysis/model_solow_subset_oecd.rds</span>
<span id="cb76-20"><a href="target-rules.html#cb76-20"></a>    <span class="ex">jobid</span>: 0</span>
<span id="cb76-21"><a href="target-rules.html#cb76-21"></a></span>
<span id="cb76-22"><a href="target-rules.html#cb76-22"></a>[<span class="ex">Thu</span> Feb 18 14:38:11 2021]</span>
<span id="cb76-23"><a href="target-rules.html#cb76-23"></a><span class="ex">Finished</span> job 0.</span>
<span id="cb76-24"><a href="target-rules.html#cb76-24"></a><span class="ex">6</span> of 6 steps (100%) <span class="kw">done</span></span></code></pre></div>
<p>The output which Snakemake prints to the screen starts with the plan Snakemake develops to generate the input files of <code>solow_target</code>.
We see that it needs to run each of the other rules once.
Snakemake then plans to execute <code>solow_target</code> at the end.
The execution of the whole chain of rules sums up to six different task that Snakemake will execute.</p>
<p>The middle part of the output, which we ommit here as <code>[...]</code> contains the messages which would be printed to screen for each of the rules which are executed.
This contains information about Snakemake’s execution as well as the console output that R would print if we execute each of the R scripts in an appropriate IDE such as <code>Rstudio</code>.</p>
<p>Finally the last part prints Snakemake’s reports about the final <code>solow_target</code> rule.
In accordance with the rule itself, it only features input files.</p>
<p>The bottom message contains information about the successful execution of all six rules with a completion rate of 100%.
Snakemake is done.</p>
</div>
</div>
<div id="target-rules-can-do-more-for-us" class="section level2">
<h2><span class="header-section-number">5.4</span> Target rules can do more for us</h2>
<p>As we know, the last execution of our target rule did nothing substantial, as the rule only includes the <code>input</code> part of the rule.</p>
<p>In practice we can also use the target rule to perform other small tasks for us with the desired output.</p>
<ul>
<li>When compiling LaTeX files, it is often easier to have all latex inputs in a separate folder.
LaTeX is typically not very good with relatives paths and likes to create many temporary files which we probably do not want to keep.
To keep things tidy, we can therefore include the cleaning of unwanted LaTeX temporary files and copy the output PDF to the main directory of our project for convenience.</li>
<li>Some of us also use the target rule to copy the output PDF to a shared folder where colleagues can access them.
When you share your work in a Dropbox folder, it can be a large time saver to not copy the output PDF there manually after each update of the draft.</li>
</ul>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="working-with-multiple-rules.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="wildcards.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/lachlandeer/snakemake-econ-r/edit/master/13-target_rules.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["https://github.com/lachlandeer/snakemake-econ-r/raw/master/13-target_rules.Rmd"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
