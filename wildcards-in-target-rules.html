<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Wildcards in Target Rules | Reproducible Data Analytic Workflows for Economics</title>
  <meta name="description" content="In progress" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Wildcards in Target Rules | Reproducible Data Analytic Workflows for Economics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="In progress" />
  <meta name="github-repo" content="lachlandeer/snakemake-econ-r-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Wildcards in Target Rules | Reproducible Data Analytic Workflows for Economics" />
  
  <meta name="twitter:description" content="In progress" />
  

<meta name="author" content="Ulrich Bergmann" />
<meta name="author" content="Lachlan Deer" />
<meta name="author" content="Julian Langer" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="wildcards.html"/>
<link rel="next" href="automating-list-construction-for-wildcard-expansion.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>

<script>
    /* ========================================================================
     * Bootstrap: transition.js v3.3.7
     * http://getbootstrap.com/javascript/#transitions
     * ========================================================================
     * Copyright 2011-2016 Twitter, Inc.
     * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
     * ======================================================================== */
    
    
    +function ($) {
      'use strict';
    
      // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
      // ============================================================
    
      function transitionEnd() {
        var el = document.createElement('bootstrap')
    
        var transEndEventNames = {
          WebkitTransition : 'webkitTransitionEnd',
          MozTransition    : 'transitionend',
          OTransition      : 'oTransitionEnd otransitionend',
          transition       : 'transitionend'
        }
    
        for (var name in transEndEventNames) {
          if (el.style[name] !== undefined) {
            return { end: transEndEventNames[name] }
          }
        }
    
        return false // explicit for ie8 (  ._.)
      }
    
      // http://blog.alexmaccaw.com/css-transitions
      $.fn.emulateTransitionEnd = function (duration) {
        var called = false
        var $el = this
        $(this).one('bsTransitionEnd', function () { called = true })
        var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
        setTimeout(callback, duration)
        return this
      }
    
      $(function () {
        $.support.transition = transitionEnd()
    
        if (!$.support.transition) return
    
        $.event.special.bsTransitionEnd = {
          bindType: $.support.transition.end,
          delegateType: $.support.transition.end,
          handle: function (e) {
            if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
          }
        }
      })
    
    }(jQuery);
    </script>
    <script>
    /* ========================================================================
     * Bootstrap: collapse.js v3.3.7
     * http://getbootstrap.com/javascript/#collapse
     * ========================================================================
     * Copyright 2011-2016 Twitter, Inc.
     * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
     * ======================================================================== */
    
    /* jshint latedef: false */
    
    +function ($) {
      'use strict';
    
      // COLLAPSE PUBLIC CLASS DEFINITION
      // ================================
    
      var Collapse = function (element, options) {
        this.$element      = $(element)
        this.options       = $.extend({}, Collapse.DEFAULTS, options)
        this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                               '[data-toggle="collapse"][data-target="#' + element.id + '"]')
        this.transitioning = null
    
        if (this.options.parent) {
          this.$parent = this.getParent()
        } else {
          this.addAriaAndCollapsedClass(this.$element, this.$trigger)
        }
    
        if (this.options.toggle) this.toggle()
      }
    
      Collapse.VERSION  = '3.3.7'
    
      Collapse.TRANSITION_DURATION = 350
    
      Collapse.DEFAULTS = {
        toggle: true
      }
    
      Collapse.prototype.dimension = function () {
        var hasWidth = this.$element.hasClass('width')
        return hasWidth ? 'width' : 'height'
      }
    
      Collapse.prototype.show = function () {
        if (this.transitioning || this.$element.hasClass('in')) return
    
        var activesData
        var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')
    
        if (actives && actives.length) {
          activesData = actives.data('bs.collapse')
          if (activesData && activesData.transitioning) return
        }
    
        var startEvent = $.Event('show.bs.collapse')
        this.$element.trigger(startEvent)
        if (startEvent.isDefaultPrevented()) return
    
        if (actives && actives.length) {
          Plugin.call(actives, 'hide')
          activesData || actives.data('bs.collapse', null)
        }
    
        var dimension = this.dimension()
    
        this.$element
          .removeClass('collapse')
          .addClass('collapsing')[dimension](0)
          .attr('aria-expanded', true)
    
        this.$trigger
          .removeClass('collapsed')
          .attr('aria-expanded', true)
    
        this.transitioning = 1
    
        var complete = function () {
          this.$element
            .removeClass('collapsing')
            .addClass('collapse in')[dimension]('')
          this.transitioning = 0
          this.$element
            .trigger('shown.bs.collapse')
        }
    
        if (!$.support.transition) return complete.call(this)
    
        var scrollSize = $.camelCase(['scroll', dimension].join('-'))
    
        this.$element
          .one('bsTransitionEnd', $.proxy(complete, this))
          .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
      }
    
      Collapse.prototype.hide = function () {
        if (this.transitioning || !this.$element.hasClass('in')) return
    
        var startEvent = $.Event('hide.bs.collapse')
        this.$element.trigger(startEvent)
        if (startEvent.isDefaultPrevented()) return
    
        var dimension = this.dimension()
    
        this.$element[dimension](this.$element[dimension]())[0].offsetHeight
    
        this.$element
          .addClass('collapsing')
          .removeClass('collapse in')
          .attr('aria-expanded', false)
    
        this.$trigger
          .addClass('collapsed')
          .attr('aria-expanded', false)
    
        this.transitioning = 1
    
        var complete = function () {
          this.transitioning = 0
          this.$element
            .removeClass('collapsing')
            .addClass('collapse')
            .trigger('hidden.bs.collapse')
        }
    
        if (!$.support.transition) return complete.call(this)
    
        this.$element
          [dimension](0)
          .one('bsTransitionEnd', $.proxy(complete, this))
          .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
      }
    
      Collapse.prototype.toggle = function () {
        this[this.$element.hasClass('in') ? 'hide' : 'show']()
      }
    
      Collapse.prototype.getParent = function () {
        return $(this.options.parent)
          .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
          .each($.proxy(function (i, element) {
            var $element = $(element)
            this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
          }, this))
          .end()
      }
    
      Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
        var isOpen = $element.hasClass('in')
    
        $element.attr('aria-expanded', isOpen)
        $trigger
          .toggleClass('collapsed', !isOpen)
          .attr('aria-expanded', isOpen)
      }
    
      function getTargetFromTrigger($trigger) {
        var href
        var target = $trigger.attr('data-target')
          || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7
    
        return $(target)
      }
    
    
      // COLLAPSE PLUGIN DEFINITION
      // ==========================
    
      function Plugin(option) {
        return this.each(function () {
          var $this   = $(this)
          var data    = $this.data('bs.collapse')
          var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)
    
          if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
          if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
          if (typeof option == 'string') data[option]()
        })
      }
    
      var old = $.fn.collapse
    
      $.fn.collapse             = Plugin
      $.fn.collapse.Constructor = Collapse
    
    
      // COLLAPSE NO CONFLICT
      // ====================
    
      $.fn.collapse.noConflict = function () {
        $.fn.collapse = old
        return this
      }
    
    
      // COLLAPSE DATA-API
      // =================
    
      $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
        var $this   = $(this)
    
        if (!$this.attr('data-target')) e.preventDefault()
    
        var $target = getTargetFromTrigger($this)
        var data    = $target.data('bs.collapse')
        var option  = data ? 'toggle' : $this.data()
    
        Plugin.call($target, option)
      })
    
    }(jQuery);
    </script>
    <script>
    window.initializeCodeFolding = function(show) {
    
      // handlers for show-all and hide all
      $("#rmd-show-all-code").click(function() {
        // close the dropdown menu when an option is clicked
        $("#allCodeButton").dropdown("toggle");
        $('div.r-code-collapse').each(function() {
          $(this).collapse('show');
        });
      });
      $("#rmd-hide-all-code").click(function() {
        // close the dropdown menu when an option is clicked
        $("#allCodeButton").dropdown("toggle");
        $('div.r-code-collapse').each(function() {
          $(this).collapse('hide');
        });
      });
    
      // index for unique code element ids
      var currentIndex = 1;
    
      // select all R code blocks
      var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
      rCodeBlocks.each(function() {
    
        // if code block has been labeled with class `fold-show`, show the code on init!
        var classList = $(this).attr('class').split(/\s+/);
        for (var i = 0; i < classList.length; i++) {
        if (classList[i] === 'fold-show') {
            show = true;
          }
        }
    
        // create a collapsable div to wrap the code in
        var div = $('<div class="collapse r-code-collapse"></div>');
        if (show)
          div.addClass('in');
        var id = 'rcode-643E0F36' + currentIndex++;
        div.attr('id', id);
        $(this).before(div);
        $(this).detach().appendTo(div);
    
        // add a show code button right above
        var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
        var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
        showCodeButton.append(showCodeText);
        showCodeButton
            .attr('data-toggle', 'collapse')
            .attr('data-target', '#' + id)
            .attr('aria-expanded', show)
            .attr('aria-controls', id);
    
        var buttonRow = $('<div class="row"></div>');
        var buttonCol = $('<div class="col-md-12"></div>');
    
        buttonCol.append(showCodeButton);
        buttonRow.append(buttonCol);
    
        div.before(buttonRow);
    
        // hack: return show to false, otherwise all next codeBlocks will be shown!
        show = false;
    
        // update state of button on show/hide
        div.on('hidden.bs.collapse', function () {
          showCodeText.text('Code');
        });
        div.on('show.bs.collapse', function () {
          showCodeText.text('Hide');
        });
      });
    
    }
    </script>
    <script>
    /* ========================================================================
     * Bootstrap: dropdown.js v3.3.7
     * http://getbootstrap.com/javascript/#dropdowns
     * ========================================================================
     * Copyright 2011-2016 Twitter, Inc.
     * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
     * ======================================================================== */
    
    
    +function ($) {
      'use strict';
    
      // DROPDOWN CLASS DEFINITION
      // =========================
    
      var backdrop = '.dropdown-backdrop'
      var toggle   = '[data-toggle="dropdown"]'
      var Dropdown = function (element) {
        $(element).on('click.bs.dropdown', this.toggle)
      }
    
      Dropdown.VERSION = '3.3.7'
    
      function getParent($this) {
        var selector = $this.attr('data-target')
    
        if (!selector) {
          selector = $this.attr('href')
          selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
        }
    
        var $parent = selector && $(selector)
    
        return $parent && $parent.length ? $parent : $this.parent()
      }
    
      function clearMenus(e) {
        if (e && e.which === 3) return
        $(backdrop).remove()
        $(toggle).each(function () {
          var $this         = $(this)
          var $parent       = getParent($this)
          var relatedTarget = { relatedTarget: this }
    
          if (!$parent.hasClass('open')) return
    
          if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return
    
          $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))
    
          if (e.isDefaultPrevented()) return
    
          $this.attr('aria-expanded', 'false')
          $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
        })
      }
    
      Dropdown.prototype.toggle = function (e) {
        var $this = $(this)
    
        if ($this.is('.disabled, :disabled')) return
    
        var $parent  = getParent($this)
        var isActive = $parent.hasClass('open')
    
        clearMenus()
    
        if (!isActive) {
          if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
            // if mobile we use a backdrop because click events don't delegate
            $(document.createElement('div'))
              .addClass('dropdown-backdrop')
              .insertAfter($(this))
              .on('click', clearMenus)
          }
    
          var relatedTarget = { relatedTarget: this }
          $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))
    
          if (e.isDefaultPrevented()) return
    
          $this
            .trigger('focus')
            .attr('aria-expanded', 'true')
    
          $parent
            .toggleClass('open')
            .trigger($.Event('shown.bs.dropdown', relatedTarget))
        }
    
        return false
      }
    
      Dropdown.prototype.keydown = function (e) {
        if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return
    
        var $this = $(this)
    
        e.preventDefault()
        e.stopPropagation()
    
        if ($this.is('.disabled, :disabled')) return
    
        var $parent  = getParent($this)
        var isActive = $parent.hasClass('open')
    
        if (!isActive && e.which != 27 || isActive && e.which == 27) {
          if (e.which == 27) $parent.find(toggle).trigger('focus')
          return $this.trigger('click')
        }
    
        var desc = ' li:not(.disabled):visible a'
        var $items = $parent.find('.dropdown-menu' + desc)
    
        if (!$items.length) return
    
        var index = $items.index(e.target)
    
        if (e.which == 38 && index > 0)                 index--         // up
        if (e.which == 40 && index < $items.length - 1) index++         // down
        if (!~index)                                    index = 0
    
        $items.eq(index).trigger('focus')
      }
    
    
      // DROPDOWN PLUGIN DEFINITION
      // ==========================
    
      function Plugin(option) {
        return this.each(function () {
          var $this = $(this)
          var data  = $this.data('bs.dropdown')
    
          if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
          if (typeof option == 'string') data[option].call($this)
        })
      }
    
      var old = $.fn.dropdown
    
      $.fn.dropdown             = Plugin
      $.fn.dropdown.Constructor = Dropdown
    
    
      // DROPDOWN NO CONFLICT
      // ====================
    
      $.fn.dropdown.noConflict = function () {
        $.fn.dropdown = old
        return this
      }
    
    
      // APPLY TO STANDARD DROPDOWN ELEMENTS
      // ===================================
    
      $(document)
        .on('click.bs.dropdown.data-api', clearMenus)
        .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
        .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
        .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
        .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)
    
    }(jQuery);
    </script>
    <style type="text/css">
    .code-folding-btn {
      margin-bottom: 4px;
    }
    
    .row { display: flex; }
    .collapse { display: none; }
    .in { display:block }
    .pull-right > .dropdown-menu {
        right: 0;
        left: auto;
    }
    
    .dropdown-menu {
        position: absolute;
        top: 100%;
        left: 0;
        z-index: 1000;
        display: none;
        float: left;
        min-width: 160px;
        padding: 5px 0;
        margin: 2px 0 0;
        font-size: 14px;
        text-align: left;
        list-style: none;
        background-color: #fff;
        -webkit-background-clip: padding-box;
        background-clip: padding-box;
        border: 1px solid #ccc;
        border: 1px solid rgba(0,0,0,.15);
        border-radius: 4px;
        -webkit-box-shadow: 0 6px 12px rgba(0,0,0,.175);
        box-shadow: 0 6px 12px rgba(0,0,0,.175);
    }
    
    .open > .dropdown-menu {
        display: block;
        color: #ffffff;
        background-color: #ffffff;
        background-image: none;
        border-color: #92897e;
    }
    
    .dropdown-menu > li > a {
      display: block;
      padding: 3px 20px;
      clear: both;
      font-weight: 400;
      line-height: 1.42857143;
      color: #000000;
      white-space: nowrap;
    }
    
    .dropdown-menu > li > a:hover,
    .dropdown-menu > li > a:focus {
      color: #ffffff;
      text-decoration: none;
      background-color: #e95420;
    }
    
    .dropdown-menu > .active > a,
    .dropdown-menu > .active > a:hover,
    .dropdown-menu > .active > a:focus {
      color: #ffffff;
      text-decoration: none;
      background-color: #e95420;
      outline: 0;
    }
    .dropdown-menu > .disabled > a,
    .dropdown-menu > .disabled > a:hover,
    .dropdown-menu > .disabled > a:focus {
      color: #aea79f;
    }
    
    .dropdown-menu > .disabled > a:hover,
    .dropdown-menu > .disabled > a:focus {
      text-decoration: none;
      cursor: not-allowed;
      background-color: transparent;
      background-image: none;
      filter: progid:DXImageTransform.Microsoft.gradient(enabled = false);
    }
    
    .btn {
      display: inline-block;
      margin-bottom: 1;
      font-weight: normal;
      text-align: center;
      white-space: nowrap;
      vertical-align: middle;
      -ms-touch-action: manipulation;
          touch-action: manipulation;
      cursor: pointer;
      background-image: none;
      border: 1px solid transparent;
      padding: 4px 8px;
      font-size: 14px;
      line-height: 1.42857143;
      border-radius: 4px;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    
    .btn:focus,
    .btn:active:focus,
    .btn.active:focus,
    .btn.focus,
    .btn:active.focus,
    .btn.active.focus {
      outline: 5px auto -webkit-focus-ring-color;
      outline-offset: -2px;
    }
    .btn:hover,
    .btn:focus,
    .btn.focus {
      color: #ffffff;
      text-decoration: none;
    }
    .btn:active,
    .btn.active {
      background-image: none;
      outline: 0;
      box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
    }
    .btn.disabled,
    .btn[disabled],
    fieldset[disabled] .btn {
      cursor: not-allowed;
      filter: alpha(opacity=65);
      opacity: 0.65;
      box-shadow: none;
    }
    a.btn.disabled,
    fieldset[disabled] a.btn {
      pointer-events: none;
    }
    .btn-default {
      color: #ffffff;
      background-color: #aea79f; #important
      border-color: #aea79f;
    }
    
    .btn-default:focus,
    .btn-default.focus {
      color: #ffffff;
      background-color: #978e83;
      border-color: #6f675e;
    }
    
    .btn-default:hover {
      color: #ffffff;
      background-color: #978e83;
      border-color: #92897e;
    }
    .btn-default:active,
    .btn-default.active,
    .btn-group > .btn:not(:first-child):not(:last-child):not(.dropdown-toggle) {
      border-radius: 0;
    }
    .btn-group > .btn:first-child {
      margin-left: 0;
    }
    .btn-group > .btn:first-child:not(:last-child):not(.dropdown-toggle) {
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }
    .btn-group > .btn:last-child:not(:first-child),
    .btn-group > .dropdown-toggle:not(:first-child) {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }
    .btn-group > .btn-group {
      float: left;
    }
    .btn-group > .btn-group:not(:first-child):not(:last-child) > .btn {
      border-radius: 0;
    }
    .btn-group > .btn-group:first-child:not(:last-child) > .btn:last-child,
    .btn-group > .btn-group:first-child:not(:last-child) > .dropdown-toggle {
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }
    .btn-group > .btn-group:last-child:not(:first-child) > .btn:first-child {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }
    .btn-group .dropdown-toggle:active,
    .btn-group.open .dropdown-toggle {
      outline: 0;
    }
    .btn-group > .btn + .dropdown-toggle {
      padding-right: 8px;
      padding-left: 8px;
    }
    .btn-group > .btn-lg + .dropdown-toggle {
      padding-right: 12px;
      padding-left: 12px;
    }
    .btn-group.open .dropdown-toggle {
      box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
    }
    .btn-group.open .dropdown-toggle.btn-link {
      box-shadow: none;
    }
    
    </style>
    <script>
    var str = '<div class="btn-group pull-right" style="position: fixed; right: 50px; top: 10px; z-index: 200"><button type="button" class="btn btn-default btn-xs dropdown-toggle" id="allCodeButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-_extension-text-contrast=""><span>Code</span> <span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All Code</a></li><li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li></ul></div>';
    document.write(str);
    </script>
    <script>
    $(document).ready(function () {
      window.initializeCodeFolding("show" === "hide");
    });
    </script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="img/logo.png"></a></li>
<div style="text-align:center">
<li><a href="./index.html">Reproducible Data Analytic <br /> Workflows with Snakemake and `R`</a></li>
</div>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-we-wrote-this-tutorial"><i class="fa fa-check"></i>Why we wrote this tutorial</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#pre-requisite-knowledge"><i class="fa fa-check"></i>Pre-requisite Knowledge</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-needs-to-be-downloaded-installed-for-this-tutorial"><i class="fa fa-check"></i>What Needs to be Downloaded &amp; Installed for this Tutorial</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#template-scripts-and-documents"><i class="fa fa-check"></i>Template Scripts and Documents</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-installation"><i class="fa fa-check"></i>Software Installation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-we-cant-cover"><i class="fa fa-check"></i>What We Can’t Cover</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the Authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#instructional-material"><i class="fa fa-check"></i>Instructional material</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software"><i class="fa fa-check"></i>Software</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#citation"><i class="fa fa-check"></i>Citation</a></li>
</ul></li>
<li class="part"><span><b>I Preliminaries</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Motivating &amp; Rationale</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#a-case-for-reproducibility"><i class="fa fa-check"></i><b>1.1</b> A Case for Reproducibility</a><ul>
<li class="chapter" data-level="1.1.1" data-path="intro.html"><a href="intro.html#how-far-to-go-in-the-quest-for-reproducibility"><i class="fa fa-check"></i><b>1.1.1</b> How far to go in the quest for reproducibility?</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#what-is-snakemake-why-should-you-use-it"><i class="fa fa-check"></i><b>1.2</b> What is <code>Snakemake</code> &amp; Why Should you use it?</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#why-r"><i class="fa fa-check"></i><b>1.3</b> Why <code>R</code>?</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#working-example-replicating-mankiw-romer-and-weils-1992-qje"><i class="fa fa-check"></i><b>1.4</b> Working Example: Replicating Mankiw, Romer and Weil’s 1992 QJE</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#the-way-forward"><i class="fa fa-check"></i><b>1.5</b> The way forward</a><ul>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#exercise-your-own-projects-steps"><i class="fa fa-check"></i>Exercise: Your own project’s steps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="project-organization.html"><a href="project-organization.html"><i class="fa fa-check"></i><b>2</b> Project Organization</a><ul>
<li class="chapter" data-level="" data-path="project-organization.html"><a href="project-organization.html#learning-objectives-1"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="2.1" data-path="project-organization.html"><a href="project-organization.html#subtitle-tbd"><i class="fa fa-check"></i><b>2.1</b> Subtitle TBD</a></li>
<li class="chapter" data-level="2.2" data-path="project-organization.html"><a href="project-organization.html#project-organization-i-separating-inputs-and-outputs"><i class="fa fa-check"></i><b>2.2</b> Project Organization I: Separating Inputs and Outputs</a></li>
<li class="chapter" data-level="2.3" data-path="project-organization.html"><a href="project-organization.html#project-structure-ii-separating-logical-chunks-of-the-project"><i class="fa fa-check"></i><b>2.3</b> Project Structure II: Separating Logical Chunks of the Project</a><ul>
<li class="chapter" data-level="2.3.1" data-path="project-organization.html"><a href="project-organization.html#aside-even-deeper-sub-folders"><i class="fa fa-check"></i><b>2.3.1</b> Aside: Even Deeper Sub-folders</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="project-organization.html"><a href="project-organization.html#project-structure-iii-separating-input-parameters-from-code"><i class="fa fa-check"></i><b>2.4</b> Project Structure III: Separating Input Parameters from Code</a></li>
</ul></li>
<li class="part"><span><b>II Basic Snakemake Workflows</b></span></li>
<li class="chapter" data-level="3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html"><i class="fa fa-check"></i><b>3</b> Initial Steps with Snakemake</a><ul>
<li class="chapter" data-level="3.1" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#writing-our-first-rule"><i class="fa fa-check"></i><b>3.1</b> Writing Our First Rule</a></li>
<li class="chapter" data-level="3.2" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#executing-a-rule"><i class="fa fa-check"></i><b>3.2</b> Executing a Rule</a></li>
<li class="chapter" data-level="3.3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#first-steps-in-the-mrw-pipeline"><i class="fa fa-check"></i><b>3.3</b> First Steps in the MRW Pipeline</a><ul>
<li class="chapter" data-level="3.3.1" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#using-the-rscript-command-to-execute-r-scripts"><i class="fa fa-check"></i><b>3.3.1</b> Using the <code>Rscript</code> command to execute R scripts</a></li>
<li class="chapter" data-level="3.3.2" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#the-input-and-output-arguments"><i class="fa fa-check"></i><b>3.3.2</b> The <code>input</code> and <code>output</code> arguments</a></li>
<li class="chapter" data-level="3.3.3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#a-rule-to-rename-variables."><i class="fa fa-check"></i><b>3.3.3</b> A rule to rename variables.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#no-redundant-executions"><i class="fa fa-check"></i><b>3.4</b> No Redundant Executions</a></li>
<li class="chapter" data-level="3.5" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#our-workflow-in-graphs"><i class="fa fa-check"></i><b>3.5</b> Our Workflow in Graphs</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html"><i class="fa fa-check"></i><b>4</b> Working With Multiple Rules</a><ul>
<li class="chapter" data-level="4.1" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#creating-a-second-rule"><i class="fa fa-check"></i><b>4.1</b> Creating a Second Rule</a></li>
<li class="chapter" data-level="4.2" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#rule-order-matters"><i class="fa fa-check"></i><b>4.2</b> Rule Order Matters</a></li>
<li class="chapter" data-level="4.3" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#dependencies-between-rules"><i class="fa fa-check"></i><b>4.3</b> Dependencies Between Rules</a></li>
<li class="chapter" data-level="4.4" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#clean-rules"><i class="fa fa-check"></i><b>4.4</b> Clean Rules</a></li>
<li class="chapter" data-level="4.5" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#our-workflow-in-graphs-1"><i class="fa fa-check"></i><b>4.5</b> Our Workflow in Graphs</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="target-rules.html"><a href="target-rules.html"><i class="fa fa-check"></i><b>5</b> Target Rules</a><ul>
<li class="chapter" data-level="5.1" data-path="target-rules.html"><a href="target-rules.html#where-we-are-now"><i class="fa fa-check"></i><b>5.1</b> Where we are now?</a></li>
<li class="chapter" data-level="5.2" data-path="target-rules.html"><a href="target-rules.html#how-snakemake-determines-the-build-order-when-multiple-rules-are-present"><i class="fa fa-check"></i><b>5.2</b> How Snakemake determines the build order when multiple rules are present</a></li>
<li class="chapter" data-level="5.3" data-path="target-rules.html"><a href="target-rules.html#dedicated-target-rules-to-execute-multiple-rules"><i class="fa fa-check"></i><b>5.3</b> Dedicated target rules to execute multiple rules</a><ul>
<li class="chapter" data-level="" data-path="target-rules.html"><a href="target-rules.html#exercise-using-target-rules"><i class="fa fa-check"></i>Exercise: Using target rules</a></li>
<li class="chapter" data-level="" data-path="target-rules.html"><a href="target-rules.html#solution-2"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="target-rules.html"><a href="target-rules.html#target-rules-can-do-more-for-us"><i class="fa fa-check"></i><b>5.4</b> Target rules can do more for us</a></li>
</ul></li>
<li class="part"><span><b>III Minimizing Repetition, Maximizing Generalizability</b></span></li>
<li class="chapter" data-level="6" data-path="wildcards.html"><a href="wildcards.html"><i class="fa fa-check"></i><b>6</b> Wildcards</a><ul>
<li class="chapter" data-level="6.1" data-path="wildcards.html"><a href="wildcards.html#the-starting-point-of-our-snakefile"><i class="fa fa-check"></i><b>6.1</b> The starting point of our Snakefile</a></li>
<li class="chapter" data-level="6.2" data-path="wildcards.html"><a href="wildcards.html#wildcards-tidying"><i class="fa fa-check"></i><b>6.2</b> Using wildcards to tidy up our code</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="wildcards-in-target-rules.html"><a href="wildcards-in-target-rules.html"><i class="fa fa-check"></i><b>7</b> Wildcards in Target Rules</a><ul>
<li class="chapter" data-level="7.1" data-path="wildcards-in-target-rules.html"><a href="wildcards-in-target-rules.html#the-expand-function"><i class="fa fa-check"></i><b>7.1</b> The <code>expand()</code> function</a></li>
<li class="chapter" data-level="7.2" data-path="wildcards-in-target-rules.html"><a href="wildcards-in-target-rules.html#using-expand-with-a-list"><i class="fa fa-check"></i><b>7.2</b> Using <code>expand()</code> with a List</a></li>
<li class="chapter" data-level="7.3" data-path="wildcards-in-target-rules.html"><a href="wildcards-in-target-rules.html#estimating-a-new-model"><i class="fa fa-check"></i><b>7.3</b> Estimating a New Model</a></li>
<li class="chapter" data-level="7.4" data-path="wildcards-in-target-rules.html"><a href="wildcards-in-target-rules.html#expanding-multiple-wildcards"><i class="fa fa-check"></i><b>7.4</b> Expanding Multiple Wildcards</a><ul>
<li class="chapter" data-level="7.4.1" data-path="wildcards-in-target-rules.html"><a href="wildcards-in-target-rules.html#unifying-the-target-rules"><i class="fa fa-check"></i><b>7.4.1</b> Unifying the Target Rules</a></li>
<li class="chapter" data-level="7.4.2" data-path="wildcards-in-target-rules.html"><a href="wildcards-in-target-rules.html#unifying-how-regression-outputs-are-built"><i class="fa fa-check"></i><b>7.4.2</b> Unifying How Regression Outputs are Built</a></li>
<li class="chapter" data-level="7.4.3" data-path="wildcards-in-target-rules.html"><a href="wildcards-in-target-rules.html#running-the-new-rule"><i class="fa fa-check"></i><b>7.4.3</b> Running the New Rule</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="wildcards-in-target-rules.html"><a href="wildcards-in-target-rules.html#our-workflow-in-graphs-2"><i class="fa fa-check"></i><b>7.5</b> Our Workflow in Graphs</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html"><i class="fa fa-check"></i><b>8</b> Automating List Construction for Wildcard Expansion</a><ul>
<li class="chapter" data-level="8.1" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#learning-objectives-2"><i class="fa fa-check"></i><b>8.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="8.2" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#state-of-the-snakefile"><i class="fa fa-check"></i><b>8.2</b> State of the Snakefile</a></li>
<li class="chapter" data-level="8.3" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#the-glob_wildcards-function"><i class="fa fa-check"></i><b>8.3</b> The <code>glob_wildcards</code> Function</a></li>
<li class="chapter" data-level="8.4" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#looking-at-the-dag-redux"><i class="fa fa-check"></i><b>8.4</b> Looking at the DAG (redux)</a><ul>
<li class="chapter" data-level="" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#exercise-exploring-glob_wildcards"><i class="fa fa-check"></i>Exercise: Exploring glob_wildcards()</a></li>
<li class="chapter" data-level="8.4.1" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#solution-4"><i class="fa fa-check"></i><b>8.4.1</b> Solution</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Bringing Many Outputs Together</b></span></li>
<li class="chapter" data-level="9" data-path="make-tables.html"><a href="make-tables.html"><i class="fa fa-check"></i><b>9</b> Make Tables</a><ul>
<li class="chapter" data-level="9.1" data-path="make-tables.html"><a href="make-tables.html#the-state-of-the-snakefile"><i class="fa fa-check"></i><b>9.1</b> The State of the Snakefile</a></li>
<li class="chapter" data-level="9.2" data-path="make-tables.html"><a href="make-tables.html#building-a-single-table"><i class="fa fa-check"></i><b>9.2</b> Building a single table</a></li>
<li class="chapter" data-level="9.3" data-path="make-tables.html"><a href="make-tables.html#building-all-tables-at-once"><i class="fa fa-check"></i><b>9.3</b> Building all tables at once</a><ul>
<li class="chapter" data-level="" data-path="make-tables.html"><a href="make-tables.html#exercise"><i class="fa fa-check"></i>Exercise</a></li>
<li class="chapter" data-level="" data-path="make-tables.html"><a href="make-tables.html#solution-5"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html"><i class="fa fa-check"></i><b>10</b> One rule to rule them all</a><ul>
<li class="chapter" data-level="10.1" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#the-state-of-the-snakefile-1"><i class="fa fa-check"></i><b>10.1</b> The State of the Snakefile</a></li>
<li class="chapter" data-level="10.2" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#creating-an-all-target-rule"><i class="fa fa-check"></i><b>10.2</b> Creating an <code>all</code> target rule</a></li>
<li class="chapter" data-level="10.3" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#concluding-remarks"><i class="fa fa-check"></i><b>10.3</b> Concluding Remarks</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html"><i class="fa fa-check"></i><b>11</b> Adding Papers and Slides to a Snakemake Workflow</a><ul>
<li class="chapter" data-level="11.1" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#learning-objectives-3"><i class="fa fa-check"></i><b>11.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="11.2" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#state-of-our-snakefile"><i class="fa fa-check"></i><b>11.2</b> State of Our Snakefile</a></li>
<li class="chapter" data-level="11.3" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#where-we-are"><i class="fa fa-check"></i><b>11.3</b> Where We Are</a></li>
<li class="chapter" data-level="11.4" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#building-a-paper"><i class="fa fa-check"></i><b>11.4</b> Building a Paper</a></li>
<li class="chapter" data-level="11.5" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#integrating-build_paper-output-into-all"><i class="fa fa-check"></i><b>11.5</b> Integrating <code>build_paper</code> output into <code>all</code></a></li>
<li class="chapter" data-level="11.6" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#making-paper.pdf-easier-to-find"><i class="fa fa-check"></i><b>11.6</b> Making <code>paper.pdf</code> Easier to Find</a><ul>
<li class="chapter" data-level="11.6.1" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#exercise-adding-a-slide-deck."><i class="fa fa-check"></i><b>11.6.1</b> Exercise: Adding a Slide Deck.</a></li>
<li class="chapter" data-level="11.6.2" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#exercise-solution"><i class="fa fa-check"></i><b>11.6.2</b> Exercise Solution</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#final-thoughts"><i class="fa fa-check"></i><b>11.7</b> Final Thoughts</a></li>
</ul></li>
<li class="part"><span><b>V Decorating Snakemake Workflows</b></span></li>
<li class="chapter" data-level="12" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html"><i class="fa fa-check"></i><b>12</b> Logging Output and Errors</a><ul>
<li class="chapter" data-level="12.1" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#logging-output"><i class="fa fa-check"></i><b>12.1</b> Logging Output</a></li>
<li class="chapter" data-level="12.2" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#logging-output-and-errors-in-one-file"><i class="fa fa-check"></i><b>12.2</b> Logging Output and Errors in One File</a><ul>
<li class="chapter" data-level="" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#exercise-logging-all-r-scripts"><i class="fa fa-check"></i>Exercise: Logging all R Scripts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="adding-parameters.html"><a href="adding-parameters.html"><i class="fa fa-check"></i><b>13</b> Adding Parameters</a><ul>
<li class="chapter" data-level="13.1" data-path="adding-parameters.html"><a href="adding-parameters.html#motivating-example-constructing-a-regression-table-from-ols-results"><i class="fa fa-check"></i><b>13.1</b> Motivating Example: Constructing a Regression Table from OLS Results</a></li>
<li class="chapter" data-level="13.2" data-path="adding-parameters.html"><a href="adding-parameters.html#creating-a-rule-with-params"><i class="fa fa-check"></i><b>13.2</b> Creating a Rule with <code>params</code></a><ul>
<li class="chapter" data-level="" data-path="adding-parameters.html"><a href="adding-parameters.html#exercise-building-table-2"><i class="fa fa-check"></i>Exercise: Building Table 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="config-files.html"><a href="config-files.html"><i class="fa fa-check"></i><b>14</b> Config Files</a><ul>
<li class="chapter" data-level="14.1" data-path="config-files.html"><a href="config-files.html#the-config.yaml-filepath"><i class="fa fa-check"></i><b>14.1</b> The <code>config.yaml</code> filepath</a></li>
<li class="chapter" data-level="14.2" data-path="config-files.html"><a href="config-files.html#using-paths-from-the-config-file"><i class="fa fa-check"></i><b>14.2</b> Using paths from the config file</a><ul>
<li class="chapter" data-level="" data-path="config-files.html"><a href="config-files.html#exercise-using-config-files"><i class="fa fa-check"></i>Exercise: Using Config Files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="self-documenting-help.html"><a href="self-documenting-help.html"><i class="fa fa-check"></i><b>15</b> Self Documenting Help</a><ul>
<li class="chapter" data-level="15.1" data-path="self-documenting-help.html"><a href="self-documenting-help.html#our-commenting-syle"><i class="fa fa-check"></i><b>15.1</b> Our Commenting Syle</a></li>
<li class="chapter" data-level="15.2" data-path="self-documenting-help.html"><a href="self-documenting-help.html#adding-further-comments"><i class="fa fa-check"></i><b>15.2</b> Adding Further Comments</a><ul>
<li class="chapter" data-level="" data-path="self-documenting-help.html"><a href="self-documenting-help.html#exercise-adding-comments"><i class="fa fa-check"></i>Exercise: Adding Comments</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="self-documenting-help.html"><a href="self-documenting-help.html#a-help-rule"><i class="fa fa-check"></i><b>15.3</b> A <code>help</code> Rule</a><ul>
<li><a href="self-documenting-help.html#exercise-saving-help-output-to-file">Exercise: Saving <code>help</code> output to file</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html"><i class="fa fa-check"></i><b>16</b> Subworkflows: Divide and Conquer</a><ul>
<li class="chapter" data-level="16.1" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#subworkflow-basics"><i class="fa fa-check"></i><b>16.1</b> Subworkflow Basics</a></li>
<li class="chapter" data-level="16.2" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#subworkflow-dependencies"><i class="fa fa-check"></i><b>16.2</b> Subworkflow dependencies</a><ul>
<li class="chapter" data-level="" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#exercise-more-subworkflows"><i class="fa fa-check"></i>Exercise: More Subworkflows</a></li>
<li><a href="subworkflows-divide-and-conquer.html#guided-exercise-help-rules-with-subworkflows">Guided Exercise: <code>help</code> rules with subworkflows</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VI Putting Workflows in a Box</b></span></li>
<li class="chapter" data-level="17" data-path="package-dependencies-with-renv.html"><a href="package-dependencies-with-renv.html"><i class="fa fa-check"></i><b>17</b> Package Dependencies with <code>renv</code></a></li>
<li class="chapter" data-level="18" data-path="containers.html"><a href="containers.html"><i class="fa fa-check"></i><b>18</b> Containers</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="installation-guide.html"><a href="installation-guide.html"><i class="fa fa-check"></i><b>A</b> Installation Guide</a><ul>
<li class="chapter" data-level="A.1" data-path="installation-guide.html"><a href="installation-guide.html#windows"><i class="fa fa-check"></i><b>A.1</b> Windows</a><ul>
<li class="chapter" data-level="A.1.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal"><i class="fa fa-check"></i><b>A.1.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.1.2" data-path="installation-guide.html"><a href="installation-guide.html#python"><i class="fa fa-check"></i><b>A.1.2</b> Python</a></li>
<li class="chapter" data-level="" data-path="installation-guide.html"><a href="installation-guide.html#installing-snakemake"><i class="fa fa-check"></i>Installing Snakemake</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="installation-guide.html"><a href="installation-guide.html#mac"><i class="fa fa-check"></i><b>A.2</b> Mac</a><ul>
<li class="chapter" data-level="A.2.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal-1"><i class="fa fa-check"></i><b>A.2.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.2.2" data-path="installation-guide.html"><a href="installation-guide.html#python-1"><i class="fa fa-check"></i><b>A.2.2</b> Python</a></li>
<li class="chapter" data-level="" data-path="installation-guide.html"><a href="installation-guide.html#installing-snakemake-1"><i class="fa fa-check"></i>Installing Snakemake</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="installation-guide.html"><a href="installation-guide.html#linux-ubuntu"><i class="fa fa-check"></i><b>A.3</b> Linux / Ubuntu</a><ul>
<li class="chapter" data-level="A.3.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal-2"><i class="fa fa-check"></i><b>A.3.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.3.2" data-path="installation-guide.html"><a href="installation-guide.html#python-2"><i class="fa fa-check"></i><b>A.3.2</b> Python</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>B</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.comlachlandeer/snakemake-econ-r/" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible Data Analytic Workflows for Economics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="wildcards-in-target-rules" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Wildcards in Target Rules</h1>
<div class="unnumbered objectives">
<h3 id="overview-2" class="unnumbered">Overview</h3>
<p><strong>Questions</strong></p>
<ul>
<li>How can we use wildcards to simplify target rules?</li>
<li>How do we make the build plan explicit in target rules?</li>
<li>How do we combine more than one wildcard in a single target rule?</li>
</ul>
<p><strong>Objectives</strong></p>
<ul>
<li>Introduce wildcards to target rules</li>
<li>Explain what the <code>expand()</code> function is and how to ues it</li>
<li>Learn how to use multiple wildcards in a single rule</li>
</ul>
</div>
<div class="unnumbered prereq">
<h3 id="snakefile-status-1" class="unnumbered">Snakefile Status</h3>
<p>After the last chapter our Snakefile should look like this:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb96-1"><a href="wildcards-in-target-rules.html#cb96-1"></a><span class="co"># --- Target Rules --- #</span></span>
<span id="cb96-2"><a href="wildcards-in-target-rules.html#cb96-2"></a></span>
<span id="cb96-3"><a href="wildcards-in-target-rules.html#cb96-3"></a><span class="ex">rule</span> solow_target:</span>
<span id="cb96-4"><a href="wildcards-in-target-rules.html#cb96-4"></a>    <span class="ex">input</span>:</span>
<span id="cb96-5"><a href="wildcards-in-target-rules.html#cb96-5"></a>        <span class="ex">intermediate</span> = <span class="st">&quot;out/analysis/model_solow_subset_intermediate.rds&quot;</span>,</span>
<span id="cb96-6"><a href="wildcards-in-target-rules.html#cb96-6"></a>        <span class="ex">nonoil</span>       = <span class="st">&quot;out/analysis/model_solow_subset_nonoil.rds&quot;</span>,</span>
<span id="cb96-7"><a href="wildcards-in-target-rules.html#cb96-7"></a>        <span class="ex">oecd</span>         = <span class="st">&quot;out/analysis/model_solow_subset_oecd.rds&quot;</span></span>
<span id="cb96-8"><a href="wildcards-in-target-rules.html#cb96-8"></a></span>
<span id="cb96-9"><a href="wildcards-in-target-rules.html#cb96-9"></a></span>
<span id="cb96-10"><a href="wildcards-in-target-rules.html#cb96-10"></a><span class="co"># --- Build Rules --- #</span></span>
<span id="cb96-11"><a href="wildcards-in-target-rules.html#cb96-11"></a></span>
<span id="cb96-12"><a href="wildcards-in-target-rules.html#cb96-12"></a><span class="ex">rule</span> solow_model:</span>
<span id="cb96-13"><a href="wildcards-in-target-rules.html#cb96-13"></a>    <span class="ex">input</span>:</span>
<span id="cb96-14"><a href="wildcards-in-target-rules.html#cb96-14"></a>        <span class="ex">script</span> = <span class="st">&quot;src/analysis/estimate_ols_model.R&quot;</span>,</span>
<span id="cb96-15"><a href="wildcards-in-target-rules.html#cb96-15"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb96-16"><a href="wildcards-in-target-rules.html#cb96-16"></a>        <span class="ex">model</span>  = <span class="st">&quot;src/model-specs/model_solow.json&quot;</span>,</span>
<span id="cb96-17"><a href="wildcards-in-target-rules.html#cb96-17"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/subset_{iSubset}.json&quot;</span></span>
<span id="cb96-18"><a href="wildcards-in-target-rules.html#cb96-18"></a>    <span class="ex">output</span>:</span>
<span id="cb96-19"><a href="wildcards-in-target-rules.html#cb96-19"></a>        <span class="ex">estimate</span> = <span class="st">&quot;out/analysis/model_solow_subset_{iSubset}.rds&quot;</span></span>
<span id="cb96-20"><a href="wildcards-in-target-rules.html#cb96-20"></a>    <span class="ex">shell</span>:</span>
<span id="cb96-21"><a href="wildcards-in-target-rules.html#cb96-21"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb96-22"><a href="wildcards-in-target-rules.html#cb96-22"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb96-23"><a href="wildcards-in-target-rules.html#cb96-23"></a><span class="st">            --model {input.model} \</span></span>
<span id="cb96-24"><a href="wildcards-in-target-rules.html#cb96-24"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb96-25"><a href="wildcards-in-target-rules.html#cb96-25"></a><span class="st">            --out {output.estimate}&quot;</span></span>
<span id="cb96-26"><a href="wildcards-in-target-rules.html#cb96-26"></a></span>
<span id="cb96-27"><a href="wildcards-in-target-rules.html#cb96-27"></a><span class="ex">rule</span> gen_regression_vars:</span>
<span id="cb96-28"><a href="wildcards-in-target-rules.html#cb96-28"></a>    <span class="ex">input</span>:</span>
<span id="cb96-29"><a href="wildcards-in-target-rules.html#cb96-29"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/gen_reg_vars.R&quot;</span>,</span>
<span id="cb96-30"><a href="wildcards-in-target-rules.html#cb96-30"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span>,</span>
<span id="cb96-31"><a href="wildcards-in-target-rules.html#cb96-31"></a>        <span class="ex">param</span>  = <span class="st">&quot;src/data-specs/param_solow.json&quot;</span></span>
<span id="cb96-32"><a href="wildcards-in-target-rules.html#cb96-32"></a>    <span class="ex">output</span>:</span>
<span id="cb96-33"><a href="wildcards-in-target-rules.html#cb96-33"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span></span>
<span id="cb96-34"><a href="wildcards-in-target-rules.html#cb96-34"></a>    <span class="ex">shell</span>:</span>
<span id="cb96-35"><a href="wildcards-in-target-rules.html#cb96-35"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb96-36"><a href="wildcards-in-target-rules.html#cb96-36"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb96-37"><a href="wildcards-in-target-rules.html#cb96-37"></a><span class="st">            --param {input.param} \</span></span>
<span id="cb96-38"><a href="wildcards-in-target-rules.html#cb96-38"></a><span class="st">            --out {output.data}&quot;</span></span>
<span id="cb96-39"><a href="wildcards-in-target-rules.html#cb96-39"></a></span>
<span id="cb96-40"><a href="wildcards-in-target-rules.html#cb96-40"></a><span class="ex">rule</span> rename_vars:</span>
<span id="cb96-41"><a href="wildcards-in-target-rules.html#cb96-41"></a>    <span class="ex">input</span>:</span>
<span id="cb96-42"><a href="wildcards-in-target-rules.html#cb96-42"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/rename_variables.R&quot;</span>,</span>
<span id="cb96-43"><a href="wildcards-in-target-rules.html#cb96-43"></a>        <span class="ex">data</span>   = <span class="st">&quot;src/data/mrw.dta&quot;</span></span>
<span id="cb96-44"><a href="wildcards-in-target-rules.html#cb96-44"></a>    <span class="ex">output</span>:</span>
<span id="cb96-45"><a href="wildcards-in-target-rules.html#cb96-45"></a>        <span class="ex">data</span> = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span></span>
<span id="cb96-46"><a href="wildcards-in-target-rules.html#cb96-46"></a>    <span class="ex">shell</span>:</span>
<span id="cb96-47"><a href="wildcards-in-target-rules.html#cb96-47"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb96-48"><a href="wildcards-in-target-rules.html#cb96-48"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb96-49"><a href="wildcards-in-target-rules.html#cb96-49"></a><span class="st">            --out {output.data}&quot;</span></span>
<span id="cb96-50"><a href="wildcards-in-target-rules.html#cb96-50"></a></span>
<span id="cb96-51"><a href="wildcards-in-target-rules.html#cb96-51"></a><span class="co"># --- Clean Rules --- #</span></span>
<span id="cb96-52"><a href="wildcards-in-target-rules.html#cb96-52"></a></span>
<span id="cb96-53"><a href="wildcards-in-target-rules.html#cb96-53"></a><span class="ex">rule</span> clean:</span>
<span id="cb96-54"><a href="wildcards-in-target-rules.html#cb96-54"></a>    <span class="ex">shell</span>:</span>
<span id="cb96-55"><a href="wildcards-in-target-rules.html#cb96-55"></a>        <span class="st">&quot;rm -rf out/*&quot;</span></span>
<span id="cb96-56"><a href="wildcards-in-target-rules.html#cb96-56"></a></span>
<span id="cb96-57"><a href="wildcards-in-target-rules.html#cb96-57"></a><span class="ex">rule</span> clean_data:</span>
<span id="cb96-58"><a href="wildcards-in-target-rules.html#cb96-58"></a>    <span class="ex">shell</span>:</span>
<span id="cb96-59"><a href="wildcards-in-target-rules.html#cb96-59"></a>        <span class="st">&quot;rm -rf out/data/*&quot;</span></span>
<span id="cb96-60"><a href="wildcards-in-target-rules.html#cb96-60"></a></span>
<span id="cb96-61"><a href="wildcards-in-target-rules.html#cb96-61"></a><span class="ex">rule</span> clean_analysis:</span>
<span id="cb96-62"><a href="wildcards-in-target-rules.html#cb96-62"></a>    <span class="ex">shell</span>:</span>
<span id="cb96-63"><a href="wildcards-in-target-rules.html#cb96-63"></a>        <span class="st">&quot;rm -rf out/analysis/*&quot;</span></span></code></pre></div>
<p>This will be our starting point for this chapter.</p>
</div>
<p>In the last chapter we have learned how to use wildcards to eliminate unnecessary repetitions in our code.
Next, we will learn how to apply wildcards to our target rules with help of the <code>expand()</code> function.</p>
<div id="the-expand-function" class="section level2">
<h2><span class="header-section-number">7.1</span> The <code>expand()</code> function</h2>
<p>When we look at our target rule:</p>
<pre class="out"><code>rule solow_target:
    input:
        intermediate = &quot;out/analysis/model_solow_subset_intermediate.rds&quot;,
        nonoil       = &quot;out/analysis/model_solow_subset_nonoil.rds&quot;,
        oecd         = &quot;out/analysis/model_solow_subset_oecd.rds&quot;</code></pre>
<p>We can see that the inputs have a very similar structure:</p>
<ul>
<li>The inputs live on the same path <code>out/analysis/</code></li>
<li>The filenames of each input begin with <code>model_solow_subset</code> and end with <code>.rds</code>.</li>
</ul>
<p>They only differ in the name of the subset of data we are using: <code>intermediate</code>, <code>nonoil</code>, and <code>oecd</code>.</p>
<p>After what we learned in the <a href="./wildcards.html">previous chapter on wildcards</a>, we should be thinking that there must be a way to reduce the repetition.
Let’s try simply adding a wildcard for the varying part of the input files.
We can do this by condensing the three inputs in <code>solow_target</code> into one as follows:</p>
<pre class="out"><code>rule solow_target:
    input:
        models = &quot;out/analysis/model_solow_subset_{iSubset}.rds&quot;,
</code></pre>
<p>To see if this has any bite, and would work as we intuitively think it might we will want to run Snakemake.
Before we do, let’s clean the output folder and start afresh:</p>
<pre class="out"><code>$ snakemake --cores 1 clean</code></pre>
<p>Then, we run our new target rule with the wildcard we added:</p>
<pre class="out"><code>$ snakemake --cores 1 solow_target</code></pre>
<p>This didn’t do as we intuitively had hoped.
Instead we get the following error:</p>
<pre class="out"><code>Building DAG of jobs...
WildcardError in line 12 of /home/lachlan/teaching/snakemake-econ-r-learner/Snakefile:
Wildcards in input files cannot be determined from output files:
&#39;iSubset&#39;</code></pre>
<p>Recall that Snakemake won’t run a target rule that contains a wildcard because it does not know how to resolve it.<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>
Snakemake doesn’t know that <code>{iSubset}</code> should first be replaced with <code>oecd</code>, then with <code>intermediate</code>, and finally with <code>nonoil</code>.
It is our job to be a bit more explicit and tell Snakemake that this is what we want to happen.</p>
<p>Snakemake has a functionality that allows us to tell it how to take a wildcard and replace it with a specific set of values.
The <code>expand()</code> function provides this for us.
As the name suggests its job is to expand a wildcard by replacing it iteratively with specified values.</p>
<p>We can use the <code>expand()</code> function as follows:</p>
<pre class="out"><code>rule solow_target:
    input:
        expand(&quot;out/analysis/model_solow_subset_{iSubset}.rds&quot;,
                    iSubset = DATA_SUBSET)</code></pre>
<p>This tells Snakemake to replace the wildcard <code>{iSubset}</code> with values from an object we have called <code>DATA_SUBSET</code>.
We now have to replace <code>DATA_SUBSET</code> with a <strong>list</strong> of values that we want to substitute in for<code>{iSubset}</code>.</p>
</div>
<div id="using-expand-with-a-list" class="section level2">
<h2><span class="header-section-number">7.2</span> Using <code>expand()</code> with a List</h2>
<p>In Python and Snakemake lists can be thought of as a container that store many values.
We create a list by putting the values we want inside square brackets and separating the values with commas.
In our case, a list of the three subsets of the data looks like this: <code>["nonoil", "oecd", "intermediate"]</code>.</p>
<p>Let us replace <code>DATA_SUBSET</code> with our new list of subset names:</p>
<pre class="out"><code>rule solow_target:
    input:
        expand(&quot;out/analysis/model_solow_subset_{iSubset}.rds&quot;,
                    iSubset = [&quot;nonoil&quot;, &quot;oecd&quot;, &quot;intermediate&quot;])</code></pre>
<p>We use the <code>--summary</code> option of Snakemake to see the build plan:</p>
<pre class="out"><code>$ snakemake --summary</code></pre>
<pre class="out"><code>output_file     date    rule    version log-file(s)     status  plan
out/analysis/model_solow_subset_nonoil.rds         -       solow_model     -               missing update pending
out/analysis/model_solow_subset_oecd.rds           -       solow_model     -               missing update pending
out/analysis/model_solow_subset_intermediate.rds   -       solow_model     -               missing update pending
out/data/mrw_complete.csv       -       gen_regression_vars     -               missing update pending
out/data/mrw_renamed.csv        -       rename_vars     -               missing update pending</code></pre>
<p>The first three lines show us that Snakemake plans to build the three files <code>out/analysis/model_solow_subset_nonoil.rds</code>, <code>out/analysis/model_solow_subset_oecd.rds</code>, <code>out/analysis/model_solow_subset_intermediate.rds</code> from our original target rule.
This means Snakemake has indeed replaced the wildcard <code>iSubset</code> with the correct three values just like we wanted.<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a>
We have successfully simplified our target rule.</p>
<div class="unnumbered tip">
<h3 id="adding-python-3-code-outside-of-snakemake-rules" class="unnumbered">Adding Python 3 Code Outside of Snakemake Rules</h3>
<p>Snakemake accepts any Python 3 code outside of rules.
You can add Python 3 lists or functions anywhere in a Snakefile.
You can then use the these lists or functions in the Snakemake rules as needed.</p>
</div>
<p>So far, we defined the list passed to the expand function at the time we needed it, inside the call to expand function.
While this makes explicit what values we want the expand function to iterate through, it might be better practice to define the list outside of it.
What this would mean is to create a list somewhere else in our Snakefile, and then tell Snakemake to use this pre-defined list inside the expand function.</p>
<p>Let us see this idea in action.
We will create our list of data subsets at the beginning of our Snakefile and then reference it in the rule <code>solow_target</code>.
Create a list called <code>DATA_SUBSET</code> at the beginning of the Snakefile as follows:<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a></p>
<pre class="out"><code>DATA_SUBSET = [&quot;oecd&quot;, &quot;intermediate&quot;, &quot;nonoil&quot;]</code></pre>
<p>We then need to refer to the list by name inside our <code>expand()</code> function.
To do so, we replace the explicit list we had before with the name of our newly constructed <code>DATA_SUBSET</code> list:</p>
<pre class="out"><code>rule solow_target:
    input:
        expand(&quot;out/analysis/model_solow_subset_{iSubset}.rds&quot;,
                    iSubset = DATA_SUBSET)</code></pre>
<p>Now us execute our rule:</p>
<pre class="out"><code>$ snakemake --cores 1 </code></pre>
<p>The last part of the output from the Snakemake rule is:</p>
<pre class="out"><code>TODO: Add Output</code></pre>
<p>Nice, everything seems to have worked.
If we look into our output folder, we should now see the three output models:</p>
<pre class="out"><code>ls out/analysis</code></pre>
<pre class="out"><code>model_solow_subset_nonoil.rds 
model_solow_subset_oecd.rds 
model_solow_subset_intermediate.rds </code></pre>
<p>Why might we have advocated for creating lists outside of the expand function?
There are at least the following three reasons you might want to do so:</p>
<ol style="list-style-type: decimal">
<li>If we want to re-use the same list of values in another rule, we would have to write the list again or copy and paste it into the second rule.
As before, this introduces extra room for errors.</li>
<li>It can be hard to find the lists we are iterating over when we read through the Snakefile.
Putting all lists we are using at the top of <code>Snakefile</code> makes this easier.</li>
<li>In the next chapter we will introduce a new function which allows us to construct lists which we pass to <code>expand()</code> from the files in our project automatically.
For this task it will be very advantageous to define lists outside of rules.</li>
</ol>
<div class="unnumbered challenge">
<h3 id="exercise-exploring-the-expand-function" class="unnumbered">Exercise: Exploring the expand function</h3>
<p><span class="citation">Mankiw, Romer, and Weil (<a href="#ref-mrw" role="doc-biblioref">1992</a>)</span> contains three plots.
Each of these plots use the data subset of ‘intermediate’ countries.
The <code>src/figures/</code> subdirectory contains three scripts which correspond to the three plots in the paper.<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a></p>
<p>It is your task to use what you have learned so far to create a workflow to produce the figures.
To do so, follow the following steps:</p>
<ol style="list-style-type: decimal">
<li>Write three rules <code>fig1</code>, <code>fig2</code> and <code>fig3</code> to produce each figure.
Each figure should be saved to the following output filepath <code>out/figures/SCRIPTNAME.pdf</code></li>
<li>Create a list called <code>PLOTS</code> that contains the file names of each of the three plot scripts (without the path or the <code>.json</code> file ending).</li>
<li>Use what you have learned about <strong>wildcards</strong> to simplify the three rules <code>fig1</code>, <code>fig2</code>, and <code>fig3</code> into a single rule called <code>figures</code>. What part of the rule needs a wildcard?</li>
<li>Use the <code>expand()</code> function to create a target rule named <code>make_figures</code>.</li>
<li>Use the summary function to check that all three figures are planned to be created correctly.</li>
<li>Create all three figures with a single execution of<code>snakemake --cores 1 figs_target</code>.</li>
<li>Make sure that the files have been written to the output folder.</li>
</ol>
<p>HINT:
The scripts are written in such a way that they accept exactly the same options.
Check first, what inputs the scripts expect.</p>
</div>
<div class="unnumbered answer">
<h3 id="solution-3" class="unnumbered">SOLUTION:</h3>
<p>In this problem the three rules <code>fig1</code>, <code>fig2</code>, and <code>fig3</code> only differ in the <code>{input.model}</code> they take and the output filename. We therefore have use wildcards in both to unify them.
The target rule <code>make_figures</code> then uses the <code>expand()</code> function and a list of the filenames without the <code>.json</code> ending to create all three plots.</p>
<p>After completing all steps. your <code>Snakefile</code> should look something like this:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb112-1"><a href="wildcards-in-target-rules.html#cb112-1"></a><span class="co"># --- Dictionaries --- #</span></span>
<span id="cb112-2"><a href="wildcards-in-target-rules.html#cb112-2"></a></span>
<span id="cb112-3"><a href="wildcards-in-target-rules.html#cb112-3"></a><span class="ex">DATA_SUBSET</span> = [<span class="st">&quot;oecd&quot;</span>,</span>
<span id="cb112-4"><a href="wildcards-in-target-rules.html#cb112-4"></a>               <span class="st">&quot;intermediate&quot;</span>,</span>
<span id="cb112-5"><a href="wildcards-in-target-rules.html#cb112-5"></a>               <span class="st">&quot;nonoil&quot;</span></span>
<span id="cb112-6"><a href="wildcards-in-target-rules.html#cb112-6"></a>]</span>
<span id="cb112-7"><a href="wildcards-in-target-rules.html#cb112-7"></a></span>
<span id="cb112-8"><a href="wildcards-in-target-rules.html#cb112-8"></a><span class="ex">PLOTS</span> = [</span>
<span id="cb112-9"><a href="wildcards-in-target-rules.html#cb112-9"></a>    <span class="st">&quot;aug_conditional_convergence&quot;</span>,</span>
<span id="cb112-10"><a href="wildcards-in-target-rules.html#cb112-10"></a>    <span class="st">&quot;conditional_convergence&quot;</span>,</span>
<span id="cb112-11"><a href="wildcards-in-target-rules.html#cb112-11"></a>    <span class="st">&quot;unconditional_convergence&quot;</span></span>
<span id="cb112-12"><a href="wildcards-in-target-rules.html#cb112-12"></a>]</span>
<span id="cb112-13"><a href="wildcards-in-target-rules.html#cb112-13"></a></span>
<span id="cb112-14"><a href="wildcards-in-target-rules.html#cb112-14"></a></span>
<span id="cb112-15"><a href="wildcards-in-target-rules.html#cb112-15"></a><span class="co"># --- Target Rules --- #</span></span>
<span id="cb112-16"><a href="wildcards-in-target-rules.html#cb112-16"></a></span>
<span id="cb112-17"><a href="wildcards-in-target-rules.html#cb112-17"></a><span class="ex">rule</span> make_figures:</span>
<span id="cb112-18"><a href="wildcards-in-target-rules.html#cb112-18"></a>    <span class="ex">input</span>:</span>
<span id="cb112-19"><a href="wildcards-in-target-rules.html#cb112-19"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/figures/{iFigure}.pdf&quot;</span>,</span>
<span id="cb112-20"><a href="wildcards-in-target-rules.html#cb112-20"></a>                    <span class="ex">iFigure</span> = PLOTS)</span>
<span id="cb112-21"><a href="wildcards-in-target-rules.html#cb112-21"></a></span>
<span id="cb112-22"><a href="wildcards-in-target-rules.html#cb112-22"></a><span class="ex">rule</span> solow_target:</span>
<span id="cb112-23"><a href="wildcards-in-target-rules.html#cb112-23"></a>    <span class="ex">input</span>:</span>
<span id="cb112-24"><a href="wildcards-in-target-rules.html#cb112-24"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/analysis/model_solow_subset_{iSubset}.rds&quot;</span>,</span>
<span id="cb112-25"><a href="wildcards-in-target-rules.html#cb112-25"></a>                    <span class="ex">iSubset</span> = DATA_SUBSET)</span>
<span id="cb112-26"><a href="wildcards-in-target-rules.html#cb112-26"></a></span>
<span id="cb112-27"><a href="wildcards-in-target-rules.html#cb112-27"></a></span>
<span id="cb112-28"><a href="wildcards-in-target-rules.html#cb112-28"></a><span class="co"># --- Build Rules --- #</span></span>
<span id="cb112-29"><a href="wildcards-in-target-rules.html#cb112-29"></a></span>
<span id="cb112-30"><a href="wildcards-in-target-rules.html#cb112-30"></a><span class="ex">rule</span> figures:</span>
<span id="cb112-31"><a href="wildcards-in-target-rules.html#cb112-31"></a>    <span class="ex">input</span>:</span>
<span id="cb112-32"><a href="wildcards-in-target-rules.html#cb112-32"></a>        <span class="ex">script</span> = <span class="st">&quot;src/figures/{iFigure}.R&quot;</span>,</span>
<span id="cb112-33"><a href="wildcards-in-target-rules.html#cb112-33"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb112-34"><a href="wildcards-in-target-rules.html#cb112-34"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/subset_intermediate.json&quot;</span></span>
<span id="cb112-35"><a href="wildcards-in-target-rules.html#cb112-35"></a>    <span class="ex">output</span>:</span>
<span id="cb112-36"><a href="wildcards-in-target-rules.html#cb112-36"></a>        <span class="ex">fig</span> = <span class="st">&quot;out/figures/{iFigure}.pdf&quot;</span></span>
<span id="cb112-37"><a href="wildcards-in-target-rules.html#cb112-37"></a>    <span class="ex">shell</span>:</span>
<span id="cb112-38"><a href="wildcards-in-target-rules.html#cb112-38"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb112-39"><a href="wildcards-in-target-rules.html#cb112-39"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb112-40"><a href="wildcards-in-target-rules.html#cb112-40"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb112-41"><a href="wildcards-in-target-rules.html#cb112-41"></a><span class="st">            --out {output.fig}&quot;</span></span>
<span id="cb112-42"><a href="wildcards-in-target-rules.html#cb112-42"></a></span>
<span id="cb112-43"><a href="wildcards-in-target-rules.html#cb112-43"></a><span class="ex">rule</span> solow_model:</span>
<span id="cb112-44"><a href="wildcards-in-target-rules.html#cb112-44"></a>    <span class="ex">input</span>:</span>
<span id="cb112-45"><a href="wildcards-in-target-rules.html#cb112-45"></a>        <span class="ex">script</span> = <span class="st">&quot;src/analysis/estimate_ols_model.R&quot;</span>,</span>
<span id="cb112-46"><a href="wildcards-in-target-rules.html#cb112-46"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb112-47"><a href="wildcards-in-target-rules.html#cb112-47"></a>        <span class="ex">model</span>  = <span class="st">&quot;src/model-specs/model_solow.json&quot;</span>,</span>
<span id="cb112-48"><a href="wildcards-in-target-rules.html#cb112-48"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/{iSubset}.json&quot;</span></span>
<span id="cb112-49"><a href="wildcards-in-target-rules.html#cb112-49"></a>    <span class="ex">output</span>:</span>
<span id="cb112-50"><a href="wildcards-in-target-rules.html#cb112-50"></a>        <span class="ex">estimate</span> = <span class="st">&quot;out/analysis/model_solow_{iSubset}.rds&quot;</span></span>
<span id="cb112-51"><a href="wildcards-in-target-rules.html#cb112-51"></a>    <span class="ex">shell</span>:</span>
<span id="cb112-52"><a href="wildcards-in-target-rules.html#cb112-52"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb112-53"><a href="wildcards-in-target-rules.html#cb112-53"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb112-54"><a href="wildcards-in-target-rules.html#cb112-54"></a><span class="st">            --model {input.model} \</span></span>
<span id="cb112-55"><a href="wildcards-in-target-rules.html#cb112-55"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb112-56"><a href="wildcards-in-target-rules.html#cb112-56"></a><span class="st">            --out {output.estimate}&quot;</span></span>
<span id="cb112-57"><a href="wildcards-in-target-rules.html#cb112-57"></a></span>
<span id="cb112-58"><a href="wildcards-in-target-rules.html#cb112-58"></a><span class="ex">rule</span> gen_regression_vars:</span>
<span id="cb112-59"><a href="wildcards-in-target-rules.html#cb112-59"></a>    <span class="ex">input</span>:</span>
<span id="cb112-60"><a href="wildcards-in-target-rules.html#cb112-60"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/gen_reg_vars.R&quot;</span>,</span>
<span id="cb112-61"><a href="wildcards-in-target-rules.html#cb112-61"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span>,</span>
<span id="cb112-62"><a href="wildcards-in-target-rules.html#cb112-62"></a>        <span class="ex">param</span>  = <span class="st">&quot;src/data-specs/param_solow.json&quot;</span></span>
<span id="cb112-63"><a href="wildcards-in-target-rules.html#cb112-63"></a>    <span class="ex">output</span>:</span>
<span id="cb112-64"><a href="wildcards-in-target-rules.html#cb112-64"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span></span>
<span id="cb112-65"><a href="wildcards-in-target-rules.html#cb112-65"></a>    <span class="ex">shell</span>:</span>
<span id="cb112-66"><a href="wildcards-in-target-rules.html#cb112-66"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb112-67"><a href="wildcards-in-target-rules.html#cb112-67"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb112-68"><a href="wildcards-in-target-rules.html#cb112-68"></a><span class="st">            --param {input.param} \</span></span>
<span id="cb112-69"><a href="wildcards-in-target-rules.html#cb112-69"></a><span class="st">            --out {output.data}&quot;</span></span>
<span id="cb112-70"><a href="wildcards-in-target-rules.html#cb112-70"></a></span>
<span id="cb112-71"><a href="wildcards-in-target-rules.html#cb112-71"></a><span class="ex">rule</span> rename_vars:</span>
<span id="cb112-72"><a href="wildcards-in-target-rules.html#cb112-72"></a>    <span class="ex">input</span>:</span>
<span id="cb112-73"><a href="wildcards-in-target-rules.html#cb112-73"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/rename_variables.R&quot;</span>,</span>
<span id="cb112-74"><a href="wildcards-in-target-rules.html#cb112-74"></a>        <span class="ex">data</span>   = <span class="st">&quot;src/data/mrw.dta&quot;</span></span>
<span id="cb112-75"><a href="wildcards-in-target-rules.html#cb112-75"></a>    <span class="ex">output</span>:</span>
<span id="cb112-76"><a href="wildcards-in-target-rules.html#cb112-76"></a>        <span class="ex">data</span> = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span></span>
<span id="cb112-77"><a href="wildcards-in-target-rules.html#cb112-77"></a>    <span class="ex">shell</span>:</span>
<span id="cb112-78"><a href="wildcards-in-target-rules.html#cb112-78"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb112-79"><a href="wildcards-in-target-rules.html#cb112-79"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb112-80"><a href="wildcards-in-target-rules.html#cb112-80"></a><span class="st">            --out {output.data}&quot;</span></span>
<span id="cb112-81"><a href="wildcards-in-target-rules.html#cb112-81"></a></span>
<span id="cb112-82"><a href="wildcards-in-target-rules.html#cb112-82"></a></span>
<span id="cb112-83"><a href="wildcards-in-target-rules.html#cb112-83"></a><span class="co"># --- Clean Rules --- #</span></span>
<span id="cb112-84"><a href="wildcards-in-target-rules.html#cb112-84"></a></span>
<span id="cb112-85"><a href="wildcards-in-target-rules.html#cb112-85"></a><span class="ex">rule</span> clean:</span>
<span id="cb112-86"><a href="wildcards-in-target-rules.html#cb112-86"></a>    <span class="ex">shell</span>:</span>
<span id="cb112-87"><a href="wildcards-in-target-rules.html#cb112-87"></a>        <span class="st">&quot;rm -rf out/*&quot;</span></span>
<span id="cb112-88"><a href="wildcards-in-target-rules.html#cb112-88"></a></span>
<span id="cb112-89"><a href="wildcards-in-target-rules.html#cb112-89"></a><span class="ex">rule</span> clean_data:</span>
<span id="cb112-90"><a href="wildcards-in-target-rules.html#cb112-90"></a>    <span class="ex">shell</span>:</span>
<span id="cb112-91"><a href="wildcards-in-target-rules.html#cb112-91"></a>        <span class="st">&quot;rm -rf out/data/*&quot;</span></span>
<span id="cb112-92"><a href="wildcards-in-target-rules.html#cb112-92"></a></span>
<span id="cb112-93"><a href="wildcards-in-target-rules.html#cb112-93"></a><span class="ex">rule</span> clean_analysis:</span>
<span id="cb112-94"><a href="wildcards-in-target-rules.html#cb112-94"></a>    <span class="ex">shell</span>:</span>
<span id="cb112-95"><a href="wildcards-in-target-rules.html#cb112-95"></a>        <span class="st">&quot;rm -rf out/analysis/*&quot;</span></span></code></pre></div>
<p>You can check the summary via</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb113-1"><a href="wildcards-in-target-rules.html#cb113-1"></a><span class="ex">snakemake</span> --summary make_figures </span></code></pre></div>
<p>run the rule via</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb114-1"><a href="wildcards-in-target-rules.html#cb114-1"></a><span class="ex">snakemake</span> --cores 1 make_figures</span></code></pre></div>
<p>and check the output via</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb115-1"><a href="wildcards-in-target-rules.html#cb115-1"></a><span class="fu">ls</span> out/figures</span></code></pre></div>
</div>
</div>
<div id="estimating-a-new-model" class="section level2">
<h2><span class="header-section-number">7.3</span> Estimating a New Model</h2>
<p>So far we have estimated the basic Solow model.
<span class="citation">Mankiw, Romer, and Weil (<a href="#ref-mrw" role="doc-biblioref">1992</a>)</span> also estimate an augmented version of the Solow model which adds human capital.
You can find the regression model required to estimate the augmented model in <code>src/model-specs/model_aug_solow.json</code>.</p>
<p>We can estimate this regression model across each of the three data sets by creating two new rules:</p>
<ul>
<li><code>aug_solow_model</code> - a rule that specifies how to estimate the regression model
<ul>
<li>This should be conceptually very similar ot the <code>solow_model</code> rule</li>
</ul></li>
<li><code>aug_solow_target</code> - a target rule, using the <code>expand()</code> function to estimate the augmented solow model across the datasets specified in DATA_SUBSET.
<ul>
<li>This will look very similar to the <code>solow_target</code> rule.</li>
</ul></li>
</ul>
<p>Let’s first create the <code>aug_solow_model</code> rule:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode bash fold-show"><code class="sourceCode bash"><span id="cb116-1"><a href="wildcards-in-target-rules.html#cb116-1"></a><span class="ex">rule</span> aug_solow_model:</span>
<span id="cb116-2"><a href="wildcards-in-target-rules.html#cb116-2"></a>    <span class="ex">input</span>:</span>
<span id="cb116-3"><a href="wildcards-in-target-rules.html#cb116-3"></a>        <span class="ex">script</span> = <span class="st">&quot;src/analysis/estimate_ols_model.R&quot;</span>,</span>
<span id="cb116-4"><a href="wildcards-in-target-rules.html#cb116-4"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb116-5"><a href="wildcards-in-target-rules.html#cb116-5"></a>        <span class="ex">model</span>  = <span class="st">&quot;src/model-specs/model_aug_solow.json&quot;</span>,</span>
<span id="cb116-6"><a href="wildcards-in-target-rules.html#cb116-6"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/subset_{iSubset}.json&quot;</span></span>
<span id="cb116-7"><a href="wildcards-in-target-rules.html#cb116-7"></a>    <span class="ex">output</span>:</span>
<span id="cb116-8"><a href="wildcards-in-target-rules.html#cb116-8"></a>        <span class="ex">estimate</span> = <span class="st">&quot;out/analysis/model_aug_solow_subset_{iSubset}.rds&quot;</span></span>
<span id="cb116-9"><a href="wildcards-in-target-rules.html#cb116-9"></a>    <span class="ex">shell</span>:</span>
<span id="cb116-10"><a href="wildcards-in-target-rules.html#cb116-10"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb116-11"><a href="wildcards-in-target-rules.html#cb116-11"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb116-12"><a href="wildcards-in-target-rules.html#cb116-12"></a><span class="st">            --model {input.model} \</span></span>
<span id="cb116-13"><a href="wildcards-in-target-rules.html#cb116-13"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb116-14"><a href="wildcards-in-target-rules.html#cb116-14"></a><span class="st">            --out {output.estimate}&quot;</span></span></code></pre></div>
<p>And then the <code>aug_solow_target</code>:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode bash fold-show"><code class="sourceCode bash"><span id="cb117-1"><a href="wildcards-in-target-rules.html#cb117-1"></a><span class="ex">rule</span> aug_solow_target:</span>
<span id="cb117-2"><a href="wildcards-in-target-rules.html#cb117-2"></a>    <span class="ex">input</span>:</span>
<span id="cb117-3"><a href="wildcards-in-target-rules.html#cb117-3"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/analysis/model_aug_solow_subset_{iSubset}.rds&quot;</span>,</span>
<span id="cb117-4"><a href="wildcards-in-target-rules.html#cb117-4"></a>                    <span class="ex">iSubset</span> = DATA_SUBSET)</span></code></pre></div>
<p>Finally, we can estimate the new regression model by executing the <code>aug_solow_target</code> rule with Snakemake:</p>
<pre class="out"><code>snakemake --cores 1 aug_solow_target</code></pre>
</div>
<div id="expanding-multiple-wildcards" class="section level2">
<h2><span class="header-section-number">7.4</span> Expanding Multiple Wildcards</h2>
<p>The rules used to estimate the standard Solow model and the augmented Solow model are identical except for the model they use.</p>
<p>The only difference between the <code>aug_solow_target</code> and <code>solow_target</code> rules is that the filename differs by three letters: <code>out/analysis/model_aug_solow_{iSubset}.rds</code> versus
<code>out/analysis/model_solow_{iSubset}.rds</code>.</p>
<pre class="out fold-show"><code>
rule solow_target:
    input:
        expand(&quot;out/analysis/model_solow_subset_{iSubset}.rds&quot;,
                    iSubset = DATA_SUBSET)

rule aug_solow_target:
    input:
        expand(&quot;out/analysis/model_aug_solow_subset_{iSubset}.rds&quot;,
                    iSubset = DATA_SUBSET)
</code></pre>
<p>And, when we look at <code>aug_solow_model</code> and compare it to <code>solow_model</code> we again see only small differences:
the model changes from <code>model_aug_solow.json</code> to <code>model_solow.json</code> and the outputs change in a similar way.</p>
<pre class="out fold-show"><code>rule solow_model:
    input:
        script = &quot;src/analysis/estimate_ols_model.R&quot;,
        data   = &quot;out/data/mrw_complete.csv&quot;,
        model  = &quot;src/model-specs/model_solow.json&quot;,
        subset = &quot;src/data-specs/subset_{iSubset}.json&quot;
    output:
        estimate = &quot;out/analysis/model_solow_subset_{iSubset}.rds&quot;
    shell:
        &quot;Rscript {input.script} \
            --data {input.data} \
            --model {input.model} \
            --subset {input.subset} \
            --out {output.estimate}&quot;

rule aug_solow_model:
    input:
        script = &quot;src/analysis/estimate_ols_model.R&quot;,
        data   = &quot;out/data/mrw_complete.csv&quot;,
        model  = &quot;src/model-specs/model_aug_solow.json&quot;,
        subset = &quot;src/data-specs/subset_{iSubset}.json&quot;
    output:
        estimate = &quot;out/analysis/model_aug_solow_subset_{iSubset}.rds&quot;
    shell:
        &quot;Rscript {input.script} \
            --data {input.data} \
            --model {input.model} \
            --subset {input.subset} \
            --out {output.estimate}&quot;</code></pre>
<p>We want to exploit this similarity and condense these four rules into two:</p>
<ul>
<li>a rule that estimates the model, named <code>model</code>, and</li>
<li>a target rule that will run each specification, named <code>run_models</code>.</li>
</ul>
<p>Let’s do this in reverse order, i.e. starting with creating the <code>run_models</code> target rule.</p>
<div id="unifying-the-target-rules" class="section level3">
<h3><span class="header-section-number">7.4.1</span> Unifying the Target Rules</h3>
<p>First, we are going to take our two rules <code>aug_solow_target</code> and <code>solow_target</code> and replace them with one rule.
To do this, we remove the existing rules and replace them with the following:</p>
<pre class="out"><code>rule run_models:
    input:
        expand(&quot;out/analysis/model_{iModel}_subset_{iSubset}.rds&quot;,
                    iSubset = DATA_SUBSET,
                    iModel = MODELS)</code></pre>
<p>What this says is <code>run_models</code> wants to create regression estimates for multiple datasets, by iterating through our existing list <code>DATA_SUBSET</code> and
replacing <code>{iSubset}</code> with each of these values one after the other.
Furthermore, it wants to create regression estimates across multiple models, by iterating through a list called <code>MODELS</code> and replacing <code>{iModel}</code> with each of these values successively.
Combined, that means <code>run_models</code> will create regression estimates for each of the pairwise combinations of elements in the <code>DATA_SUBSET</code> and <code>MODELS</code> lists.</p>
<p>We have not specified the list <code>MODELS</code> yet, so let’s do that now.
<code>MODELS</code> contains two elements, <code>solow</code> and <code>aug_solow</code> - which are the names of the models we estimate.
Let’s add this to the top of our Snakefile:</p>
<pre class="out"><code>MODELS = [
          &quot;solow&quot;,
          &quot;aug_solow&quot;
          ]</code></pre>
</div>
<div id="unifying-how-regression-outputs-are-built" class="section level3">
<h3><span class="header-section-number">7.4.2</span> Unifying How Regression Outputs are Built</h3>
<p>The rule <code>run_models</code> tells Snakemake what we want to produce.
Now we have to dictate how these estimates can be produced - i.e. how to we combine data, regression models and R scripts to produce the outputs.
We are going to replace the two rules <code>solow_model</code> and <code>aug_solow_model</code> with one rule <code>model</code> that can estimate <em>both</em> regression models.
To do this, we generalize these existing rules.
The <code>{input.model}</code> is what needs generalization - instead of taking the value <code>model_solow.json</code> OR <code>model_aug_solow.json</code> it will take a wildcard value <code>model_{iModel}.json</code>.
This should give us the following:<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a></p>
<pre class="out"><code>rule model:
    input:
        script = &quot;src/analysis/estimate_ols_model.R&quot;,
        data   = &quot;out/data/mrw_complete.csv&quot;,
        model  = &quot;src/model-specs/model_{iModel}.json&quot;,
        subset = &quot;src/data-specs/subset_{iSubset}.json&quot;
    output:
        estimate = &quot;out/analysis/model_{iModel}_subset_{iSubset}.rds&quot;
    shell:
        &quot;Rscript {input.script} \
            --data {input.data} \
            --model {input.model} \
            --subset {input.subset} \
            --out {output.estimate}&quot;</code></pre>
<p>Now the rule <code>model</code> can estimate an OLS model using different regression specification by substituting a value into <code>{iModel}</code>, and across different data sets by substituting a value into <code>{iSubset}</code>.
The target rule we created above, tells Snakemake which values to substitute.</p>
</div>
<div id="running-the-new-rule" class="section level3">
<h3><span class="header-section-number">7.4.3</span> Running the New Rule</h3>
<p>To see this new rule in action, let’s start by cleaning our output folder to start fresh:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb124-1"><a href="wildcards-in-target-rules.html#cb124-1"></a><span class="ex">snakemake</span> --clean</span></code></pre></div>
<p>Before running Snakemake let’s look at the summary information from Snakemake:</p>
<pre class="out"><code>$ snakemake --summary</code></pre>
<p>which yields:</p>
<pre class="out"><code>output_file     date    rule    version log-file(s)     status  plan
out/analysis/model_solow_subset_oecd.rds        -       -       -       -       missing update pending
out/analysis/model_aug_solow_subset_oecd.rds    -       -       -       -       missing update pending
out/analysis/model_solow_subset_intermediate.rds        -       -       -       -       missing update pending
out/analysis/model_aug_solow_subset_intermediate.rds    -       -       -       -       missing update pending
out/analysis/model_solow_subset_nonoil.rds      -       -       -       -       missing update pending
out/analysis/model_aug_solow_subset_nonoil.rds  -       -       -       -       missing update pending
out/data/mrw_complete.csv       -       gen_regression_vars     -               missing update pending
out/data/mrw_renamed.csv        -       rename_vars     -               missing update pending</code></pre>
<p>This confirms that our new target and model rules work.
Snakemake plans to do the data management steps and build all six model outputs afterwards.</p>
<p>Let’s now execute our target rule:</p>
<pre class="out"><code>$ snakemake --cores 1 run_models</code></pre>
<div class="unnumbered tip">
<p>Notice how the figures aren’t produced automatically.
Do you remember why?
If not, revisit the previous chapter.
You can build them with <code>snakemake --cores 1 make_figures</code></p>
</div>
</div>
</div>
<div id="our-workflow-in-graphs-2" class="section level2">
<h2><span class="header-section-number">7.5</span> Our Workflow in Graphs</h2>
<p>We’ve make some good progess in this chapter using <code>expand()</code> to reduce replication in our Snakefile.
The Snakemake rule graph which shows the rules we execute in our workflow is now:</p>
<p><img src="img/22-expand/rulegraph.png" /><!-- --></p>
<p>This says to run the rule <code>run_models</code> - Snakemake expands wildcards and builds the regression outputs using the <code>models</code> rule.
Before the models are run, the data cleaning steps are completed in order.</p>
<p>We can get an even more insightful perspective on what Snakemake is doing under the hood by looking at the DAG:</p>
<p><img src="img/22-expand/dag.png" /><!-- --></p>
<p>The DAG makes even clearer what our workflow is doing:</p>
<ul>
<li>Snakemake wants to build the inputs listed in <code>run_models</code></li>
<li>It can build those inputs by running the <code>model</code> rule six times when it iterates over the wildcards</li>
<li>To run each model, it needs the clean data, so it needs to run the two data cleaning steps first</li>
</ul>
<p>Notice that the rule graph and DAG don’t show us how the figures are created.
This is because the rule that generates figures, <code>make_figures</code> is not the first rule in the Snakefile.
For the sake of completeness, the rulegraph for how figures are made is:</p>
<p><img src="img/22-expand/rulegraph_figures.png" /><!-- --></p>
<p>And the DAG is:</p>
<p><img src="img/22-expand/dag_figures.png" /><!-- --></p>
<p>We leave it to the interested reader to provide themselves a verbal understanding of what these graphs mean in terms of workflow execution.</p>

</div>
</div>
<h3><span class="header-section-number">B</span> References</h3>
<div id="refs" class="references">
<div id="ref-mrw">
<p>Mankiw, N. Gregory, David Romer, and David N. Weil. 1992. “A Contribution to the Empirics of Economic Growth*.” <em>The Quarterly Journal of Economics</em> 107 (2): 407–37. <a href="https://doi.org/10.2307/2118477">https://doi.org/10.2307/2118477</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="9">
<li id="fn9"><p>
If this doesn’t feel like a familar argument to you, review the material from the previous chapter <a href="wildcards.html#wildcards-tidying">here</a>.<a href="wildcards-in-target-rules.html#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p>
Note that the <code>--summary</code> command did not throw an error message.
This means we have solved the <code>WildcardError</code> we began with.<a href="wildcards-in-target-rules.html#fnref10" class="footnote-back">↩︎</a></p></li>
<li id="fn11"><p>
We capitalize lists that we iterate over to separate them from other parts of code.
This is not essential but makes life a bit easier sometimes.
Whenever you see a capitalized name, you know it is a list that we want to iterate over.<a href="wildcards-in-target-rules.html#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p>
This is not entirely true, we are yet to figure out how to get the y-axis range from the original paper.<a href="wildcards-in-target-rules.html#fnref12" class="footnote-back">↩︎</a></p></li>
<li id="fn13"><p>
Instead of typing out this new rule <code>models</code> and deleting <code>solow_model</code> and <code>aug_solow_model</code>, you could delete the rule <code>aug_solow_model</code> and modify the <code>solow_rule</code> so that it looks like this.<a href="wildcards-in-target-rules.html#fnref13" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="wildcards.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="automating-list-construction-for-wildcard-expansion.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/lachlandeer/snakemake-econ-r/edit/master/22-expand.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["https://github.com/lachlandeer/snakemake-econ-r/raw/master/22-expand.Rmd"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
