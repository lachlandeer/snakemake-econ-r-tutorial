<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Automatic Expansion of Wildcards | Reproducible Data Analytic Workflows with Snakemake and R</title>
  <meta name="description" content="In progress" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Automatic Expansion of Wildcards | Reproducible Data Analytic Workflows with Snakemake and R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="In progress" />
  <meta name="github-repo" content="lachlandeer/snakemake-econ-r-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Automatic Expansion of Wildcards | Reproducible Data Analytic Workflows with Snakemake and R" />
  
  <meta name="twitter:description" content="In progress" />
  

<meta name="author" content="Ulrich Bergmann" />
<meta name="author" content="Lachlan Deer" />
<meta name="author" content="Julian Langer" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="wildcards.html"/>
<link rel="next" href="automating-list-construction-for-wildcard-expansion.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="img/logo.png"></a></li>
<div style="text-align:center">
<li><a href="./index.html">Reproducible Data Analytic <br /> Workflows with Snakemake and `R`</a></li>
</div>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-we-wrote-this-tutorial"><i class="fa fa-check"></i>Why we wrote this tutorial</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#pre-requisite-knowledge"><i class="fa fa-check"></i>Pre-requisite Knowledge</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-needs-to-be-downloaded-installed-for-this-tutorial"><i class="fa fa-check"></i>What Needs to be Downloaded &amp; Installed for this Tutorial</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#template-scripts-and-documents"><i class="fa fa-check"></i>Template Scripts and Documents</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-installation"><i class="fa fa-check"></i>Software Installation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-we-cant-cover"><i class="fa fa-check"></i>What We Can’t Cover</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the Authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#instructional-material"><i class="fa fa-check"></i>Instructional material</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software"><i class="fa fa-check"></i>Software</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#citation"><i class="fa fa-check"></i>Citation</a></li>
</ul></li>
<li class="part"><span><b>I Preliminaries</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Motivating &amp; Rationale</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#a-case-for-reproducibility"><i class="fa fa-check"></i><b>1.1</b> A Case for Reproducibility</a><ul>
<li class="chapter" data-level="1.1.1" data-path="intro.html"><a href="intro.html#how-far-to-go-in-the-quest-for-reproducibility"><i class="fa fa-check"></i><b>1.1.1</b> How far to go in the quest for reproducibility?</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#what-is-snakemake-why-should-you-use-it"><i class="fa fa-check"></i><b>1.2</b> What is <code>Snakemake</code> &amp; Why Should you use it?</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#why-r"><i class="fa fa-check"></i><b>1.3</b> Why <code>R</code>?</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#working-example-replicating-mankiw-romer-and-weils-1992-qje"><i class="fa fa-check"></i><b>1.4</b> Working Example: Replicating Mankiw, Romer and Weil’s 1992 QJE</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#the-way-forward"><i class="fa fa-check"></i><b>1.5</b> The way forward</a><ul>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#exercise-your-own-projects-steps"><i class="fa fa-check"></i>Exercise: Your own project’s steps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="project-organization.html"><a href="project-organization.html"><i class="fa fa-check"></i><b>2</b> Project Organization</a><ul>
<li class="chapter" data-level="" data-path="project-organization.html"><a href="project-organization.html#learning-objectives"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="2.1" data-path="project-organization.html"><a href="project-organization.html#subtitle-tbd"><i class="fa fa-check"></i><b>2.1</b> Subtitle TBD</a></li>
<li class="chapter" data-level="2.2" data-path="project-organization.html"><a href="project-organization.html#project-organization-i-separating-inputs-and-outputs"><i class="fa fa-check"></i><b>2.2</b> Project Organization I: Separating Inputs and Outputs</a></li>
<li class="chapter" data-level="2.3" data-path="project-organization.html"><a href="project-organization.html#project-structure-ii-separating-logical-chunks-of-the-project"><i class="fa fa-check"></i><b>2.3</b> Project Structure II: Separating Logical Chunks of the Project</a><ul>
<li class="chapter" data-level="2.3.1" data-path="project-organization.html"><a href="project-organization.html#aside-even-deeper-sub-folders"><i class="fa fa-check"></i><b>2.3.1</b> Aside: Even Deeper Sub-folders</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="project-organization.html"><a href="project-organization.html#project-structure-iii-separating-input-parameters-from-code"><i class="fa fa-check"></i><b>2.4</b> Project Structure III: Separating Input Parameters from Code</a></li>
</ul></li>
<li class="part"><span><b>II Basic Snakemake Workflows</b></span></li>
<li class="chapter" data-level="3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html"><i class="fa fa-check"></i><b>3</b> Initial Steps with Snakemake</a><ul>
<li class="chapter" data-level="3.1" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#snakefile-writing-our-first-rule"><i class="fa fa-check"></i><b>3.1</b> Snakefile – Writing Our First Rule</a></li>
<li class="chapter" data-level="3.2" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#the-snakemake-command-executing-a-rule"><i class="fa fa-check"></i><b>3.2</b> The Snakemake Command – Executing a Rule</a></li>
<li class="chapter" data-level="3.3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#reading-and-writing-files-first-steps-in-a-data-science-pipeline"><i class="fa fa-check"></i><b>3.3</b> Reading and Writing Files – First Steps in a Data Science Pipeline</a><ul>
<li class="chapter" data-level="3.3.1" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#using-the-rscript-command-to-execute-r-scripts"><i class="fa fa-check"></i><b>3.3.1</b> Using the Rscript command to execute R scripts</a></li>
<li class="chapter" data-level="3.3.2" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#the-input-and-output-arguments"><i class="fa fa-check"></i><b>3.3.2</b> The input and output arguments</a></li>
<li class="chapter" data-level="3.3.3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#a-rule-to-rename-variables."><i class="fa fa-check"></i><b>3.3.3</b> A rule to rename variables.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#redundant-executions-dont-run-a-rule-repeatedly"><i class="fa fa-check"></i><b>3.4</b> Redundant Executions – (Don’t) Run a Rule Repeatedly</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html"><i class="fa fa-check"></i><b>4</b> Working With Multiple Rules</a><ul>
<li class="chapter" data-level="4.1" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#creating-a-second-rule"><i class="fa fa-check"></i><b>4.1</b> Creating a second rule</a><ul>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#exercise-creating-rules"><i class="fa fa-check"></i>Exercise: Creating Rules</a></li>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#solution"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#clean-rules"><i class="fa fa-check"></i><b>4.2</b> Clean Rules</a><ul>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#exercise-creating-cleaning-rules"><i class="fa fa-check"></i>Exercise: Creating Cleaning Rules</a></li>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#solution-1"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="target-rules.html"><a href="target-rules.html"><i class="fa fa-check"></i><b>5</b> Target Rules</a><ul>
<li class="chapter" data-level="5.1" data-path="target-rules.html"><a href="target-rules.html#where-we-are-now"><i class="fa fa-check"></i><b>5.1</b> Where we are now?</a></li>
<li class="chapter" data-level="5.2" data-path="target-rules.html"><a href="target-rules.html#how-snakemake-determines-the-build-order-when-multiple-rules-are-present"><i class="fa fa-check"></i><b>5.2</b> How Snakemake determines the build order when multiple rules are present</a></li>
<li class="chapter" data-level="5.3" data-path="target-rules.html"><a href="target-rules.html#dedicated-target-rules-to-execute-multiple-rules"><i class="fa fa-check"></i><b>5.3</b> Dedicated target rules to execute multiple rules</a><ul>
<li class="chapter" data-level="" data-path="target-rules.html"><a href="target-rules.html#exercise-using-target-rules"><i class="fa fa-check"></i>Exercise: Using target rules</a></li>
<li class="chapter" data-level="" data-path="target-rules.html"><a href="target-rules.html#solution-2"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="target-rules.html"><a href="target-rules.html#target-rules-can-do-more-for-us"><i class="fa fa-check"></i><b>5.4</b> Target rules can do more for us</a></li>
</ul></li>
<li class="part"><span><b>III Minimizing Repetition, Maximizing Generalizability</b></span></li>
<li class="chapter" data-level="6" data-path="wildcards.html"><a href="wildcards.html"><i class="fa fa-check"></i><b>6</b> Wildcards</a><ul>
<li class="chapter" data-level="6.1" data-path="wildcards.html"><a href="wildcards.html#the-starting-point-of-our-snakefile"><i class="fa fa-check"></i><b>6.1</b> The starting point of our Snakefile</a></li>
<li class="chapter" data-level="6.2" data-path="wildcards.html"><a href="wildcards.html#using-wildcards-to-tidy-up-our-code"><i class="fa fa-check"></i><b>6.2</b> Using wildcards to tidy up our code</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html"><i class="fa fa-check"></i><b>7</b> Automatic Expansion of Wildcards</a><ul>
<li class="chapter" data-level="7.1" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#learning-goals"><i class="fa fa-check"></i><b>7.1</b> Learning Goals</a></li>
<li class="chapter" data-level="7.2" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#the-expand-function"><i class="fa fa-check"></i><b>7.2</b> The <code>expand()</code> function</a><ul>
<li class="chapter" data-level="" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#exercise-exploring-the-expand-function-i"><i class="fa fa-check"></i>Exercise: Exploring the expand function I</a></li>
<li class="chapter" data-level="7.2.1" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#solution-3"><i class="fa fa-check"></i><b>7.2.1</b> SOLUTION:</a></li>
<li class="chapter" data-level="" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#exercise-exploring-the-expand-function-ii"><i class="fa fa-check"></i>Exercise: Exploring the expand() function II</a></li>
<li class="chapter" data-level="7.2.2" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#solution-4"><i class="fa fa-check"></i><b>7.2.2</b> Solution</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#expanding-multiple-wildcards"><i class="fa fa-check"></i><b>7.3</b> Expanding Multiple Wildcards</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html"><i class="fa fa-check"></i><b>8</b> Automating List Construction for Wildcard Expansion</a><ul>
<li class="chapter" data-level="8.1" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#learning-objectives-1"><i class="fa fa-check"></i><b>8.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="8.2" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#state-of-the-snakefile"><i class="fa fa-check"></i><b>8.2</b> State of the Snakefile</a></li>
<li class="chapter" data-level="8.3" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#the-glob_wildcards-function"><i class="fa fa-check"></i><b>8.3</b> The <code>glob_wildcards</code> Function</a></li>
<li class="chapter" data-level="8.4" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#looking-at-the-dag-redux"><i class="fa fa-check"></i><b>8.4</b> Looking at the DAG (redux)</a><ul>
<li class="chapter" data-level="" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#exercise-exploring-glob_wildcards"><i class="fa fa-check"></i>Exercise: Exploring glob_wildcards()</a></li>
<li class="chapter" data-level="8.4.1" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#solution-5"><i class="fa fa-check"></i><b>8.4.1</b> Solution</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Bringing Many Outputs Together</b></span></li>
<li class="chapter" data-level="9" data-path="make-tables.html"><a href="make-tables.html"><i class="fa fa-check"></i><b>9</b> Make Tables</a><ul>
<li class="chapter" data-level="9.1" data-path="make-tables.html"><a href="make-tables.html#the-state-of-the-snakefile"><i class="fa fa-check"></i><b>9.1</b> The State of the Snakefile</a></li>
<li class="chapter" data-level="9.2" data-path="make-tables.html"><a href="make-tables.html#building-a-single-table"><i class="fa fa-check"></i><b>9.2</b> Building a single table</a></li>
<li class="chapter" data-level="9.3" data-path="make-tables.html"><a href="make-tables.html#building-all-tables-at-once"><i class="fa fa-check"></i><b>9.3</b> Building all tables at once</a><ul>
<li class="chapter" data-level="" data-path="make-tables.html"><a href="make-tables.html#exercise"><i class="fa fa-check"></i>Exercise</a></li>
<li class="chapter" data-level="" data-path="make-tables.html"><a href="make-tables.html#solution-6"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html"><i class="fa fa-check"></i><b>10</b> One rule to rule them all</a><ul>
<li class="chapter" data-level="10.1" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#the-state-of-the-snakefile-1"><i class="fa fa-check"></i><b>10.1</b> The State of the Snakefile</a></li>
<li class="chapter" data-level="10.2" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#creating-an-all-target-rule"><i class="fa fa-check"></i><b>10.2</b> Creating an <code>all</code> target rule</a></li>
<li class="chapter" data-level="10.3" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#concluding-remarks"><i class="fa fa-check"></i><b>10.3</b> Concluding Remarks</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html"><i class="fa fa-check"></i><b>11</b> Adding Papers and Slides to a Snakemake Workflow</a><ul>
<li class="chapter" data-level="11.1" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#learning-objectives-2"><i class="fa fa-check"></i><b>11.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="11.2" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#state-of-our-snakefile"><i class="fa fa-check"></i><b>11.2</b> State of Our Snakefile</a></li>
<li class="chapter" data-level="11.3" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#where-we-are"><i class="fa fa-check"></i><b>11.3</b> Where We Are</a></li>
<li class="chapter" data-level="11.4" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#building-a-paper"><i class="fa fa-check"></i><b>11.4</b> Building a Paper</a></li>
<li class="chapter" data-level="11.5" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#integrating-build_paper-output-into-all"><i class="fa fa-check"></i><b>11.5</b> Integrating <code>build_paper</code> output into <code>all</code></a></li>
<li class="chapter" data-level="11.6" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#making-paper.pdf-easier-to-find"><i class="fa fa-check"></i><b>11.6</b> Making <code>paper.pdf</code> Easier to Find</a><ul>
<li class="chapter" data-level="11.6.1" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#exercise-adding-a-slide-deck."><i class="fa fa-check"></i><b>11.6.1</b> Exercise: Adding a Slide Deck.</a></li>
<li class="chapter" data-level="11.6.2" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#exercise-solution"><i class="fa fa-check"></i><b>11.6.2</b> Exercise Solution</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#final-thoughts"><i class="fa fa-check"></i><b>11.7</b> Final Thoughts</a></li>
</ul></li>
<li class="part"><span><b>V Decorating Snakemake Workflows</b></span></li>
<li class="chapter" data-level="12" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html"><i class="fa fa-check"></i><b>12</b> Logging Output and Errors</a><ul>
<li class="chapter" data-level="12.1" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#logging-output"><i class="fa fa-check"></i><b>12.1</b> Logging Output</a></li>
<li class="chapter" data-level="12.2" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#logging-output-and-errors-in-one-file"><i class="fa fa-check"></i><b>12.2</b> Logging Output and Errors in One File</a><ul>
<li class="chapter" data-level="" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#exercise-logging-all-r-scripts"><i class="fa fa-check"></i>Exercise: Logging all R Scripts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="adding-parameters.html"><a href="adding-parameters.html"><i class="fa fa-check"></i><b>13</b> Adding Parameters</a><ul>
<li class="chapter" data-level="13.1" data-path="adding-parameters.html"><a href="adding-parameters.html#motivating-example-constructing-a-regression-table-from-ols-results"><i class="fa fa-check"></i><b>13.1</b> Motivating Example: Constructing a Regression Table from OLS Results</a></li>
<li class="chapter" data-level="13.2" data-path="adding-parameters.html"><a href="adding-parameters.html#creating-a-rule-with-params"><i class="fa fa-check"></i><b>13.2</b> Creating a Rule with <code>params</code></a><ul>
<li class="chapter" data-level="" data-path="adding-parameters.html"><a href="adding-parameters.html#exercise-building-table-2"><i class="fa fa-check"></i>Exercise: Building Table 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="config-files.html"><a href="config-files.html"><i class="fa fa-check"></i><b>14</b> Config Files</a><ul>
<li class="chapter" data-level="14.1" data-path="config-files.html"><a href="config-files.html#the-config.yaml-filepath"><i class="fa fa-check"></i><b>14.1</b> The <code>config.yaml</code> filepath</a></li>
<li class="chapter" data-level="14.2" data-path="config-files.html"><a href="config-files.html#using-paths-from-the-config-file"><i class="fa fa-check"></i><b>14.2</b> Using paths from the config file</a><ul>
<li class="chapter" data-level="" data-path="config-files.html"><a href="config-files.html#exercise-using-config-files"><i class="fa fa-check"></i>Exercise: Using Config Files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="self-documenting-help.html"><a href="self-documenting-help.html"><i class="fa fa-check"></i><b>15</b> Self Documenting Help</a><ul>
<li class="chapter" data-level="15.1" data-path="self-documenting-help.html"><a href="self-documenting-help.html#our-commenting-syle"><i class="fa fa-check"></i><b>15.1</b> Our Commenting Syle</a></li>
<li class="chapter" data-level="15.2" data-path="self-documenting-help.html"><a href="self-documenting-help.html#adding-further-comments"><i class="fa fa-check"></i><b>15.2</b> Adding Further Comments</a><ul>
<li class="chapter" data-level="" data-path="self-documenting-help.html"><a href="self-documenting-help.html#exercise-adding-comments"><i class="fa fa-check"></i>Exercise: Adding Comments</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="self-documenting-help.html"><a href="self-documenting-help.html#a-help-rule"><i class="fa fa-check"></i><b>15.3</b> A <code>help</code> Rule</a><ul>
<li><a href="self-documenting-help.html#exercise-saving-help-output-to-file">Exercise: Saving <code>help</code> output to file</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html"><i class="fa fa-check"></i><b>16</b> Subworkflows: Divide and Conquer</a><ul>
<li class="chapter" data-level="16.1" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#subworkflow-basics"><i class="fa fa-check"></i><b>16.1</b> Subworkflow Basics</a></li>
<li class="chapter" data-level="16.2" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#subworkflow-dependencies"><i class="fa fa-check"></i><b>16.2</b> Subworkflow dependencies</a><ul>
<li class="chapter" data-level="" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#exercise-more-subworkflows"><i class="fa fa-check"></i>Exercise: More Subworkflows</a></li>
<li><a href="subworkflows-divide-and-conquer.html#guided-exercise-help-rules-with-subworkflows">Guided Exercise: <code>help</code> rules with subworkflows</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VI Putting Workflows in a Box</b></span></li>
<li class="chapter" data-level="17" data-path="package-dependencies-with-renv.html"><a href="package-dependencies-with-renv.html"><i class="fa fa-check"></i><b>17</b> Package Dependencies with <code>renv</code></a></li>
<li class="chapter" data-level="18" data-path="containers.html"><a href="containers.html"><i class="fa fa-check"></i><b>18</b> Containers</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="installation-guide.html"><a href="installation-guide.html"><i class="fa fa-check"></i><b>A</b> Installation Guide</a><ul>
<li class="chapter" data-level="A.1" data-path="installation-guide.html"><a href="installation-guide.html#windows"><i class="fa fa-check"></i><b>A.1</b> Windows</a><ul>
<li class="chapter" data-level="A.1.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal"><i class="fa fa-check"></i><b>A.1.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.1.2" data-path="installation-guide.html"><a href="installation-guide.html#python"><i class="fa fa-check"></i><b>A.1.2</b> Python</a></li>
<li class="chapter" data-level="" data-path="installation-guide.html"><a href="installation-guide.html#installing-snakemake"><i class="fa fa-check"></i>Installing Snakemake</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="installation-guide.html"><a href="installation-guide.html#mac"><i class="fa fa-check"></i><b>A.2</b> Mac</a><ul>
<li class="chapter" data-level="A.2.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal-1"><i class="fa fa-check"></i><b>A.2.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.2.2" data-path="installation-guide.html"><a href="installation-guide.html#python-1"><i class="fa fa-check"></i><b>A.2.2</b> Python</a></li>
<li class="chapter" data-level="" data-path="installation-guide.html"><a href="installation-guide.html#installing-snakemake-1"><i class="fa fa-check"></i>Installing Snakemake</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="installation-guide.html"><a href="installation-guide.html#linux-ubuntu"><i class="fa fa-check"></i><b>A.3</b> Linux / Ubuntu</a><ul>
<li class="chapter" data-level="A.3.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal-2"><i class="fa fa-check"></i><b>A.3.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.3.2" data-path="installation-guide.html"><a href="installation-guide.html#python-2"><i class="fa fa-check"></i><b>A.3.2</b> Python</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>B</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.comlachlandeer/snakemake-econ-r/" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible Data Analytic Workflows with Snakemake and <code>R</code></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="automatic-expansion-of-wildcards" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Automatic Expansion of Wildcards</h1>
<div id="learning-goals" class="section level2">
<h2><span class="header-section-number">7.1</span> Learning Goals</h2>
<p>TODO: Add Goals</p>
<p>TODO:</p>
<p>!!! State of the Snakefile !!!</p>
<p>Add a box with how the snakefile needs to be at the beginning of this chapter</p>
</div>
<div id="the-expand-function" class="section level2">
<h2><span class="header-section-number">7.2</span> The <code>expand()</code> function</h2>
<p>When we look at our target rule:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb77-1"><a href="automatic-expansion-of-wildcards.html#cb77-1"></a><span class="ex">rule</span> solow_target:</span>
<span id="cb77-2"><a href="automatic-expansion-of-wildcards.html#cb77-2"></a>    <span class="ex">input</span>:</span>
<span id="cb77-3"><a href="automatic-expansion-of-wildcards.html#cb77-3"></a>        <span class="ex">intermediate</span> = <span class="st">&quot;out/analysis/model_solow_subset_intermediate.rds&quot;</span>,</span>
<span id="cb77-4"><a href="automatic-expansion-of-wildcards.html#cb77-4"></a>        <span class="ex">nonoil</span>       = <span class="st">&quot;out/analysis/model_solow_subset_nonoil.rds&quot;</span>,</span>
<span id="cb77-5"><a href="automatic-expansion-of-wildcards.html#cb77-5"></a>        <span class="ex">oecd</span>         = <span class="st">&quot;out/analysis/model_solow_subset_oecd.rds&quot;</span></span></code></pre></div>
<p>We can see that each of inputs listed have similar structure:</p>
<ul>
<li>The outputs live on the same path <code>out/analysis/</code>, and</li>
<li>The filenames of each output begin with <code>model_solow</code> and end with <code>.rds</code>.</li>
</ul>
<p>Only the name of the subset of data we are using changing.
We can use the idea of wildcards from the previous chapter together with some additional Snakemake functionality to simplify this target rule.
Using what we learned in Chapter XX, we can modify <code>solow_target</code> using a wildcard:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb78-1"><a href="automatic-expansion-of-wildcards.html#cb78-1"></a><span class="ex">rule</span> solow_target:</span>
<span id="cb78-2"><a href="automatic-expansion-of-wildcards.html#cb78-2"></a>    <span class="ex">input</span>:</span>
<span id="cb78-3"><a href="automatic-expansion-of-wildcards.html#cb78-3"></a>        <span class="ex">models</span> = <span class="st">&quot;out/analysis/model_solow_{iSubset}.rds&quot;</span>,</span></code></pre></div>
<p>If we try and run snakemake with our target rule written like this we see the following:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb79-1"><a href="automatic-expansion-of-wildcards.html#cb79-1"></a>$ <span class="ex">snakemake</span> --cores 1 solow_target</span></code></pre></div>
<p>We get an error:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb80-1"><a href="automatic-expansion-of-wildcards.html#cb80-1"></a><span class="ex">Building</span> DAG of jobs...</span>
<span id="cb80-2"><a href="automatic-expansion-of-wildcards.html#cb80-2"></a><span class="ex">WildcardError</span> in line 12 of /home/lachlan/teaching/snakemake-econ-r-learner/Snakefile:</span>
<span id="cb80-3"><a href="automatic-expansion-of-wildcards.html#cb80-3"></a><span class="ex">Wildcards</span> in input files cannot be determined from output files:</span>
<span id="cb80-4"><a href="automatic-expansion-of-wildcards.html#cb80-4"></a><span class="st">&#39;iSubset&#39;</span></span></code></pre></div>
<p>Recall that Snakemake won’t run a rule that contains a wildcard because it does not know how to resolve it,
i.e. Snakemake doesn’t know to replace <code>{iSubset}</code> with either of <code>subset_oecd</code>, <code>subset_intermediate</code> or <code>subset_nonoil</code>.
It is our job to tell Snakemake that this is what we want to happen.
Luckily Snakemake has a functionality that allows us to tell it how to accept a wildcard and replace it with a set of specific values.</p>
<p>The function we are looking for is the <code>expand()</code> function.
As the name suggests its job is to expand a wildcard by replacing with with a specified value.
All we need to do is tell Snakemake what to substitute in the wildcard’s place.
We can use the <code>expand()</code> function as follows:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb81-1"><a href="automatic-expansion-of-wildcards.html#cb81-1"></a><span class="ex">rule</span> solow_target:</span>
<span id="cb81-2"><a href="automatic-expansion-of-wildcards.html#cb81-2"></a>    <span class="ex">input</span>:</span>
<span id="cb81-3"><a href="automatic-expansion-of-wildcards.html#cb81-3"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/analysis/model_solow_{iSubset}.rds&quot;</span>,</span>
<span id="cb81-4"><a href="automatic-expansion-of-wildcards.html#cb81-4"></a>                    <span class="ex">iSubset</span> = DATA_SUBSET)</span></code></pre></div>
<p>This says replace the wildcard <code>{iSubset}</code> with some value <code>DATA_SUBSET</code>.
Let’s look at the what this buys us.</p>
<p>First, let’s clean up our output folder with <code>snakemake clean</code> so that we have an clean slate to work with:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb82-1"><a href="automatic-expansion-of-wildcards.html#cb82-1"></a>$ <span class="ex">snakemake</span> --cores 1 clean</span></code></pre></div>
<p>Now replace <code>DATA_SUBSET</code> in our target rule of the Snakefile with one of our data subsets the analysis uses,
<code>subset_nonoil</code>:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb83-1"><a href="automatic-expansion-of-wildcards.html#cb83-1"></a><span class="ex">rule</span> solow_target:</span>
<span id="cb83-2"><a href="automatic-expansion-of-wildcards.html#cb83-2"></a>    <span class="ex">input</span>:</span>
<span id="cb83-3"><a href="automatic-expansion-of-wildcards.html#cb83-3"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/analysis/model_solow_{iSubset}.rds&quot;</span>,</span>
<span id="cb83-4"><a href="automatic-expansion-of-wildcards.html#cb83-4"></a>                    <span class="ex">iSubset</span> = <span class="st">&quot;subset_nonoil&quot;</span>)</span></code></pre></div>
<p>And let’s use the <code>--summary</code> option of snakemake to see what the build plan would be:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb84-1"><a href="automatic-expansion-of-wildcards.html#cb84-1"></a>$ <span class="ex">snakemake</span> --summary</span></code></pre></div>
<p>We see:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb85-1"><a href="automatic-expansion-of-wildcards.html#cb85-1"></a><span class="ex">output_file</span>     date    rule    version log-file(s)     <span class="ex">status</span>  plan</span>
<span id="cb85-2"><a href="automatic-expansion-of-wildcards.html#cb85-2"></a><span class="ex">out/analysis/model_solow_subset_nonoil.rds</span>      -       solow_model     -               missing update pending</span>
<span id="cb85-3"><a href="automatic-expansion-of-wildcards.html#cb85-3"></a><span class="ex">out/data/mrw_complete.csv</span>       -       gen_regression_vars     -               missing update pending</span>
<span id="cb85-4"><a href="automatic-expansion-of-wildcards.html#cb85-4"></a><span class="ex">out/data/mrw_renamed.csv</span>        -       rename_vars     -               missing update pending</span></code></pre></div>
<p>From the top line of the output, we can see that Snakemake wants to build the file <code>out/analysis/model_solow_subset_nonoil.rds</code>.
This means Snakemake has indeed replaced the wildcard <code>iSubset</code> with <code>subset_nonoil</code>.
And, because we were not thrown an error message, the problem of not being able to resolve a wildcard has been solved through the use of <code>expand()</code>.</p>
<p>Now that we have the idea that <code>expand()</code> can replace a wilcard with a value, we want to know how to replace a wildcard with multiple values iteratively,
i.e., first with <code>subset_nonoil</code>, then with <code>subset_oecd</code> and finally with <code>subset_intermediate</code>.
We do this by passing a list, in the python sense of the word, of values that we want {iSubset} to take.
For example, if we want to run the model on both <code>subset_nonoil</code> and <code>subset_oecd</code>:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb86-1"><a href="automatic-expansion-of-wildcards.html#cb86-1"></a><span class="ex">rule</span> solow_target:</span>
<span id="cb86-2"><a href="automatic-expansion-of-wildcards.html#cb86-2"></a>    <span class="ex">input</span>:</span>
<span id="cb86-3"><a href="automatic-expansion-of-wildcards.html#cb86-3"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/analysis/model_solow_{iSubset}.rds&quot;</span>,</span>
<span id="cb86-4"><a href="automatic-expansion-of-wildcards.html#cb86-4"></a>                    <span class="ex">iSubset</span> = [<span class="st">&quot;subset_nonoil&quot;</span>, <span class="st">&quot;subset_oecd&quot;</span>])</span></code></pre></div>
<p>If we then look at the summary:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb87-1"><a href="automatic-expansion-of-wildcards.html#cb87-1"></a>$ <span class="ex">snakemake</span> --summary</span></code></pre></div>
<p>We see:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb88-1"><a href="automatic-expansion-of-wildcards.html#cb88-1"></a><span class="ex">output_file</span>     date    rule    version log-file(s)     <span class="ex">status</span>  plan</span>
<span id="cb88-2"><a href="automatic-expansion-of-wildcards.html#cb88-2"></a><span class="ex">out/analysis/model_solow_subset_nonoil.rds</span>      -       solow_model     -               missing update pending</span>
<span id="cb88-3"><a href="automatic-expansion-of-wildcards.html#cb88-3"></a><span class="ex">out/analysis/model_solow_subset_oecd.rds</span>        -       solow_model     -               missing update pending</span>
<span id="cb88-4"><a href="automatic-expansion-of-wildcards.html#cb88-4"></a><span class="ex">out/data/mrw_complete.csv</span>       -       gen_regression_vars     -               missing update pending</span>
<span id="cb88-5"><a href="automatic-expansion-of-wildcards.html#cb88-5"></a><span class="ex">out/data/mrw_renamed.csv</span>        -       rename_vars     -               missing update pending</span></code></pre></div>
<p>The top two lines show the wildcard {iSubset} has indeed been replaced successively with <code>subset_nonoil</code> and then <code>subset_oecd</code>.</p>
<p>The notion of constructing a list of values for Snakemake to iterate through is definitely beneficial,
and progress has been made.
However, specifying the list each time in the rule itself is not ideal for at least two reasons:</p>
<ol style="list-style-type: lower-roman">
<li>If we need to use the same list multiple times across different rules we have to copy and paste it, and then be sure we update it correctly each time, and</li>
<li>It can be hard to find the lists we are iterating over when we read through the Snakefile.</li>
</ol>
<p>We can easily overcome both limitations by creating our list of data subsets outside of the rule,
and then referring the list by name as needed.
To do this, at the top of our Snakefile we will create an area to store lists we will want to iterate through.
For us right now, we want to create a list of data subsets, so let’s call the list <code>DATA_SUBSET</code>.<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>
Inside that list we put the three subsets:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb89-1"><a href="automatic-expansion-of-wildcards.html#cb89-1"></a><span class="ex">DATA_SUBSET</span> = [</span>
<span id="cb89-2"><a href="automatic-expansion-of-wildcards.html#cb89-2"></a>                <span class="st">&quot;subset_oecd&quot;</span>,</span>
<span id="cb89-3"><a href="automatic-expansion-of-wildcards.html#cb89-3"></a>                <span class="st">&quot;subset_intermediate&quot;</span>,</span>
<span id="cb89-4"><a href="automatic-expansion-of-wildcards.html#cb89-4"></a>                <span class="st">&quot;subset_nonoil&quot;</span></span>
<span id="cb89-5"><a href="automatic-expansion-of-wildcards.html#cb89-5"></a>                ]</span></code></pre></div>
<p>Then we inside our <code>expand()</code> we write <code>iSubset = DATA_SUBSET</code> so Snakemake knows to iterate through that list:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb90-1"><a href="automatic-expansion-of-wildcards.html#cb90-1"></a><span class="ex">rule</span> solow_target:</span>
<span id="cb90-2"><a href="automatic-expansion-of-wildcards.html#cb90-2"></a>    <span class="ex">input</span>:</span>
<span id="cb90-3"><a href="automatic-expansion-of-wildcards.html#cb90-3"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/analysis/model_solow_{iSubset}.rds&quot;</span>,</span>
<span id="cb90-4"><a href="automatic-expansion-of-wildcards.html#cb90-4"></a>                    <span class="ex">iSubset</span> = DATA_SUBSET)</span></code></pre></div>
<p>Now when we look at the build plan with the <code>summary</code> option:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb91-1"><a href="automatic-expansion-of-wildcards.html#cb91-1"></a>$ <span class="ex">snakemake</span> --summary</span></code></pre></div>
<p>We see:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb92-1"><a href="automatic-expansion-of-wildcards.html#cb92-1"></a><span class="ex">output_file</span>     date    rule    version log-file(s)     <span class="ex">status</span>  plan</span>
<span id="cb92-2"><a href="automatic-expansion-of-wildcards.html#cb92-2"></a><span class="ex">out/analysis/model_solow_subset_oecd.rds</span>        -       solow_model     -               missing update pending</span>
<span id="cb92-3"><a href="automatic-expansion-of-wildcards.html#cb92-3"></a><span class="ex">out/analysis/model_solow_subset_intermediate.rds</span>        -       solow_model     -               missing update pending</span>
<span id="cb92-4"><a href="automatic-expansion-of-wildcards.html#cb92-4"></a><span class="ex">out/analysis/model_solow_subset_nonoil.rds</span>      -       solow_model     -               missing update pending</span>
<span id="cb92-5"><a href="automatic-expansion-of-wildcards.html#cb92-5"></a><span class="ex">out/data/mrw_complete.csv</span>       -       gen_regression_vars     -               missing update pending</span>
<span id="cb92-6"><a href="automatic-expansion-of-wildcards.html#cb92-6"></a><span class="ex">out/data/mrw_renamed.csv</span>        -       rename_vars     -               missing update pending</span></code></pre></div>
<p>Which shows Snakemake wants to run the regression on all three data subsets.</p>
<p>Let’s do that now:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb93-1"><a href="automatic-expansion-of-wildcards.html#cb93-1"></a>$ <span class="ex">snakemake</span> --cores 1 </span></code></pre></div>
<p>!! TO DO !!</p>
<p>add the output here</p>
<div id="exercise-exploring-the-expand-function-i" class="section level3 unnumbered exercise">
<h3>Exercise: Exploring the expand function I</h3>
<p>The MRW paper contains three plots.
Each of these plots use the data subset of ‘intermediate’ countries.
In the <code>src/figures/</code> subdirectory, there are three scripts that reproduce the figures one script per plot.<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a></p>
<ol style="list-style-type: lower-alpha">
<li>Write three rules <code>fig_1</code>, <code>fig_2</code> and <code>fig_3</code> to produce each figure.
Each figure should be saved with the following name ‘out/figures/SCRIPTNAME.pdf’</li>
<li>Create a list called <code>PLOTS</code> that contains the file names of each of the three plot scripts (without <code>.R</code>).
Use what you have learned about wildcards and the <code>expand</code> function to condense the three rules in (a) into
one rule <code>figures</code> that can make each figure and a target rule <code>make_figures</code> so that <code>snakemake --cores 1 figs_target</code>
builds all three figures, one after the other.</li>
</ol>
<p>HINT:
The scripts are written in such a way that they accept exactly the same options.
Using wildcards and the expand function extend the Snakefile to construct each figure.</p>
</div>
<div id="solution-3" class="section level3">
<h3><span class="header-section-number">7.2.1</span> SOLUTION:</h3>
<p>Use <code>snakemake --cores 1 make_figures</code> to run the figures</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb94-1"><a href="automatic-expansion-of-wildcards.html#cb94-1"></a><span class="co"># --- Dictionaries --- #</span></span>
<span id="cb94-2"><a href="automatic-expansion-of-wildcards.html#cb94-2"></a></span>
<span id="cb94-3"><a href="automatic-expansion-of-wildcards.html#cb94-3"></a><span class="ex">DATA_SUBSET</span> = [</span>
<span id="cb94-4"><a href="automatic-expansion-of-wildcards.html#cb94-4"></a>                <span class="st">&quot;subset_oecd&quot;</span>,</span>
<span id="cb94-5"><a href="automatic-expansion-of-wildcards.html#cb94-5"></a>                <span class="st">&quot;subset_intermediate&quot;</span>,</span>
<span id="cb94-6"><a href="automatic-expansion-of-wildcards.html#cb94-6"></a>                <span class="st">&quot;subset_nonoil&quot;</span></span>
<span id="cb94-7"><a href="automatic-expansion-of-wildcards.html#cb94-7"></a>                ]</span>
<span id="cb94-8"><a href="automatic-expansion-of-wildcards.html#cb94-8"></a></span>
<span id="cb94-9"><a href="automatic-expansion-of-wildcards.html#cb94-9"></a><span class="ex">PLOTS</span> = [</span>
<span id="cb94-10"><a href="automatic-expansion-of-wildcards.html#cb94-10"></a>    <span class="st">&quot;aug_conditional_convergence&quot;</span>,</span>
<span id="cb94-11"><a href="automatic-expansion-of-wildcards.html#cb94-11"></a>    <span class="st">&quot;conditional_convergence&quot;</span>,</span>
<span id="cb94-12"><a href="automatic-expansion-of-wildcards.html#cb94-12"></a>    <span class="st">&quot;unconditional_convergence&quot;</span></span>
<span id="cb94-13"><a href="automatic-expansion-of-wildcards.html#cb94-13"></a>]</span>
<span id="cb94-14"><a href="automatic-expansion-of-wildcards.html#cb94-14"></a></span>
<span id="cb94-15"><a href="automatic-expansion-of-wildcards.html#cb94-15"></a><span class="co"># --- Build Rules --- #</span></span>
<span id="cb94-16"><a href="automatic-expansion-of-wildcards.html#cb94-16"></a></span>
<span id="cb94-17"><a href="automatic-expansion-of-wildcards.html#cb94-17"></a><span class="ex">rule</span> solow_target:</span>
<span id="cb94-18"><a href="automatic-expansion-of-wildcards.html#cb94-18"></a>    <span class="ex">input</span>:</span>
<span id="cb94-19"><a href="automatic-expansion-of-wildcards.html#cb94-19"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/analysis/model_solow_{iSubset}.rds&quot;</span>,</span>
<span id="cb94-20"><a href="automatic-expansion-of-wildcards.html#cb94-20"></a>                    <span class="ex">iSubset</span> = DATA_SUBSET)</span>
<span id="cb94-21"><a href="automatic-expansion-of-wildcards.html#cb94-21"></a></span>
<span id="cb94-22"><a href="automatic-expansion-of-wildcards.html#cb94-22"></a><span class="ex">rule</span> solow_model:</span>
<span id="cb94-23"><a href="automatic-expansion-of-wildcards.html#cb94-23"></a>    <span class="ex">input</span>:</span>
<span id="cb94-24"><a href="automatic-expansion-of-wildcards.html#cb94-24"></a>        <span class="ex">script</span> = <span class="st">&quot;src/analysis/estimate_ols_model.R&quot;</span>,</span>
<span id="cb94-25"><a href="automatic-expansion-of-wildcards.html#cb94-25"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb94-26"><a href="automatic-expansion-of-wildcards.html#cb94-26"></a>        <span class="ex">model</span>  = <span class="st">&quot;src/model-specs/model_solow.json&quot;</span>,</span>
<span id="cb94-27"><a href="automatic-expansion-of-wildcards.html#cb94-27"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/{iSubset}.json&quot;</span></span>
<span id="cb94-28"><a href="automatic-expansion-of-wildcards.html#cb94-28"></a>    <span class="ex">output</span>:</span>
<span id="cb94-29"><a href="automatic-expansion-of-wildcards.html#cb94-29"></a>        <span class="ex">estimate</span> = <span class="st">&quot;out/analysis/model_solow_{iSubset}.rds&quot;</span></span>
<span id="cb94-30"><a href="automatic-expansion-of-wildcards.html#cb94-30"></a>    <span class="ex">shell</span>:</span>
<span id="cb94-31"><a href="automatic-expansion-of-wildcards.html#cb94-31"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb94-32"><a href="automatic-expansion-of-wildcards.html#cb94-32"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb94-33"><a href="automatic-expansion-of-wildcards.html#cb94-33"></a><span class="st">            --model {input.model} \</span></span>
<span id="cb94-34"><a href="automatic-expansion-of-wildcards.html#cb94-34"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb94-35"><a href="automatic-expansion-of-wildcards.html#cb94-35"></a><span class="st">            --out {output.estimate}&quot;</span></span>
<span id="cb94-36"><a href="automatic-expansion-of-wildcards.html#cb94-36"></a></span>
<span id="cb94-37"><a href="automatic-expansion-of-wildcards.html#cb94-37"></a></span>
<span id="cb94-38"><a href="automatic-expansion-of-wildcards.html#cb94-38"></a><span class="ex">rule</span> make_figures:</span>
<span id="cb94-39"><a href="automatic-expansion-of-wildcards.html#cb94-39"></a>    <span class="ex">input</span>:</span>
<span id="cb94-40"><a href="automatic-expansion-of-wildcards.html#cb94-40"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/figures/{iFigure}.pdf&quot;</span>,</span>
<span id="cb94-41"><a href="automatic-expansion-of-wildcards.html#cb94-41"></a>                    <span class="ex">iFigure</span> = PLOTS)</span>
<span id="cb94-42"><a href="automatic-expansion-of-wildcards.html#cb94-42"></a></span>
<span id="cb94-43"><a href="automatic-expansion-of-wildcards.html#cb94-43"></a><span class="ex">rule</span> figure:</span>
<span id="cb94-44"><a href="automatic-expansion-of-wildcards.html#cb94-44"></a>    <span class="ex">input</span>:</span>
<span id="cb94-45"><a href="automatic-expansion-of-wildcards.html#cb94-45"></a>        <span class="ex">script</span> = <span class="st">&quot;src/figures/{iFigure}.R&quot;</span>,</span>
<span id="cb94-46"><a href="automatic-expansion-of-wildcards.html#cb94-46"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb94-47"><a href="automatic-expansion-of-wildcards.html#cb94-47"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/subset_intermediate.json&quot;</span></span>
<span id="cb94-48"><a href="automatic-expansion-of-wildcards.html#cb94-48"></a>    <span class="ex">output</span>:</span>
<span id="cb94-49"><a href="automatic-expansion-of-wildcards.html#cb94-49"></a>        <span class="ex">fig</span> = <span class="st">&quot;out/figures/{iFigure}.pdf&quot;</span></span>
<span id="cb94-50"><a href="automatic-expansion-of-wildcards.html#cb94-50"></a>    <span class="ex">shell</span>:</span>
<span id="cb94-51"><a href="automatic-expansion-of-wildcards.html#cb94-51"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb94-52"><a href="automatic-expansion-of-wildcards.html#cb94-52"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb94-53"><a href="automatic-expansion-of-wildcards.html#cb94-53"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb94-54"><a href="automatic-expansion-of-wildcards.html#cb94-54"></a><span class="st">            --out {output.fig}&quot;</span></span>
<span id="cb94-55"><a href="automatic-expansion-of-wildcards.html#cb94-55"></a></span>
<span id="cb94-56"><a href="automatic-expansion-of-wildcards.html#cb94-56"></a><span class="ex">rule</span> gen_regression_vars:</span>
<span id="cb94-57"><a href="automatic-expansion-of-wildcards.html#cb94-57"></a>    <span class="ex">input</span>:</span>
<span id="cb94-58"><a href="automatic-expansion-of-wildcards.html#cb94-58"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/gen_reg_vars.R&quot;</span>,</span>
<span id="cb94-59"><a href="automatic-expansion-of-wildcards.html#cb94-59"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span>,</span>
<span id="cb94-60"><a href="automatic-expansion-of-wildcards.html#cb94-60"></a>        <span class="ex">param</span>  = <span class="st">&quot;src/data-specs/param_solow.json&quot;</span></span>
<span id="cb94-61"><a href="automatic-expansion-of-wildcards.html#cb94-61"></a>    <span class="ex">output</span>:</span>
<span id="cb94-62"><a href="automatic-expansion-of-wildcards.html#cb94-62"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span></span>
<span id="cb94-63"><a href="automatic-expansion-of-wildcards.html#cb94-63"></a>    <span class="ex">shell</span>:</span>
<span id="cb94-64"><a href="automatic-expansion-of-wildcards.html#cb94-64"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb94-65"><a href="automatic-expansion-of-wildcards.html#cb94-65"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb94-66"><a href="automatic-expansion-of-wildcards.html#cb94-66"></a><span class="st">            --param {input.param} \</span></span>
<span id="cb94-67"><a href="automatic-expansion-of-wildcards.html#cb94-67"></a><span class="st">            --out {output.data}&quot;</span></span>
<span id="cb94-68"><a href="automatic-expansion-of-wildcards.html#cb94-68"></a></span>
<span id="cb94-69"><a href="automatic-expansion-of-wildcards.html#cb94-69"></a><span class="ex">rule</span> rename_vars:</span>
<span id="cb94-70"><a href="automatic-expansion-of-wildcards.html#cb94-70"></a>    <span class="ex">input</span>:</span>
<span id="cb94-71"><a href="automatic-expansion-of-wildcards.html#cb94-71"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/rename_variables.R&quot;</span>,</span>
<span id="cb94-72"><a href="automatic-expansion-of-wildcards.html#cb94-72"></a>        <span class="ex">data</span>   = <span class="st">&quot;src/data/mrw.dta&quot;</span></span>
<span id="cb94-73"><a href="automatic-expansion-of-wildcards.html#cb94-73"></a>    <span class="ex">output</span>:</span>
<span id="cb94-74"><a href="automatic-expansion-of-wildcards.html#cb94-74"></a>        <span class="ex">data</span> = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span></span>
<span id="cb94-75"><a href="automatic-expansion-of-wildcards.html#cb94-75"></a>    <span class="ex">shell</span>:</span>
<span id="cb94-76"><a href="automatic-expansion-of-wildcards.html#cb94-76"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb94-77"><a href="automatic-expansion-of-wildcards.html#cb94-77"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb94-78"><a href="automatic-expansion-of-wildcards.html#cb94-78"></a><span class="st">            --out {output.data}&quot;</span></span>
<span id="cb94-79"><a href="automatic-expansion-of-wildcards.html#cb94-79"></a></span>
<span id="cb94-80"><a href="automatic-expansion-of-wildcards.html#cb94-80"></a><span class="ex">rule</span> clean:</span>
<span id="cb94-81"><a href="automatic-expansion-of-wildcards.html#cb94-81"></a>    <span class="ex">shell</span>:</span>
<span id="cb94-82"><a href="automatic-expansion-of-wildcards.html#cb94-82"></a>        <span class="st">&quot;rm -rf out/*&quot;</span></span>
<span id="cb94-83"><a href="automatic-expansion-of-wildcards.html#cb94-83"></a></span>
<span id="cb94-84"><a href="automatic-expansion-of-wildcards.html#cb94-84"></a><span class="ex">rule</span> clean_data:</span>
<span id="cb94-85"><a href="automatic-expansion-of-wildcards.html#cb94-85"></a>    <span class="ex">shell</span>:</span>
<span id="cb94-86"><a href="automatic-expansion-of-wildcards.html#cb94-86"></a>        <span class="st">&quot;rm -rf out/data/*&quot;</span></span>
<span id="cb94-87"><a href="automatic-expansion-of-wildcards.html#cb94-87"></a></span>
<span id="cb94-88"><a href="automatic-expansion-of-wildcards.html#cb94-88"></a><span class="ex">rule</span> clean_analysis:</span>
<span id="cb94-89"><a href="automatic-expansion-of-wildcards.html#cb94-89"></a>    <span class="ex">shell</span>:</span>
<span id="cb94-90"><a href="automatic-expansion-of-wildcards.html#cb94-90"></a>        <span class="st">&quot;rm -rf out/analysis/*&quot;</span></span></code></pre></div>
</div>
<div id="exercise-exploring-the-expand-function-ii" class="section level3 unnumbered exercise">
<h3>Exercise: Exploring the expand() function II</h3>
<p>So far we have estimated the basic Solow model.
MRW also estimate an augmented version of the Solow model, adding human capital.
The regression model required to estimate the augmented model is written up in <code>src/model-specs/model_aug_solow.json</code>.</p>
<ol style="list-style-type: lower-alpha">
<li>Write the pair of rules <code>aug_solow_model</code> and <code>aug_solow_target</code> to estimate this model on each of the data subsets in <code>DATA_SUBSET</code></li>
</ol>
<p>HINT: Use the <code>expand()</code> function together with the <code>estimate_ols.R</code> script to estimate the augmented solow model on each of the three data subsets.
The rule structures should look very similar to what we have done so far.</p>
</div>
<div id="solution-4" class="section level3">
<h3><span class="header-section-number">7.2.2</span> Solution</h3>
<div class="sourceCode" id="cb95"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb95-1"><a href="automatic-expansion-of-wildcards.html#cb95-1"></a><span class="co"># --- Dictionaries --- #</span></span>
<span id="cb95-2"><a href="automatic-expansion-of-wildcards.html#cb95-2"></a></span>
<span id="cb95-3"><a href="automatic-expansion-of-wildcards.html#cb95-3"></a><span class="ex">DATA_SUBSET</span> = [</span>
<span id="cb95-4"><a href="automatic-expansion-of-wildcards.html#cb95-4"></a>                <span class="st">&quot;subset_oecd&quot;</span>,</span>
<span id="cb95-5"><a href="automatic-expansion-of-wildcards.html#cb95-5"></a>                <span class="st">&quot;subset_intermediate&quot;</span>,</span>
<span id="cb95-6"><a href="automatic-expansion-of-wildcards.html#cb95-6"></a>                <span class="st">&quot;subset_nonoil&quot;</span></span>
<span id="cb95-7"><a href="automatic-expansion-of-wildcards.html#cb95-7"></a>                ]</span>
<span id="cb95-8"><a href="automatic-expansion-of-wildcards.html#cb95-8"></a></span>
<span id="cb95-9"><a href="automatic-expansion-of-wildcards.html#cb95-9"></a><span class="ex">PLOTS</span> = [</span>
<span id="cb95-10"><a href="automatic-expansion-of-wildcards.html#cb95-10"></a>    <span class="st">&quot;aug_conditional_convergence&quot;</span>,</span>
<span id="cb95-11"><a href="automatic-expansion-of-wildcards.html#cb95-11"></a>    <span class="st">&quot;conditional_convergence&quot;</span>,</span>
<span id="cb95-12"><a href="automatic-expansion-of-wildcards.html#cb95-12"></a>    <span class="st">&quot;unconditional_convergence&quot;</span></span>
<span id="cb95-13"><a href="automatic-expansion-of-wildcards.html#cb95-13"></a>]</span>
<span id="cb95-14"><a href="automatic-expansion-of-wildcards.html#cb95-14"></a></span>
<span id="cb95-15"><a href="automatic-expansion-of-wildcards.html#cb95-15"></a><span class="co"># --- Build Rules --- #</span></span>
<span id="cb95-16"><a href="automatic-expansion-of-wildcards.html#cb95-16"></a></span>
<span id="cb95-17"><a href="automatic-expansion-of-wildcards.html#cb95-17"></a><span class="ex">rule</span> solow_target:</span>
<span id="cb95-18"><a href="automatic-expansion-of-wildcards.html#cb95-18"></a>    <span class="ex">input</span>:</span>
<span id="cb95-19"><a href="automatic-expansion-of-wildcards.html#cb95-19"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/analysis/model_solow_{iSubset}.rds&quot;</span>,</span>
<span id="cb95-20"><a href="automatic-expansion-of-wildcards.html#cb95-20"></a>                    <span class="ex">iSubset</span> = DATA_SUBSET)</span>
<span id="cb95-21"><a href="automatic-expansion-of-wildcards.html#cb95-21"></a></span>
<span id="cb95-22"><a href="automatic-expansion-of-wildcards.html#cb95-22"></a><span class="ex">rule</span> aug_solow_target:</span>
<span id="cb95-23"><a href="automatic-expansion-of-wildcards.html#cb95-23"></a>    <span class="ex">input</span>:</span>
<span id="cb95-24"><a href="automatic-expansion-of-wildcards.html#cb95-24"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/analysis/model_aug_solow_{iSubset}.rds&quot;</span>,</span>
<span id="cb95-25"><a href="automatic-expansion-of-wildcards.html#cb95-25"></a>                    <span class="ex">iSubset</span> = DATA_SUBSET)</span>
<span id="cb95-26"><a href="automatic-expansion-of-wildcards.html#cb95-26"></a></span>
<span id="cb95-27"><a href="automatic-expansion-of-wildcards.html#cb95-27"></a><span class="ex">rule</span> solow_model:</span>
<span id="cb95-28"><a href="automatic-expansion-of-wildcards.html#cb95-28"></a>    <span class="ex">input</span>:</span>
<span id="cb95-29"><a href="automatic-expansion-of-wildcards.html#cb95-29"></a>        <span class="ex">script</span> = <span class="st">&quot;src/analysis/estimate_ols_model.R&quot;</span>,</span>
<span id="cb95-30"><a href="automatic-expansion-of-wildcards.html#cb95-30"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb95-31"><a href="automatic-expansion-of-wildcards.html#cb95-31"></a>        <span class="ex">model</span>  = <span class="st">&quot;src/model-specs/model_solow.json&quot;</span>,</span>
<span id="cb95-32"><a href="automatic-expansion-of-wildcards.html#cb95-32"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/{iSubset}.json&quot;</span></span>
<span id="cb95-33"><a href="automatic-expansion-of-wildcards.html#cb95-33"></a>    <span class="ex">output</span>:</span>
<span id="cb95-34"><a href="automatic-expansion-of-wildcards.html#cb95-34"></a>        <span class="ex">estimate</span> = <span class="st">&quot;out/analysis/model_solow_{iSubset}.rds&quot;</span></span>
<span id="cb95-35"><a href="automatic-expansion-of-wildcards.html#cb95-35"></a>    <span class="ex">shell</span>:</span>
<span id="cb95-36"><a href="automatic-expansion-of-wildcards.html#cb95-36"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb95-37"><a href="automatic-expansion-of-wildcards.html#cb95-37"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb95-38"><a href="automatic-expansion-of-wildcards.html#cb95-38"></a><span class="st">            --model {input.model} \</span></span>
<span id="cb95-39"><a href="automatic-expansion-of-wildcards.html#cb95-39"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb95-40"><a href="automatic-expansion-of-wildcards.html#cb95-40"></a><span class="st">            --out {output.estimate}&quot;</span></span>
<span id="cb95-41"><a href="automatic-expansion-of-wildcards.html#cb95-41"></a></span>
<span id="cb95-42"><a href="automatic-expansion-of-wildcards.html#cb95-42"></a><span class="ex">rule</span> aug_solow_model:</span>
<span id="cb95-43"><a href="automatic-expansion-of-wildcards.html#cb95-43"></a>    <span class="ex">input</span>:</span>
<span id="cb95-44"><a href="automatic-expansion-of-wildcards.html#cb95-44"></a>        <span class="ex">script</span> = <span class="st">&quot;src/analysis/estimate_ols_model.R&quot;</span>,</span>
<span id="cb95-45"><a href="automatic-expansion-of-wildcards.html#cb95-45"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb95-46"><a href="automatic-expansion-of-wildcards.html#cb95-46"></a>        <span class="ex">model</span>  = <span class="st">&quot;src/model-specs/model_aug_solow.json&quot;</span>,</span>
<span id="cb95-47"><a href="automatic-expansion-of-wildcards.html#cb95-47"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/{iSubset}.json&quot;</span></span>
<span id="cb95-48"><a href="automatic-expansion-of-wildcards.html#cb95-48"></a>    <span class="ex">output</span>:</span>
<span id="cb95-49"><a href="automatic-expansion-of-wildcards.html#cb95-49"></a>        <span class="ex">estimate</span> = <span class="st">&quot;out/analysis/model_aug_solow_{iSubset}.rds&quot;</span></span>
<span id="cb95-50"><a href="automatic-expansion-of-wildcards.html#cb95-50"></a>    <span class="ex">shell</span>:</span>
<span id="cb95-51"><a href="automatic-expansion-of-wildcards.html#cb95-51"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb95-52"><a href="automatic-expansion-of-wildcards.html#cb95-52"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb95-53"><a href="automatic-expansion-of-wildcards.html#cb95-53"></a><span class="st">            --model {input.model} \</span></span>
<span id="cb95-54"><a href="automatic-expansion-of-wildcards.html#cb95-54"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb95-55"><a href="automatic-expansion-of-wildcards.html#cb95-55"></a><span class="st">            --out {output.estimate}&quot;</span></span>
<span id="cb95-56"><a href="automatic-expansion-of-wildcards.html#cb95-56"></a></span>
<span id="cb95-57"><a href="automatic-expansion-of-wildcards.html#cb95-57"></a></span>
<span id="cb95-58"><a href="automatic-expansion-of-wildcards.html#cb95-58"></a><span class="ex">rule</span> make_figures:</span>
<span id="cb95-59"><a href="automatic-expansion-of-wildcards.html#cb95-59"></a>    <span class="ex">input</span>:</span>
<span id="cb95-60"><a href="automatic-expansion-of-wildcards.html#cb95-60"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/figures/{iFigure}.pdf&quot;</span>,</span>
<span id="cb95-61"><a href="automatic-expansion-of-wildcards.html#cb95-61"></a>                    <span class="ex">iFigure</span> = PLOTS)</span>
<span id="cb95-62"><a href="automatic-expansion-of-wildcards.html#cb95-62"></a></span>
<span id="cb95-63"><a href="automatic-expansion-of-wildcards.html#cb95-63"></a><span class="ex">rule</span> figure:</span>
<span id="cb95-64"><a href="automatic-expansion-of-wildcards.html#cb95-64"></a>    <span class="ex">input</span>:</span>
<span id="cb95-65"><a href="automatic-expansion-of-wildcards.html#cb95-65"></a>        <span class="ex">script</span> = <span class="st">&quot;src/figures/{iFigure}.R&quot;</span>,</span>
<span id="cb95-66"><a href="automatic-expansion-of-wildcards.html#cb95-66"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb95-67"><a href="automatic-expansion-of-wildcards.html#cb95-67"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/subset_intermediate.json&quot;</span></span>
<span id="cb95-68"><a href="automatic-expansion-of-wildcards.html#cb95-68"></a>    <span class="ex">output</span>:</span>
<span id="cb95-69"><a href="automatic-expansion-of-wildcards.html#cb95-69"></a>        <span class="ex">fig</span> = <span class="st">&quot;out/figures/{iFigure}.pdf&quot;</span></span>
<span id="cb95-70"><a href="automatic-expansion-of-wildcards.html#cb95-70"></a>    <span class="ex">shell</span>:</span>
<span id="cb95-71"><a href="automatic-expansion-of-wildcards.html#cb95-71"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb95-72"><a href="automatic-expansion-of-wildcards.html#cb95-72"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb95-73"><a href="automatic-expansion-of-wildcards.html#cb95-73"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb95-74"><a href="automatic-expansion-of-wildcards.html#cb95-74"></a><span class="st">            --out {output.fig}&quot;</span></span>
<span id="cb95-75"><a href="automatic-expansion-of-wildcards.html#cb95-75"></a></span>
<span id="cb95-76"><a href="automatic-expansion-of-wildcards.html#cb95-76"></a><span class="ex">rule</span> gen_regression_vars:</span>
<span id="cb95-77"><a href="automatic-expansion-of-wildcards.html#cb95-77"></a>    <span class="ex">input</span>:</span>
<span id="cb95-78"><a href="automatic-expansion-of-wildcards.html#cb95-78"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/gen_reg_vars.R&quot;</span>,</span>
<span id="cb95-79"><a href="automatic-expansion-of-wildcards.html#cb95-79"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span>,</span>
<span id="cb95-80"><a href="automatic-expansion-of-wildcards.html#cb95-80"></a>        <span class="ex">param</span>  = <span class="st">&quot;src/data-specs/param_solow.json&quot;</span></span>
<span id="cb95-81"><a href="automatic-expansion-of-wildcards.html#cb95-81"></a>    <span class="ex">output</span>:</span>
<span id="cb95-82"><a href="automatic-expansion-of-wildcards.html#cb95-82"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span></span>
<span id="cb95-83"><a href="automatic-expansion-of-wildcards.html#cb95-83"></a>    <span class="ex">shell</span>:</span>
<span id="cb95-84"><a href="automatic-expansion-of-wildcards.html#cb95-84"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb95-85"><a href="automatic-expansion-of-wildcards.html#cb95-85"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb95-86"><a href="automatic-expansion-of-wildcards.html#cb95-86"></a><span class="st">            --param {input.param} \</span></span>
<span id="cb95-87"><a href="automatic-expansion-of-wildcards.html#cb95-87"></a><span class="st">            --out {output.data}&quot;</span></span>
<span id="cb95-88"><a href="automatic-expansion-of-wildcards.html#cb95-88"></a></span>
<span id="cb95-89"><a href="automatic-expansion-of-wildcards.html#cb95-89"></a><span class="ex">rule</span> rename_vars:</span>
<span id="cb95-90"><a href="automatic-expansion-of-wildcards.html#cb95-90"></a>    <span class="ex">input</span>:</span>
<span id="cb95-91"><a href="automatic-expansion-of-wildcards.html#cb95-91"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/rename_variables.R&quot;</span>,</span>
<span id="cb95-92"><a href="automatic-expansion-of-wildcards.html#cb95-92"></a>        <span class="ex">data</span>   = <span class="st">&quot;src/data/mrw.dta&quot;</span></span>
<span id="cb95-93"><a href="automatic-expansion-of-wildcards.html#cb95-93"></a>    <span class="ex">output</span>:</span>
<span id="cb95-94"><a href="automatic-expansion-of-wildcards.html#cb95-94"></a>        <span class="ex">data</span> = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span></span>
<span id="cb95-95"><a href="automatic-expansion-of-wildcards.html#cb95-95"></a>    <span class="ex">shell</span>:</span>
<span id="cb95-96"><a href="automatic-expansion-of-wildcards.html#cb95-96"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb95-97"><a href="automatic-expansion-of-wildcards.html#cb95-97"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb95-98"><a href="automatic-expansion-of-wildcards.html#cb95-98"></a><span class="st">            --out {output.data}&quot;</span></span>
<span id="cb95-99"><a href="automatic-expansion-of-wildcards.html#cb95-99"></a></span>
<span id="cb95-100"><a href="automatic-expansion-of-wildcards.html#cb95-100"></a><span class="ex">rule</span> clean:</span>
<span id="cb95-101"><a href="automatic-expansion-of-wildcards.html#cb95-101"></a>    <span class="ex">shell</span>:</span>
<span id="cb95-102"><a href="automatic-expansion-of-wildcards.html#cb95-102"></a>        <span class="st">&quot;rm -rf out/*&quot;</span></span>
<span id="cb95-103"><a href="automatic-expansion-of-wildcards.html#cb95-103"></a></span>
<span id="cb95-104"><a href="automatic-expansion-of-wildcards.html#cb95-104"></a><span class="ex">rule</span> clean_data:</span>
<span id="cb95-105"><a href="automatic-expansion-of-wildcards.html#cb95-105"></a>    <span class="ex">shell</span>:</span>
<span id="cb95-106"><a href="automatic-expansion-of-wildcards.html#cb95-106"></a>        <span class="st">&quot;rm -rf out/data/*&quot;</span></span>
<span id="cb95-107"><a href="automatic-expansion-of-wildcards.html#cb95-107"></a></span>
<span id="cb95-108"><a href="automatic-expansion-of-wildcards.html#cb95-108"></a><span class="ex">rule</span> clean_analysis:</span>
<span id="cb95-109"><a href="automatic-expansion-of-wildcards.html#cb95-109"></a>    <span class="ex">shell</span>:</span>
<span id="cb95-110"><a href="automatic-expansion-of-wildcards.html#cb95-110"></a>        <span class="st">&quot;rm -rf out/analysis/*&quot;</span></span></code></pre></div>
</div>
</div>
<div id="expanding-multiple-wildcards" class="section level2">
<h2><span class="header-section-number">7.3</span> Expanding Multiple Wildcards</h2>
<p>The rules used to estimate the standard Solow model, and the augmented Solow model have very similar structure:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb96-1"><a href="automatic-expansion-of-wildcards.html#cb96-1"></a><span class="ex">rule</span> solow_target:</span>
<span id="cb96-2"><a href="automatic-expansion-of-wildcards.html#cb96-2"></a>    <span class="ex">input</span>:</span>
<span id="cb96-3"><a href="automatic-expansion-of-wildcards.html#cb96-3"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/analysis/model_solow_{iSubset}.rds&quot;</span>,</span>
<span id="cb96-4"><a href="automatic-expansion-of-wildcards.html#cb96-4"></a>                    <span class="ex">iSubset</span> = DATA_SUBSET)</span>
<span id="cb96-5"><a href="automatic-expansion-of-wildcards.html#cb96-5"></a></span>
<span id="cb96-6"><a href="automatic-expansion-of-wildcards.html#cb96-6"></a><span class="ex">rule</span> aug_solow_target:</span>
<span id="cb96-7"><a href="automatic-expansion-of-wildcards.html#cb96-7"></a>    <span class="ex">input</span>:</span>
<span id="cb96-8"><a href="automatic-expansion-of-wildcards.html#cb96-8"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/analysis/model_aug_solow_{iSubset}.rds&quot;</span>,</span>
<span id="cb96-9"><a href="automatic-expansion-of-wildcards.html#cb96-9"></a>                    <span class="ex">iSubset</span> = DATA_SUBSET)</span>
<span id="cb96-10"><a href="automatic-expansion-of-wildcards.html#cb96-10"></a></span>
<span id="cb96-11"><a href="automatic-expansion-of-wildcards.html#cb96-11"></a><span class="ex">rule</span> solow_model:</span>
<span id="cb96-12"><a href="automatic-expansion-of-wildcards.html#cb96-12"></a>    <span class="ex">input</span>:</span>
<span id="cb96-13"><a href="automatic-expansion-of-wildcards.html#cb96-13"></a>        <span class="ex">script</span> = <span class="st">&quot;src/analysis/estimate_ols_model.R&quot;</span>,</span>
<span id="cb96-14"><a href="automatic-expansion-of-wildcards.html#cb96-14"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb96-15"><a href="automatic-expansion-of-wildcards.html#cb96-15"></a>        <span class="ex">model</span>  = <span class="st">&quot;src/model-specs/model_solow.json&quot;</span>,</span>
<span id="cb96-16"><a href="automatic-expansion-of-wildcards.html#cb96-16"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/{iSubset}.json&quot;</span></span>
<span id="cb96-17"><a href="automatic-expansion-of-wildcards.html#cb96-17"></a>    <span class="ex">output</span>:</span>
<span id="cb96-18"><a href="automatic-expansion-of-wildcards.html#cb96-18"></a>        <span class="ex">estimate</span> = <span class="st">&quot;out/analysis/model_solow_{iSubset}.rds&quot;</span></span>
<span id="cb96-19"><a href="automatic-expansion-of-wildcards.html#cb96-19"></a>    <span class="ex">shell</span>:</span>
<span id="cb96-20"><a href="automatic-expansion-of-wildcards.html#cb96-20"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb96-21"><a href="automatic-expansion-of-wildcards.html#cb96-21"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb96-22"><a href="automatic-expansion-of-wildcards.html#cb96-22"></a><span class="st">            --model {input.model} \</span></span>
<span id="cb96-23"><a href="automatic-expansion-of-wildcards.html#cb96-23"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb96-24"><a href="automatic-expansion-of-wildcards.html#cb96-24"></a><span class="st">            --out {output.estimate}&quot;</span></span>
<span id="cb96-25"><a href="automatic-expansion-of-wildcards.html#cb96-25"></a></span>
<span id="cb96-26"><a href="automatic-expansion-of-wildcards.html#cb96-26"></a><span class="ex">rule</span> aug_solow_model:</span>
<span id="cb96-27"><a href="automatic-expansion-of-wildcards.html#cb96-27"></a>    <span class="ex">input</span>:</span>
<span id="cb96-28"><a href="automatic-expansion-of-wildcards.html#cb96-28"></a>        <span class="ex">script</span> = <span class="st">&quot;src/analysis/estimate_ols_model.R&quot;</span>,</span>
<span id="cb96-29"><a href="automatic-expansion-of-wildcards.html#cb96-29"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb96-30"><a href="automatic-expansion-of-wildcards.html#cb96-30"></a>        <span class="ex">model</span>  = <span class="st">&quot;src/model-specs/model_aug_solow.json&quot;</span>,</span>
<span id="cb96-31"><a href="automatic-expansion-of-wildcards.html#cb96-31"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/{iSubset}.json&quot;</span></span>
<span id="cb96-32"><a href="automatic-expansion-of-wildcards.html#cb96-32"></a>    <span class="ex">output</span>:</span>
<span id="cb96-33"><a href="automatic-expansion-of-wildcards.html#cb96-33"></a>        <span class="ex">estimate</span> = <span class="st">&quot;out/analysis/model_aug_solow_{iSubset}.rds&quot;</span></span>
<span id="cb96-34"><a href="automatic-expansion-of-wildcards.html#cb96-34"></a>    <span class="ex">shell</span>:</span>
<span id="cb96-35"><a href="automatic-expansion-of-wildcards.html#cb96-35"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb96-36"><a href="automatic-expansion-of-wildcards.html#cb96-36"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb96-37"><a href="automatic-expansion-of-wildcards.html#cb96-37"></a><span class="st">            --model {input.model} \</span></span>
<span id="cb96-38"><a href="automatic-expansion-of-wildcards.html#cb96-38"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb96-39"><a href="automatic-expansion-of-wildcards.html#cb96-39"></a><span class="st">            --out {output.estimate}&quot;</span></span></code></pre></div>
<p>We see that the only difference between the <code>aug_solow_target</code> and <code>solow_target</code> rules
is that the filename differs by three letters: <code>out/analysis/model_aug_solow_{iSubset}.rds</code> versus
<code>out/analysis/model_solow_{iSubset}.rds</code>.</p>
<p>And, when we look at <code>aug_solow_model</code> and compare it to <code>solow_model</code> we again see only small differences:
the model changes from <code>model_aug_solow.json</code> to <code>model_solow.json</code> and the outputs change in a similar way.</p>
<p>We want to exploit this similarity and condense these four rules into two:
one that estimates the model, named <code>model</code> and a target rule that will run each specification, names <code>run_models</code>.
We are going to do this by creating a new list, called <code>MODELS</code>.
<code>MODELS</code> will contain two elements, “model_solow” and “model_aug_solow”.
Let’s add this to the top of our Snakefile:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb97-1"><a href="automatic-expansion-of-wildcards.html#cb97-1"></a><span class="co"># --- Dictionaries --- #</span></span>
<span id="cb97-2"><a href="automatic-expansion-of-wildcards.html#cb97-2"></a><span class="ex">MODELS</span> = [</span>
<span id="cb97-3"><a href="automatic-expansion-of-wildcards.html#cb97-3"></a>          <span class="st">&quot;model_solow&quot;</span>,</span>
<span id="cb97-4"><a href="automatic-expansion-of-wildcards.html#cb97-4"></a>          <span class="st">&quot;model_aug_solow&quot;</span></span>
<span id="cb97-5"><a href="automatic-expansion-of-wildcards.html#cb97-5"></a>          ]</span>
<span id="cb97-6"><a href="automatic-expansion-of-wildcards.html#cb97-6"></a></span>
<span id="cb97-7"><a href="automatic-expansion-of-wildcards.html#cb97-7"></a><span class="ex">DATA_SUBSET</span> = [</span>
<span id="cb97-8"><a href="automatic-expansion-of-wildcards.html#cb97-8"></a>                <span class="st">&quot;subset_oecd&quot;</span>,</span>
<span id="cb97-9"><a href="automatic-expansion-of-wildcards.html#cb97-9"></a>                <span class="st">&quot;subset_intermediate&quot;</span>,</span>
<span id="cb97-10"><a href="automatic-expansion-of-wildcards.html#cb97-10"></a>                <span class="st">&quot;subset_nonoil&quot;</span></span>
<span id="cb97-11"><a href="automatic-expansion-of-wildcards.html#cb97-11"></a>                ]</span>
<span id="cb97-12"><a href="automatic-expansion-of-wildcards.html#cb97-12"></a></span>
<span id="cb97-13"><a href="automatic-expansion-of-wildcards.html#cb97-13"></a><span class="ex">PLOTS</span> = [</span>
<span id="cb97-14"><a href="automatic-expansion-of-wildcards.html#cb97-14"></a>    <span class="st">&quot;aug_conditional_convergence&quot;</span>,</span>
<span id="cb97-15"><a href="automatic-expansion-of-wildcards.html#cb97-15"></a>    <span class="st">&quot;conditional_convergence&quot;</span>,</span>
<span id="cb97-16"><a href="automatic-expansion-of-wildcards.html#cb97-16"></a>    <span class="st">&quot;unconditional_convergence&quot;</span></span>
<span id="cb97-17"><a href="automatic-expansion-of-wildcards.html#cb97-17"></a>]</span></code></pre></div>
<p>We are now going to delete the target rules <code>aug_solow_target</code> and <code>solow_target</code>, and the estimation rules
<code>aug_solow_model</code> and <code>solow_model</code>.
Let’s replace them with the following:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb98-1"><a href="automatic-expansion-of-wildcards.html#cb98-1"></a><span class="ex">rule</span> run_models:</span>
<span id="cb98-2"><a href="automatic-expansion-of-wildcards.html#cb98-2"></a>    <span class="ex">input</span>:</span>
<span id="cb98-3"><a href="automatic-expansion-of-wildcards.html#cb98-3"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/analysis/{iModel}_{iSubset}.rds&quot;</span>,</span>
<span id="cb98-4"><a href="automatic-expansion-of-wildcards.html#cb98-4"></a>                    <span class="ex">iSubset</span> = DATA_SUBSET,</span>
<span id="cb98-5"><a href="automatic-expansion-of-wildcards.html#cb98-5"></a>                    <span class="ex">iModel</span> = MODELS)</span>
<span id="cb98-6"><a href="automatic-expansion-of-wildcards.html#cb98-6"></a></span>
<span id="cb98-7"><a href="automatic-expansion-of-wildcards.html#cb98-7"></a><span class="ex">rule</span> model:</span>
<span id="cb98-8"><a href="automatic-expansion-of-wildcards.html#cb98-8"></a>    <span class="ex">input</span>:</span>
<span id="cb98-9"><a href="automatic-expansion-of-wildcards.html#cb98-9"></a>        <span class="ex">script</span> = <span class="st">&quot;src/analysis/estimate_ols_model.R&quot;</span>,</span>
<span id="cb98-10"><a href="automatic-expansion-of-wildcards.html#cb98-10"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb98-11"><a href="automatic-expansion-of-wildcards.html#cb98-11"></a>        <span class="ex">model</span>  = <span class="st">&quot;src/model-specs/{iModel}.json&quot;</span>,</span>
<span id="cb98-12"><a href="automatic-expansion-of-wildcards.html#cb98-12"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/{iSubset}.json&quot;</span></span>
<span id="cb98-13"><a href="automatic-expansion-of-wildcards.html#cb98-13"></a>    <span class="ex">output</span>:</span>
<span id="cb98-14"><a href="automatic-expansion-of-wildcards.html#cb98-14"></a>        <span class="ex">estimate</span> = <span class="st">&quot;out/analysis/{iModel}_{iSubset}.rds&quot;</span></span>
<span id="cb98-15"><a href="automatic-expansion-of-wildcards.html#cb98-15"></a>    <span class="ex">shell</span>:</span>
<span id="cb98-16"><a href="automatic-expansion-of-wildcards.html#cb98-16"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb98-17"><a href="automatic-expansion-of-wildcards.html#cb98-17"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb98-18"><a href="automatic-expansion-of-wildcards.html#cb98-18"></a><span class="st">            --model {input.model} \</span></span>
<span id="cb98-19"><a href="automatic-expansion-of-wildcards.html#cb98-19"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb98-20"><a href="automatic-expansion-of-wildcards.html#cb98-20"></a><span class="st">            --out {output.estimate}&quot;</span></span></code></pre></div>
<p>The rule <code>model</code> is a generalization of the <code>solow_model</code> we had before.
We have added an extra wildcard, <code>{iModel}</code> so that the rule can estimate a wider set of models that we specify in the <code>src/model-specs</code> folder.
It’s <code>input.model</code> now takes a wildcard {iModel} and it’s output is a <code>{iModel}</code> - <code>{iSubset}</code> pair.</p>
<p>Similarly, the target rule <code>run_models</code> is a generalization of <code>solow_target</code>.
Instead of taking only the <code>model_solow</code> models as inputs - and looking for how to build those, it now takes any <code>{iModel}</code> as an input.
Notice there are now <strong>two</strong> wildcards in the <code>expand()</code> function, <code>{iSubset}</code> as before, and now also <code>{iModel}</code>.
We then naturally have to tell Snakemake which lists to use to expand each wildcard,
<code>DATA_SUBSET</code> for <code>{iSubset}</code>, and
<code>MODELS</code> for <code>{iModel}</code>.</p>
<p>Let’s clean our output folder and then use Snakemakes <code>--summary</code> to see what Snakemake wants to build.
We anticipate it will want to to the data cleaning steps, and then six regression models.
The six regression models will be three each of <code>model_solow</code> and <code>model_aug_solow</code>.
Each model should be run on each data subset.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb99-1"><a href="automatic-expansion-of-wildcards.html#cb99-1"></a>$ <span class="ex">snakemake</span> clean --cores 1</span></code></pre></div>
<div class="sourceCode" id="cb100"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb100-1"><a href="automatic-expansion-of-wildcards.html#cb100-1"></a>$ <span class="ex">snakemake</span> --summary</span></code></pre></div>
<p>Here’s the output we get:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb101-1"><a href="automatic-expansion-of-wildcards.html#cb101-1"></a><span class="ex">MissingInputException</span> in line 42 of /home/lachlan/teaching/snakemake-econ-r-learner/Snakefile:</span>
<span id="cb101-2"><a href="automatic-expansion-of-wildcards.html#cb101-2"></a><span class="ex">Missing</span> input files for rule model:</span>
<span id="cb101-3"><a href="automatic-expansion-of-wildcards.html#cb101-3"></a><span class="ex">src/data-specs/oecd.json</span></span>
<span id="cb101-4"><a href="automatic-expansion-of-wildcards.html#cb101-4"></a><span class="ex">src/model-specs/model_solow_subset.json</span></span></code></pre></div>
<p>What is going on here?
The problem is as follows:
because our filenames have underscores <code>_</code> in them <em>and</em> we are using the underscore to separate <code>{iModel}</code> and <code>{iSubset}</code>
Snakemake cannot figure out where the first wildcard substitution ends.
We think <code>model_solow</code> should be substituted as <code>{iModel}</code> and <code>subset_oecd</code> should be substituted for <code>iSubset</code>.
Unfortunately Snakemake can’t handle use of underscores in both file names and wildcard separation simultaneously.</p>
<p>Worry not, there is simple ways around this.
We are going to solve it by separating the wildcards with a period <code>.</code> rather than an underscore.<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a>
We make this change in both the <code>model</code> and <code>run_models</code> rules.
This breaks any ambiguity about where a wildcard ends and another begins.
Our updated rules are:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb102-1"><a href="automatic-expansion-of-wildcards.html#cb102-1"></a><span class="ex">rule</span> run_models:</span>
<span id="cb102-2"><a href="automatic-expansion-of-wildcards.html#cb102-2"></a>    <span class="ex">input</span>:</span>
<span id="cb102-3"><a href="automatic-expansion-of-wildcards.html#cb102-3"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/analysis/{iModel}.{iSubset}.rds&quot;</span>,</span>
<span id="cb102-4"><a href="automatic-expansion-of-wildcards.html#cb102-4"></a>                    <span class="ex">iSubset</span> = DATA_SUBSET,</span>
<span id="cb102-5"><a href="automatic-expansion-of-wildcards.html#cb102-5"></a>                    <span class="ex">iModel</span> = MODELS)</span>
<span id="cb102-6"><a href="automatic-expansion-of-wildcards.html#cb102-6"></a></span>
<span id="cb102-7"><a href="automatic-expansion-of-wildcards.html#cb102-7"></a><span class="ex">rule</span> model:</span>
<span id="cb102-8"><a href="automatic-expansion-of-wildcards.html#cb102-8"></a>    <span class="ex">input</span>:</span>
<span id="cb102-9"><a href="automatic-expansion-of-wildcards.html#cb102-9"></a>        <span class="ex">script</span> = <span class="st">&quot;src/analysis/estimate_ols_model.R&quot;</span>,</span>
<span id="cb102-10"><a href="automatic-expansion-of-wildcards.html#cb102-10"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb102-11"><a href="automatic-expansion-of-wildcards.html#cb102-11"></a>        <span class="ex">model</span>  = <span class="st">&quot;src/model-specs/{iModel}.json&quot;</span>,</span>
<span id="cb102-12"><a href="automatic-expansion-of-wildcards.html#cb102-12"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/{iSubset}.json&quot;</span></span>
<span id="cb102-13"><a href="automatic-expansion-of-wildcards.html#cb102-13"></a>    <span class="ex">output</span>:</span>
<span id="cb102-14"><a href="automatic-expansion-of-wildcards.html#cb102-14"></a>        <span class="ex">estimate</span> = <span class="st">&quot;out/analysis/{iModel}.{iSubset}.rds&quot;</span></span>
<span id="cb102-15"><a href="automatic-expansion-of-wildcards.html#cb102-15"></a>    <span class="ex">shell</span>:</span>
<span id="cb102-16"><a href="automatic-expansion-of-wildcards.html#cb102-16"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb102-17"><a href="automatic-expansion-of-wildcards.html#cb102-17"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb102-18"><a href="automatic-expansion-of-wildcards.html#cb102-18"></a><span class="st">            --model {input.model} \</span></span>
<span id="cb102-19"><a href="automatic-expansion-of-wildcards.html#cb102-19"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb102-20"><a href="automatic-expansion-of-wildcards.html#cb102-20"></a><span class="st">            --out {output.estimate}&quot;</span></span></code></pre></div>
<p>Now we again try to get the summary information from Snakemake:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb103-1"><a href="automatic-expansion-of-wildcards.html#cb103-1"></a>$ <span class="ex">snakemake</span> --summary</span></code></pre></div>
<p>There’s no longer an error, and instead we see:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb104-1"><a href="automatic-expansion-of-wildcards.html#cb104-1"></a><span class="ex">output_file</span>     date    rule    version log-file(s)     <span class="ex">status</span>  plan</span>
<span id="cb104-2"><a href="automatic-expansion-of-wildcards.html#cb104-2"></a><span class="ex">out/analysis/model_solow.subset_oecd.rds</span>        -       -       -       -       missing update pending</span>
<span id="cb104-3"><a href="automatic-expansion-of-wildcards.html#cb104-3"></a><span class="ex">out/analysis/model_aug_solow.subset_oecd.rds</span>    -       -       -       -       missing update pending</span>
<span id="cb104-4"><a href="automatic-expansion-of-wildcards.html#cb104-4"></a><span class="ex">out/analysis/model_solow.subset_intermediate.rds</span>        -       -       -       -       missing update pending</span>
<span id="cb104-5"><a href="automatic-expansion-of-wildcards.html#cb104-5"></a><span class="ex">out/analysis/model_aug_solow.subset_intermediate.rds</span>    -       -       -       -       missing update pending</span>
<span id="cb104-6"><a href="automatic-expansion-of-wildcards.html#cb104-6"></a><span class="ex">out/analysis/model_solow.subset_nonoil.rds</span>      -       -       -       -       missing update pending</span>
<span id="cb104-7"><a href="automatic-expansion-of-wildcards.html#cb104-7"></a><span class="ex">out/analysis/model_aug_solow.subset_nonoil.rds</span>  -       -       -       -       missing update pending</span>
<span id="cb104-8"><a href="automatic-expansion-of-wildcards.html#cb104-8"></a><span class="ex">out/data/mrw_complete.csv</span>       -       gen_regression_vars     -               missing update pending</span>
<span id="cb104-9"><a href="automatic-expansion-of-wildcards.html#cb104-9"></a><span class="ex">out/data/mrw_renamed.csv</span>        -       rename_vars     -               missing update pending</span></code></pre></div>
<p>which confirms that Snakemake wants to do our data cleaning steps before estimating the six regressions.
Let’s do it:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb105-1"><a href="automatic-expansion-of-wildcards.html#cb105-1"></a>$ <span class="ex">snakemake</span> --cores 1</span></code></pre></div>
<p>Our Snakemake rule graph - which shows the rules we execute in our workflow is now:</p>
<embed src="img/ch-5c/rulegraph.pdf" style="display: block; margin: auto;" type="application/pdf" />
<p>TODO? Some explanation?</p>
<p>And the DAG is:</p>
<embed src="img/ch-5c/dag.pdf" style="display: block; margin: auto;" type="application/pdf" />
<p>The DAG makes crystal clear what our workflow is doing:</p>
<ul>
<li>Snakemake wants to build the inputs listed in <code>run_models</code></li>
<li>It can build those inputs by running the <code>model</code> rule six times when it iterates over the wildcards</li>
<li>To run each model, it needs the clean data, so it needs to run the two data cleaning steps first</li>
</ul>
<p>!!! REMARK !!!</p>
<p>Notice how the figures aren’t produced automatically.
Do you remember why?
If not, revisit Chapter XX.
You can build them with <code>snakemake --cores 1 make_figures</code></p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="8">
<li id="fn8"><p>
The capitalization of the list <code>DATA_SUBSET</code> is not essential.
We do it to separate lists that we will iterate through from other parts of our Snakefile.
This means whenever we see a capitalized name, we know it is a list that we want to iterate through.<a href="automatic-expansion-of-wildcards.html#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>
This is not entirely true, we are yet to figure out how to get the y-axis range from the original paper.<a href="automatic-expansion-of-wildcards.html#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p>
There’s other ways to go here.
You could continue to use underscores but add a few letters inbetween the wildcards and it would also work.
This means <code>out/analysis/{iModel}.{iSubset}.rds</code> would become <code>out/analysis/{iModel}_SOMETEXT_{iSubset}.rds</code>.
It’s equally valid.<a href="automatic-expansion-of-wildcards.html#fnref10" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="wildcards.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="automating-list-construction-for-wildcard-expansion.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/lachlandeer/snakemake-econ-r/edit/master/22-expand.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["https://github.com/lachlandeer/snakemake-econ-r/raw/master/22-expand.Rmd"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
