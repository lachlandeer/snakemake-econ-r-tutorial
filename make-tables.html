<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Make Tables | Reproducible Data Analytic Workflows with Snakemake and R</title>
  <meta name="description" content="In progress" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Make Tables | Reproducible Data Analytic Workflows with Snakemake and R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="In progress" />
  <meta name="github-repo" content="lachlandeer/snakemake-econ-r-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Make Tables | Reproducible Data Analytic Workflows with Snakemake and R" />
  
  <meta name="twitter:description" content="In progress" />
  

<meta name="author" content="Ulrich Bergmann" />
<meta name="author" content="Lachlan Deer" />
<meta name="author" content="Julian Langer" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="automating-list-construction-for-wildcard-expansion.html"/>
<link rel="next" href="building-all-outputs-at-once.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html">Reproducible Data Analytic Workflows with Snakemake and `R`</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-we-wrote-this-tutorial"><i class="fa fa-check"></i>Why we wrote this tutorial</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#pre-requisite-knowledge"><i class="fa fa-check"></i>Pre-requisite Knowledge</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-needs-to-be-downloaded-installed-for-this-tutorial"><i class="fa fa-check"></i>What Needs to be Downloaded &amp; Installed for this Tutorial</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#template-scripts-and-documents"><i class="fa fa-check"></i>Template Scripts and Documents</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-installation"><i class="fa fa-check"></i>Software Installation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-we-cant-cover"><i class="fa fa-check"></i>What We Can’t Cover</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the Authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#instructional-material"><i class="fa fa-check"></i>Instructional material</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software"><i class="fa fa-check"></i>Software</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#citation"><i class="fa fa-check"></i>Citation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="part-i-preliminaries.html"><a href="part-i-preliminaries.html"><i class="fa fa-check"></i>PART I - Preliminaries</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Motivating &amp; Rationale</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#a-case-for-reproducibility"><i class="fa fa-check"></i><b>1.1</b> A Case for Reproducibility</a><ul>
<li class="chapter" data-level="1.1.1" data-path="intro.html"><a href="intro.html#how-far-to-go-in-the-quest-for-reproducibility"><i class="fa fa-check"></i><b>1.1.1</b> How far to go in the quest for reproducibility?</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#what-is-snakemake-why-should-you-use-it"><i class="fa fa-check"></i><b>1.2</b> What is <code>Snakemake</code> &amp; Why Should you use it?</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#why-r"><i class="fa fa-check"></i><b>1.3</b> Why <code>R</code>?</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#working-example-replicating-mankiw-romer-and-weils-1992-qje"><i class="fa fa-check"></i><b>1.4</b> Working Example: Replicating Mankiw, Romer and Weil’s 1992 QJE</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#the-way-forward"><i class="fa fa-check"></i><b>1.5</b> The way forward</a><ul>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#exercise-your-own-projects-steps"><i class="fa fa-check"></i>Exercise: Your own project’s steps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="project-organization.html"><a href="project-organization.html"><i class="fa fa-check"></i><b>2</b> Project Organization</a><ul>
<li class="chapter" data-level="" data-path="project-organization.html"><a href="project-organization.html#learning-objectives"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="2.1" data-path="project-organization.html"><a href="project-organization.html#subtitle-tbd"><i class="fa fa-check"></i><b>2.1</b> Subtitle TBD</a></li>
<li class="chapter" data-level="2.2" data-path="project-organization.html"><a href="project-organization.html#project-organization-i-separating-inputs-and-outputs"><i class="fa fa-check"></i><b>2.2</b> Project Organization I: Separating Inputs and Outputs</a></li>
<li class="chapter" data-level="2.3" data-path="project-organization.html"><a href="project-organization.html#project-structure-ii-separating-logical-chunks-of-the-project"><i class="fa fa-check"></i><b>2.3</b> Project Structure II: Separating Logical Chunks of the Project</a><ul>
<li class="chapter" data-level="2.3.1" data-path="project-organization.html"><a href="project-organization.html#aside-even-deeper-sub-folders"><i class="fa fa-check"></i><b>2.3.1</b> Aside: Even Deeper Sub-folders</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="project-organization.html"><a href="project-organization.html#project-structure-iii-separating-input-parameters-from-code"><i class="fa fa-check"></i><b>2.4</b> Project Structure III: Separating Input Parameters from Code</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html"><i class="fa fa-check"></i><b>3</b> Initial Steps with Snakemake</a><ul>
<li class="chapter" data-level="3.1" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#snakefile-writing-our-first-rule"><i class="fa fa-check"></i><b>3.1</b> Snakefile – Writing Our First Rule</a></li>
<li class="chapter" data-level="3.2" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#the-snakemake-command-executing-a-rule"><i class="fa fa-check"></i><b>3.2</b> The Snakemake Command – Executing a Rule</a></li>
<li class="chapter" data-level="3.3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#reading-and-writing-files-first-steps-in-a-data-science-pipeline"><i class="fa fa-check"></i><b>3.3</b> Reading and Writing Files – First Steps in a Data Science Pipeline</a><ul>
<li class="chapter" data-level="3.3.1" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#using-the-rscript-command-to-execute-r-scripts"><i class="fa fa-check"></i><b>3.3.1</b> Using the Rscript command to execute R scripts</a></li>
<li class="chapter" data-level="3.3.2" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#the-input-and-output-arguments"><i class="fa fa-check"></i><b>3.3.2</b> The input and output arguments</a></li>
<li class="chapter" data-level="3.3.3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#a-rule-to-rename-variables."><i class="fa fa-check"></i><b>3.3.3</b> A rule to rename variables.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#redundant-executions-dont-run-a-rule-repeatedly"><i class="fa fa-check"></i><b>3.4</b> Redundant Executions – (Don’t) Run a Rule Repeatedly</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html"><i class="fa fa-check"></i><b>4</b> Working With Multiple Rules</a><ul>
<li class="chapter" data-level="4.1" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#creating-a-second-rule"><i class="fa fa-check"></i><b>4.1</b> Creating a second rule</a><ul>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#exercise-creating-rules"><i class="fa fa-check"></i>Exercise: Creating Rules</a></li>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#solution"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#clean-rules"><i class="fa fa-check"></i><b>4.2</b> Clean Rules</a><ul>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#exercise-creating-cleaning-rules"><i class="fa fa-check"></i>Exercise: Creating Cleaning Rules</a></li>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#solution-1"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="target-rules.html"><a href="target-rules.html"><i class="fa fa-check"></i><b>5</b> Target Rules</a><ul>
<li class="chapter" data-level="5.1" data-path="target-rules.html"><a href="target-rules.html#where-we-are-now"><i class="fa fa-check"></i><b>5.1</b> Where we are now?</a></li>
<li class="chapter" data-level="5.2" data-path="target-rules.html"><a href="target-rules.html#how-snakemake-determines-the-build-order-when-multiple-rules-are-present"><i class="fa fa-check"></i><b>5.2</b> How Snakemake determines the build order when multiple rules are present</a></li>
<li class="chapter" data-level="5.3" data-path="target-rules.html"><a href="target-rules.html#dedicated-target-rules-to-execute-multiple-rules"><i class="fa fa-check"></i><b>5.3</b> Dedicated target rules to execute multiple rules</a><ul>
<li class="chapter" data-level="" data-path="target-rules.html"><a href="target-rules.html#exercise-using-target-rules"><i class="fa fa-check"></i>Exercise: Using target rules</a></li>
<li class="chapter" data-level="" data-path="target-rules.html"><a href="target-rules.html#solution-2"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="target-rules.html"><a href="target-rules.html#target-rules-can-do-more-for-us"><i class="fa fa-check"></i><b>5.4</b> Target rules can do more for us</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="wildcards.html"><a href="wildcards.html"><i class="fa fa-check"></i><b>6</b> Wildcards</a><ul>
<li class="chapter" data-level="6.1" data-path="wildcards.html"><a href="wildcards.html#the-starting-point-of-our-snakefile"><i class="fa fa-check"></i><b>6.1</b> The starting point of our Snakefile</a></li>
<li class="chapter" data-level="6.2" data-path="wildcards.html"><a href="wildcards.html#using-wildcards-to-tidy-up-our-code"><i class="fa fa-check"></i><b>6.2</b> Using wildcards to tidy up our code</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html"><i class="fa fa-check"></i><b>7</b> Automatic Expansion of Wildcards</a><ul>
<li class="chapter" data-level="7.1" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#learning-goals"><i class="fa fa-check"></i><b>7.1</b> Learning Goals</a></li>
<li class="chapter" data-level="7.2" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#the-expand-function"><i class="fa fa-check"></i><b>7.2</b> The <code>expand()</code> function</a><ul>
<li class="chapter" data-level="" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#exercise-exploring-the-expand-function-i"><i class="fa fa-check"></i>Exercise: Exploring the expand function I</a></li>
<li class="chapter" data-level="7.2.1" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#solution-3"><i class="fa fa-check"></i><b>7.2.1</b> SOLUTION:</a></li>
<li class="chapter" data-level="" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#exercise-exploring-the-expand-function-ii"><i class="fa fa-check"></i>Exercise: Exploring the expand() function II</a></li>
<li class="chapter" data-level="7.2.2" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#solution-4"><i class="fa fa-check"></i><b>7.2.2</b> Solution</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#expanding-multiple-wildcards"><i class="fa fa-check"></i><b>7.3</b> Expanding Multiple Wildcards</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html"><i class="fa fa-check"></i><b>8</b> Automating List Construction for Wildcard Expansion</a><ul>
<li class="chapter" data-level="8.1" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#learning-objectives-1"><i class="fa fa-check"></i><b>8.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="8.2" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#state-of-the-snakefile"><i class="fa fa-check"></i><b>8.2</b> State of the Snakefile</a></li>
<li class="chapter" data-level="8.3" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#the-glob_wildcards-function"><i class="fa fa-check"></i><b>8.3</b> The <code>glob_wildcards</code> Function</a></li>
<li class="chapter" data-level="8.4" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#looking-at-the-dag-redux"><i class="fa fa-check"></i><b>8.4</b> Looking at the DAG (redux)</a><ul>
<li class="chapter" data-level="" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#exercise-exploring-glob_wildcards"><i class="fa fa-check"></i>Exercise: Exploring glob_wildcards()</a></li>
<li class="chapter" data-level="8.4.1" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#solution-5"><i class="fa fa-check"></i><b>8.4.1</b> Solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="make-tables.html"><a href="make-tables.html"><i class="fa fa-check"></i><b>9</b> Make Tables</a><ul>
<li class="chapter" data-level="9.1" data-path="make-tables.html"><a href="make-tables.html#the-state-of-the-snakefile"><i class="fa fa-check"></i><b>9.1</b> The State of the Snakefile</a></li>
<li class="chapter" data-level="9.2" data-path="make-tables.html"><a href="make-tables.html#building-a-single-table"><i class="fa fa-check"></i><b>9.2</b> Building a single table</a></li>
<li class="chapter" data-level="9.3" data-path="make-tables.html"><a href="make-tables.html#building-all-tables-at-once"><i class="fa fa-check"></i><b>9.3</b> Building all tables at once</a><ul>
<li class="chapter" data-level="" data-path="make-tables.html"><a href="make-tables.html#exercise"><i class="fa fa-check"></i>Exercise</a></li>
<li class="chapter" data-level="" data-path="make-tables.html"><a href="make-tables.html#solution-6"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="building-all-outputs-at-once.html"><a href="building-all-outputs-at-once.html"><i class="fa fa-check"></i><b>10</b> Building all outputs at once</a><ul>
<li class="chapter" data-level="10.1" data-path="building-all-outputs-at-once.html"><a href="building-all-outputs-at-once.html#creating-an-all-rule"><i class="fa fa-check"></i><b>10.1</b> Creating an <code>all</code> rule</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="adding-parameters.html"><a href="adding-parameters.html"><i class="fa fa-check"></i><b>11</b> Adding Parameters</a><ul>
<li class="chapter" data-level="11.1" data-path="adding-parameters.html"><a href="adding-parameters.html#motivating-example-constructing-a-regression-table-from-ols-results"><i class="fa fa-check"></i><b>11.1</b> Motivating Example: Constructing a Regression Table from OLS Results</a></li>
<li class="chapter" data-level="11.2" data-path="adding-parameters.html"><a href="adding-parameters.html#creating-a-rule-with-params"><i class="fa fa-check"></i><b>11.2</b> Creating a Rule with <code>params</code></a><ul>
<li class="chapter" data-level="" data-path="adding-parameters.html"><a href="adding-parameters.html#exercise-building-table-2"><i class="fa fa-check"></i>Exercise: Building Table 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="part-ii.html"><a href="part-ii.html"><i class="fa fa-check"></i>PART II</a></li>
<li class="chapter" data-level="12" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html"><i class="fa fa-check"></i><b>12</b> Logging Output and Errors</a><ul>
<li class="chapter" data-level="12.1" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#logging-output"><i class="fa fa-check"></i><b>12.1</b> Logging Output</a></li>
<li class="chapter" data-level="12.2" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#logging-output-and-errors-in-one-file"><i class="fa fa-check"></i><b>12.2</b> Logging Output and Errors in One File</a><ul>
<li class="chapter" data-level="" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#exercise-logging-all-r-scripts"><i class="fa fa-check"></i>Exercise: Logging all R Scripts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="self-documenting-help.html"><a href="self-documenting-help.html"><i class="fa fa-check"></i><b>13</b> Self Documenting Help</a><ul>
<li class="chapter" data-level="13.1" data-path="self-documenting-help.html"><a href="self-documenting-help.html#our-commenting-syle"><i class="fa fa-check"></i><b>13.1</b> Our Commenting Syle</a></li>
<li class="chapter" data-level="13.2" data-path="self-documenting-help.html"><a href="self-documenting-help.html#adding-further-comments"><i class="fa fa-check"></i><b>13.2</b> Adding Further Comments</a><ul>
<li class="chapter" data-level="" data-path="self-documenting-help.html"><a href="self-documenting-help.html#exercise-adding-comments"><i class="fa fa-check"></i>Exercise: Adding Comments</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="self-documenting-help.html"><a href="self-documenting-help.html#a-help-rule"><i class="fa fa-check"></i><b>13.3</b> A <code>help</code> Rule</a><ul>
<li><a href="self-documenting-help.html#exercise-saving-help-output-to-file">Exercise: Saving <code>help</code> output to file</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="config-files.html"><a href="config-files.html"><i class="fa fa-check"></i><b>14</b> Config Files</a><ul>
<li class="chapter" data-level="14.1" data-path="config-files.html"><a href="config-files.html#the-config.yaml-filepath"><i class="fa fa-check"></i><b>14.1</b> The <code>config.yaml</code> filepath</a></li>
<li class="chapter" data-level="14.2" data-path="config-files.html"><a href="config-files.html#using-paths-from-the-config-file"><i class="fa fa-check"></i><b>14.2</b> Using paths from the config file</a><ul>
<li class="chapter" data-level="" data-path="config-files.html"><a href="config-files.html#exercise-using-config-files"><i class="fa fa-check"></i>Exercise: Using Config Files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html"><i class="fa fa-check"></i><b>15</b> Subworkflows: Divide and Conquer</a><ul>
<li class="chapter" data-level="15.1" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#subworkflow-basics"><i class="fa fa-check"></i><b>15.1</b> Subworkflow Basics</a></li>
<li class="chapter" data-level="15.2" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#subworkflow-dependencies"><i class="fa fa-check"></i><b>15.2</b> Subworkflow dependencies</a><ul>
<li class="chapter" data-level="" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#exercise-more-subworkflows"><i class="fa fa-check"></i>Exercise: More Subworkflows</a></li>
<li><a href="subworkflows-divide-and-conquer.html#guided-exercise-help-rules-with-subworkflows">Guided Exercise: <code>help</code> rules with subworkflows</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="part-iii.html"><a href="part-iii.html"><i class="fa fa-check"></i>PART III</a></li>
<li class="chapter" data-level="16" data-path="reproducible-articles-with-rmd.html"><a href="reproducible-articles-with-rmd.html"><i class="fa fa-check"></i><b>16</b> Reproducible Articles with Rmd</a></li>
<li class="chapter" data-level="17" data-path="reproducible-slides-with-rmd.html"><a href="reproducible-slides-with-rmd.html"><i class="fa fa-check"></i><b>17</b> Reproducible Slides with Rmd</a></li>
<li class="chapter" data-level="18" data-path="package-dependencies-with-packrat.html"><a href="package-dependencies-with-packrat.html"><i class="fa fa-check"></i><b>18</b> Package Dependencies with Packrat</a></li>
<li class="chapter" data-level="19" data-path="containers.html"><a href="containers.html"><i class="fa fa-check"></i><b>19</b> Containers</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible Data Analytic Workflows with Snakemake and <code>R</code></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="make-tables" class="section level1">
<h1><span class="header-section-number">Chapter 9</span> Make Tables</h1>
<p>Now that we have learned how to make our code more concise, we want to move forward and apply the new concepts from the previous part to finish our replication.</p>
<p>In this chapter we will create a rule which generates all the regression tables in <span class="citation">Mankiw, Romer, and Weil (<a href="#ref-mrw" role="doc-biblioref">1992</a>)</span>.</p>
<div id="the-state-of-the-snakefile" class="section level2">
<h2><span class="header-section-number">9.1</span> The State of the Snakefile</h2>
<div class="sourceCode" id="cb127"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb127-1"><a href="make-tables.html#cb127-1"></a><span class="ex">MODELS</span> = glob_wildcards(<span class="st">&quot;src/model-specs/{fname}.json&quot;</span>)<span class="ex">.fname</span> </span>
<span id="cb127-2"><a href="make-tables.html#cb127-2"></a></span>
<span id="cb127-3"><a href="make-tables.html#cb127-3"></a><span class="co"># note this filter is only needed coz we are running an older version of the src files, will be updated soon</span></span>
<span id="cb127-4"><a href="make-tables.html#cb127-4"></a><span class="ex">DATA_SUBSET</span> = glob_wildcards(<span class="st">&quot;src/data-specs/{fname}.json&quot;</span>)<span class="ex">.fname</span></span>
<span id="cb127-5"><a href="make-tables.html#cb127-5"></a><span class="ex">DATA_SUBSET</span> = list(filter(lambda x: x.startswith(<span class="st">&quot;subset&quot;</span>), <span class="ex">DATA_SUBSET</span>))</span>
<span id="cb127-6"><a href="make-tables.html#cb127-6"></a></span>
<span id="cb127-7"><a href="make-tables.html#cb127-7"></a><span class="ex">PLOTS</span> = glob_wildcards(<span class="st">&quot;src/figures/{fname}.R&quot;</span>)<span class="ex">.fname</span></span>
<span id="cb127-8"><a href="make-tables.html#cb127-8"></a></span>
<span id="cb127-9"><a href="make-tables.html#cb127-9"></a><span class="co">##############################################</span></span>
<span id="cb127-10"><a href="make-tables.html#cb127-10"></a><span class="co"># OLS TARGET</span></span>
<span id="cb127-11"><a href="make-tables.html#cb127-11"></a><span class="co">##############################################</span></span>
<span id="cb127-12"><a href="make-tables.html#cb127-12"></a></span>
<span id="cb127-13"><a href="make-tables.html#cb127-13"></a><span class="ex">rule</span> run_models:</span>
<span id="cb127-14"><a href="make-tables.html#cb127-14"></a>    <span class="ex">input</span>:</span>
<span id="cb127-15"><a href="make-tables.html#cb127-15"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/analysis/{iModel}.{iSubset}.rds&quot;</span>,</span>
<span id="cb127-16"><a href="make-tables.html#cb127-16"></a>                    <span class="ex">iSubset</span> = DATA_SUBSET,</span>
<span id="cb127-17"><a href="make-tables.html#cb127-17"></a>                    <span class="ex">iModel</span> = MODELS)</span>
<span id="cb127-18"><a href="make-tables.html#cb127-18"></a></span>
<span id="cb127-19"><a href="make-tables.html#cb127-19"></a><span class="co">##############################################</span></span>
<span id="cb127-20"><a href="make-tables.html#cb127-20"></a><span class="co"># OLS RULES</span></span>
<span id="cb127-21"><a href="make-tables.html#cb127-21"></a><span class="co">##############################################</span></span>
<span id="cb127-22"><a href="make-tables.html#cb127-22"></a></span>
<span id="cb127-23"><a href="make-tables.html#cb127-23"></a><span class="ex">rule</span> model:</span>
<span id="cb127-24"><a href="make-tables.html#cb127-24"></a>    <span class="ex">input</span>:</span>
<span id="cb127-25"><a href="make-tables.html#cb127-25"></a>        <span class="ex">script</span> = <span class="st">&quot;src/analysis/estimate_ols_model.R&quot;</span>,</span>
<span id="cb127-26"><a href="make-tables.html#cb127-26"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb127-27"><a href="make-tables.html#cb127-27"></a>        <span class="ex">model</span>  = <span class="st">&quot;src/model-specs/{iModel}.json&quot;</span>,</span>
<span id="cb127-28"><a href="make-tables.html#cb127-28"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/{iSubset}.json&quot;</span></span>
<span id="cb127-29"><a href="make-tables.html#cb127-29"></a>    <span class="ex">output</span>:</span>
<span id="cb127-30"><a href="make-tables.html#cb127-30"></a>        <span class="ex">estimate</span> = <span class="st">&quot;out/analysis/{iModel}.{iSubset}.rds&quot;</span></span>
<span id="cb127-31"><a href="make-tables.html#cb127-31"></a>    <span class="ex">shell</span>:</span>
<span id="cb127-32"><a href="make-tables.html#cb127-32"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb127-33"><a href="make-tables.html#cb127-33"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb127-34"><a href="make-tables.html#cb127-34"></a><span class="st">            --model {input.model} \</span></span>
<span id="cb127-35"><a href="make-tables.html#cb127-35"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb127-36"><a href="make-tables.html#cb127-36"></a><span class="st">            --out {output.estimate}&quot;</span></span>
<span id="cb127-37"><a href="make-tables.html#cb127-37"></a></span>
<span id="cb127-38"><a href="make-tables.html#cb127-38"></a><span class="co">##############################################</span></span>
<span id="cb127-39"><a href="make-tables.html#cb127-39"></a><span class="co"># figs TARGET</span></span>
<span id="cb127-40"><a href="make-tables.html#cb127-40"></a><span class="co">##############################################</span></span>
<span id="cb127-41"><a href="make-tables.html#cb127-41"></a></span>
<span id="cb127-42"><a href="make-tables.html#cb127-42"></a><span class="ex">rule</span> make_figures:</span>
<span id="cb127-43"><a href="make-tables.html#cb127-43"></a>    <span class="ex">input</span>:</span>
<span id="cb127-44"><a href="make-tables.html#cb127-44"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/figures/{iFigure}.pdf&quot;</span>,</span>
<span id="cb127-45"><a href="make-tables.html#cb127-45"></a>                    <span class="ex">iFigure</span> = PLOTS)</span>
<span id="cb127-46"><a href="make-tables.html#cb127-46"></a></span>
<span id="cb127-47"><a href="make-tables.html#cb127-47"></a><span class="co">##############################################</span></span>
<span id="cb127-48"><a href="make-tables.html#cb127-48"></a><span class="co"># MAKING FIGS</span></span>
<span id="cb127-49"><a href="make-tables.html#cb127-49"></a><span class="co">##############################################</span></span>
<span id="cb127-50"><a href="make-tables.html#cb127-50"></a></span>
<span id="cb127-51"><a href="make-tables.html#cb127-51"></a><span class="ex">rule</span> figure:</span>
<span id="cb127-52"><a href="make-tables.html#cb127-52"></a>    <span class="ex">input</span>:</span>
<span id="cb127-53"><a href="make-tables.html#cb127-53"></a>        <span class="ex">script</span> = <span class="st">&quot;src/figures/{iFigure}.R&quot;</span>,</span>
<span id="cb127-54"><a href="make-tables.html#cb127-54"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span>,</span>
<span id="cb127-55"><a href="make-tables.html#cb127-55"></a>        <span class="ex">subset</span> = <span class="st">&quot;src/data-specs/subset_intermediate.json&quot;</span></span>
<span id="cb127-56"><a href="make-tables.html#cb127-56"></a>    <span class="ex">output</span>:</span>
<span id="cb127-57"><a href="make-tables.html#cb127-57"></a>        <span class="ex">fig</span> = <span class="st">&quot;out/figures/{iFigure}.pdf&quot;</span></span>
<span id="cb127-58"><a href="make-tables.html#cb127-58"></a>    <span class="ex">shell</span>:</span>
<span id="cb127-59"><a href="make-tables.html#cb127-59"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb127-60"><a href="make-tables.html#cb127-60"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb127-61"><a href="make-tables.html#cb127-61"></a><span class="st">            --subset {input.subset} \</span></span>
<span id="cb127-62"><a href="make-tables.html#cb127-62"></a><span class="st">            --out {output.fig}&quot;</span></span>
<span id="cb127-63"><a href="make-tables.html#cb127-63"></a></span>
<span id="cb127-64"><a href="make-tables.html#cb127-64"></a><span class="co">##############################################</span></span>
<span id="cb127-65"><a href="make-tables.html#cb127-65"></a><span class="co"># DATA MANAGEMENT</span></span>
<span id="cb127-66"><a href="make-tables.html#cb127-66"></a><span class="co">##############################################</span></span>
<span id="cb127-67"><a href="make-tables.html#cb127-67"></a></span>
<span id="cb127-68"><a href="make-tables.html#cb127-68"></a><span class="ex">rule</span> gen_regression_vars:</span>
<span id="cb127-69"><a href="make-tables.html#cb127-69"></a>    <span class="ex">input</span>:</span>
<span id="cb127-70"><a href="make-tables.html#cb127-70"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/gen_reg_vars.R&quot;</span>,</span>
<span id="cb127-71"><a href="make-tables.html#cb127-71"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span>,</span>
<span id="cb127-72"><a href="make-tables.html#cb127-72"></a>        <span class="ex">param</span>  = <span class="st">&quot;src/data-specs/param_solow.json&quot;</span></span>
<span id="cb127-73"><a href="make-tables.html#cb127-73"></a>    <span class="ex">output</span>:</span>
<span id="cb127-74"><a href="make-tables.html#cb127-74"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span></span>
<span id="cb127-75"><a href="make-tables.html#cb127-75"></a>    <span class="ex">shell</span>:</span>
<span id="cb127-76"><a href="make-tables.html#cb127-76"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb127-77"><a href="make-tables.html#cb127-77"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb127-78"><a href="make-tables.html#cb127-78"></a><span class="st">            --param {input.param} \</span></span>
<span id="cb127-79"><a href="make-tables.html#cb127-79"></a><span class="st">            --out {output.data}&quot;</span></span>
<span id="cb127-80"><a href="make-tables.html#cb127-80"></a></span>
<span id="cb127-81"><a href="make-tables.html#cb127-81"></a><span class="ex">rule</span> rename_vars:</span>
<span id="cb127-82"><a href="make-tables.html#cb127-82"></a>    <span class="ex">input</span>:</span>
<span id="cb127-83"><a href="make-tables.html#cb127-83"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/rename_variables.R&quot;</span>,</span>
<span id="cb127-84"><a href="make-tables.html#cb127-84"></a>        <span class="ex">data</span>   = <span class="st">&quot;src/data/mrw.dta&quot;</span></span>
<span id="cb127-85"><a href="make-tables.html#cb127-85"></a>    <span class="ex">output</span>:</span>
<span id="cb127-86"><a href="make-tables.html#cb127-86"></a>        <span class="ex">data</span> = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span></span>
<span id="cb127-87"><a href="make-tables.html#cb127-87"></a>    <span class="ex">shell</span>:</span>
<span id="cb127-88"><a href="make-tables.html#cb127-88"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb127-89"><a href="make-tables.html#cb127-89"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb127-90"><a href="make-tables.html#cb127-90"></a><span class="st">            --out {output.data}&quot;</span></span>
<span id="cb127-91"><a href="make-tables.html#cb127-91"></a></span>
<span id="cb127-92"><a href="make-tables.html#cb127-92"></a></span>
<span id="cb127-93"><a href="make-tables.html#cb127-93"></a></span>
<span id="cb127-94"><a href="make-tables.html#cb127-94"></a><span class="co">##############################################</span></span>
<span id="cb127-95"><a href="make-tables.html#cb127-95"></a><span class="co"># CLEANING RULES</span></span>
<span id="cb127-96"><a href="make-tables.html#cb127-96"></a><span class="co">##############################################</span></span>
<span id="cb127-97"><a href="make-tables.html#cb127-97"></a></span>
<span id="cb127-98"><a href="make-tables.html#cb127-98"></a><span class="ex">rule</span> clean:</span>
<span id="cb127-99"><a href="make-tables.html#cb127-99"></a>    <span class="ex">shell</span>:</span>
<span id="cb127-100"><a href="make-tables.html#cb127-100"></a>        <span class="st">&quot;rm -rf out/*&quot;</span></span>
<span id="cb127-101"><a href="make-tables.html#cb127-101"></a></span>
<span id="cb127-102"><a href="make-tables.html#cb127-102"></a><span class="ex">rule</span> clean_data:</span>
<span id="cb127-103"><a href="make-tables.html#cb127-103"></a>    <span class="ex">shell</span>:</span>
<span id="cb127-104"><a href="make-tables.html#cb127-104"></a>        <span class="st">&quot;rm -rf out/data/*&quot;</span></span>
<span id="cb127-105"><a href="make-tables.html#cb127-105"></a></span>
<span id="cb127-106"><a href="make-tables.html#cb127-106"></a><span class="ex">rule</span> clean_analysis:</span>
<span id="cb127-107"><a href="make-tables.html#cb127-107"></a>    <span class="ex">shell</span>:</span>
<span id="cb127-108"><a href="make-tables.html#cb127-108"></a>        <span class="st">&quot;rm -rf out/analysis/*&quot;</span></span></code></pre></div>
</div>
<div id="building-a-single-table" class="section level2">
<h2><span class="header-section-number">9.2</span> Building a single table</h2>
<p>Let us first start by making a single, explicit rule to create our first table.</p>
<p>You can find the R script which does this under <code>src/tables/regression_table.R</code>.
As always, we start by using the help function to learn the necessary input parameters the script expects:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb128-1"><a href="make-tables.html#cb128-1"></a><span class="ex">Rscript</span> src/table/regression_table.R --help</span></code></pre></div>
<div class="sourceCode" id="cb129"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb129-1"><a href="make-tables.html#cb129-1"></a><span class="ex">Usage</span>: src/tables/regression_table.R [options]</span>
<span id="cb129-2"><a href="make-tables.html#cb129-2"></a></span>
<span id="cb129-3"><a href="make-tables.html#cb129-3"></a><span class="ex">Options</span>:</span>
<span id="cb129-4"><a href="make-tables.html#cb129-4"></a>        <span class="ex">-s</span> CHARACTER, --spec=CHARACTER</span>
<span id="cb129-5"><a href="make-tables.html#cb129-5"></a>                <span class="ex">a</span> json dictionary of table parameters</span>
<span id="cb129-6"><a href="make-tables.html#cb129-6"></a></span>
<span id="cb129-7"><a href="make-tables.html#cb129-7"></a>        <span class="ex">-o</span> CHARACTER, --out=CHARACTER</span>
<span id="cb129-8"><a href="make-tables.html#cb129-8"></a>                <span class="ex">output</span> file name [default = out.tex]</span>
<span id="cb129-9"><a href="make-tables.html#cb129-9"></a></span>
<span id="cb129-10"><a href="make-tables.html#cb129-10"></a>        <span class="ex">-h</span>, --help</span>
<span id="cb129-11"><a href="make-tables.html#cb129-11"></a>                <span class="ex">Show</span> this help message and exit</span></code></pre></div>
<p>Our model expects two arguments:</p>
<ul>
<li><code>--spec</code>, a json dictionary with table parameters. This includes the models this tables contains as well as table specifications such as headers, column names etc.</li>
<li><code>--out</code>, the output filename the LaTeX code will be saved to</li>
</ul>
<p>We will make the first table with <code>table_01.json</code> as the <code>spec</code> argument and an appropriate output filename:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb130-1"><a href="make-tables.html#cb130-1"></a><span class="ex">rule</span> table:</span>
<span id="cb130-2"><a href="make-tables.html#cb130-2"></a>    <span class="ex">input</span>:</span>
<span id="cb130-3"><a href="make-tables.html#cb130-3"></a>        <span class="ex">script</span> = <span class="st">&quot;src/tables/regression_table.R&quot;</span>,</span>
<span id="cb130-4"><a href="make-tables.html#cb130-4"></a>        <span class="ex">spec</span>   = <span class="st">&quot;src/table-specs/table_01.json&quot;</span></span>
<span id="cb130-5"><a href="make-tables.html#cb130-5"></a>    <span class="ex">output</span>:</span>
<span id="cb130-6"><a href="make-tables.html#cb130-6"></a>        <span class="ex">table</span> = <span class="st">&quot;out/tables/table_01.tex&quot;</span></span>
<span id="cb130-7"><a href="make-tables.html#cb130-7"></a>    <span class="ex">shell</span>:</span>
<span id="cb130-8"><a href="make-tables.html#cb130-8"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb130-9"><a href="make-tables.html#cb130-9"></a><span class="st">            --spec {input.spec} \</span></span>
<span id="cb130-10"><a href="make-tables.html#cb130-10"></a><span class="st">            --out {output.table}&quot;</span>           </span></code></pre></div>
<p>If all model files have been created in the last chapter, then this rule should run through with a single executed task via</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb131-1"><a href="make-tables.html#cb131-1"></a><span class="ex">snakemake</span> --cores 1 table</span></code></pre></div>
<p>Additional to the usual Snakemake output, the LaTeX code of the table is printed to the screen.</p>
<p>Let us check that the table has been successfully created in the <code>out/tables</code> folder:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb132-1"><a href="make-tables.html#cb132-1"></a><span class="fu">ls</span> out/tables</span></code></pre></div>
<div class="sourceCode" id="cb133"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb133-1"><a href="make-tables.html#cb133-1"></a><span class="ex">table_01.tex</span></span></code></pre></div>
<p>Nice, let us now clean our output folder and try to execute the table rule again.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb134-1"><a href="make-tables.html#cb134-1"></a><span class="ex">snakemake</span> --cores 1 clean</span>
<span id="cb134-2"><a href="make-tables.html#cb134-2"></a><span class="ex">snakemake</span> --cores 1 table</span></code></pre></div>
<div class="sourceCode" id="cb135"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb135-1"><a href="make-tables.html#cb135-1"></a>[<span class="ex">...</span>]</span>
<span id="cb135-2"><a href="make-tables.html#cb135-2"></a></span>
<span id="cb135-3"><a href="make-tables.html#cb135-3"></a>[<span class="ex">Sat</span> Feb 20 21:19:20 2021]</span>
<span id="cb135-4"><a href="make-tables.html#cb135-4"></a><span class="ex">rule</span> table:</span>
<span id="cb135-5"><a href="make-tables.html#cb135-5"></a>    <span class="ex">input</span>: src/tables/regression_table.R, src/table-specs/table_01.json</span>
<span id="cb135-6"><a href="make-tables.html#cb135-6"></a>    <span class="ex">output</span>: out/tables/table_01.tex</span>
<span id="cb135-7"><a href="make-tables.html#cb135-7"></a>    <span class="ex">jobid</span>: 0</span>
<span id="cb135-8"><a href="make-tables.html#cb135-8"></a></span>
<span id="cb135-9"><a href="make-tables.html#cb135-9"></a>[<span class="ex">...</span>]</span>
<span id="cb135-10"><a href="make-tables.html#cb135-10"></a></span>
<span id="cb135-11"><a href="make-tables.html#cb135-11"></a><span class="ex">In</span> gzfile(file, <span class="st">&quot;rb&quot;</span>) <span class="bu">:</span>  </span>
<span id="cb135-12"><a href="make-tables.html#cb135-12"></a>  <span class="ex">cannot</span> open compressed file <span class="st">&#39;/Users/ubergm/Documents/projects/snakemake/snakemake-econ-r-learner/out/analysis/model_solow.subset_nonoil.rds&#39;</span>,  </span>
<span id="cb135-13"><a href="make-tables.html#cb135-13"></a>  <span class="ex">probable</span> reason <span class="st">&#39;No such file or directory&#39;</span>  </span>
<span id="cb135-14"><a href="make-tables.html#cb135-14"></a><span class="ex">Execution</span> stopped</span>
<span id="cb135-15"><a href="make-tables.html#cb135-15"></a></span>
<span id="cb135-16"><a href="make-tables.html#cb135-16"></a>[<span class="ex">Sat</span> Feb 20 21:19:20 2021]</span>
<span id="cb135-17"><a href="make-tables.html#cb135-17"></a><span class="ex">Error</span> in rule table:</span>
<span id="cb135-18"><a href="make-tables.html#cb135-18"></a>    <span class="ex">jobid</span>: 0</span>
<span id="cb135-19"><a href="make-tables.html#cb135-19"></a>    <span class="ex">output</span>: out/tables/table_01.tex</span>
<span id="cb135-20"><a href="make-tables.html#cb135-20"></a>    <span class="ex">shell</span>:</span>
<span id="cb135-21"><a href="make-tables.html#cb135-21"></a>        <span class="ex">Rscript</span> src/tables/regression_table.R  </span>
<span id="cb135-22"><a href="make-tables.html#cb135-22"></a>        <span class="ex">--spec</span> src/table-specs/table_01.json  </span>
<span id="cb135-23"><a href="make-tables.html#cb135-23"></a>        <span class="ex">--out</span> out/tables/table_01.tex  </span>
<span id="cb135-24"><a href="make-tables.html#cb135-24"></a>        <span class="kw">(</span><span class="ex">one</span> of the commands exited with non-zero exit code<span class="kw">;</span>  </span>
<span id="cb135-25"><a href="make-tables.html#cb135-25"></a>        <span class="ex">note</span> that snakemake uses bash strict mode!<span class="kw">)</span></span>
<span id="cb135-26"><a href="make-tables.html#cb135-26"></a></span>
<span id="cb135-27"><a href="make-tables.html#cb135-27"></a><span class="ex">Shutting</span> down, this might take some time.  </span>
<span id="cb135-28"><a href="make-tables.html#cb135-28"></a><span class="ex">Exiting</span> because a job execution failed. Look above for error message  </span>
<span id="cb135-29"><a href="make-tables.html#cb135-29"></a><span class="ex">Complete</span> log: /Users/ubergm/Documents/projects/snakemake/  </span>
<span id="cb135-30"><a href="make-tables.html#cb135-30"></a><span class="ex">snakemake-econ-r-learner/.snakemake/log/2021-02-20T211920.004018.snakemake.log</span></span></code></pre></div>
<p>We got an error.
Looking at the R output, we see that the file <code>out/analysis/model_solow.subset_nonoil.rds</code> could not be found.
Why is this?</p>
<p>The model specification includes the path to the necessary models featured in table 1.
Therefore R is looking for them in the output folder of the model rules.
However, we have not included the model outputs as necessary inputs to our table rule.
Snakemake therefore does not check if they exist and will not build them either.</p>
<p>This is easy to fix.
We just need to include the model inputs from the <code>run_models</code> target rule from the previous chapter into our new rule.
This tells Snakemake to create all models before creating the regression table.</p>
<p>Copying this part and adding it as <code>{input.models}</code> makes our table rule a target for the model outputs.
We should end up with a rule like this:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb136-1"><a href="make-tables.html#cb136-1"></a><span class="ex">rule</span> table:</span>
<span id="cb136-2"><a href="make-tables.html#cb136-2"></a>    <span class="ex">input</span>:</span>
<span id="cb136-3"><a href="make-tables.html#cb136-3"></a>        <span class="ex">script</span> = <span class="st">&quot;src/tables/regression_table.R&quot;</span>,</span>
<span id="cb136-4"><a href="make-tables.html#cb136-4"></a>        <span class="ex">spec</span>   = <span class="st">&quot;src/table-specs/table_01.json&quot;</span>,</span>
<span id="cb136-5"><a href="make-tables.html#cb136-5"></a>        <span class="ex">models</span> = expand(<span class="st">&quot;out/analysis/{iModel}.{iSubset}.rds&quot;</span>,</span>
<span id="cb136-6"><a href="make-tables.html#cb136-6"></a>                        <span class="ex">iModel</span> = MODELS,</span>
<span id="cb136-7"><a href="make-tables.html#cb136-7"></a>                        <span class="ex">iSubset</span> = DATA_SUBSET)        </span>
<span id="cb136-8"><a href="make-tables.html#cb136-8"></a>    <span class="ex">output</span>:</span>
<span id="cb136-9"><a href="make-tables.html#cb136-9"></a>        <span class="ex">table</span> = <span class="st">&quot;out/tables/table_01.tex&quot;</span></span>
<span id="cb136-10"><a href="make-tables.html#cb136-10"></a>    <span class="ex">shell</span>:</span>
<span id="cb136-11"><a href="make-tables.html#cb136-11"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb136-12"><a href="make-tables.html#cb136-12"></a><span class="st">            --spec {input.spec} \</span></span>
<span id="cb136-13"><a href="make-tables.html#cb136-13"></a><span class="st">            --out {output.table}&quot;</span>           </span></code></pre></div>
<p>Let us clean and rerun the rule:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb137-1"><a href="make-tables.html#cb137-1"></a><span class="ex">snakemake</span> --cores 1 clean</span>
<span id="cb137-2"><a href="make-tables.html#cb137-2"></a><span class="ex">snakemake</span> --cores 1 table</span></code></pre></div>
<p>Checking the output folder again, we see that all models</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb138-1"><a href="make-tables.html#cb138-1"></a><span class="fu">ls</span> out/analysis</span></code></pre></div>
<div class="sourceCode" id="cb139"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb139-1"><a href="make-tables.html#cb139-1"></a><span class="ex">model_aug_cc.subset_intermediate.rds</span>        model_aug_cc_restr.subset_nonoil.rds     model_aug_solow.subset_oecd.rds            model_cc.subset_intermediate.rds     model_solow.subset_nonoil.rds          model_solow_restr.subset_oecd.rds</span>
<span id="cb139-2"><a href="make-tables.html#cb139-2"></a><span class="ex">model_aug_cc.subset_nonoil.rds</span>          model_aug_cc_restr.subset_oecd.rds       model_aug_solow_restr.subset_intermediate.rds  model_cc.subset_nonoil.rds       model_solow.subset_oecd.rds            model_ucc.subset_intermediate.rds</span>
<span id="cb139-3"><a href="make-tables.html#cb139-3"></a><span class="ex">model_aug_cc.subset_oecd.rds</span>            model_aug_solow.subset_intermediate.rds  model_aug_solow_restr.subset_nonoil.rds        model_cc.subset_oecd.rds         model_solow_restr.subset_intermediate.rds  model_ucc.subset_nonoil.rds</span>
<span id="cb139-4"><a href="make-tables.html#cb139-4"></a><span class="ex">model_aug_cc_restr.subset_intermediate.rds</span>  model_aug_solow.subset_nonoil.rds        model_aug_solow_restr.subset_oecd.rds      model_solow.subset_intermediate.rds  model_solow_restr.subset_nonoil.rds        model_ucc.subset_oecd.rds</span></code></pre></div>
<p>and the table</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb140-1"><a href="make-tables.html#cb140-1"></a><span class="fu">ls</span> out/tables</span></code></pre></div>
<div class="sourceCode" id="cb141"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb141-1"><a href="make-tables.html#cb141-1"></a><span class="ex">table_01.tex</span></span></code></pre></div>
<p>have been successfully created.</p>
</div>
<div id="building-all-tables-at-once" class="section level2">
<h2><span class="header-section-number">9.3</span> Building all tables at once</h2>
<p>Being able to build a single table and all the models is of course nice but we want to build <em>all</em> six tables from <span class="citation">Mankiw, Romer, and Weil (<a href="#ref-mrw" role="doc-biblioref">1992</a>)</span> with a single line of code.
To do so elegantly, we will employ all tools we have learned in the last part.
You will practice this in the following exercise.</p>
<div id="exercise" class="section level3 unnumbered exercise">
<h3>Exercise</h3>
<p>We want to generalize our table building script in this exercise to automatically create all six tables from <span class="citation">Mankiw, Romer, and Weil (<a href="#ref-mrw" role="doc-biblioref">1992</a>)</span>.</p>
<p>Follow these steps to accomplish this:</p>
<ol style="list-style-type: decimal">
<li>Add a wildcard to the <code>table</code> rule which can take the varying part of the <code>{input.spec}</code> and <code>{output.table}</code> parts. To do so, replace <code>table_01</code> with <code>{iTable}</code> in both.</li>
<li>Create a new target rule called <code>make_tables</code>. The rule expands the output argument of the <code>table</code> rule. It uses the <code>{iTable}</code> wildcard from a list called <code>TABLES</code>.</li>
<li>Create the TABLES list using the <code>glob_wildcards function</code> which matches filenames without the file ending from the <code>src/table-spec</code> folder.</li>
<li>Clean your output folder.</li>
<li>Run the <code>make_tables</code> rule.</li>
<li>Verify that all six tables have been created in the output folder.</li>
</ol>
</div>
<div id="solution-6" class="section level3 unnumbered solution">
<h3>Solution</h3>
<p>Putting Steps 1-3 together should give us these three new parts:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb142-1"><a href="make-tables.html#cb142-1"></a><span class="ex">TABLES</span> = glob_wildcards(<span class="st">&quot;src/table-specs/{fname}.json&quot;</span>)<span class="ex">.fname</span></span>
<span id="cb142-2"><a href="make-tables.html#cb142-2"></a></span>
<span id="cb142-3"><a href="make-tables.html#cb142-3"></a><span class="ex">rule</span> make_tables:</span>
<span id="cb142-4"><a href="make-tables.html#cb142-4"></a>    <span class="ex">input</span>:</span>
<span id="cb142-5"><a href="make-tables.html#cb142-5"></a>        <span class="ex">expand</span>(<span class="st">&quot;out/tables/{iTable}.tex&quot;</span>,</span>
<span id="cb142-6"><a href="make-tables.html#cb142-6"></a>                <span class="ex">iTable</span> = TABLES)</span>
<span id="cb142-7"><a href="make-tables.html#cb142-7"></a></span>
<span id="cb142-8"><a href="make-tables.html#cb142-8"></a><span class="ex">rule</span> table:</span>
<span id="cb142-9"><a href="make-tables.html#cb142-9"></a>    <span class="ex">input</span>:</span>
<span id="cb142-10"><a href="make-tables.html#cb142-10"></a>        <span class="ex">script</span> = <span class="st">&quot;src/tables/regression_table.R&quot;</span>,</span>
<span id="cb142-11"><a href="make-tables.html#cb142-11"></a>        <span class="ex">spec</span>   = <span class="st">&quot;src/table-specs/{iTable}.json&quot;</span>,</span>
<span id="cb142-12"><a href="make-tables.html#cb142-12"></a>        <span class="ex">models</span> = expand(<span class="st">&quot;out/analysis/{iModel}.{iSubset}.rds&quot;</span>,</span>
<span id="cb142-13"><a href="make-tables.html#cb142-13"></a>                        <span class="ex">iModel</span> = MODELS,</span>
<span id="cb142-14"><a href="make-tables.html#cb142-14"></a>                        <span class="ex">iSubset</span> = DATA_SUBSET),</span>
<span id="cb142-15"><a href="make-tables.html#cb142-15"></a>    <span class="ex">output</span>:</span>
<span id="cb142-16"><a href="make-tables.html#cb142-16"></a>        <span class="ex">table</span> = <span class="st">&quot;out/tables/{iTable}.tex&quot;</span></span>
<span id="cb142-17"><a href="make-tables.html#cb142-17"></a>    <span class="ex">shell</span>:</span>
<span id="cb142-18"><a href="make-tables.html#cb142-18"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb142-19"><a href="make-tables.html#cb142-19"></a><span class="st">            --spec {input.spec} \</span></span>
<span id="cb142-20"><a href="make-tables.html#cb142-20"></a><span class="st">            --out {output.table}&quot;</span></span>
<span id="cb142-21"><a href="make-tables.html#cb142-21"></a>[<span class="ex">...</span>]</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Clean your output folder.</li>
</ol>
<div class="sourceCode" id="cb143"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb143-1"><a href="make-tables.html#cb143-1"></a><span class="ex">snakemake</span> --cores 1 clean</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Run the <code>make_tables</code> rule.</li>
</ol>
<div class="sourceCode" id="cb144"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb144-1"><a href="make-tables.html#cb144-1"></a><span class="ex">snakemake</span> --cores 1 make_tables</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Verify that all six tables have been created in the output folder.</li>
</ol>
<div class="sourceCode" id="cb145"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb145-1"><a href="make-tables.html#cb145-1"></a><span class="fu">ls</span> out/tables</span></code></pre></div>
<p>The expected output are the six table files:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb146-1"><a href="make-tables.html#cb146-1"></a><span class="ex">table_01.tex</span>  table_02.tex  table_03.tex  table_04.tex  table_05.tex  table_06.tex</span></code></pre></div>

</div>
</div>
</div>
<h3> Containers</h3>
<div id="refs" class="references">
<div id="ref-mrw">
<p>Mankiw, N. Gregory, David Romer, and David N. Weil. 1992. “A Contribution to the Empirics of Economic Growth*.” <em>The Quarterly Journal of Economics</em> 107 (2): 407–37. <a href="https://doi.org/10.2307/2118477">https://doi.org/10.2307/2118477</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="automating-list-construction-for-wildcard-expansion.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="building-all-outputs-at-once.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/06-tables.rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["book.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
