<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Working With Multiple Rules | Reproducible Data Analytic Workflows with Snakemake and R</title>
  <meta name="description" content="In progress" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Working With Multiple Rules | Reproducible Data Analytic Workflows with Snakemake and R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="In progress" />
  <meta name="github-repo" content="lachlandeer/snakemake-econ-r-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Working With Multiple Rules | Reproducible Data Analytic Workflows with Snakemake and R" />
  
  <meta name="twitter:description" content="In progress" />
  

<meta name="author" content="Ulrich Bergmann" />
<meta name="author" content="Lachlan Deer" />
<meta name="author" content="Julian Langer" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="initial-steps-with-snakemake.html"/>
<link rel="next" href="target-rules.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="img/logo.png"></a></li>
<div style="text-align:center">
<li><a href="./index.html">Reproducible Data Analytic <br /> Workflows with Snakemake and `R`</a></li>
</div>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-we-wrote-this-tutorial"><i class="fa fa-check"></i>Why we wrote this tutorial</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#pre-requisite-knowledge"><i class="fa fa-check"></i>Pre-requisite Knowledge</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-needs-to-be-downloaded-installed-for-this-tutorial"><i class="fa fa-check"></i>What Needs to be Downloaded &amp; Installed for this Tutorial</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#template-scripts-and-documents"><i class="fa fa-check"></i>Template Scripts and Documents</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-installation"><i class="fa fa-check"></i>Software Installation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-we-cant-cover"><i class="fa fa-check"></i>What We Can’t Cover</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the Authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#instructional-material"><i class="fa fa-check"></i>Instructional material</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software"><i class="fa fa-check"></i>Software</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#citation"><i class="fa fa-check"></i>Citation</a></li>
</ul></li>
<li class="part"><span><b>I Preliminaries</b></span><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#learning-objectives"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#solution"><i class="fa fa-check"></i>Solution</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#exercise"><i class="fa fa-check"></i>Exercise</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prereq"><i class="fa fa-check"></i>Prereq</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#warning"><i class="fa fa-check"></i>warning</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#tip"><i class="fa fa-check"></i>tip</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Motivating &amp; Rationale</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#a-case-for-reproducibility"><i class="fa fa-check"></i><b>1.1</b> A Case for Reproducibility</a><ul>
<li class="chapter" data-level="1.1.1" data-path="intro.html"><a href="intro.html#how-far-to-go-in-the-quest-for-reproducibility"><i class="fa fa-check"></i><b>1.1.1</b> How far to go in the quest for reproducibility?</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#what-is-snakemake-why-should-you-use-it"><i class="fa fa-check"></i><b>1.2</b> What is <code>Snakemake</code> &amp; Why Should you use it?</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#why-r"><i class="fa fa-check"></i><b>1.3</b> Why <code>R</code>?</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#working-example-replicating-mankiw-romer-and-weils-1992-qje"><i class="fa fa-check"></i><b>1.4</b> Working Example: Replicating Mankiw, Romer and Weil’s 1992 QJE</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#the-way-forward"><i class="fa fa-check"></i><b>1.5</b> The way forward</a><ul>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#exercise-your-own-projects-steps"><i class="fa fa-check"></i>Exercise: Your own project’s steps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="project-organization.html"><a href="project-organization.html"><i class="fa fa-check"></i><b>2</b> Project Organization</a><ul>
<li class="chapter" data-level="" data-path="project-organization.html"><a href="project-organization.html#learning-objectives-1"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="2.1" data-path="project-organization.html"><a href="project-organization.html#subtitle-tbd"><i class="fa fa-check"></i><b>2.1</b> Subtitle TBD</a></li>
<li class="chapter" data-level="2.2" data-path="project-organization.html"><a href="project-organization.html#project-organization-i-separating-inputs-and-outputs"><i class="fa fa-check"></i><b>2.2</b> Project Organization I: Separating Inputs and Outputs</a></li>
<li class="chapter" data-level="2.3" data-path="project-organization.html"><a href="project-organization.html#project-structure-ii-separating-logical-chunks-of-the-project"><i class="fa fa-check"></i><b>2.3</b> Project Structure II: Separating Logical Chunks of the Project</a><ul>
<li class="chapter" data-level="2.3.1" data-path="project-organization.html"><a href="project-organization.html#aside-even-deeper-sub-folders"><i class="fa fa-check"></i><b>2.3.1</b> Aside: Even Deeper Sub-folders</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="project-organization.html"><a href="project-organization.html#project-structure-iii-separating-input-parameters-from-code"><i class="fa fa-check"></i><b>2.4</b> Project Structure III: Separating Input Parameters from Code</a></li>
</ul></li>
<li class="part"><span><b>II Basic Snakemake Workflows</b></span></li>
<li class="chapter" data-level="3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html"><i class="fa fa-check"></i><b>3</b> Initial Steps with Snakemake</a><ul>
<li class="chapter" data-level="3.1" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#snakefile-writing-our-first-rule"><i class="fa fa-check"></i><b>3.1</b> Snakefile – Writing Our First Rule</a></li>
<li class="chapter" data-level="3.2" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#the-snakemake-command-executing-a-rule"><i class="fa fa-check"></i><b>3.2</b> The Snakemake Command – Executing a Rule</a></li>
<li class="chapter" data-level="3.3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#reading-and-writing-files-first-steps-in-a-data-science-pipeline"><i class="fa fa-check"></i><b>3.3</b> Reading and Writing Files – First Steps in a Data Science Pipeline</a><ul>
<li class="chapter" data-level="3.3.1" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#using-the-rscript-command-to-execute-r-scripts"><i class="fa fa-check"></i><b>3.3.1</b> Using the Rscript command to execute R scripts</a></li>
<li class="chapter" data-level="3.3.2" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#the-input-and-output-arguments"><i class="fa fa-check"></i><b>3.3.2</b> The input and output arguments</a></li>
<li class="chapter" data-level="3.3.3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#a-rule-to-rename-variables."><i class="fa fa-check"></i><b>3.3.3</b> A rule to rename variables.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#redundant-executions-dont-run-a-rule-repeatedly"><i class="fa fa-check"></i><b>3.4</b> Redundant Executions – (Don’t) Run a Rule Repeatedly</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html"><i class="fa fa-check"></i><b>4</b> Working With Multiple Rules</a><ul>
<li class="chapter" data-level="4.1" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#creating-a-second-rule"><i class="fa fa-check"></i><b>4.1</b> Creating a second rule</a><ul>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#exercise-creating-rules"><i class="fa fa-check"></i>Exercise: Creating Rules</a></li>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#solution-1"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#clean-rules"><i class="fa fa-check"></i><b>4.2</b> Clean Rules</a><ul>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#exercise-creating-cleaning-rules"><i class="fa fa-check"></i>Exercise: Creating Cleaning Rules</a></li>
<li class="chapter" data-level="" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#solution-2"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="target-rules.html"><a href="target-rules.html"><i class="fa fa-check"></i><b>5</b> Target Rules</a><ul>
<li class="chapter" data-level="5.1" data-path="target-rules.html"><a href="target-rules.html#where-we-are-now"><i class="fa fa-check"></i><b>5.1</b> Where we are now?</a></li>
<li class="chapter" data-level="5.2" data-path="target-rules.html"><a href="target-rules.html#how-snakemake-determines-the-build-order-when-multiple-rules-are-present"><i class="fa fa-check"></i><b>5.2</b> How Snakemake determines the build order when multiple rules are present</a></li>
<li class="chapter" data-level="5.3" data-path="target-rules.html"><a href="target-rules.html#dedicated-target-rules-to-execute-multiple-rules"><i class="fa fa-check"></i><b>5.3</b> Dedicated target rules to execute multiple rules</a><ul>
<li class="chapter" data-level="" data-path="target-rules.html"><a href="target-rules.html#exercise-using-target-rules"><i class="fa fa-check"></i>Exercise: Using target rules</a></li>
<li class="chapter" data-level="" data-path="target-rules.html"><a href="target-rules.html#solution-3"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="target-rules.html"><a href="target-rules.html#target-rules-can-do-more-for-us"><i class="fa fa-check"></i><b>5.4</b> Target rules can do more for us</a></li>
</ul></li>
<li class="part"><span><b>III Minimizing Repetition, Maximizing Generalizability</b></span></li>
<li class="chapter" data-level="6" data-path="wildcards.html"><a href="wildcards.html"><i class="fa fa-check"></i><b>6</b> Wildcards</a><ul>
<li class="chapter" data-level="6.1" data-path="wildcards.html"><a href="wildcards.html#the-starting-point-of-our-snakefile"><i class="fa fa-check"></i><b>6.1</b> The starting point of our Snakefile</a></li>
<li class="chapter" data-level="6.2" data-path="wildcards.html"><a href="wildcards.html#using-wildcards-to-tidy-up-our-code"><i class="fa fa-check"></i><b>6.2</b> Using wildcards to tidy up our code</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html"><i class="fa fa-check"></i><b>7</b> Automatic Expansion of Wildcards</a><ul>
<li class="chapter" data-level="7.1" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#learning-goals"><i class="fa fa-check"></i><b>7.1</b> Learning Goals</a></li>
<li class="chapter" data-level="7.2" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#the-expand-function"><i class="fa fa-check"></i><b>7.2</b> The <code>expand()</code> function</a><ul>
<li class="chapter" data-level="" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#exercise-exploring-the-expand-function-i"><i class="fa fa-check"></i>Exercise: Exploring the expand function I</a></li>
<li class="chapter" data-level="7.2.1" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#solution-4"><i class="fa fa-check"></i><b>7.2.1</b> SOLUTION:</a></li>
<li class="chapter" data-level="" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#exercise-exploring-the-expand-function-ii"><i class="fa fa-check"></i>Exercise: Exploring the expand() function II</a></li>
<li class="chapter" data-level="7.2.2" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#solution-5"><i class="fa fa-check"></i><b>7.2.2</b> Solution</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="automatic-expansion-of-wildcards.html"><a href="automatic-expansion-of-wildcards.html#expanding-multiple-wildcards"><i class="fa fa-check"></i><b>7.3</b> Expanding Multiple Wildcards</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html"><i class="fa fa-check"></i><b>8</b> Automating List Construction for Wildcard Expansion</a><ul>
<li class="chapter" data-level="8.1" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#learning-objectives-2"><i class="fa fa-check"></i><b>8.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="8.2" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#state-of-the-snakefile"><i class="fa fa-check"></i><b>8.2</b> State of the Snakefile</a></li>
<li class="chapter" data-level="8.3" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#the-glob_wildcards-function"><i class="fa fa-check"></i><b>8.3</b> The <code>glob_wildcards</code> Function</a></li>
<li class="chapter" data-level="8.4" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#looking-at-the-dag-redux"><i class="fa fa-check"></i><b>8.4</b> Looking at the DAG (redux)</a><ul>
<li class="chapter" data-level="" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#exercise-exploring-glob_wildcards"><i class="fa fa-check"></i>Exercise: Exploring glob_wildcards()</a></li>
<li class="chapter" data-level="8.4.1" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#solution-6"><i class="fa fa-check"></i><b>8.4.1</b> Solution</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Bringing Many Outputs Together</b></span></li>
<li class="chapter" data-level="9" data-path="make-tables.html"><a href="make-tables.html"><i class="fa fa-check"></i><b>9</b> Make Tables</a><ul>
<li class="chapter" data-level="9.1" data-path="make-tables.html"><a href="make-tables.html#the-state-of-the-snakefile"><i class="fa fa-check"></i><b>9.1</b> The State of the Snakefile</a></li>
<li class="chapter" data-level="9.2" data-path="make-tables.html"><a href="make-tables.html#building-a-single-table"><i class="fa fa-check"></i><b>9.2</b> Building a single table</a></li>
<li class="chapter" data-level="9.3" data-path="make-tables.html"><a href="make-tables.html#building-all-tables-at-once"><i class="fa fa-check"></i><b>9.3</b> Building all tables at once</a><ul>
<li class="chapter" data-level="" data-path="make-tables.html"><a href="make-tables.html#exercise-1"><i class="fa fa-check"></i>Exercise</a></li>
<li class="chapter" data-level="" data-path="make-tables.html"><a href="make-tables.html#solution-7"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html"><i class="fa fa-check"></i><b>10</b> One rule to rule them all</a><ul>
<li class="chapter" data-level="10.1" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#the-state-of-the-snakefile-1"><i class="fa fa-check"></i><b>10.1</b> The State of the Snakefile</a></li>
<li class="chapter" data-level="10.2" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#creating-an-all-target-rule"><i class="fa fa-check"></i><b>10.2</b> Creating an <code>all</code> target rule</a></li>
<li class="chapter" data-level="10.3" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#concluding-remarks"><i class="fa fa-check"></i><b>10.3</b> Concluding Remarks</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html"><i class="fa fa-check"></i><b>11</b> Adding Papers and Slides to a Snakemake Workflow</a><ul>
<li class="chapter" data-level="11.1" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#learning-objectives-3"><i class="fa fa-check"></i><b>11.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="11.2" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#state-of-our-snakefile"><i class="fa fa-check"></i><b>11.2</b> State of Our Snakefile</a></li>
<li class="chapter" data-level="11.3" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#where-we-are"><i class="fa fa-check"></i><b>11.3</b> Where We Are</a></li>
<li class="chapter" data-level="11.4" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#building-a-paper"><i class="fa fa-check"></i><b>11.4</b> Building a Paper</a></li>
<li class="chapter" data-level="11.5" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#integrating-build_paper-output-into-all"><i class="fa fa-check"></i><b>11.5</b> Integrating <code>build_paper</code> output into <code>all</code></a></li>
<li class="chapter" data-level="11.6" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#making-paper.pdf-easier-to-find"><i class="fa fa-check"></i><b>11.6</b> Making <code>paper.pdf</code> Easier to Find</a><ul>
<li class="chapter" data-level="11.6.1" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#exercise-adding-a-slide-deck."><i class="fa fa-check"></i><b>11.6.1</b> Exercise: Adding a Slide Deck.</a></li>
<li class="chapter" data-level="11.6.2" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#exercise-solution"><i class="fa fa-check"></i><b>11.6.2</b> Exercise Solution</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#final-thoughts"><i class="fa fa-check"></i><b>11.7</b> Final Thoughts</a></li>
</ul></li>
<li class="part"><span><b>V Decorating Snakemake Workflows</b></span></li>
<li class="chapter" data-level="12" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html"><i class="fa fa-check"></i><b>12</b> Logging Output and Errors</a><ul>
<li class="chapter" data-level="12.1" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#logging-output"><i class="fa fa-check"></i><b>12.1</b> Logging Output</a></li>
<li class="chapter" data-level="12.2" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#logging-output-and-errors-in-one-file"><i class="fa fa-check"></i><b>12.2</b> Logging Output and Errors in One File</a><ul>
<li class="chapter" data-level="" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#exercise-logging-all-r-scripts"><i class="fa fa-check"></i>Exercise: Logging all R Scripts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="adding-parameters.html"><a href="adding-parameters.html"><i class="fa fa-check"></i><b>13</b> Adding Parameters</a><ul>
<li class="chapter" data-level="13.1" data-path="adding-parameters.html"><a href="adding-parameters.html#motivating-example-constructing-a-regression-table-from-ols-results"><i class="fa fa-check"></i><b>13.1</b> Motivating Example: Constructing a Regression Table from OLS Results</a></li>
<li class="chapter" data-level="13.2" data-path="adding-parameters.html"><a href="adding-parameters.html#creating-a-rule-with-params"><i class="fa fa-check"></i><b>13.2</b> Creating a Rule with <code>params</code></a><ul>
<li class="chapter" data-level="" data-path="adding-parameters.html"><a href="adding-parameters.html#exercise-building-table-2"><i class="fa fa-check"></i>Exercise: Building Table 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="config-files.html"><a href="config-files.html"><i class="fa fa-check"></i><b>14</b> Config Files</a><ul>
<li class="chapter" data-level="14.1" data-path="config-files.html"><a href="config-files.html#the-config.yaml-filepath"><i class="fa fa-check"></i><b>14.1</b> The <code>config.yaml</code> filepath</a></li>
<li class="chapter" data-level="14.2" data-path="config-files.html"><a href="config-files.html#using-paths-from-the-config-file"><i class="fa fa-check"></i><b>14.2</b> Using paths from the config file</a><ul>
<li class="chapter" data-level="" data-path="config-files.html"><a href="config-files.html#exercise-using-config-files"><i class="fa fa-check"></i>Exercise: Using Config Files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="self-documenting-help.html"><a href="self-documenting-help.html"><i class="fa fa-check"></i><b>15</b> Self Documenting Help</a><ul>
<li class="chapter" data-level="15.1" data-path="self-documenting-help.html"><a href="self-documenting-help.html#our-commenting-syle"><i class="fa fa-check"></i><b>15.1</b> Our Commenting Syle</a></li>
<li class="chapter" data-level="15.2" data-path="self-documenting-help.html"><a href="self-documenting-help.html#adding-further-comments"><i class="fa fa-check"></i><b>15.2</b> Adding Further Comments</a><ul>
<li class="chapter" data-level="" data-path="self-documenting-help.html"><a href="self-documenting-help.html#exercise-adding-comments"><i class="fa fa-check"></i>Exercise: Adding Comments</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="self-documenting-help.html"><a href="self-documenting-help.html#a-help-rule"><i class="fa fa-check"></i><b>15.3</b> A <code>help</code> Rule</a><ul>
<li><a href="self-documenting-help.html#exercise-saving-help-output-to-file">Exercise: Saving <code>help</code> output to file</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html"><i class="fa fa-check"></i><b>16</b> Subworkflows: Divide and Conquer</a><ul>
<li class="chapter" data-level="16.1" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#subworkflow-basics"><i class="fa fa-check"></i><b>16.1</b> Subworkflow Basics</a></li>
<li class="chapter" data-level="16.2" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#subworkflow-dependencies"><i class="fa fa-check"></i><b>16.2</b> Subworkflow dependencies</a><ul>
<li class="chapter" data-level="" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#exercise-more-subworkflows"><i class="fa fa-check"></i>Exercise: More Subworkflows</a></li>
<li><a href="subworkflows-divide-and-conquer.html#guided-exercise-help-rules-with-subworkflows">Guided Exercise: <code>help</code> rules with subworkflows</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VI Putting Workflows in a Box</b></span></li>
<li class="chapter" data-level="17" data-path="package-dependencies-with-renv.html"><a href="package-dependencies-with-renv.html"><i class="fa fa-check"></i><b>17</b> Package Dependencies with <code>renv</code></a></li>
<li class="chapter" data-level="18" data-path="containers.html"><a href="containers.html"><i class="fa fa-check"></i><b>18</b> Containers</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="installation-guide.html"><a href="installation-guide.html"><i class="fa fa-check"></i><b>A</b> Installation Guide</a><ul>
<li class="chapter" data-level="A.1" data-path="installation-guide.html"><a href="installation-guide.html#windows"><i class="fa fa-check"></i><b>A.1</b> Windows</a><ul>
<li class="chapter" data-level="A.1.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal"><i class="fa fa-check"></i><b>A.1.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.1.2" data-path="installation-guide.html"><a href="installation-guide.html#python"><i class="fa fa-check"></i><b>A.1.2</b> Python</a></li>
<li class="chapter" data-level="" data-path="installation-guide.html"><a href="installation-guide.html#installing-snakemake"><i class="fa fa-check"></i>Installing Snakemake</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="installation-guide.html"><a href="installation-guide.html#mac"><i class="fa fa-check"></i><b>A.2</b> Mac</a><ul>
<li class="chapter" data-level="A.2.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal-1"><i class="fa fa-check"></i><b>A.2.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.2.2" data-path="installation-guide.html"><a href="installation-guide.html#python-1"><i class="fa fa-check"></i><b>A.2.2</b> Python</a></li>
<li class="chapter" data-level="" data-path="installation-guide.html"><a href="installation-guide.html#installing-snakemake-1"><i class="fa fa-check"></i>Installing Snakemake</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="installation-guide.html"><a href="installation-guide.html#linux-ubuntu"><i class="fa fa-check"></i><b>A.3</b> Linux / Ubuntu</a><ul>
<li class="chapter" data-level="A.3.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal-2"><i class="fa fa-check"></i><b>A.3.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.3.2" data-path="installation-guide.html"><a href="installation-guide.html#python-2"><i class="fa fa-check"></i><b>A.3.2</b> Python</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>B</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.comlachlandeer/snakemake-econ-r/" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible Data Analytic Workflows with Snakemake and <code>R</code></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="working-with-multiple-rules" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Working With Multiple Rules</h1>
<p>Learning goals</p>
<ul>
<li>How do we chain Snakemake rules together?</li>
<li>How does Snakemake know in which order to execute rules?</li>
<li>Practice writing Snakemake rules</li>
<li>What are clean rules and how can they make our life easier?</li>
</ul>
<p>In the last chapter we have learned how to write and execute a single Snakemake rule.
This is obviously not sufficient for a real world research workflow which requires many different operations to be executed sequentially.
in this chapter we will therefore learn how to work with several rules and how they interact with each other.</p>
<div id="creating-a-second-rule" class="section level2">
<h2><span class="header-section-number">4.1</span> Creating a second rule</h2>
<p>The second step in our data management is to create additional variables we will use in our regression analysis.
The script <code>gen_reg_vars.R</code> in the <code>src/data-management</code> folder does this for us.
We are going to build a rule called <code>gen_regression_vars</code> to do this from Snakemake.
Let’s see what arguments the script expects to be passed:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb43-1"><a href="working-with-multiple-rules.html#cb43-1"></a>$ <span class="ex">Rscript</span> src/data-management/gen_reg_vars.R --help</span></code></pre></div>
<pre class="out"><code>Options:
    -d CHARACTER, --data=CHARACTER
        a csv file name

    -p NUMERIC, --param=NUMERIC
        Solow`s Constant, as a numeric [default = 0.05]

    -o CHARACTER, --out=CHARACTER
        output file name [default = out.csv]

    -h, --help
        Show this help message and exit</code></pre>
<p>We see that script expects three arguments:</p>
<ul>
<li><code>--data</code>, the file path of the input file</li>
<li><code>--out</code>, the file path of the output file</li>
<li><code>--param</code>, Solow’s constant which defaults to 0.05, the parameter used in <span class="citation">Mankiw, Romer, and Weil (<a href="#ref-mrw" role="doc-biblioref">1992</a>)</span>. We can safely ignore this for now.</li>
</ul>
<p>To chain two rules together, the second one needs to use the output of the first rule as its input.
This way the second script will receive all the changes the first script made so they are not lost.</p>
<p>Let us incorporate this here and create a <code>gen_regression_vars</code> rule on top of the <code>rename_vars</code> rule.
The rule takes two inputs:
<code>{input.script}</code> will be <code>gen_reg_vars.R</code> and <code>{input.data}</code> will be the file defined as <code>{output.data}</code> in the <code>rename_vars</code> rule.
Our new rule now should look something like this:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb45-1"><a href="working-with-multiple-rules.html#cb45-1"></a><span class="ex">rule</span> gen_regression_vars:</span>
<span id="cb45-2"><a href="working-with-multiple-rules.html#cb45-2"></a>    <span class="ex">input</span>:</span>
<span id="cb45-3"><a href="working-with-multiple-rules.html#cb45-3"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/gen_reg_vars.R&quot;</span>,</span>
<span id="cb45-4"><a href="working-with-multiple-rules.html#cb45-4"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span></span></code></pre></div>
<p>Let us now add the filepath the output of the rule will be saved to.
We will use a new filename in the <code>out/data</code> folder and choose <code>mrw_complete.csv</code> to indicate that this data set includes all data modifications the project requires:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb46-1"><a href="working-with-multiple-rules.html#cb46-1"></a><span class="ex">rule</span> gen_regression_vars:</span>
<span id="cb46-2"><a href="working-with-multiple-rules.html#cb46-2"></a>    <span class="ex">input</span>:</span>
<span id="cb46-3"><a href="working-with-multiple-rules.html#cb46-3"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/gen_reg_vars.R&quot;</span>,</span>
<span id="cb46-4"><a href="working-with-multiple-rules.html#cb46-4"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span>,</span>
<span id="cb46-5"><a href="working-with-multiple-rules.html#cb46-5"></a>    <span class="ex">output</span>:</span>
<span id="cb46-6"><a href="working-with-multiple-rules.html#cb46-6"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span></span></code></pre></div>
<p>Finally, let us add the <code>shell</code> argument, which is identical to the one used in our first rule.
Now, our rule is complete:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb47-1"><a href="working-with-multiple-rules.html#cb47-1"></a><span class="ex">rule</span> gen_regression_vars:</span>
<span id="cb47-2"><a href="working-with-multiple-rules.html#cb47-2"></a>    <span class="ex">input</span>:</span>
<span id="cb47-3"><a href="working-with-multiple-rules.html#cb47-3"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/gen_reg_vars.R&quot;</span>,</span>
<span id="cb47-4"><a href="working-with-multiple-rules.html#cb47-4"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span></span>
<span id="cb47-5"><a href="working-with-multiple-rules.html#cb47-5"></a>    <span class="ex">output</span>:</span>
<span id="cb47-6"><a href="working-with-multiple-rules.html#cb47-6"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span></span>
<span id="cb47-7"><a href="working-with-multiple-rules.html#cb47-7"></a>    <span class="ex">shell</span>:</span>
<span id="cb47-8"><a href="working-with-multiple-rules.html#cb47-8"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb47-9"><a href="working-with-multiple-rules.html#cb47-9"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb47-10"><a href="working-with-multiple-rules.html#cb47-10"></a><span class="st">            --out {output.data}&quot;</span></span></code></pre></div>
<p>To find out how Snakemake perceives our projects, let’s use the summary option</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb48-1"><a href="working-with-multiple-rules.html#cb48-1"></a>$ <span class="ex">snakemake</span> --summary</span></code></pre></div>
<p>which yields the following console output:</p>
<pre class="out"><code>Building DAG of jobs...
output_file                    date                     rule                  version   log-file(s) status     plan
out/data/mrw_complete.csv   -                           gen_regression_vars     -                   missing update pending
out/data/mrw_renamed.csv    Fri Jan 11 13:40:07 2019    rename_vars             -                   ok          no update</code></pre>
<p>Snakemake knows that the output of the <code>rename_vars</code> rule is up to date and therefore plans to only execute the <code>gen_regression_vars</code> rule as it’s output
<code>out/data/mrw_complete.csv</code> does not yet exist.</p>
<p>Let’s run snakemake to build our new file:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb50-1"><a href="working-with-multiple-rules.html#cb50-1"></a>$ <span class="ex">snakemake</span> --cores 1</span></code></pre></div>
<p>When we look at our output directory</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb51-1"><a href="working-with-multiple-rules.html#cb51-1"></a>$ <span class="fu">ls</span> out/data/</span></code></pre></div>
<p>we see that the second output file has been created.</p>
<pre class="out"><code>mrw_complete.csv  mrw_renamed.csv</code></pre>
<div id="exercise-creating-rules" class="section level3 unnumbered exercise">
<h3>Exercise: Creating Rules</h3>
<p><span class="citation">Mankiw, Romer, and Weil (<a href="#ref-mrw" role="doc-biblioref">1992</a>)</span> estimate the Solow model for three subsets of data.
The R script <code>src/analysis/estimate_ols.R</code> will estimate a OLS model for a given dataset when you provide the necessary inputs.</p>
<ul>
<li>The script expects an OLS specification.
You can point to the basic OLS specification from <span class="citation">Mankiw, Romer, and Weil (<a href="#ref-mrw" role="doc-biblioref">1992</a>)</span> in <code>src/model-specs/model_solow.json</code>.</li>
<li>You will find the necessary data subsetting conditions in <code>src/data-specs</code>.</li>
</ul>
<p>Write one rule for each subset of the data.</p>
<ol style="list-style-type: decimal">
<li>What inputs do you need to provide?</li>
<li>What outputs will be produced?</li>
<li>Write Snakemake rules to estimate the solow model for each subset of data.</li>
</ol>
</div>
<div id="solution-1" class="section level3 unnumbered solution">
<h3>Solution</h3>
<ol style="list-style-type: decimal">
<li>What inputs do you need to provide?</li>
</ol>
<ul>
<li><code>--data</code> the file path of a csv dataset as an input. We use the output of our last rule: <code>out/data/mrw_complete.csv</code>.</li>
<li><code>--model</code> the file path of a regression model. We follow the hint and use <code>src/model-specs/model_solow.json</code>.</li>
<li><code>--subset</code> the file path of a sub setting condition. We will use one of the three files in <code>src/data-specs</code> for each rule respectively.</li>
<li><code>--out</code> the file path for the output file.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>What outputs will be produced?</li>
</ol>
<p>One <code>.rds</code> file for each ols model.
This is a <code>R</code> data type appropriate for saving <code>R</code> objects.
The rule therefore outputs one <code>R</code> object containing the regression results for each rule.
Loading the <code>.rds</code> file in another script will allow us later to use the regression results to create regression tables and graphs.</p>
<ol start="3" style="list-style-type: decimal">
<li>Write Snakemake rules to estimate the solow model for each subset of data.</li>
</ol>
<p>Incorporating everything will give us three rules similar to these:</p>
<pre class="out"><code>rule solow_intermediate:
    input:
        script   = &quot;src/analysis/estimate_ols_model.R&quot;,
        data     = &quot;out/data/mrw_complete.csv&quot;,
        model    = &quot;src/model-specs/model_solow.json&quot;,
        subset   = &quot;src/data-specs/subset_intermediate.json&quot;
    output:
        estimate = &quot;out/analysis/model_solow_subset_intermediate.rds&quot;,
    shell:
        &quot;Rscript {input.script} \
            --data {input.data} \
            --model {input.model} \
            --subset {input.subset} \
            --out {output.estimate}&quot;

rule solow_nonoil:
    input:
        script   = &quot;src/analysis/estimate_ols_model.R&quot;,
        data     = &quot;out/data/mrw_complete.csv&quot;,
        model    = &quot;src/model-specs/model_solow.json&quot;,
        subset   = &quot;src/data-specs/subset_nonoil.json&quot;
    output:
        estimate = &quot;out/analysis/model_solow_subset_nonoil.rds&quot;,
    shell:
        &quot;Rscript {input.script} \
            --data {input.data} \
            --model {input.model} \
            --subset {input.subset} \
            --out {output.estimate}&quot;

rule solow_oecd:
    input:
        script   = &quot;src/analysis/estimate_ols_model.R&quot;,
        data     = &quot;out/data/mrw_complete.csv&quot;,
        model    = &quot;src/model-specs/model_solow.json&quot;,
        subset   = &quot;src/data-specs/subset_oecd.json&quot;
    output:
        estimate = &quot;out/analysis/model_solow_subset_oecd.rds&quot;,
    shell:
        &quot;Rscript {input.script} \
            --data {input.data} \
            --model {input.model} \
            --subset {input.subset} \
            --out {output.estimate}&quot;</code></pre>
</div>
</div>
<div id="clean-rules" class="section level2">
<h2><span class="header-section-number">4.2</span> Clean Rules</h2>
<p>We want to end this chapter with a little extra rule which will make our life easier down the road.</p>
<p>So far we have built rules to move our replication of <span class="citation">Mankiw, Romer, and Weil (<a href="#ref-mrw" role="doc-biblioref">1992</a>)</span> forward.
As we continue to extend our Snakefile in the coming chapters we might want to be able to delete all of the produced outputs and make sure our projects builds cleanly from start to end.</p>
<p>The manual way to do this is to go to our terminal window and enter the following command each time</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb54-1"><a href="working-with-multiple-rules.html#cb54-1"></a>$ <span class="fu">rm</span> -rf out/*</span></code></pre></div>
<p>which deletes all contents of the <code>out</code> folder.</p>
<p>To make this task a bit more comfortable, we write a clean rule which deletes all contents of the output folder.</p>
<p>We can create a rule called <code>clean</code> at the bottom of our <code>Snakefile</code> that stores the shell command from above:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb55-1"><a href="working-with-multiple-rules.html#cb55-1"></a><span class="ex">rule</span> clean:</span>
<span id="cb55-2"><a href="working-with-multiple-rules.html#cb55-2"></a>    <span class="ex">shell</span>:</span>
<span id="cb55-3"><a href="working-with-multiple-rules.html#cb55-3"></a>        <span class="st">&quot;rm -rf out/*&quot;</span></span></code></pre></div>
<p>Note that this rule has no inputs or outputs.</p>
<p>To use this rule, we enter the following into our terminal:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb56-1"><a href="working-with-multiple-rules.html#cb56-1"></a>$ <span class="ex">snakemake</span> --cores 1 clean</span></code></pre></div>
<p>Notice that to use the clean rule we had to call the rule name, <code>clean</code>, explicitly.
This is necessary as the rule is at the bottom of our Snakefile.
Snakemake the first rule it finds at the top of the file when not explicitly told otherwise.</p>
<p>Now if we look out the output of running the summary call with snakemake, we see the following output:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb57-1"><a href="working-with-multiple-rules.html#cb57-1"></a><span class="ex">snakemake</span> --summary</span></code></pre></div>
<pre class="out"><code>Building DAG of jobs...
output_file                                        date   rule  version log-file(s)     status  plan
out/analysis/model_solow_subset_intermediate.rds    -     inter        -                missing update pending
out/analysis/model_solow_subset_nonoil.rds          -     nonoil       -                missing update pending
out/analysis/model_solow_subset_oecd.rds            -     oecd         -                missing update pending
out/data/mrw_complete.csv                           -     gen_regression_vars           missing update pending
out/data/mrw_renamed.csv                            -     rename_vars                   missing update pending</code></pre>
<p>Which reveals snakemake’s plan the next time its run will be to build all outputs.</p>
<div id="exercise-creating-cleaning-rules" class="section level3 unnumbered exercise">
<h3>Exercise: Creating Cleaning Rules</h3>
<p>So far we have written a cleaning rule that deletes everything in the <code>out/</code> directory.
Construct rules that would separately clean the <code>out/data/</code> and <code>out/analysis</code> subdirectories.
Why might we want to do this?</p>
</div>
<div id="solution-2" class="section level3 unnumbered solution">
<h3>Solution</h3>
<p>We only need to change the folders to delete in the shell command.
A solution might look something like this:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb59-1"><a href="working-with-multiple-rules.html#cb59-1"></a><span class="ex">rule</span> clean_data:</span>
<span id="cb59-2"><a href="working-with-multiple-rules.html#cb59-2"></a>    <span class="ex">shell</span>:</span>
<span id="cb59-3"><a href="working-with-multiple-rules.html#cb59-3"></a>        <span class="st">&quot;rm -rf out/data/*&quot;</span></span>
<span id="cb59-4"><a href="working-with-multiple-rules.html#cb59-4"></a></span>
<span id="cb59-5"><a href="working-with-multiple-rules.html#cb59-5"></a><span class="ex">rule</span> clean_analysis:</span>
<span id="cb59-6"><a href="working-with-multiple-rules.html#cb59-6"></a>    <span class="ex">shell</span>:</span>
<span id="cb59-7"><a href="working-with-multiple-rules.html#cb59-7"></a>        <span class="st">&quot;rm -rf out/analysis/*&quot;</span></span></code></pre></div>
<p>Splitting the clean rule gives us a bit more control on what we want to refresh.
In practice, data cleaning and wrangling can be computationally very taxing.
Especially later in a project’s life cycle these task seldomly change.
It can therefore be beneficial and sufficient to only reset all other analysis via a clean rule that does not delete the transformed data.</p>

</div>
</div>
</div>
<h3><span class="header-section-number">B</span> References</h3>
<div id="refs" class="references">
<div id="ref-mrw">
<p>Mankiw, N. Gregory, David Romer, and David N. Weil. 1992. “A Contribution to the Empirics of Economic Growth*.” <em>The Quarterly Journal of Economics</em> 107 (2): 407–37. <a href="https://doi.org/10.2307/2118477">https://doi.org/10.2307/2118477</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="initial-steps-with-snakemake.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="target-rules.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/lachlandeer/snakemake-econ-r/edit/master/12-multiple_rules.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["https://github.com/lachlandeer/snakemake-econ-r/raw/master/12-multiple_rules.Rmd"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
