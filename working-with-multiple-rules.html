<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Working With Multiple Rules | Reproducible Data Analytic Workflows with Snakemake and R</title>
  <meta name="description" content="In progress" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Working With Multiple Rules | Reproducible Data Analytic Workflows with Snakemake and R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="In progress" />
  <meta name="github-repo" content="lachlandeer/snakemake-econ-r-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Working With Multiple Rules | Reproducible Data Analytic Workflows with Snakemake and R" />
  
  <meta name="twitter:description" content="In progress" />
  

<meta name="author" content="Ulrich Bergmann" />
<meta name="author" content="Lachlan Deer" />
<meta name="author" content="Julian Langer" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="initial-steps-with-snakemake.html"/>
<link rel="next" href="target-rules.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>

<script>
    /* ========================================================================
     * Bootstrap: transition.js v3.3.7
     * http://getbootstrap.com/javascript/#transitions
     * ========================================================================
     * Copyright 2011-2016 Twitter, Inc.
     * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
     * ======================================================================== */
    
    
    +function ($) {
      'use strict';
    
      // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
      // ============================================================
    
      function transitionEnd() {
        var el = document.createElement('bootstrap')
    
        var transEndEventNames = {
          WebkitTransition : 'webkitTransitionEnd',
          MozTransition    : 'transitionend',
          OTransition      : 'oTransitionEnd otransitionend',
          transition       : 'transitionend'
        }
    
        for (var name in transEndEventNames) {
          if (el.style[name] !== undefined) {
            return { end: transEndEventNames[name] }
          }
        }
    
        return false // explicit for ie8 (  ._.)
      }
    
      // http://blog.alexmaccaw.com/css-transitions
      $.fn.emulateTransitionEnd = function (duration) {
        var called = false
        var $el = this
        $(this).one('bsTransitionEnd', function () { called = true })
        var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
        setTimeout(callback, duration)
        return this
      }
    
      $(function () {
        $.support.transition = transitionEnd()
    
        if (!$.support.transition) return
    
        $.event.special.bsTransitionEnd = {
          bindType: $.support.transition.end,
          delegateType: $.support.transition.end,
          handle: function (e) {
            if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
          }
        }
      })
    
    }(jQuery);
    </script>
    <script>
    /* ========================================================================
     * Bootstrap: collapse.js v3.3.7
     * http://getbootstrap.com/javascript/#collapse
     * ========================================================================
     * Copyright 2011-2016 Twitter, Inc.
     * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
     * ======================================================================== */
    
    /* jshint latedef: false */
    
    +function ($) {
      'use strict';
    
      // COLLAPSE PUBLIC CLASS DEFINITION
      // ================================
    
      var Collapse = function (element, options) {
        this.$element      = $(element)
        this.options       = $.extend({}, Collapse.DEFAULTS, options)
        this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                               '[data-toggle="collapse"][data-target="#' + element.id + '"]')
        this.transitioning = null
    
        if (this.options.parent) {
          this.$parent = this.getParent()
        } else {
          this.addAriaAndCollapsedClass(this.$element, this.$trigger)
        }
    
        if (this.options.toggle) this.toggle()
      }
    
      Collapse.VERSION  = '3.3.7'
    
      Collapse.TRANSITION_DURATION = 350
    
      Collapse.DEFAULTS = {
        toggle: true
      }
    
      Collapse.prototype.dimension = function () {
        var hasWidth = this.$element.hasClass('width')
        return hasWidth ? 'width' : 'height'
      }
    
      Collapse.prototype.show = function () {
        if (this.transitioning || this.$element.hasClass('in')) return
    
        var activesData
        var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')
    
        if (actives && actives.length) {
          activesData = actives.data('bs.collapse')
          if (activesData && activesData.transitioning) return
        }
    
        var startEvent = $.Event('show.bs.collapse')
        this.$element.trigger(startEvent)
        if (startEvent.isDefaultPrevented()) return
    
        if (actives && actives.length) {
          Plugin.call(actives, 'hide')
          activesData || actives.data('bs.collapse', null)
        }
    
        var dimension = this.dimension()
    
        this.$element
          .removeClass('collapse')
          .addClass('collapsing')[dimension](0)
          .attr('aria-expanded', true)
    
        this.$trigger
          .removeClass('collapsed')
          .attr('aria-expanded', true)
    
        this.transitioning = 1
    
        var complete = function () {
          this.$element
            .removeClass('collapsing')
            .addClass('collapse in')[dimension]('')
          this.transitioning = 0
          this.$element
            .trigger('shown.bs.collapse')
        }
    
        if (!$.support.transition) return complete.call(this)
    
        var scrollSize = $.camelCase(['scroll', dimension].join('-'))
    
        this.$element
          .one('bsTransitionEnd', $.proxy(complete, this))
          .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
      }
    
      Collapse.prototype.hide = function () {
        if (this.transitioning || !this.$element.hasClass('in')) return
    
        var startEvent = $.Event('hide.bs.collapse')
        this.$element.trigger(startEvent)
        if (startEvent.isDefaultPrevented()) return
    
        var dimension = this.dimension()
    
        this.$element[dimension](this.$element[dimension]())[0].offsetHeight
    
        this.$element
          .addClass('collapsing')
          .removeClass('collapse in')
          .attr('aria-expanded', false)
    
        this.$trigger
          .addClass('collapsed')
          .attr('aria-expanded', false)
    
        this.transitioning = 1
    
        var complete = function () {
          this.transitioning = 0
          this.$element
            .removeClass('collapsing')
            .addClass('collapse')
            .trigger('hidden.bs.collapse')
        }
    
        if (!$.support.transition) return complete.call(this)
    
        this.$element
          [dimension](0)
          .one('bsTransitionEnd', $.proxy(complete, this))
          .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
      }
    
      Collapse.prototype.toggle = function () {
        this[this.$element.hasClass('in') ? 'hide' : 'show']()
      }
    
      Collapse.prototype.getParent = function () {
        return $(this.options.parent)
          .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
          .each($.proxy(function (i, element) {
            var $element = $(element)
            this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
          }, this))
          .end()
      }
    
      Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
        var isOpen = $element.hasClass('in')
    
        $element.attr('aria-expanded', isOpen)
        $trigger
          .toggleClass('collapsed', !isOpen)
          .attr('aria-expanded', isOpen)
      }
    
      function getTargetFromTrigger($trigger) {
        var href
        var target = $trigger.attr('data-target')
          || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7
    
        return $(target)
      }
    
    
      // COLLAPSE PLUGIN DEFINITION
      // ==========================
    
      function Plugin(option) {
        return this.each(function () {
          var $this   = $(this)
          var data    = $this.data('bs.collapse')
          var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)
    
          if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
          if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
          if (typeof option == 'string') data[option]()
        })
      }
    
      var old = $.fn.collapse
    
      $.fn.collapse             = Plugin
      $.fn.collapse.Constructor = Collapse
    
    
      // COLLAPSE NO CONFLICT
      // ====================
    
      $.fn.collapse.noConflict = function () {
        $.fn.collapse = old
        return this
      }
    
    
      // COLLAPSE DATA-API
      // =================
    
      $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
        var $this   = $(this)
    
        if (!$this.attr('data-target')) e.preventDefault()
    
        var $target = getTargetFromTrigger($this)
        var data    = $target.data('bs.collapse')
        var option  = data ? 'toggle' : $this.data()
    
        Plugin.call($target, option)
      })
    
    }(jQuery);
    </script>
    <script>
    window.initializeCodeFolding = function(show) {
    
      // handlers for show-all and hide all
      $("#rmd-show-all-code").click(function() {
        // close the dropdown menu when an option is clicked
        $("#allCodeButton").dropdown("toggle");
        $('div.r-code-collapse').each(function() {
          $(this).collapse('show');
        });
      });
      $("#rmd-hide-all-code").click(function() {
        // close the dropdown menu when an option is clicked
        $("#allCodeButton").dropdown("toggle");
        $('div.r-code-collapse').each(function() {
          $(this).collapse('hide');
        });
      });
    
      // index for unique code element ids
      var currentIndex = 1;
    
      // select all R code blocks
      var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
      rCodeBlocks.each(function() {
    
        // if code block has been labeled with class `fold-show`, show the code on init!
        var classList = $(this).attr('class').split(/\s+/);
        for (var i = 0; i < classList.length; i++) {
        if (classList[i] === 'fold-show') {
            show = true;
          }
        }
    
        // create a collapsable div to wrap the code in
        var div = $('<div class="collapse r-code-collapse"></div>');
        if (show)
          div.addClass('in');
        var id = 'rcode-643E0F36' + currentIndex++;
        div.attr('id', id);
        $(this).before(div);
        $(this).detach().appendTo(div);
    
        // add a show code button right above
        var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
        var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
        showCodeButton.append(showCodeText);
        showCodeButton
            .attr('data-toggle', 'collapse')
            .attr('data-target', '#' + id)
            .attr('aria-expanded', show)
            .attr('aria-controls', id);
    
        var buttonRow = $('<div class="row"></div>');
        var buttonCol = $('<div class="col-md-12"></div>');
    
        buttonCol.append(showCodeButton);
        buttonRow.append(buttonCol);
    
        div.before(buttonRow);
    
        // hack: return show to false, otherwise all next codeBlocks will be shown!
        show = false;
    
        // update state of button on show/hide
        div.on('hidden.bs.collapse', function () {
          showCodeText.text('Code');
        });
        div.on('show.bs.collapse', function () {
          showCodeText.text('Hide');
        });
      });
    
    }
    </script>
    <script>
    /* ========================================================================
     * Bootstrap: dropdown.js v3.3.7
     * http://getbootstrap.com/javascript/#dropdowns
     * ========================================================================
     * Copyright 2011-2016 Twitter, Inc.
     * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
     * ======================================================================== */
    
    
    +function ($) {
      'use strict';
    
      // DROPDOWN CLASS DEFINITION
      // =========================
    
      var backdrop = '.dropdown-backdrop'
      var toggle   = '[data-toggle="dropdown"]'
      var Dropdown = function (element) {
        $(element).on('click.bs.dropdown', this.toggle)
      }
    
      Dropdown.VERSION = '3.3.7'
    
      function getParent($this) {
        var selector = $this.attr('data-target')
    
        if (!selector) {
          selector = $this.attr('href')
          selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
        }
    
        var $parent = selector && $(selector)
    
        return $parent && $parent.length ? $parent : $this.parent()
      }
    
      function clearMenus(e) {
        if (e && e.which === 3) return
        $(backdrop).remove()
        $(toggle).each(function () {
          var $this         = $(this)
          var $parent       = getParent($this)
          var relatedTarget = { relatedTarget: this }
    
          if (!$parent.hasClass('open')) return
    
          if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return
    
          $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))
    
          if (e.isDefaultPrevented()) return
    
          $this.attr('aria-expanded', 'false')
          $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
        })
      }
    
      Dropdown.prototype.toggle = function (e) {
        var $this = $(this)
    
        if ($this.is('.disabled, :disabled')) return
    
        var $parent  = getParent($this)
        var isActive = $parent.hasClass('open')
    
        clearMenus()
    
        if (!isActive) {
          if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
            // if mobile we use a backdrop because click events don't delegate
            $(document.createElement('div'))
              .addClass('dropdown-backdrop')
              .insertAfter($(this))
              .on('click', clearMenus)
          }
    
          var relatedTarget = { relatedTarget: this }
          $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))
    
          if (e.isDefaultPrevented()) return
    
          $this
            .trigger('focus')
            .attr('aria-expanded', 'true')
    
          $parent
            .toggleClass('open')
            .trigger($.Event('shown.bs.dropdown', relatedTarget))
        }
    
        return false
      }
    
      Dropdown.prototype.keydown = function (e) {
        if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return
    
        var $this = $(this)
    
        e.preventDefault()
        e.stopPropagation()
    
        if ($this.is('.disabled, :disabled')) return
    
        var $parent  = getParent($this)
        var isActive = $parent.hasClass('open')
    
        if (!isActive && e.which != 27 || isActive && e.which == 27) {
          if (e.which == 27) $parent.find(toggle).trigger('focus')
          return $this.trigger('click')
        }
    
        var desc = ' li:not(.disabled):visible a'
        var $items = $parent.find('.dropdown-menu' + desc)
    
        if (!$items.length) return
    
        var index = $items.index(e.target)
    
        if (e.which == 38 && index > 0)                 index--         // up
        if (e.which == 40 && index < $items.length - 1) index++         // down
        if (!~index)                                    index = 0
    
        $items.eq(index).trigger('focus')
      }
    
    
      // DROPDOWN PLUGIN DEFINITION
      // ==========================
    
      function Plugin(option) {
        return this.each(function () {
          var $this = $(this)
          var data  = $this.data('bs.dropdown')
    
          if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
          if (typeof option == 'string') data[option].call($this)
        })
      }
    
      var old = $.fn.dropdown
    
      $.fn.dropdown             = Plugin
      $.fn.dropdown.Constructor = Dropdown
    
    
      // DROPDOWN NO CONFLICT
      // ====================
    
      $.fn.dropdown.noConflict = function () {
        $.fn.dropdown = old
        return this
      }
    
    
      // APPLY TO STANDARD DROPDOWN ELEMENTS
      // ===================================
    
      $(document)
        .on('click.bs.dropdown.data-api', clearMenus)
        .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
        .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
        .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
        .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)
    
    }(jQuery);
    </script>
    <style type="text/css">
    .code-folding-btn {
      margin-bottom: 4px;
    }
    
    .row { display: flex; }
    .collapse { display: none; }
    .in { display:block }
    .pull-right > .dropdown-menu {
        right: 0;
        left: auto;
    }
    
    .dropdown-menu {
        position: absolute;
        top: 100%;
        left: 0;
        z-index: 1000;
        display: none;
        float: left;
        min-width: 160px;
        padding: 5px 0;
        margin: 2px 0 0;
        font-size: 14px;
        text-align: left;
        list-style: none;
        background-color: #fff;
        -webkit-background-clip: padding-box;
        background-clip: padding-box;
        border: 1px solid #ccc;
        border: 1px solid rgba(0,0,0,.15);
        border-radius: 4px;
        -webkit-box-shadow: 0 6px 12px rgba(0,0,0,.175);
        box-shadow: 0 6px 12px rgba(0,0,0,.175);
    }
    
    .open > .dropdown-menu {
        display: block;
        color: #ffffff;
        background-color: #ffffff;
        background-image: none;
        border-color: #92897e;
    }
    
    .dropdown-menu > li > a {
      display: block;
      padding: 3px 20px;
      clear: both;
      font-weight: 400;
      line-height: 1.42857143;
      color: #000000;
      white-space: nowrap;
    }
    
    .dropdown-menu > li > a:hover,
    .dropdown-menu > li > a:focus {
      color: #ffffff;
      text-decoration: none;
      background-color: #e95420;
    }
    
    .dropdown-menu > .active > a,
    .dropdown-menu > .active > a:hover,
    .dropdown-menu > .active > a:focus {
      color: #ffffff;
      text-decoration: none;
      background-color: #e95420;
      outline: 0;
    }
    .dropdown-menu > .disabled > a,
    .dropdown-menu > .disabled > a:hover,
    .dropdown-menu > .disabled > a:focus {
      color: #aea79f;
    }
    
    .dropdown-menu > .disabled > a:hover,
    .dropdown-menu > .disabled > a:focus {
      text-decoration: none;
      cursor: not-allowed;
      background-color: transparent;
      background-image: none;
      filter: progid:DXImageTransform.Microsoft.gradient(enabled = false);
    }
    
    .btn {
      display: inline-block;
      margin-bottom: 1;
      font-weight: normal;
      text-align: center;
      white-space: nowrap;
      vertical-align: middle;
      -ms-touch-action: manipulation;
          touch-action: manipulation;
      cursor: pointer;
      background-image: none;
      border: 1px solid transparent;
      padding: 4px 8px;
      font-size: 14px;
      line-height: 1.42857143;
      border-radius: 4px;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    
    .btn:focus,
    .btn:active:focus,
    .btn.active:focus,
    .btn.focus,
    .btn:active.focus,
    .btn.active.focus {
      outline: 5px auto -webkit-focus-ring-color;
      outline-offset: -2px;
    }
    .btn:hover,
    .btn:focus,
    .btn.focus {
      color: #ffffff;
      text-decoration: none;
    }
    .btn:active,
    .btn.active {
      background-image: none;
      outline: 0;
      box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
    }
    .btn.disabled,
    .btn[disabled],
    fieldset[disabled] .btn {
      cursor: not-allowed;
      filter: alpha(opacity=65);
      opacity: 0.65;
      box-shadow: none;
    }
    a.btn.disabled,
    fieldset[disabled] a.btn {
      pointer-events: none;
    }
    .btn-default {
      color: #ffffff;
      background-color: #aea79f; #important
      border-color: #aea79f;
    }
    
    .btn-default:focus,
    .btn-default.focus {
      color: #ffffff;
      background-color: #978e83;
      border-color: #6f675e;
    }
    
    .btn-default:hover {
      color: #ffffff;
      background-color: #978e83;
      border-color: #92897e;
    }
    .btn-default:active,
    .btn-default.active,
    .btn-group > .btn:not(:first-child):not(:last-child):not(.dropdown-toggle) {
      border-radius: 0;
    }
    .btn-group > .btn:first-child {
      margin-left: 0;
    }
    .btn-group > .btn:first-child:not(:last-child):not(.dropdown-toggle) {
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }
    .btn-group > .btn:last-child:not(:first-child),
    .btn-group > .dropdown-toggle:not(:first-child) {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }
    .btn-group > .btn-group {
      float: left;
    }
    .btn-group > .btn-group:not(:first-child):not(:last-child) > .btn {
      border-radius: 0;
    }
    .btn-group > .btn-group:first-child:not(:last-child) > .btn:last-child,
    .btn-group > .btn-group:first-child:not(:last-child) > .dropdown-toggle {
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }
    .btn-group > .btn-group:last-child:not(:first-child) > .btn:first-child {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }
    .btn-group .dropdown-toggle:active,
    .btn-group.open .dropdown-toggle {
      outline: 0;
    }
    .btn-group > .btn + .dropdown-toggle {
      padding-right: 8px;
      padding-left: 8px;
    }
    .btn-group > .btn-lg + .dropdown-toggle {
      padding-right: 12px;
      padding-left: 12px;
    }
    .btn-group.open .dropdown-toggle {
      box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
    }
    .btn-group.open .dropdown-toggle.btn-link {
      box-shadow: none;
    }
    
    </style>
    <script>
    var str = '<div class="btn-group pull-right" style="position: fixed; right: 50px; top: 10px; z-index: 200"><button type="button" class="btn btn-default btn-xs dropdown-toggle" id="allCodeButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-_extension-text-contrast=""><span>Code</span> <span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All Code</a></li><li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li></ul></div>';
    document.write(str);
    </script>
    <script>
    $(document).ready(function () {
      window.initializeCodeFolding("show" === "hide");
    });
    </script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="img/logo.png"></a></li>
<div style="text-align:center">
<li><a href="./index.html">Reproducible Data Analytic <br /> Workflows with Snakemake and `R`</a></li>
</div>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-we-wrote-this-tutorial"><i class="fa fa-check"></i>Why we wrote this tutorial</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#pre-requisite-knowledge"><i class="fa fa-check"></i>Pre-requisite Knowledge</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-needs-to-be-downloaded-installed-for-this-tutorial"><i class="fa fa-check"></i>What Needs to be Downloaded &amp; Installed for this Tutorial</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#template-scripts-and-documents"><i class="fa fa-check"></i>Template Scripts and Documents</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-installation"><i class="fa fa-check"></i>Software Installation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-we-cant-cover"><i class="fa fa-check"></i>What We Can’t Cover</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the Authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#instructional-material"><i class="fa fa-check"></i>Instructional material</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software"><i class="fa fa-check"></i>Software</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#citation"><i class="fa fa-check"></i>Citation</a></li>
</ul></li>
<li class="part"><span><b>I Preliminaries</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Motivating &amp; Rationale</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#a-case-for-reproducibility"><i class="fa fa-check"></i><b>1.1</b> A Case for Reproducibility</a><ul>
<li class="chapter" data-level="1.1.1" data-path="intro.html"><a href="intro.html#how-far-to-go-in-the-quest-for-reproducibility"><i class="fa fa-check"></i><b>1.1.1</b> How far to go in the quest for reproducibility?</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#what-is-snakemake-why-should-you-use-it"><i class="fa fa-check"></i><b>1.2</b> What is <code>Snakemake</code> &amp; Why Should you use it?</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#why-r"><i class="fa fa-check"></i><b>1.3</b> Why <code>R</code>?</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#working-example-replicating-mankiw-romer-and-weils-1992-qje"><i class="fa fa-check"></i><b>1.4</b> Working Example: Replicating Mankiw, Romer and Weil’s 1992 QJE</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#the-way-forward"><i class="fa fa-check"></i><b>1.5</b> The way forward</a><ul>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#exercise-your-own-projects-steps"><i class="fa fa-check"></i>Exercise: Your own project’s steps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="project-organization.html"><a href="project-organization.html"><i class="fa fa-check"></i><b>2</b> Project Organization</a><ul>
<li class="chapter" data-level="" data-path="project-organization.html"><a href="project-organization.html#learning-objectives-1"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="2.1" data-path="project-organization.html"><a href="project-organization.html#subtitle-tbd"><i class="fa fa-check"></i><b>2.1</b> Subtitle TBD</a></li>
<li class="chapter" data-level="2.2" data-path="project-organization.html"><a href="project-organization.html#project-organization-i-separating-inputs-and-outputs"><i class="fa fa-check"></i><b>2.2</b> Project Organization I: Separating Inputs and Outputs</a></li>
<li class="chapter" data-level="2.3" data-path="project-organization.html"><a href="project-organization.html#project-structure-ii-separating-logical-chunks-of-the-project"><i class="fa fa-check"></i><b>2.3</b> Project Structure II: Separating Logical Chunks of the Project</a><ul>
<li class="chapter" data-level="2.3.1" data-path="project-organization.html"><a href="project-organization.html#aside-even-deeper-sub-folders"><i class="fa fa-check"></i><b>2.3.1</b> Aside: Even Deeper Sub-folders</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="project-organization.html"><a href="project-organization.html#project-structure-iii-separating-input-parameters-from-code"><i class="fa fa-check"></i><b>2.4</b> Project Structure III: Separating Input Parameters from Code</a></li>
</ul></li>
<li class="part"><span><b>II Basic Snakemake Workflows</b></span></li>
<li class="chapter" data-level="3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html"><i class="fa fa-check"></i><b>3</b> Initial Steps with Snakemake</a><ul>
<li class="chapter" data-level="3.1" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#writing-our-first-rule"><i class="fa fa-check"></i><b>3.1</b> Writing Our First Rule</a></li>
<li class="chapter" data-level="3.2" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#executing-a-rule"><i class="fa fa-check"></i><b>3.2</b> Executing a Rule</a></li>
<li class="chapter" data-level="3.3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#first-steps-in-the-mrw-pipeline"><i class="fa fa-check"></i><b>3.3</b> First Steps in the MRW Pipeline</a><ul>
<li class="chapter" data-level="3.3.1" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#using-the-rscript-command-to-execute-r-scripts"><i class="fa fa-check"></i><b>3.3.1</b> Using the <code>Rscript</code> command to execute R scripts</a></li>
<li class="chapter" data-level="3.3.2" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#the-input-and-output-arguments"><i class="fa fa-check"></i><b>3.3.2</b> The <code>input</code> and <code>output</code> arguments</a></li>
<li class="chapter" data-level="3.3.3" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#a-rule-to-rename-variables."><i class="fa fa-check"></i><b>3.3.3</b> A rule to rename variables.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#no-redundant-executions"><i class="fa fa-check"></i><b>3.4</b> No Redundant Executions</a></li>
<li class="chapter" data-level="3.5" data-path="initial-steps-with-snakemake.html"><a href="initial-steps-with-snakemake.html#our-workflow-in-graphs"><i class="fa fa-check"></i><b>3.5</b> Our Workflow in Graphs</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html"><i class="fa fa-check"></i><b>4</b> Working With Multiple Rules</a><ul>
<li class="chapter" data-level="4.1" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#creating-a-second-rule"><i class="fa fa-check"></i><b>4.1</b> Creating a Second Rule</a></li>
<li class="chapter" data-level="4.2" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#rule-order-matters"><i class="fa fa-check"></i><b>4.2</b> Rule Order Matters</a></li>
<li class="chapter" data-level="4.3" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#dependencies-between-rules"><i class="fa fa-check"></i><b>4.3</b> Dependencies Between Rules</a></li>
<li class="chapter" data-level="4.4" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#clean-rules"><i class="fa fa-check"></i><b>4.4</b> Clean Rules</a></li>
<li class="chapter" data-level="4.5" data-path="working-with-multiple-rules.html"><a href="working-with-multiple-rules.html#our-workflow-in-graphs-1"><i class="fa fa-check"></i><b>4.5</b> Our Workflow in Graphs</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="target-rules.html"><a href="target-rules.html"><i class="fa fa-check"></i><b>5</b> Target Rules</a><ul>
<li class="chapter" data-level="5.1" data-path="target-rules.html"><a href="target-rules.html#where-we-are-now"><i class="fa fa-check"></i><b>5.1</b> Where we are now?</a></li>
<li class="chapter" data-level="5.2" data-path="target-rules.html"><a href="target-rules.html#how-snakemake-determines-the-build-order-when-multiple-rules-are-present"><i class="fa fa-check"></i><b>5.2</b> How Snakemake determines the build order when multiple rules are present</a></li>
<li class="chapter" data-level="5.3" data-path="target-rules.html"><a href="target-rules.html#dedicated-target-rules-to-execute-multiple-rules"><i class="fa fa-check"></i><b>5.3</b> Dedicated target rules to execute multiple rules</a><ul>
<li class="chapter" data-level="" data-path="target-rules.html"><a href="target-rules.html#exercise-using-target-rules"><i class="fa fa-check"></i>Exercise: Using target rules</a></li>
<li class="chapter" data-level="" data-path="target-rules.html"><a href="target-rules.html#solution-2"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="target-rules.html"><a href="target-rules.html#target-rules-can-do-more-for-us"><i class="fa fa-check"></i><b>5.4</b> Target rules can do more for us</a></li>
</ul></li>
<li class="part"><span><b>III Minimizing Repetition, Maximizing Generalizability</b></span></li>
<li class="chapter" data-level="6" data-path="wildcards.html"><a href="wildcards.html"><i class="fa fa-check"></i><b>6</b> Wildcards</a><ul>
<li class="chapter" data-level="6.1" data-path="wildcards.html"><a href="wildcards.html#the-starting-point-of-our-snakefile"><i class="fa fa-check"></i><b>6.1</b> The starting point of our Snakefile</a></li>
<li class="chapter" data-level="6.2" data-path="wildcards.html"><a href="wildcards.html#wildcards-tidying"><i class="fa fa-check"></i><b>6.2</b> Using wildcards to tidy up our code</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="wildcards-in-target-rules.html"><a href="wildcards-in-target-rules.html"><i class="fa fa-check"></i><b>7</b> Wildcards in Target Rules</a><ul>
<li class="chapter" data-level="7.1" data-path="wildcards-in-target-rules.html"><a href="wildcards-in-target-rules.html#the-expand-function"><i class="fa fa-check"></i><b>7.1</b> The <code>expand()</code> function</a></li>
<li class="chapter" data-level="7.2" data-path="wildcards-in-target-rules.html"><a href="wildcards-in-target-rules.html#using-expand-with-a-list"><i class="fa fa-check"></i><b>7.2</b> Using <code>expand()</code> with a List</a></li>
<li class="chapter" data-level="7.3" data-path="wildcards-in-target-rules.html"><a href="wildcards-in-target-rules.html#estimating-a-new-model"><i class="fa fa-check"></i><b>7.3</b> Estimating a New Model</a></li>
<li class="chapter" data-level="7.4" data-path="wildcards-in-target-rules.html"><a href="wildcards-in-target-rules.html#expanding-multiple-wildcards"><i class="fa fa-check"></i><b>7.4</b> Expanding Multiple Wildcards</a><ul>
<li class="chapter" data-level="7.4.1" data-path="wildcards-in-target-rules.html"><a href="wildcards-in-target-rules.html#unifying-the-target-rules"><i class="fa fa-check"></i><b>7.4.1</b> Unifying the Target Rules</a></li>
<li class="chapter" data-level="7.4.2" data-path="wildcards-in-target-rules.html"><a href="wildcards-in-target-rules.html#unifying-how-regression-outputs-are-built"><i class="fa fa-check"></i><b>7.4.2</b> Unifying How Regression Outputs are Built</a></li>
<li class="chapter" data-level="7.4.3" data-path="wildcards-in-target-rules.html"><a href="wildcards-in-target-rules.html#running-the-new-rule"><i class="fa fa-check"></i><b>7.4.3</b> Running the New Rule</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="wildcards-in-target-rules.html"><a href="wildcards-in-target-rules.html#our-workflow-in-graphs-2"><i class="fa fa-check"></i><b>7.5</b> Our Workflow in Graphs</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html"><i class="fa fa-check"></i><b>8</b> Automating List Construction for Wildcard Expansion</a><ul>
<li class="chapter" data-level="8.1" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#learning-objectives-2"><i class="fa fa-check"></i><b>8.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="8.2" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#state-of-the-snakefile"><i class="fa fa-check"></i><b>8.2</b> State of the Snakefile</a></li>
<li class="chapter" data-level="8.3" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#the-glob_wildcards-function"><i class="fa fa-check"></i><b>8.3</b> The <code>glob_wildcards</code> Function</a></li>
<li class="chapter" data-level="8.4" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#looking-at-the-dag-redux"><i class="fa fa-check"></i><b>8.4</b> Looking at the DAG (redux)</a><ul>
<li class="chapter" data-level="" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#exercise-exploring-glob_wildcards"><i class="fa fa-check"></i>Exercise: Exploring glob_wildcards()</a></li>
<li class="chapter" data-level="8.4.1" data-path="automating-list-construction-for-wildcard-expansion.html"><a href="automating-list-construction-for-wildcard-expansion.html#solution-4"><i class="fa fa-check"></i><b>8.4.1</b> Solution</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Bringing Many Outputs Together</b></span></li>
<li class="chapter" data-level="9" data-path="make-tables.html"><a href="make-tables.html"><i class="fa fa-check"></i><b>9</b> Make Tables</a><ul>
<li class="chapter" data-level="9.1" data-path="make-tables.html"><a href="make-tables.html#the-state-of-the-snakefile"><i class="fa fa-check"></i><b>9.1</b> The State of the Snakefile</a></li>
<li class="chapter" data-level="9.2" data-path="make-tables.html"><a href="make-tables.html#building-a-single-table"><i class="fa fa-check"></i><b>9.2</b> Building a single table</a></li>
<li class="chapter" data-level="9.3" data-path="make-tables.html"><a href="make-tables.html#building-all-tables-at-once"><i class="fa fa-check"></i><b>9.3</b> Building all tables at once</a><ul>
<li class="chapter" data-level="" data-path="make-tables.html"><a href="make-tables.html#exercise"><i class="fa fa-check"></i>Exercise</a></li>
<li class="chapter" data-level="" data-path="make-tables.html"><a href="make-tables.html#solution-5"><i class="fa fa-check"></i>Solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html"><i class="fa fa-check"></i><b>10</b> One rule to rule them all</a><ul>
<li class="chapter" data-level="10.1" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#the-state-of-the-snakefile-1"><i class="fa fa-check"></i><b>10.1</b> The State of the Snakefile</a></li>
<li class="chapter" data-level="10.2" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#creating-an-all-target-rule"><i class="fa fa-check"></i><b>10.2</b> Creating an <code>all</code> target rule</a></li>
<li class="chapter" data-level="10.3" data-path="one-rule-to-rule-them-all.html"><a href="one-rule-to-rule-them-all.html#concluding-remarks"><i class="fa fa-check"></i><b>10.3</b> Concluding Remarks</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html"><i class="fa fa-check"></i><b>11</b> Adding Papers and Slides to a Snakemake Workflow</a><ul>
<li class="chapter" data-level="11.1" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#learning-objectives-3"><i class="fa fa-check"></i><b>11.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="11.2" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#state-of-our-snakefile"><i class="fa fa-check"></i><b>11.2</b> State of Our Snakefile</a></li>
<li class="chapter" data-level="11.3" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#where-we-are"><i class="fa fa-check"></i><b>11.3</b> Where We Are</a></li>
<li class="chapter" data-level="11.4" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#building-a-paper"><i class="fa fa-check"></i><b>11.4</b> Building a Paper</a></li>
<li class="chapter" data-level="11.5" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#integrating-build_paper-output-into-all"><i class="fa fa-check"></i><b>11.5</b> Integrating <code>build_paper</code> output into <code>all</code></a></li>
<li class="chapter" data-level="11.6" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#making-paper.pdf-easier-to-find"><i class="fa fa-check"></i><b>11.6</b> Making <code>paper.pdf</code> Easier to Find</a><ul>
<li class="chapter" data-level="11.6.1" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#exercise-adding-a-slide-deck."><i class="fa fa-check"></i><b>11.6.1</b> Exercise: Adding a Slide Deck.</a></li>
<li class="chapter" data-level="11.6.2" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#exercise-solution"><i class="fa fa-check"></i><b>11.6.2</b> Exercise Solution</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="adding-papers-and-slides-to-a-snakemake-workflow.html"><a href="adding-papers-and-slides-to-a-snakemake-workflow.html#final-thoughts"><i class="fa fa-check"></i><b>11.7</b> Final Thoughts</a></li>
</ul></li>
<li class="part"><span><b>V Decorating Snakemake Workflows</b></span></li>
<li class="chapter" data-level="12" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html"><i class="fa fa-check"></i><b>12</b> Logging Output and Errors</a><ul>
<li class="chapter" data-level="12.1" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#logging-output"><i class="fa fa-check"></i><b>12.1</b> Logging Output</a></li>
<li class="chapter" data-level="12.2" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#logging-output-and-errors-in-one-file"><i class="fa fa-check"></i><b>12.2</b> Logging Output and Errors in One File</a><ul>
<li class="chapter" data-level="" data-path="logging-output-and-errors.html"><a href="logging-output-and-errors.html#exercise-logging-all-r-scripts"><i class="fa fa-check"></i>Exercise: Logging all R Scripts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="adding-parameters.html"><a href="adding-parameters.html"><i class="fa fa-check"></i><b>13</b> Adding Parameters</a><ul>
<li class="chapter" data-level="13.1" data-path="adding-parameters.html"><a href="adding-parameters.html#motivating-example-constructing-a-regression-table-from-ols-results"><i class="fa fa-check"></i><b>13.1</b> Motivating Example: Constructing a Regression Table from OLS Results</a></li>
<li class="chapter" data-level="13.2" data-path="adding-parameters.html"><a href="adding-parameters.html#creating-a-rule-with-params"><i class="fa fa-check"></i><b>13.2</b> Creating a Rule with <code>params</code></a><ul>
<li class="chapter" data-level="" data-path="adding-parameters.html"><a href="adding-parameters.html#exercise-building-table-2"><i class="fa fa-check"></i>Exercise: Building Table 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="config-files.html"><a href="config-files.html"><i class="fa fa-check"></i><b>14</b> Config Files</a><ul>
<li class="chapter" data-level="14.1" data-path="config-files.html"><a href="config-files.html#the-config.yaml-filepath"><i class="fa fa-check"></i><b>14.1</b> The <code>config.yaml</code> filepath</a></li>
<li class="chapter" data-level="14.2" data-path="config-files.html"><a href="config-files.html#using-paths-from-the-config-file"><i class="fa fa-check"></i><b>14.2</b> Using paths from the config file</a><ul>
<li class="chapter" data-level="" data-path="config-files.html"><a href="config-files.html#exercise-using-config-files"><i class="fa fa-check"></i>Exercise: Using Config Files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="self-documenting-help.html"><a href="self-documenting-help.html"><i class="fa fa-check"></i><b>15</b> Self Documenting Help</a><ul>
<li class="chapter" data-level="15.1" data-path="self-documenting-help.html"><a href="self-documenting-help.html#our-commenting-syle"><i class="fa fa-check"></i><b>15.1</b> Our Commenting Syle</a></li>
<li class="chapter" data-level="15.2" data-path="self-documenting-help.html"><a href="self-documenting-help.html#adding-further-comments"><i class="fa fa-check"></i><b>15.2</b> Adding Further Comments</a><ul>
<li class="chapter" data-level="" data-path="self-documenting-help.html"><a href="self-documenting-help.html#exercise-adding-comments"><i class="fa fa-check"></i>Exercise: Adding Comments</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="self-documenting-help.html"><a href="self-documenting-help.html#a-help-rule"><i class="fa fa-check"></i><b>15.3</b> A <code>help</code> Rule</a><ul>
<li><a href="self-documenting-help.html#exercise-saving-help-output-to-file">Exercise: Saving <code>help</code> output to file</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html"><i class="fa fa-check"></i><b>16</b> Subworkflows: Divide and Conquer</a><ul>
<li class="chapter" data-level="16.1" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#subworkflow-basics"><i class="fa fa-check"></i><b>16.1</b> Subworkflow Basics</a></li>
<li class="chapter" data-level="16.2" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#subworkflow-dependencies"><i class="fa fa-check"></i><b>16.2</b> Subworkflow dependencies</a><ul>
<li class="chapter" data-level="" data-path="subworkflows-divide-and-conquer.html"><a href="subworkflows-divide-and-conquer.html#exercise-more-subworkflows"><i class="fa fa-check"></i>Exercise: More Subworkflows</a></li>
<li><a href="subworkflows-divide-and-conquer.html#guided-exercise-help-rules-with-subworkflows">Guided Exercise: <code>help</code> rules with subworkflows</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VI Putting Workflows in a Box</b></span></li>
<li class="chapter" data-level="17" data-path="package-dependencies-with-renv.html"><a href="package-dependencies-with-renv.html"><i class="fa fa-check"></i><b>17</b> Package Dependencies with <code>renv</code></a></li>
<li class="chapter" data-level="18" data-path="containers.html"><a href="containers.html"><i class="fa fa-check"></i><b>18</b> Containers</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="installation-guide.html"><a href="installation-guide.html"><i class="fa fa-check"></i><b>A</b> Installation Guide</a><ul>
<li class="chapter" data-level="A.1" data-path="installation-guide.html"><a href="installation-guide.html#windows"><i class="fa fa-check"></i><b>A.1</b> Windows</a><ul>
<li class="chapter" data-level="A.1.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal"><i class="fa fa-check"></i><b>A.1.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.1.2" data-path="installation-guide.html"><a href="installation-guide.html#python"><i class="fa fa-check"></i><b>A.1.2</b> Python</a></li>
<li class="chapter" data-level="" data-path="installation-guide.html"><a href="installation-guide.html#installing-snakemake"><i class="fa fa-check"></i>Installing Snakemake</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="installation-guide.html"><a href="installation-guide.html#mac"><i class="fa fa-check"></i><b>A.2</b> Mac</a><ul>
<li class="chapter" data-level="A.2.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal-1"><i class="fa fa-check"></i><b>A.2.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.2.2" data-path="installation-guide.html"><a href="installation-guide.html#python-1"><i class="fa fa-check"></i><b>A.2.2</b> Python</a></li>
<li class="chapter" data-level="" data-path="installation-guide.html"><a href="installation-guide.html#installing-snakemake-1"><i class="fa fa-check"></i>Installing Snakemake</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="installation-guide.html"><a href="installation-guide.html#linux-ubuntu"><i class="fa fa-check"></i><b>A.3</b> Linux / Ubuntu</a><ul>
<li class="chapter" data-level="A.3.1" data-path="installation-guide.html"><a href="installation-guide.html#bash-terminal-2"><i class="fa fa-check"></i><b>A.3.1</b> Bash terminal</a></li>
<li class="chapter" data-level="A.3.2" data-path="installation-guide.html"><a href="installation-guide.html#python-2"><i class="fa fa-check"></i><b>A.3.2</b> Python</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>B</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.comlachlandeer/snakemake-econ-r/" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible Data Analytic Workflows with Snakemake and <code>R</code></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="working-with-multiple-rules" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Working With Multiple Rules</h1>
<div class="unnumbered objectives">
<h3 id="overview-1" class="unnumbered">Overview</h3>
<p><strong>Questions</strong></p>
<ul>
<li>How does Snakemake link rules together?</li>
<li>How does Snakemake know in which order to execute rules?</li>
<li>How can we delete project output and build our project from scratch?</li>
</ul>
<p><strong>Objectives</strong></p>
<ul>
<li>Explain how Snakemake rules depend on each other</li>
<li>Practice writing Snakemake rules</li>
<li>Explain what a <code>clean</code> rule is and why we use use them</li>
</ul>
</div>
<div class="unnumbered prereq">
<h3 id="snakefile-status" class="unnumbered">Snakefile Status</h3>
<p>At the end of the previous Chapter, our Snakefile has the following contents:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb48-1"><a href="working-with-multiple-rules.html#cb48-1"></a><span class="ex">rule</span> rename_vars:</span>
<span id="cb48-2"><a href="working-with-multiple-rules.html#cb48-2"></a>    <span class="ex">input</span>:</span>
<span id="cb48-3"><a href="working-with-multiple-rules.html#cb48-3"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/rename_variables.R&quot;</span>,</span>
<span id="cb48-4"><a href="working-with-multiple-rules.html#cb48-4"></a>        <span class="ex">data</span>   = <span class="st">&quot;src/data/mrw.dta&quot;</span></span>
<span id="cb48-5"><a href="working-with-multiple-rules.html#cb48-5"></a>    <span class="ex">output</span>:</span>
<span id="cb48-6"><a href="working-with-multiple-rules.html#cb48-6"></a>        <span class="ex">data</span> = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span></span>
<span id="cb48-7"><a href="working-with-multiple-rules.html#cb48-7"></a>    <span class="ex">shell</span>:</span>
<span id="cb48-8"><a href="working-with-multiple-rules.html#cb48-8"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb48-9"><a href="working-with-multiple-rules.html#cb48-9"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb48-10"><a href="working-with-multiple-rules.html#cb48-10"></a><span class="st">            --out {output.data}&quot;</span></span></code></pre></div>
<p>At the beginning of each chapter, we will have a copy of the <code>Snakefile</code> contents of the previous chapter.
This will be our starting point.</p>
</div>
<p>In the last chapter we learned how to write and execute a single Snakemake rule.
Real world research workflow typically have more than one step, and require many scripts to be executed sequentially.
Next, we will learn how to work with several rules and understand how rules interact with each other.</p>
<div id="creating-a-second-rule" class="section level2">
<h2><span class="header-section-number">4.1</span> Creating a Second Rule</h2>
<p>The second step in our data management is to create additional variables we will use in our regression analysis.
The script <code>gen_reg_vars.R</code> in the <code>src/data-management</code> folder does this for us.
We are going to build a rule called <code>gen_regression_vars</code> to run this script using Snakemake.
To investigate what the inputs and outputs might be in this new rule, let’s look at the help output from the <code>gen_reg_vars.R</code> script:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode bash fold-show"><code class="sourceCode bash"><span id="cb49-1"><a href="working-with-multiple-rules.html#cb49-1"></a>$ <span class="ex">Rscript</span> src/data-management/gen_reg_vars.R --help</span></code></pre></div>
<p>The following is returned to screen:</p>
<pre class="out fold-show"><code>Options:
    -d CHARACTER, --data=CHARACTER
        a csv file name

    -p NUMERIC, --param=NUMERIC
        Solow`s Constant, as a numeric [default = 0.05]

    -o CHARACTER, --out=CHARACTER
        output file name [default = out.csv]

    -h, --help
        Show this help message and exit</code></pre>
<p>We see that script expects three arguments:</p>
<ul>
<li><code>--data</code>, the file path of the input file, which is suggested to be a csv.</li>
<li><code>--out</code>, the file path of the output file.</li>
<li><code>--param</code>, Solow’s constant which defaults to 0.05, the value used in <span class="citation">Mankiw, Romer, and Weil (<a href="#ref-mrw" role="doc-biblioref">1992</a>)</span>.
We can safely ignore this for now.</li>
</ul>
<p>Let’s construct a new rule, called <code>gen_regression_vars</code> that can run this script.
We place it <strong>above</strong> the rule <code>rename_vars</code></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode bash fold-show"><code class="sourceCode bash"><span id="cb51-1"><a href="working-with-multiple-rules.html#cb51-1"></a><span class="ex">rule</span> gen_regression_vars:</span>
<span id="cb51-2"><a href="working-with-multiple-rules.html#cb51-2"></a>    <span class="ex">input</span>:</span>
<span id="cb51-3"><a href="working-with-multiple-rules.html#cb51-3"></a>        <span class="ex">script</span> = <span class="st">&quot;src/data-management/gen_reg_vars.R&quot;</span>,</span>
<span id="cb51-4"><a href="working-with-multiple-rules.html#cb51-4"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_renamed.csv&quot;</span></span>
<span id="cb51-5"><a href="working-with-multiple-rules.html#cb51-5"></a>    <span class="ex">output</span>:</span>
<span id="cb51-6"><a href="working-with-multiple-rules.html#cb51-6"></a>        <span class="ex">data</span>   = <span class="st">&quot;out/data/mrw_complete.csv&quot;</span></span>
<span id="cb51-7"><a href="working-with-multiple-rules.html#cb51-7"></a>    <span class="ex">shell</span>:</span>
<span id="cb51-8"><a href="working-with-multiple-rules.html#cb51-8"></a>        <span class="st">&quot;Rscript {input.script} \</span></span>
<span id="cb51-9"><a href="working-with-multiple-rules.html#cb51-9"></a><span class="st">            --data {input.data} \</span></span>
<span id="cb51-10"><a href="working-with-multiple-rules.html#cb51-10"></a><span class="st">            --out {output.data}&quot;</span></span></code></pre></div>
<p>Note that when the <code>--help</code> suggests there is a default,
<strong>and</strong> we want to use that default we do not have to use this option in our <code>Rscript</code> call.</p>
<p>To find out whether Snakemake wants to run any of the rules, let’s use the <code>--summary</code> option:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode bash fold-show"><code class="sourceCode bash"><span id="cb52-1"><a href="working-with-multiple-rules.html#cb52-1"></a>$ <span class="ex">snakemake</span> --summary</span></code></pre></div>
<p>which yields the following console output:</p>
<pre class="out fold-show"><code>Building DAG of jobs...
output_file                    date                     rule                  version   log-file(s) status     plan
out/data/mrw_complete.csv   -                           gen_regression_vars     -                   missing update pending
out/data/mrw_renamed.csv    Fri Jan 11 13:40:07 2019    rename_vars             -                   ok          no update</code></pre>
<p>Snakemake knows that the output of the <code>rename_vars</code> rule is up to date.
We can see this by looking at the <code>status</code> of the output file <code>out/data/mrw_renamed.csv</code> which is <code>ok</code>.
The status is <code>ok</code> because none of the inputs to <code>rename_vars</code> has changed since we last ran Snakemake.
Further, we can see that <code>plan</code> takes the value <code>no update</code>.
This means Snakemake won’t build this file the next time it runs.</p>
<p>Looking at the first line, which displays the information for our new rule <code>gen_regression_vars</code> we see that the
status of it’s output <code>out/data/mrw_complete.csv</code> is <code>missing</code>.
This means that Snakemake does not see this file in the output directory, which makes sense as we have not run this rule before.
We also see that <code>plan</code> takes the value <code>update pending</code>.
Because the output is <code>missing</code>, Snakemake will execute this rule the next time it runs.
This will create the file <code>out/data/mrw_complete.csv</code>, which updates it (in this case the update is going from not there to being there).</p>
<p>Let’s run Snakemake to build our new file:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode bash fold-show"><code class="sourceCode bash"><span id="cb54-1"><a href="working-with-multiple-rules.html#cb54-1"></a>$ <span class="ex">snakemake</span> --cores 1</span></code></pre></div>
<p>When we look at our output directory</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode bash fold-show"><code class="sourceCode bash"><span id="cb55-1"><a href="working-with-multiple-rules.html#cb55-1"></a>$ <span class="fu">ls</span> out/data/</span></code></pre></div>
<p>we see that the second output file has been created.</p>
<pre class="out fold-show"><code>mrw_complete.csv  mrw_renamed.csv</code></pre>
<p>Now if we run the <code>--summary</code> command again, we see:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode bash fold-show"><code class="sourceCode bash"><span id="cb57-1"><a href="working-with-multiple-rules.html#cb57-1"></a>$ <span class="ex">snakemake</span> --summary</span></code></pre></div>
<p>which yields:</p>
<pre class="out fold-show"><code>Building DAG of jobs...
output_file                    date                     rule                  version   log-file(s) status     plan
out/data/mrw_complete.csv   Fri Jan 11 13:45:07 2019    gen_regression_vars     -                   ok          no update
out/data/mrw_renamed.csv    Fri Jan 11 13:40:07 2019    rename_vars             -                   ok          no update</code></pre>
<p>Now we see that both the output files are <code>ok</code> and have <code>no update</code> in the <code>plan</code> column.
This means that if we were to run Snakemake again, it will not execute any of the rules.</p>
<p>To see that this is true:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode bash fold-show"><code class="sourceCode bash"><span id="cb59-1"><a href="working-with-multiple-rules.html#cb59-1"></a>$ <span class="ex">snakemake</span> --cores 1</span></code></pre></div>
<p>which yields the following console output:</p>
<pre class="out fold-show"><code>Building DAG of jobs...
Nothing to be done.</code></pre>
<p>as expected.</p>
</div>
<div id="rule-order-matters" class="section level2">
<h2><span class="header-section-number">4.2</span> Rule Order Matters</h2>
<p>In the text above we asked you to put the rule <code>gen_regression_vars</code> above the rule <code>rename_vars</code>.
What would have happened if we put it underneath?</p>
<p>If you try it, what you would find when you run <code>snakemake --summary</code> is</p>
<pre class="out fold-show"><code>Building DAG of jobs...
output_file                    date                     rule                  version   log-file(s) status     plan
out/data/mrw_renamed.csv    Fri Jan 11 13:40:07 2019    rename_vars             -                   ok          no update</code></pre>
<p>which has no information about the new rule <code>gen_regression vars</code>.
The question is why?</p>
<p>When you run a Snakemake command without adding any information about the rule you are interested in will look for the first rule it finds in the <code>Snakefile</code>.
If our rules are in opposite order, Snakemake finds <code>rename_vars</code> first (it looks from top to bottom) and thus reports information about this rule.
To find out information about the second rule in the file, we would need to run the summary command as:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode bash fold-show"><code class="sourceCode bash"><span id="cb62-1"><a href="working-with-multiple-rules.html#cb62-1"></a>$ <span class="ex">snakemake</span> --summary gen_regression_vars</span></code></pre></div>
<p>And we would get information about the output of <code>gen_regression_vars</code> <em>and</em> <code>rename_vars</code>.
If we wanted to run the rule <code>gen_regression_vars</code>, we would then execute Snakemake as:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode bash fold-show"><code class="sourceCode bash"><span id="cb63-1"><a href="working-with-multiple-rules.html#cb63-1"></a>$ <span class="ex">snakemake</span> --cores 1 gen_regression_vars</span></code></pre></div>
<p>The main takeaway here is that it is good practice to put rules that are further along the analysis pipeline higher up the <code>Snakefile</code>.
Make sure before you proceed to the next section, <code>gen_regression_vars</code> is above <code>rename_vars</code> so you get the same output as the text.</p>
</div>
<div id="dependencies-between-rules" class="section level2">
<h2><span class="header-section-number">4.3</span> Dependencies Between Rules</h2>
<p>Our two rules have a dependent relationship.
To be precise, <code>gen_regression_vars</code> depends on the rule <code>rename_vars</code>.
This is because the output of <code>rename_vars</code>, <code>out/data/mrw_renamed.csv</code> is an input to the rule <code>gen_regression vars</code>.
Now that we have two rules and we as researchers know there’s a dependency between them,
we want to know whether Snakemake is also aware of the dependency.</p>
<p>How can we check this?
The following argument should hold:
If when we update an input of <code>rename_vars</code>, this would potentially change it’s output file <code>mrw_renamed.csv</code>.
This means that Snakemake should want to run the rule <code>rename_vars</code> on it’s next run.
<code>mrw_renamed.csv</code> is an input to the rule <code>gen_regression_vars</code>.
If an input to this rule changes, so might it’s output.
Then Snakemake should <strong>also</strong> want to run <code>gen_regression vars</code> the next time it is run too.</p>
<p>Let’s see whether all of this is in fact true.
Using our trick from the last chapter, let’s update the time-stamp of <code>src/data-management/rename_variables.R</code>:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode bash fold-show"><code class="sourceCode bash"><span id="cb64-1"><a href="working-with-multiple-rules.html#cb64-1"></a>$ <span class="fu">touch</span> src/data-management/rename_variables.R</span></code></pre></div>
<p>The input file is now newer than the output.
This is implicitly the same as having new content.
Now let’s check out the summary of Snakemake:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode bash fold-show"><code class="sourceCode bash"><span id="cb65-1"><a href="working-with-multiple-rules.html#cb65-1"></a>$ <span class="ex">snakemake</span> --summary</span></code></pre></div>
<p>which prints the following to screen:</p>
<pre class="out fold-show"><code>Building DAG of jobs...
output_file                    date                     rule                  version   log-file(s) status                plan
out/data/mrw_complete.csv   Fri Jan 11 13:45:07 2019    gen_regression_vars     -                   ok                    update pending
out/data/mrw_renamed.csv    Fri Jan 11 13:40:07 2019    rename_vars             -                   updated input files   update pending</code></pre>
<p>We see that for the rule <code>rename_vars</code> the status has changed to <code>updated input files</code>.
This makes sense because it is exactly what happened.
As a result, <code>plan</code> changes to update pending - meaning Snakemake will execute this rule the next time it runs.
Next, we look at the rule <code>gen_regression_vars</code>.
<code>status</code> is still <code>ok</code>, but we see that <code>plan</code> is also <code>update_pending</code> so this rule will <em>also</em> be executed next time Snakemake runs.</p>
<p>This is exactly what we had hoped - Snakemake detected the relationship between the two rules.
It also uses this relationship when deciding its build plan,
tracing out what rules deeper down the workflow are impacted by a change in an earlier step.
This is a <strong>big</strong> advantage to us as researchers - now we don’t have to manually track the depedencies between workflows.
We, as authors and as researchers, feel that this benefit <em>cannot be understated</em>.</p>
<p>Let’s run Snakemake once more to get the new outputs:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode bash fold-show"><code class="sourceCode bash"><span id="cb67-1"><a href="working-with-multiple-rules.html#cb67-1"></a>$ <span class="ex">snakemake</span> --cores 1</span></code></pre></div>
<p>which prints the following to screen:</p>
<pre class="out fold-show"><code>Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 1 (use --cores to define parallelism)
Rules claiming more threads will be scaled down.
Job counts:
        count   jobs
        1       gen_regression_vars
        1       rename_vars
        2

...

Finished job 0.
2 of 2 steps (100%) done</code></pre>
<p>and updates our output files.</p>
<div class="unnumbered challenge">
<h3 id="exercise-creating-rules" class="unnumbered">Exercise: Creating Rules</h3>
<p><span class="citation">Mankiw, Romer, and Weil (<a href="#ref-mrw" role="doc-biblioref">1992</a>)</span> estimate the Solow model for three subsets of data.
The R script <code>src/analysis/estimate_ols.R</code> will estimate a OLS model for a given dataset when you provide the necessary inputs.</p>
<ul>
<li>The script expects an OLS specification.
You can point to the basic OLS specification from <span class="citation">Mankiw, Romer, and Weil (<a href="#ref-mrw" role="doc-biblioref">1992</a>)</span> in <code>src/model-specs/model_solow.json</code>.</li>
<li>You will find the necessary data subsetting conditions in <code>src/data-specs</code>.</li>
</ul>
<p>The goal is to construct one rule for each subset of the data.</p>
<ol style="list-style-type: decimal">
<li>What inputs do you need to provide?</li>
<li>What outputs will be produced?</li>
<li>Write Snakemake rules to estimate the solow model for each subset of data.</li>
</ol>
</div>
<div class="unnumbered answer">
<h3 id="solution" class="unnumbered">Solution</h3>
<ol style="list-style-type: decimal">
<li>What inputs do you need to provide?</li>
</ol>
<ul>
<li><code>--data</code> the file path of a csv dataset as an input. We use the output of our last rule: <code>out/data/mrw_complete.csv</code>.</li>
<li><code>--model</code> the file path of a regression model. We follow the hint and use <code>src/model-specs/model_solow.json</code>.</li>
<li><code>--subset</code> the file path of a sub setting condition. We will use one of the three files in <code>src/data-specs</code> for each rule respectively.</li>
<li><code>--out</code> the file path for the output file.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>What outputs will be produced?</li>
</ol>
<p>One <code>.rds</code> file for each ols model.
This is a <code>R</code> data type appropriate for saving <code>R</code> objects.
The rule therefore outputs one <code>R</code> object containing the regression results for each rule.
Loading the <code>.rds</code> file in another script will allow us later to use the regression results to create regression tables and graphs.</p>
<ol start="3" style="list-style-type: decimal">
<li>Write Snakemake rules to estimate the solow model for each subset of data.</li>
</ol>
<p>Incorporating everything will give us three rules similar to these:</p>
<pre class="out"><code>rule solow_intermediate:
    input:
        script   = &quot;src/analysis/estimate_ols_model.R&quot;,
        data     = &quot;out/data/mrw_complete.csv&quot;,
        model    = &quot;src/model-specs/model_solow.json&quot;,
        subset   = &quot;src/data-specs/subset_intermediate.json&quot;
    output:
        estimate = &quot;out/analysis/model_solow_subset_intermediate.rds&quot;,
    shell:
        &quot;Rscript {input.script} \
            --data {input.data} \
            --model {input.model} \
            --subset {input.subset} \
            --out {output.estimate}&quot;

rule solow_nonoil:
    input:
        script   = &quot;src/analysis/estimate_ols_model.R&quot;,
        data     = &quot;out/data/mrw_complete.csv&quot;,
        model    = &quot;src/model-specs/model_solow.json&quot;,
        subset   = &quot;src/data-specs/subset_nonoil.json&quot;
    output:
        estimate = &quot;out/analysis/model_solow_subset_nonoil.rds&quot;,
    shell:
        &quot;Rscript {input.script} \
            --data {input.data} \
            --model {input.model} \
            --subset {input.subset} \
            --out {output.estimate}&quot;

rule solow_oecd:
    input:
        script   = &quot;src/analysis/estimate_ols_model.R&quot;,
        data     = &quot;out/data/mrw_complete.csv&quot;,
        model    = &quot;src/model-specs/model_solow.json&quot;,
        subset   = &quot;src/data-specs/subset_oecd.json&quot;
    output:
        estimate = &quot;out/analysis/model_solow_subset_oecd.rds&quot;,
    shell:
        &quot;Rscript {input.script} \
            --data {input.data} \
            --model {input.model} \
            --subset {input.subset} \
            --out {output.estimate}&quot;</code></pre>
<p>If you want to run each of them, you need to run Snakemake three times:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode bash fold-show"><code class="sourceCode bash"><span id="cb70-1"><a href="working-with-multiple-rules.html#cb70-1"></a>$ <span class="ex">snakemake</span> --cores 1 solow_nonoil</span>
<span id="cb70-2"><a href="working-with-multiple-rules.html#cb70-2"></a>$ <span class="ex">snakemake</span> --cores 1 solow_intermediate</span>
<span id="cb70-3"><a href="working-with-multiple-rules.html#cb70-3"></a>$ <span class="ex">snakemake</span> --cores 1 solow_oecd</span></code></pre></div>
<p>Do you remember why?</p>
</div>
</div>
<div id="clean-rules" class="section level2">
<h2><span class="header-section-number">4.4</span> Clean Rules</h2>
<p>We want to end this chapter with an extra rule which will make our life easier down the road.</p>
<p>So far we have built rules to move our replication of <span class="citation">Mankiw, Romer, and Weil (<a href="#ref-mrw" role="doc-biblioref">1992</a>)</span> forward.
As we continue to extend our Snakefile in the coming chapters we might want to be able to delete all of the produced outputs and make sure our projects builds cleanly from start to end.</p>
<p>The manual way to do this is to go to our terminal window and enter the following command each time</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode bash fold-show"><code class="sourceCode bash"><span id="cb71-1"><a href="working-with-multiple-rules.html#cb71-1"></a>$ <span class="fu">rm</span> -rf out/*</span></code></pre></div>
<p>which deletes all contents of the <code>out</code> folder.</p>
<p>To make this task a bit more comfortable, we write a “clean” rule which deletes all contents of the output folder.</p>
<p>We can create a rule called <code>clean</code> at the bottom of our <code>Snakefile</code> that stores the shell command from above:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb72-1"><a href="working-with-multiple-rules.html#cb72-1"></a><span class="ex">rule</span> clean:</span>
<span id="cb72-2"><a href="working-with-multiple-rules.html#cb72-2"></a>    <span class="ex">shell</span>:</span>
<span id="cb72-3"><a href="working-with-multiple-rules.html#cb72-3"></a>        <span class="st">&quot;rm -rf out/*&quot;</span></span></code></pre></div>
<p>Note that this rule has no inputs or outputs.</p>
<p>To use this rule, we enter the following into our terminal:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode bash fold-show"><code class="sourceCode bash"><span id="cb73-1"><a href="working-with-multiple-rules.html#cb73-1"></a>$ <span class="ex">snakemake</span> --cores 1 clean</span></code></pre></div>
<p>Notice that to use the clean rule we had to call the rule name, <code>clean</code>, explicitly.
This is necessary as the rule is at the bottom of our Snakefile.</p>
<p>Now if we look out the output of running the summary call with snakemake, we see the following output:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode bash fold-show"><code class="sourceCode bash"><span id="cb74-1"><a href="working-with-multiple-rules.html#cb74-1"></a><span class="ex">snakemake</span> --summary</span></code></pre></div>
<pre class="out fold-show"><code>Building DAG of jobs...
output_file                                        date   rule  version log-file(s)     status  plan
out/analysis/model_solow_subset_intermediate.rds    -     inter        -                missing update pending
out/analysis/model_solow_subset_nonoil.rds          -     nonoil       -                missing update pending
out/analysis/model_solow_subset_oecd.rds            -     oecd         -                missing update pending
out/data/mrw_complete.csv                           -     gen_regression_vars           missing update pending
out/data/mrw_renamed.csv                            -     rename_vars                   missing update pending</code></pre>
<p>Which reveals Snakemake’s plan the next time its run will be to build all outputs.</p>
<div class="unnumbered challenge">
<h3 id="exercise-creating-cleaning-rules" class="unnumbered">Exercise: Creating Cleaning Rules</h3>
<p>The cleaning rule we just created deletes everything in the <code>out/</code> directory.
Construct rules that would separately clean the <code>out/data/</code> and <code>out/analysis</code> subdirectories.
Why might we want to do this?</p>
</div>
<div class="unnumbered answer">
<h3 id="solution-1" class="unnumbered">Solution</h3>
<p>We only need to change the folders to delete in the shell command.
A solution might look something like this:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode bash fold-show"><code class="sourceCode bash"><span id="cb76-1"><a href="working-with-multiple-rules.html#cb76-1"></a><span class="ex">rule</span> clean_data:</span>
<span id="cb76-2"><a href="working-with-multiple-rules.html#cb76-2"></a>    <span class="ex">shell</span>:</span>
<span id="cb76-3"><a href="working-with-multiple-rules.html#cb76-3"></a>        <span class="st">&quot;rm -rf out/data/*&quot;</span></span>
<span id="cb76-4"><a href="working-with-multiple-rules.html#cb76-4"></a></span>
<span id="cb76-5"><a href="working-with-multiple-rules.html#cb76-5"></a><span class="ex">rule</span> clean_analysis:</span>
<span id="cb76-6"><a href="working-with-multiple-rules.html#cb76-6"></a>    <span class="ex">shell</span>:</span>
<span id="cb76-7"><a href="working-with-multiple-rules.html#cb76-7"></a>        <span class="st">&quot;rm -rf out/analysis/*&quot;</span></span></code></pre></div>
<p>Splitting the clean rule gives us a bit more control on what we want to refresh.
In practice, data cleaning and wrangling can be computationally taxing and take a while to run through.
Later in a project’s life cycle these task’s output will seldomly change.
It can therefore be beneficial and sufficient to only reset only the analysis via a clean rule.</p>
</div>
</div>
<div id="our-workflow-in-graphs-1" class="section level2">
<h2><span class="header-section-number">4.5</span> Our Workflow in Graphs</h2>
<p>In this chapter we created four additional steps, creating the following rules:</p>
<ol style="list-style-type: decimal">
<li><code>gen_regression_vars</code></li>
<li><code>solow_nonoil</code></li>
<li><code>solow_oecd</code></li>
<li><code>solow_intermediate</code></li>
</ol>
<p>The rules <code>rename_vars</code> and <code>gen_regression vars</code> are dependencies of the three solow rules.
But each of the solow rules are currently separate worklows.
This means we have three parallel workflows, as illustrated below:</p>
<p><img src="img/12-multiple-rules/rulegraph-nonoil.png" width="33%" /><img src="img/12-multiple-rules/rulegraph-oecd.png" width="33%" /><img src="img/12-multiple-rules/rulegraph-intermediate.png" width="33%" /></p>
<p>Each of these workflows, that produce one regression each are very similar.
We can see this by looking at the files that each rule uses:</p>
<p><img src="img/12-multiple-rules/filegraph-nonoil.png" width="33%" /><img src="img/12-multiple-rules/filegraph-oecd.png" width="33%" /><img src="img/12-multiple-rules/filegraph-intermediate.png" width="33%" /></p>
<p>The only difference is the <code>model-specs</code> file and the name of the output file.
We will look to exploit this similarity in the next chapter to make our Snakefile look simpler.</p>

</div>
</div>
<h3><span class="header-section-number">B</span> References</h3>
<div id="refs" class="references">
<div id="ref-mrw">
<p>Mankiw, N. Gregory, David Romer, and David N. Weil. 1992. “A Contribution to the Empirics of Economic Growth*.” <em>The Quarterly Journal of Economics</em> 107 (2): 407–37. <a href="https://doi.org/10.2307/2118477">https://doi.org/10.2307/2118477</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="initial-steps-with-snakemake.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="target-rules.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/lachlandeer/snakemake-econ-r/edit/master/12-multiple_rules.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["https://github.com/lachlandeer/snakemake-econ-r/raw/master/12-multiple_rules.Rmd"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
